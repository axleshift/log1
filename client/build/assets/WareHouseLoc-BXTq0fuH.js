import{r as t,_ as ge,u as xe,a as k,R as E,C as je,c as Ce,P as g,d as ve,G as ye,l as $,j as e,k as A,n as O,H as be,A as re}from"./index-B7tt-_z2.js";import{F as U,s as Ne,v as we,l as Se,k as Le}from"./index-Cksx_lIE.js";import{a as T}from"./CButton-DHG-8eSQ.js";import{C as ne,a as oe,b as ie,c as ce}from"./CModalHeader-HJ5CiMFx.js";import{C as le}from"./CModalTitle-CxgbIroD.js";import{C as W}from"./CAlert-CiL0kjf2.js";import{C as de}from"./CForm-Bw0E6oTw.js";import{C as R}from"./CFormInput-CcAoUPm0.js";import{C as G}from"./CContainer-DsR16nVH.js";import{C as Pe}from"./CInputGroup-R3hzUTqx.js";import{C as ke}from"./CInputGroupText-lri4ewp7.js";import{C as Ee}from"./CCard-syAs6zah.js";import{e as se,u as Te,C as ue}from"./DefaultLayout-d5qKowmC.js";import{C as We}from"./CCardBody-BUhd4CpF.js";import{C as Ae,a as Ie,b as ae,c as V,d as Fe,e as _}from"./CTable-BlEzTZBB.js";import{g as Re}from"./getTransitionDurationFromElement-Cpu4p4hx.js";import{C as Me,a as Q}from"./CPaginationItem-DE4JPUqI.js";import"./index.esm-DP2xG5JN.js";import"./1-CpimflZn.js";import"./cil-user-Ddrdy7PS.js";var te=function(s){typeof s=="function"&&s()},He=function(s){s.dispatchEvent(new Event("transitionend"))},Be=function(s,u,b){if(b===void 0&&(b=!0),!b){te(s);return}var x=5,j=Re(u)+x,c=!1,f=function(l){var m=l.target;m===u&&(c=!0,u.removeEventListener("transitionend",f),te(s))};u.addEventListener("transitionend",f),setTimeout(function(){c||He(u)},j)},De=function(s,u){switch(s){case"right":return se(u)?"left":"right";case"left":return se(u)?"right":"left";default:return s}},F=t.forwardRef(function(s,u){var b=s.children,x=s.animation,j=x===void 0?!0:x,c=s.className,f=s.container,l=s.content,m=s.delay,o=m===void 0?0:m,i=s.fallbackPlacements,C=i===void 0?["top","right","bottom","left"]:i,r=s.offset,d=r===void 0?[0,6]:r,n=s.onHide,L=s.onShow,w=s.placement,P=w===void 0?"top":w,N=s.popperConfig,S=s.trigger,h=S===void 0?["hover","focus"]:S,v=s.visible,a=ge(s,["children","animation","className","container","content","delay","fallbackPlacements","offset","onHide","onShow","placement","popperConfig","trigger","visible"]),p=t.useRef(null),y=t.useRef(null),q=xe(u,p),M="tooltip".concat(t.useId()),J=t.useState(!1),H=J[0],Y=J[1],K=t.useState(v),I=K[0],X=K[1],z=Te(),fe=z.initPopper,me=z.destroyPopper,he=z.updatePopper,Z=typeof o=="number"?{show:o,hide:o}:o,ee={modifiers:[{name:"arrow",options:{element:".tooltip-arrow"}},{name:"flip",options:{fallbackPlacements:C}},{name:"offset",options:{offset:d}}],placement:De(P,y.current)},pe=k(k({},ee),typeof N=="function"?N(ee):N);t.useEffect(function(){if(v){B();return}D()},[v]),t.useEffect(function(){if(H&&y.current&&p.current){fe(y.current,p.current,pe),setTimeout(function(){X(!0)},Z.show);return}!H&&y.current&&p.current&&me()},[H]),t.useEffect(function(){!I&&y.current&&p.current&&Be(function(){Y(!1)},p.current)},[I]);var B=function(){Y(!0),L&&L()},D=function(){setTimeout(function(){X(!1),n&&n()},Z.hide)};return t.useEffect(function(){he()},[l]),E.createElement(E.Fragment,null,E.cloneElement(b,k(k(k(k(k({},I&&{"aria-describedby":M}),{ref:y}),(h==="click"||h.includes("click"))&&{onClick:function(){return I?D():B()}}),(h==="focus"||h.includes("focus"))&&{onFocus:function(){return B()},onBlur:function(){return D()}}),(h==="hover"||h.includes("hover"))&&{onMouseEnter:function(){return B()},onMouseLeave:function(){return D()}})),E.createElement(je,{container:f,portal:!0},H&&E.createElement("div",k({className:Ce("tooltip","bs-tooltip-auto",{fade:j,show:I},c),id:M,ref:q,role:"tooltip"},a),E.createElement("div",{className:"tooltip-arrow"}),E.createElement("div",{className:"tooltip-inner"},l))))});F.propTypes={animation:g.bool,children:g.node,container:g.any,content:g.oneOfType([g.string,g.node]),delay:g.oneOfType([g.number,g.shape({show:g.number.isRequired,hide:g.number.isRequired})]),fallbackPlacements:ye,offset:g.any,onHide:g.func,onShow:g.func,placement:g.oneOf(["auto","top","right","bottom","left"]),popperConfig:g.oneOfType([g.func,g.object]),trigger:ve,visible:g.bool};F.displayName="CTooltip";const Ve=({onAddWarehouseLoc:s})=>{const{showSuccess:u,showError:b}=$(),[x,j]=t.useState(!1),[c,f]=t.useState(!1),[l,m]=t.useState(!1),[o,i]=t.useState(null),C={warehouseName:"",address:"",capacity:{totalSpace:0,availableSpace:0,unit:"sqft"}},[r,d]=t.useState(C),n=w=>{const{id:P,value:N}=w.target;d(S=>({...S,[P]:N}))},L=async w=>{var N,S,h,v;if(w.preventDefault(),!w.currentTarget.checkValidity()){w.stopPropagation(),f(!0);return}m(!0);try{const a=JSON.parse(sessionStorage.getItem("user")),p=await O.post("api/v1/warehouseLoc/add",{...r,createdBy:a.email});p.data.success&&(u(p.data.message),s(p.data.data),j(!1),d(C),f(!1))}catch(a){i(((S=(N=a.response)==null?void 0:N.data)==null?void 0:S.message)||"An error occurred"),b(((v=(h=a.response)==null?void 0:h.data)==null?void 0:v.message)||"An error occurred")}finally{m(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs(T,{color:"primary",onClick:()=>j(!0),children:[e.jsx(U,{icon:Ne})," Add Warehouse"]}),e.jsxs(ne,{visible:x,onClose:()=>j(!1),"aria-labelledby":"AddWarehouseModal",children:[e.jsx(oe,{closeButton:!0,children:e.jsx(le,{children:"Add New Warehouse"})}),e.jsxs(ie,{children:[o&&e.jsx(W,{color:"danger",children:o}),e.jsxs(de,{noValidate:!0,validated:c,children:[e.jsx(R,{type:"text",id:"warehouseName",className:"mb-3",placeholder:"Warehouse Name",floatingLabel:"Warehouse Name",onChange:n,value:r.warehouseName,required:!0,feedbackInvalid:"Please enter a warehouse name"}),e.jsx(R,{type:"text",id:"address",className:"mb-3",placeholder:"Address",floatingLabel:"Address",onChange:n,value:r.address,required:!0,feedbackInvalid:"Please enter an address"})]})]}),e.jsxs(ce,{children:[e.jsx(T,{color:"secondary",onClick:()=>{j(!1),d(C),i(null),f(!1)},children:"Cancel"}),e.jsx(T,{color:"primary",onClick:L,disabled:l,children:l?e.jsx(A,{size:"sm"}):"Save"})]})]})]})},_e=({warehouseLoc:s,onDeleteWarehouseLoc:u})=>{const{showSuccess:b,showError:x}=$(),[j,c]=t.useState(!1),[f,l]=t.useState(null),m=async()=>{c(!0);try{const i=await O.patch(`api/v1/warehouseLoc/delete/${s._id}`);i.data.success&&(b(i.data.message),u(s._id),c(!1),l(null))}catch(i){l(i),x(i.message)}finally{c(!1)}};if(f)return e.jsxs(W,{color:"danger",className:"text-center mt-5 w-75 mx-auto",children:["Error: ",f.message]});const o=({icon:i})=>{const[C,r]=t.useState(!1);return e.jsx(U,{icon:i,bounce:C,onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1)})};return e.jsx(e.Fragment,{children:e.jsxs(T,{color:"danger",disabled:j,variant:"outline",onClick:m,className:"me-2",children:[j?e.jsx(A,{size:"sm"}):e.jsx(o,{icon:we})," Delete"]})})},Oe=({warehouseLoc:s,onUpdateWarehouseLoc:u})=>{const b=be(),{showSuccess:x,showErrors:j}=$(),[c,f]=t.useState(!1),[l,m]=t.useState(!1),[o,i]=t.useState(!1),[C,r]=t.useState(null),[d,n]=t.useState(null),[L,w]=t.useState({warehouseName:s.warehouseName,address:s.address}),P=h=>{const{id:v,value:a}=h.target;w(p=>({...p,[v]:a}))},N=async h=>{const a=h.currentTarget.checkValidity();a||(h.preventDefault(),h.stopPropagation()),m(a);const p=b;if(!p){r("User email not found. Please log in again.");return}i(!0);try{const y=await O.put(`api/v1/warehouseLoc/update/${s._id}`,{...L,createdBy:p});y.data.success&&(x(y.data.message),u(y.data.data),setTimeout(()=>{n(null),f(!1),r(null),m(!1)},2e3))}catch(y){r(y.response.data.message),j(y.response.data.message),setTimeout(()=>{r(null)},2e3)}i(!1)},S=({icon:h})=>{const[v,a]=t.useState(!1);return e.jsx(U,{icon:h,bounce:v,onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1)})};return e.jsxs(e.Fragment,{children:[e.jsxs(T,{color:"primary",variant:"outline",disabled:o,onClick:()=>f(!0),className:"me-2",children:[o?e.jsx(A,{size:"sm"}):e.jsx(S,{icon:Se})," Update"]}),e.jsxs(ne,{visible:c,onClose:()=>f(!1),children:[e.jsx(oe,{closeButton:!0,children:e.jsx(le,{children:"Update Warehouse Location"})}),C&&e.jsx(W,{color:"danger",className:"m-3",children:C}),d&&e.jsx(W,{color:"success",className:"m-3",children:d}),e.jsx(ie,{children:e.jsxs(de,{noValidate:!0,validated:l,children:[e.jsx(R,{type:"text",id:"warehouseName",className:"mb-3",placeholder:"Warehouse Name",floatingLabel:"Warehouse Name",onChange:P,value:L.warehouseName,autoComplete:"off",required:!0,feedbackInvalid:"Please enter a warehouse name.",feedbackValid:"Looks good!"}),e.jsx(R,{type:"text",id:"address",className:"mb-3",placeholder:"Address",floatingLabel:"Address",onChange:P,value:L.address,autoComplete:"off",required:!0,feedbackInvalid:"Please enter an address.",feedbackValid:"Looks good!"})]})}),e.jsxs(ce,{children:[e.jsx(T,{color:"secondary",variant:"outline",disabled:o,onClick:()=>{f(!1),r(null),m(!1)},children:o?e.jsx(A,{size:"sm",color:"secondary"}):"Cancel"}),e.jsx(T,{color:"primary",variant:"outline",disabled:o,onClick:N,children:o?e.jsx(A,{size:"sm",color:"success"}):"Update"})]})]})]})},Ue=({warehouseLoc:s,loading:u,error:b,onDeleteWarehouseLoc:x,onUpdateWarehouseLoc:j})=>{const[c,f]=t.useState(""),[l,m]=t.useState([]),[o,i]=t.useState(1),[C,r]=t.useState(null),d=10,n=re(),L=["manager","admin"],w="admin";if(t.useEffect(()=>{m(s)},[s]),t.useEffect(()=>{if(c==="")m(s);else{const a=s.filter(p=>{const y=p.warehouseName.toLowerCase().includes(c.toLowerCase()),q=p.address.toLowerCase().includes(c.toLowerCase()),M=L.includes(n)&&p.createdBy.toLowerCase().includes(c.toLowerCase());return y||q||M});m(a),i(1),a.length===0?r("No results found"):r(null)}},[c,s]),s.length===0)return e.jsx(W,{color:"danger",className:"text-center mt-5 w-75 mx-auto justify-content-center",children:"No Warehouse Location Found"});const P=a=>{f(a.target.value)},N=o*d,S=N-d,h=l.slice(S,N),v=Math.ceil(l.length/d);return u?e.jsx(A,{color:"primary",className:"text-center mt-5 w-75 mx-auto",children:"Loading Warehouse Location..."}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"m-3",children:e.jsxs(Pe,{className:"w-50 mb-3",children:[e.jsx(R,{type:"text",id:"search",value:c,onChange:P,placeholder:"Search Warehouse Location..."}),e.jsx(ke,{children:e.jsx(U,{icon:Le})})]})}),e.jsxs(Ee,{children:[e.jsx(ue,{children:"Warehouse Location List"}),e.jsxs(We,{className:"md-3",children:[e.jsxs(Ae,{bordered:!0,hover:!0,responsive:!0,className:"mx-auto ",children:[e.jsx(Ie,{className:"text-center",children:e.jsxs(ae,{children:[e.jsx(V,{className:"fixed-width bg-secondary",children:"Warehouse Name"}),e.jsx(V,{className:"fixed-width bg-secondary",children:"Address"}),w.includes(n)&&e.jsx(V,{className:"fixed-width bg-secondary",children:"Created By"}),e.jsx(V,{className:"fixed-width bg-secondary",children:"Actions"})]})}),e.jsx(Fe,{className:"text-center",children:h.map(a=>e.jsxs(ae,{children:[e.jsx(_,{className:"fixed-width",children:e.jsx(F,{content:a.warehouseName,children:e.jsx("span",{children:a.warehouseName})})}),e.jsx(_,{className:"fixed-width",children:e.jsx(F,{content:a.address,children:e.jsx("span",{children:a.address})})}),w.includes(n)&&e.jsx(_,{className:"fixed-width",color:"danger",children:e.jsx(F,{content:a.createdBy,children:e.jsx("span",{children:a.createdBy})})}),e.jsxs(_,{className:"fixed-width",children:[e.jsx(Oe,{warehouseLoc:a,onUpdateWarehouseLoc:j}),L.includes(n)&&e.jsx(_e,{warehouseLoc:a,onDeleteWarehouseLoc:x})]})]},a._id))})]}),l.length>0&&e.jsxs(G,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs(G,{children:["Showing ",S+1," to"," ",Math.min(N,l.length)," of"," ",l.length," entries"]}),e.jsxs(Me,{className:"mt-3",children:[e.jsx(Q,{disabled:o===1,onClick:()=>i(a=>Math.max(a-1,1)),children:"Previous"}),[...Array(v).keys()].map(a=>e.jsx(Q,{active:a+1===o,onClick:()=>i(a+1),children:a+1},a+1)),e.jsx(Q,{disabled:o===v,onClick:()=>i(a=>Math.min(a+1,v)),children:"Next"})]})]}),C&&e.jsx(W,{color:"danger",className:"text-center mt-5 w-75 mx-auto justify-content-center",children:C})]})]})]})};sessionStorage.getItem("accessToken");const ds=()=>{const s=re(),u=["super admin","admin","manager","warehouse manager"],[b,x]=t.useState([]),[j,c]=t.useState(!1),[f,l]=t.useState(null),m=async()=>{var r,d;c(!0);try{const n=await O.get("api/v1/warehouseLoc/locations");n.status===200?x(n.data.data):l(n.data.message)}catch(n){l(((d=(r=n.response)==null?void 0:r.data)==null?void 0:d.message)||n.message)}finally{c(!1)}};t.useEffect(()=>{m()},[]);const o=r=>{x(d=>[...d,r])},i=r=>{x(d=>d.filter(n=>n._id!==r))},C=r=>{x(d=>d.map(n=>n._id===r._id?r:n))};return e.jsx(e.Fragment,{children:s&&u.includes(s)?e.jsxs(e.Fragment,{children:[e.jsx(ue,{children:"Warehouse location"}),e.jsx(Ve,{onAddWarehouseLoc:o}),e.jsx(Ue,{warehouseLoc:b,loading:j,error:f,onDeleteWarehouseLoc:i,onUpdateWarehouseLoc:C})]}):e.jsx(W,{color:"danger",className:"text-center justify-content-center m-5",children:"You do not have permission to access this page."})})};export{ds as default};
