import{l as q,r as t,j as e,k as w,n as _,A as Q}from"./index-DIr8SfUZ.js";import{s as J,F,t as K,v as W,m as X,u as Y}from"./index-DVU2N_FE.js";import{a as M}from"./CButton-CKxY_gO7.js";import{C as O,a as H,b as U,c as B}from"./CModalHeader-BuvawqpT.js";import{C as $}from"./CModalTitle-ksjbRGhg.js";import{C as k}from"./CAlert-YFK_--rC.js";import{C as G}from"./CForm-DyG4V1wM.js";import{C}from"./CFormInput-TBJlv8r-.js";import{C as z}from"./CFormSelect-DgKTSEfE.js";import{C as P}from"./CContainer-D47TnRk5.js";import{C as Z}from"./CInputGroup-C75-Rb3x.js";import{C as ee}from"./CInputGroupText-KzbX8BmI.js";import{C as se,a as ae,b as te,c as le}from"./CAccordionHeader-BKFUQjBB.js";import{C as I}from"./DefaultLayout-BhPnEiZn.js";import{C as re,a as T}from"./CPaginationItem-D6Y4X2BL.js";import{C as ne}from"./CCard-DEWXlYfS.js";import{C as oe}from"./CCardBody-CmaYCouu.js";import"./index.esm-Tvy7v6ta.js";import"./1-MGlrdTNP.js";import"./cil-user-Ddrdy7PS.js";const ie=({onAddDriver:o})=>{const{showSuccess:A,showError:b}=q(),[d,v]=t.useState(!1),[x,D]=t.useState(null),[L,n]=t.useState(null),[E,i]=t.useState(!1),[N,g]=t.useState([]),[y,f]=t.useState(!1),c={idNum:Math.floor(Math.random()*1e6).toString(),driverName:"",email:"",phone:"",address:"",licenseNumber:"",status:"available",assignedVehicle:""},[a,m]=t.useState(c),u=r=>{const{id:l,value:p}=r.target;m(j=>({...j,[l]:p}))},h=async()=>{try{const r=await _.get("api/v1/vehicle/available");g(r.data.data)}catch(r){console.error("Error fetching vehicles:",r)}};t.useEffect(()=>{h()},[]);const s=async r=>{r.currentTarget.checkValidity()===!1&&(r.preDefault(),r.stopPropagation()),f(!0),{...a},v(!0);try{const p=await _.post("api/v1/driver",a);p.status===201&&(A(p.data.message),o(p.data.data),setTimeout(()=>{m(c),f(!1),i(!1),v(!1)},2e3))}catch(p){n(p.response.data.message),b(p.response.data.message),setTimeout(()=>{n(null)},3e3)}finally{v(!1)}},S=({icon:r})=>{const[l,p]=t.useState(!1);return e.jsx(F,{icon:r,bounce:l,onMouseEnter:()=>p(!0),onMouseLeave:()=>p(!1)})};return e.jsx(e.Fragment,{children:d?e.jsx(w,{color:"primary",size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsxs(M,{color:"primary",disabled:d,variant:"outline",onClick:()=>i(!0),children:[d?e.jsx(w,{color:"primary",size:"sm"}):e.jsx(S,{icon:J})," Add Driver"]}),e.jsxs(O,{visible:E,onClose:()=>i(!1),children:[e.jsx(H,{children:e.jsx($,{children:"Add Driver"})}),L&&e.jsx(k,{color:"danger",className:"m-3",children:L}),x&&e.jsx(k,{color:"success",className:"m-3",children:x}),e.jsx(U,{children:e.jsxs(G,{noValidate:!0,validated:y,children:[e.jsx(C,{className:"mb-3",floatingLabel:"ID Number",placeholder:"ID Number",type:"text",id:"idNum",label:"ID Number",value:a.idNum,disabled:!0}),e.jsx(C,{className:"mb-3",floatingLabel:"Name",placeholder:"Name",type:"text",id:"driverName",label:"Name",autoComplete:"off",required:!0,value:a.driverName,onChange:u}),e.jsx(C,{className:"mb-3",floatingLabel:"email",placeholder:"Model",type:"email",id:"email",label:"Email",autoComplete:"off",required:!0,value:a.email,onChange:u}),e.jsx(C,{type:"phone",className:"mb-3",floatingLabel:"phone",placeholder:"phone",id:"phone",label:"Phone",title:"Please enter a valid phone number",autoComplete:"off",value:a.phone,required:!0,onChange:u}),e.jsx(C,{className:"mb-3",floatingLabel:"Address",placeholder:"Address",type:"text",id:"address",label:"Address",autoComplete:"off",required:!0,value:a.address,onChange:u}),e.jsx(C,{className:"mb-3",floatingLabel:"License Number",placeholder:"License Number",type:"text",id:"licenseNumber",label:"License Number",autoComplete:"off",required:!0,value:a.licenseNumber,onChange:u}),e.jsxs(z,{className:"mb-3",floatingLabel:"Vehicle",label:"Vehicle",id:"assignedVehicle",required:!0,value:a.assignedVehicle,onChange:u,children:[e.jsx("option",{value:null,children:"Select Vehicle"}),N.map(r=>e.jsxs("option",{value:r._id,children:[r.brand," /",r.model," /",r.regisNumber]},r._id))]})]})}),e.jsxs(B,{children:[e.jsx(M,{color:"secondary",variant:"outline",disabled:d,onClick:()=>{i(!1),m(c),n(null),f(!1)},children:d?e.jsx(w,{color:"secondary",size:"sm"}):"Cancel"}),e.jsx(M,{color:"primary",variant:"outline",onClick:s,disabled:d,children:d?e.jsx(w,{color:"primary",size:"sm"}):"Add Driver"})]})]})]})})},ce=({driver:o,onUpdateDriver:A})=>{const{showSuccess:b,showError:d}=q(),[v,x]=t.useState(!1),[D,L]=t.useState(null),[n,E]=t.useState([]),[i,N]=t.useState(!1),[g,y]=t.useState(null),[f,V]=t.useState(!1),c={idNum:o.idNum,driverName:o.driverName,email:o.email,phone:o.phone,address:o.address,licenseNumber:o.licenseNumber,status:o.status,assignedVehicle:o.assignedVehicle},[a,m]=t.useState(c),u=l=>{const{id:p,value:j}=l.target;m(R=>({...R,[p]:j}))},h=async()=>{try{const l=await _.get("api/v1/vehicle/available");E(l.data.data)}catch(l){d(l.message)}};t.useEffect(()=>{h()},[]);const s=async l=>{l.preventDefault(),l.currentTarget.checkValidity()===!1&&l.stopPropagation(),N(!0),V(!0),{...a};try{const j=await _.put(`/api/v1/driver/${o._id}`,a);j.data.success&&(b(j.data.message),A(j.data.data),setTimeout(()=>{x(!1),m(c)},2e3))}catch(j){y(j.response.data.message),d(j.response.data.message),setTimeout(()=>{y(null)},2e3)}finally{V(!1)}},S=[{value:"available",label:"Available"},{value:"on_duty",label:"On Duty"},{value:"off_duty",label:"Off Duty"}],r=({icon:l})=>{const[p,j]=t.useState(!1);return e.jsx(F,{icon:l,bounce:p,onMouseEnter:()=>j(!0),onMouseLeave:()=>j(!1)})};return e.jsxs(e.Fragment,{children:[e.jsxs(M,{color:"primary",variant:"outline",disabled:f,onClick:()=>x(!0),className:"me-2",children:[f?e.jsx(w,{size:"sm"}):e.jsx(r,{icon:K})," Update"]}),e.jsxs(O,{visible:v,onClose:()=>x(!1),children:[e.jsx(H,{children:e.jsx($,{children:"Update Driver"})}),g&&e.jsx(k,{color:"danger",className:"m-3",children:g}),D&&e.jsx(k,{color:"success",className:"m-3",children:D}),e.jsx(U,{children:e.jsx(G,{noValidate:!0,validated:i,children:e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"mb-3",floatingLabel:"ID Number",placeholder:"ID Number",type:"text",id:"idNum",label:"ID Number",value:a.idNum,disabled:!0}),e.jsx(C,{className:"mb-3",floatingLabel:"Name",placeholder:"Name",type:"text",id:"driverName",label:"Name",autoComplete:"off",required:!0,value:a.driverName,onChange:u}),e.jsx(C,{className:"mb-3",floatingLabel:"email",placeholder:"Model",type:"email",id:"email",label:"Email",autoComplete:"off",required:!0,value:a.email,onChange:u}),e.jsx(C,{type:"phone",className:"mb-3",floatingLabel:"phone",placeholder:"phone",id:"phone",label:"Phone",title:"Please enter a valid phone number",autoComplete:"off",value:a.phone,required:!0,onChange:u}),e.jsx(C,{className:"mb-3",floatingLabel:"Address",placeholder:"Address",type:"text",id:"address",label:"Address",autoComplete:"off",required:!0,value:a.address,onChange:u}),e.jsx(C,{className:"mb-3",floatingLabel:"License Number",placeholder:"License Number",type:"text",id:"licenseNumber",label:"License Number",autoComplete:"off",required:!0,value:a.licenseNumber,onChange:u}),e.jsx(z,{className:"mb-3",floatingLabel:"Status",placeholder:"Status",id:"status",label:"Status",autoComplete:"off",required:!0,value:a.status||"",onChange:u,children:S.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))}),a.status==="available"||a.status==="on_duty"&&e.jsxs(z,{className:"mb-3",floatingLabel:"Assigned Vehicle",label:"Assigned Vehicle",id:"assignedVehicle",value:a.assignedVehicle||"",onChange:u,children:[e.jsx("option",{value:"",children:"Select a vehicle"}),n.map(l=>e.jsxs("option",{value:l._id,children:[l.brand," / ",l.model," / ",l.regisNumber]},l._id))]})]})})}),e.jsxs(B,{children:[e.jsx(M,{color:"secondary",variant:"outline",disabled:f,onClick:()=>{x(!1),y(null),N(!1)},children:f?e.jsx(w,{color:"secondary",size:"sm"}):"Close"}),e.jsx(M,{color:"success",variant:"outline",disabled:f,onClick:s,children:f?e.jsx(w,{color:"success",size:"sm"}):"Save Changes"})]})]})]})},de=({driver:o,onDeleteDriver:A})=>{const[b,d]=t.useState(!1),[v,x]=t.useState(null),{showError:D,showSuccess:L}=q(),n=async()=>{d(!0);try{const i=await _.delete(`api/v1/driver/${o._id}`);i.status===200&&(L(i.data.message),A(o._id),d(!1),x(null))}catch(i){x(i),D(i.response.data.message)}finally{d(!1)}},E=({icon:i})=>{const[N,g]=t.useState(!1);return e.jsx(F,{icon:i,bounce:N,onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1)})};return e.jsx(e.Fragment,{children:e.jsxs(M,{color:"danger",variant:"outline",onClick:n,className:"me-2",disabled:b,children:[b?e.jsx(w,{size:"sm"}):e.jsx(E,{icon:W})," Delete"]})})},ue=({driver:o,loading:A,onDeleteDriver:b,onUpdateDriver:d})=>{const v=Q(),x=["manager","admin","super admin"],[D,L]=t.useState(null),[n,E]=t.useState(""),[i,N]=t.useState([]),[g,y]=t.useState(1),[f]=t.useState(10),V=g*f,c=V-f,a=i.slice(c,V),m=Math.ceil(i.length/f);t.useEffect(()=>{(async()=>{if(y(1),n==="")N(o);else{const S=o.filter(r=>r.driverName.toLowerCase().includes(n.toLowerCase())||r.idNum.toString().includes(n)||r.email.toLowerCase().includes(n.toLowerCase())||r.phone.toString().includes(n)||r.address.toLowerCase().includes(n.toLowerCase())||r.licenseNumber.toString().includes(n)||h.find(l=>l.value===r.status).label.toLowerCase().includes(n.toLowerCase()));N(S),S.length===0?L("No results found"):L(null)}})()},[n,o]);const u=s=>{switch(s){case"available":return"green";case"on_duty":return"red";case"off_duty":return"orange";default:return"black"}},h=[{label:"Available",value:"available"},{label:"On Duty",value:"on_duty"},{label:"Off Duty",value:"off_duty"}];return o.length===0?e.jsx(k,{color:"danger",className:"justfy-content-center",children:"No drivers found"}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"mt-3",children:e.jsxs(Z,{className:"w-50 mb-3 ",children:[e.jsx(C,{type:"text",placeholder:"Search Drivers...",id:"search",value:n,onChange:s=>E(s.target.value),className:"w-50 me-2 "}),e.jsx(ee,{children:e.jsx(F,{icon:X})})]})}),e.jsx(se,{className:"m-2",children:a.map(s=>e.jsxs(ae,{children:[e.jsx(te,{children:e.jsxs("p",{className:"w-100 m-1",children:["Driver Name: ",e.jsxs("strong",{children:[" ",s.driverName," "]}),e.jsx(F,{icon:Y,color:u(s.status),className:"m-2 float-end"}),e.jsxs("small",{className:"m-2 float-end",children:[" ",h.find(S=>S.value===s.status).label]})]})}),e.jsxs(le,{children:[e.jsxs(I,{children:["ID: ",s.idNum]}),e.jsxs(I,{children:["Email: ",s.email]}),e.jsxs(I,{children:["Phone: ",s.phone]}),e.jsxs(I,{children:["Address: ",s.address]}),e.jsxs(I,{children:["License Number: ",s.licenseNumber]}),e.jsxs(I,{children:["Vehicle:"," ",s.assignedVehicle?`${s.assignedVehicle.regisNumber} - ${s.assignedVehicle.brand} ${s.assignedVehicle.model}`:"No vehicle assigned"]}),e.jsxs(I,{children:["Status: ",h.find(S=>S.value===s.status).label]}),e.jsxs(P,{className:"d-flex justify-content-end mt-3",children:[A?e.jsx(w,{color:"primary",size:"sm"}):e.jsx(ce,{driver:s,onUpdateDriver:d}),x.includes(v)&&e.jsx(de,{driver:s,onDeleteDriver:b})]})]})]},s._id))}),i.length>0&&e.jsxs(P,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs(P,{children:["Showing ",c+1," to ",Math.min(V,i.length)," of"," ",i.length," entries"]}),e.jsxs(re,{className:"mt-3",children:[e.jsx(T,{disabled:g===1,onClick:()=>y(s=>Math.max(s-1,1)),children:"Previous"}),Array.from({length:m},(s,S)=>S+1).map(s=>e.jsx(T,{active:s===g,onClick:()=>y(s),children:s},s)),e.jsx(T,{disabled:g===m,onClick:()=>y(s=>Math.min(s+1,m)),children:"Next"})]})]}),D&&e.jsx(k,{color:"danger",className:"text-center justify-content-center",children:D})]})},Ee=()=>{const{showError:o}=q(),[A,b]=t.useState([]),[d,v]=t.useState(!1),[x,D]=t.useState(null),[L,n]=t.useState(!1),[E,i]=t.useState(null),N=async()=>{var c,a,m,u;v(!0);try{const h=await _.get("api/v1/driver");h.status===200?(b(h.data.data),v(!1)):(D(h.data.message),o(h.data.message))}catch(h){D(((a=(c=h.response)==null?void 0:c.data)==null?void 0:a.message)||h.message),o(((u=(m=h.response)==null?void 0:m.data)==null?void 0:u.message)||h.message)}finally{v(!1)}};t.useEffect(()=>{N()},[]);const g=c=>{b(a=>[...a,c]),N()},y=c=>{i(c),n(!0)},f=c=>{b(a=>a.filter(m=>m._id!==c))},V=c=>{b(a=>a.map(m=>m._id===c._id?c:m))};return d?e.jsx("div",{className:"text-center  ",children:e.jsx(w,{color:"primary",size:"sm"})}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"text-center",children:"Driver Management"}),e.jsx(P,{className:"m-3",children:e.jsx(ie,{onAddDriver:g})}),e.jsxs(ne,{children:[e.jsx(I,{children:"Drivers list"}),e.jsx(oe,{className:"md-3",children:e.jsx(ue,{driver:A,loading:d,error:x,onDeleteDriver:y,onUpdateDriver:V})})]}),e.jsxs(O,{visible:L,onClose:()=>n(!1),alignment:"center",children:[e.jsx(H,{closeButton:!0,children:"Confirm Delete"}),e.jsx(U,{children:"Are you sure you want to delete this driver? This action cannot be undone."}),e.jsxs(B,{children:[e.jsx(M,{color:"secondary",onClick:()=>n(!1),children:"Cancel"}),e.jsx(M,{color:"danger",onClick:f,children:"Delete"})]})]})]})};export{Ee as default};
