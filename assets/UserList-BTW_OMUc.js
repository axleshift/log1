import{r as o,_ as ee,R as se,a as ae,c as te,P as I,j as e,C as Q,x as H,k as re}from"./index-jiNyKwsp.js";import{F as D,e as oe,g as ne,b as le,h as ie}from"./index-DFyN7MmU.js";import{C as ce,a as de,b as me,c as ue,d as he}from"./CModalTitle-CoYR5CZO.js";import{a as R,C as pe}from"./CForm-DqhKtZxf.js";import{C as A,a as fe}from"./CFormInput-Aogae6Re.js";import{C as xe}from"./CFormSelect-kO3egkmH.js";import{C as Ce}from"./CImage-BSkrlDg4.js";import{a as f}from"./CButton-BYhtaUES.js";import{C as M}from"./CContainer-DTmQoVhq.js";import{C as je,a as ve}from"./CInputGroupText-vwwZNSfW.js";import{C as ge}from"./CCard-DdcUPz_T.js";import{C as we}from"./CCardHeader-BwFjmdu4.js";import{C as be}from"./CCardBody-DHnVSZdn.js";import{C as ye,a as Ne,b as q,c as S,d as Se,e as P}from"./CTable-ChCIrykH.js";import{C as Pe,a as z}from"./CPaginationItem-D6lPLeSz.js";import"./CCloseButton-BXXgN7mW.js";var G=o.forwardRef(function(r,y){var l,x=r.children,a=r.className,c=r.size,C=r.vertical,m=ee(r,["children","className","size","vertical"]);return se.createElement("div",ae({className:te(C?"btn-group-vertical":"btn-group",(l={},l["btn-group-".concat(c)]=c,l),a)},m,{ref:y}),x)});G.propTypes={children:I.node,className:I.string,size:I.oneOf(["sm","lg"]),vertical:I.bool};G.displayName="CButtonGroup";const Ae=({user:r,visible:y,onClose:l,onUpdate:x})=>{const[a,c]=o.useState({username:"",email:"",password:"",confirmPassword:"",role:"",photo:""}),[C,m]=o.useState(!1),[j,v]=o.useState(null),[g,_]=o.useState(null),[E,u]=o.useState(null),U="http://localhost:5057";o.useEffect(()=>{if(r&&(c({username:r.username||"",email:r.email||"",password:"",confirmPassword:"",role:r.role||"",photo:null}),r.photo)){const h=r.photo.startsWith("http")?r.photo:`${U}/uploads/${r.photo}`;u(h)}},[r,U]);const L=async h=>{var d,i;h.preventDefault(),m(!0),v(null);try{if((a.password||a.confirmPassword)&&a.password!==a.confirmPassword)throw new Error("Passwords do not match");const n=new FormData;n.append("username",a.username),n.append("email",a.email),n.append("role",a.role),a.password&&n.append("password",a.password),a.photo&&n.append("photo",a.photo);const N=await H.put(`/api/v1/user/update-user/${r._id}`,n);N.data.success&&(_("User updated successfully"),x(N.data.data),setTimeout(()=>{l()},2e3))}catch(n){console.error("Error updating user:",n),v(((i=(d=n.response)==null?void 0:d.data)==null?void 0:i.message)||n.message||"Failed to update user")}finally{m(!1)}},w=h=>{const{id:d,value:i}=h.target;c(n=>({...n,[d]:i}))},F=h=>{const d=h.target.files[0];if(d){c(n=>({...n,photo:d}));const i=new FileReader;i.onloadend=()=>{u(i.result)},i.readAsDataURL(d)}};return e.jsxs(ce,{visible:y,onClose:l,children:[e.jsx(de,{children:e.jsxs(me,{children:["Edit User: ",r==null?void 0:r.username]})}),e.jsxs(ue,{children:[j&&e.jsx(R,{color:"danger",children:j}),g&&e.jsx(R,{color:"success",children:g}),e.jsxs(pe,{onSubmit:L,children:[e.jsx(A,{id:"username",value:a.username,onChange:w,className:"mb-3",placeholder:"Enter username",autoComplete:"off",floatingLabel:"Username",required:!0}),e.jsx(A,{type:"email",id:"email",value:a.email,onChange:w,className:"mb-3",placeholder:"Enter email",autoComplete:"off",floatingLabel:"Email",required:!0}),e.jsx(fe,{htmlFor:"password",children:"New Password (leave blank to keep current)"}),e.jsx(A,{type:"password",id:"password",value:a.password,onChange:w,className:"mb-3",autoComplete:"off",placeholder:"New Password",floatingLabel:"New Password"}),e.jsx(A,{type:"password",id:"confirmPassword",value:a.confirmPassword,onChange:w,className:"mb-3",autoComplete:"off",placeholder:"Confirm Password",floatingLabel:"Confirm Password"}),e.jsxs(xe,{id:"role",label:"Role",value:a.role,onChange:w,className:"mb-3",required:!0,children:[e.jsx("option",{value:"",children:"Select Role"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"manager",children:"Manager"}),e.jsx("option",{value:"inspector",children:"Inspector"}),e.jsx("option",{value:"driver",children:"Driver"})]}),e.jsx(A,{type:"file",id:"photo",label:"Profile Photo",onChange:F,accept:"image/*",className:"mb-3"}),E&&e.jsx("div",{className:"mb-3",children:e.jsx(Ce,{src:E,alt:"Preview",align:"center",rounded:!0,width:200,height:200,crossOrigin:"anonymous"})})]})]}),e.jsxs(he,{children:[e.jsx(f,{color:"secondary",onClick:l,children:"Cancel"}),e.jsx(f,{color:"primary",onClick:L,disabled:C,children:C?e.jsx(Q,{size:"sm"}):"Save Changes"})]})]})},$e=({onUpdateUser:r})=>{const y=re(),[l,x]=o.useState([]),[a,c]=o.useState(!0),[C,m]=o.useState([]),[j,v]=o.useState(1),[g,_]=o.useState(""),[E,u]=o.useState(null),[U,L]=o.useState(null),[w,F]=o.useState(!1),[h,d]=o.useState(null),[i,n]=o.useState("all"),N=10,V=s=>{switch(i){case"active":return s.filter(t=>t.isActive);case"inactive":return s.filter(t=>!t.isActive);default:return s}},W=async()=>{c(!0);try{const t=(await H.get("/api/v1/user/all-user")).data.data;x(t),m(t)}catch(s){console.error("Error fetching users:",s),u("Error fetching users")}finally{c(!1)}};o.useEffect(()=>{W()},[]),o.useEffect(()=>{if(g==="")m(l);else{const s=l.filter(t=>{const p=g.toLowerCase(),b=t.isActive?"active":"inactive",k=t.isActive?"deactivate":"activate";return t.username.toLowerCase().includes(p)||t.email.toLowerCase().includes(p)||t.role.toLowerCase().includes(p)||b.includes(p)||k.includes(p)||t.createdAt.toLowerCase().includes(p)});m(s),v(1),s.length===0?u("No matching users found"):u(null)}},[g,l]);const J=async s=>{var t,p;c(!0);try{const b=await H.post(`/api/v1/user/in-active-user/${s}`);if(b.data.success){const k=l.map(T=>T._id===s?{...T,isActive:!T.isActive}:T);x(k),m(k),L(b.data.message)}else u(b.data.message);setTimeout(()=>{L(null),u(null)},3e3)}catch(b){u(((p=(t=b.response)==null?void 0:t.data)==null?void 0:p.message)||"Failed to update user status"),setTimeout(()=>u(null),3e3)}finally{c(!1)}},K=s=>{d(s),F(!0)},X=s=>{x(l.map(t=>t._id===s._id?s:t)),m(C.map(t=>t._id===s._id?s:t))};if(a)return e.jsx(Q,{className:"m-5 d-flex justify-content-center"});const O=V(C),$=j*N,Y=$-N,Z=O.slice(Y,$),B=Math.ceil(O.length/N);return e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"m-3 d-flex justify-content-center align-items-center",children:e.jsx("h1",{children:"Accounts"})}),e.jsxs(M,{className:"m-3 d-flex justify-content-between",children:[e.jsx(f,{color:"primary",className:"m-3 ",disabled:a,onClick:()=>y("/dashboard"),children:a?"Loading...":e.jsx(D,{icon:oe})}),e.jsx(f,{color:"primary",className:"m-3",onClick:()=>y("/register"),children:"Add User"})]}),e.jsxs(M,{className:"m-3",children:[E&&e.jsx(R,{color:"danger",className:"mb-3",children:E}),U&&e.jsx(R,{color:"success",className:"mb-3",children:U}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs(je,{className:"w-50",children:[e.jsx(A,{type:"text",value:g,id:"search",onChange:s=>_(s.target.value),placeholder:"Search users..."}),e.jsx(ve,{children:e.jsx(D,{icon:ne})})]}),e.jsxs(G,{children:[e.jsx(f,{color:i==="all"?"primary":"secondary",onClick:()=>n("all"),children:"All"}),e.jsx(f,{color:i==="active"?"primary":"secondary",onClick:()=>n("active"),children:"Active"}),e.jsx(f,{color:i==="inactive"?"primary":"secondary",onClick:()=>n("inactive"),children:"Inactive"})]})]}),e.jsx("div",{className:"text-muted small mb-3",children:"Search by: username, email, role, status (active/inactive), or action (activate/deactivate)"}),e.jsxs(ge,{children:[e.jsx(we,{children:e.jsx("h4",{children:"User List"})}),e.jsxs(be,{children:[e.jsxs(ye,{hover:!0,responsive:!0,className:"text-center",children:[e.jsx(Ne,{children:e.jsxs(q,{children:[e.jsx(S,{children:"Username"}),e.jsx(S,{children:"Email"}),e.jsx(S,{children:"Role"}),e.jsx(S,{children:"Created Date"}),e.jsx(S,{children:"Status"}),e.jsx(S,{children:"Actions"})]})}),e.jsx(Se,{children:Z.map(s=>e.jsxs(q,{children:[e.jsx(P,{children:s.username}),e.jsx(P,{children:s.email}),e.jsx(P,{children:s.role}),e.jsx(P,{children:s.createdAt.slice(0,10)}),e.jsx(P,{children:e.jsx(le,{color:s.isActive?"success":"danger",children:s.isActive?"Active":"Inactive"})}),e.jsx(P,{children:e.jsxs(M,{className:" d-flex justify-content-center align-items-center",children:[e.jsx(f,{variant:"outline",className:"me-2",color:s.isActive?"danger":"success",onClick:()=>J(s._id),children:s.isActive?"Deactivate":"Activate"}),e.jsx(f,{variant:"outline",className:"me-2",color:"primary",onClick:()=>K(s),children:e.jsx(D,{icon:ie})})]})})]},s._id))})]}),h&&e.jsx(Ae,{user:h,visible:w,onClose:()=>{F(!1),d(null)},onUpdate:X}),e.jsxs(Pe,{align:"center",children:[e.jsx(z,{disabled:j===1,onClick:()=>v(s=>Math.max(s-1,1)),children:"Previous"}),[...Array(B).keys()].map(s=>e.jsx(z,{active:s+1===j,onClick:()=>v(s+1),children:s+1},s+1)),e.jsx(z,{disabled:j===B,onClick:()=>v(s=>Math.min(s+1,B)),children:"Next"})]})]})]})]})]})};export{$e as default};
