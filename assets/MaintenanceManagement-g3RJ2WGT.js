import{r as i,_ as Ce,u as Ve,R as E,a as G,c as ee,P,b as Re,l as ce,j as e,k as be,n as U,D as De,E as Le}from"./index-CDBEKR8m.js";import{r as Be,F as ie,G as ze,s as He,m as Oe,a as ge,t as $e,L as Qe,u as Ge}from"./index-BZSDq1jT.js";import{C as _e,a as D}from"./CButton-BIvZ-J4N.js";import{C as ue,a as pe,b as me,c as ve}from"./CModalHeader-D9K_epp8.js";import{C as fe}from"./CModalTitle-DWazJ51Z.js";import{C as de}from"./CAlert-COglbjmG.js";import{C as we}from"./CForm-CJwbtsib.js";import{C as _}from"./CInputGroup-DNMVtog-.js";import{C as K}from"./CFormSelect-AIdqeu-0.js";import{a as Pe,b as Me,C as B}from"./CFormInput-B6JhvP-D.js";import{C as xe}from"./CCard-y_jN0oNm.js";import{C as ye}from"./CCardHeader-bOtoRGnU.js";import{C as ne}from"./CCardBody-DFxpVfuj.js";import{C as Te,a as Ie,b as he,c as te,d as Ae,e as ae}from"./CTable-Ez-jL17Z.js";import{C as $}from"./CContainer-DncXOvlk.js";import{C as Q,b as Ue,c as Ke,d as Je,a as We}from"./DefaultLayout-DVBkXjcr.js";import{C as qe}from"./CFormTextarea-Dg8YXvZN.js";import{C as Xe}from"./CInputGroupText-NV6kimLu.js";import{C as Ye,a as Ze,b as et,c as tt}from"./CAccordionHeader-CEElsRfB.js";import{C as at,a as je}from"./CPaginationItem-C7kbKv-4.js";import{C as st,a as lt,b as rt,c as it}from"./CTabList-BmCcwp9E.js";import"./index.esm-CffKrjm9.js";import"./1-Cdrai1gQ.js";import"./cil-user-Ddrdy7PS.js";import"./getTransitionDurationFromElement-Cpu4p4hx.js";var ke=i.forwardRef(function(n,a){var h=n.className,f=n.button,M=n.feedback,I=n.feedbackInvalid,x=n.feedbackValid,L=n.floatingLabel,m=n.tooltipFeedback,y=n.hitArea,v=n.id,A=n.indeterminate,F=n.inline,k=n.invalid,c=n.label,V=n.reverse,u=n.type,T=u===void 0?"checkbox":u,R=n.valid,z=Ce(n,["className","button","feedback","feedbackInvalid","feedbackValid","floatingLabel","tooltipFeedback","hitArea","id","indeterminate","inline","invalid","label","reverse","type","valid"]),N=i.useRef(null),o=Ve(a,N);i.useEffect(function(){N.current&&A&&(N.current.indeterminate=A)},[A,N.current]);var j=function(){return E.createElement("input",G({type:T,className:ee(f?"btn-check":"form-check-input",{"is-invalid":k,"is-valid":R,"me-2":y}),id:v},z,{ref:o}))},p=function(){return E.createElement(Me,{describedby:z["aria-describedby"],feedback:M,feedbackInvalid:I,feedbackValid:x,floatingLabel:L,invalid:k,tooltipFeedback:m,valid:R})},H=function(){var O;return E.createElement(Pe,G({customClassName:ee(f?ee("btn",f.variant?"btn-".concat(f.variant,"-").concat(f.color):"btn-".concat(f.color),(O={},O["btn-".concat(f.size)]=f.size,O),"".concat(f.shape)):"form-check-label")},v&&{htmlFor:v}),c)},J=function(){return f?E.createElement(E.Fragment,null,E.createElement(j,null),c&&E.createElement(H,null),E.createElement(p,null)):c?y?E.createElement(E.Fragment,null,E.createElement(j,null),E.createElement(Pe,G({customClassName:ee("form-check-label stretched-link",h)},v&&{htmlFor:v}),c),E.createElement(p,null)):E.createElement("div",{className:ee("form-check",{"form-check-inline":F,"form-check-reverse":V,"is-invalid":k,"is-valid":R},h)},E.createElement(j,null),E.createElement(H,null),E.createElement(p,null)):E.createElement(j,null)};return E.createElement(J,null)});ke.propTypes=G({button:P.object,className:P.string,hitArea:P.oneOf(["full"]),id:P.string,indeterminate:P.bool,inline:P.bool,label:P.oneOfType([P.string,P.node]),reverse:P.bool,type:P.oneOf(["checkbox","radio"])},Me.propTypes);ke.displayName="CFormCheck";var Ne=i.forwardRef(function(n,a){var h,f=n.children,M=n.as,I=M===void 0?"ul":M,x=n.className,L=n.flush,m=n.layout,y=Ce(n,["children","as","className","flush","layout"]);return E.createElement(I,G({className:ee("list-group",(h={"list-group-flush":L},h["list-group-".concat(m)]=m,h),x)},y,{ref:a}),f)});Ne.propTypes={as:P.elementType,children:P.node,className:P.string,flush:P.bool,layout:P.oneOf(["horizontal","horizontal-sm","horizontal-md","horizontal-lg","horizontal-xl","horizontal-xxl"])};Ne.displayName="CListGroup";var Se=i.forwardRef(function(n,a){var h,f=n.children,M=n.active,I=n.as,x=I===void 0?"li":I,L=n.className,m=n.disabled,y=n.color,v=Ce(n,["children","active","as","className","disabled","color"]),A=x==="a"||x==="button"?_e:x;return v=G(G(G(G({},(x==="a"||x==="button")&&{active:M,disabled:m,as:x,ref:a}),M&&{"aria-current":!0}),m&&{"aria-disabled":!0}),v),E.createElement(A,G({className:ee("list-group-item",(h={},h["list-group-item-".concat(y)]=y,h["list-group-item-action"]=x==="a"||x==="button",h.active=M,h.disabled=m,h),L)},v),f)});Se.propTypes={active:P.bool,as:P.elementType,children:P.node,className:P.string,color:Re,disabled:P.bool};Se.displayName="CListGroupItem";const nt=({onAddMaintenance:n})=>{const{showError:a,showSuccess:h}=ce(),[f,M]=i.useState(!1),[I,x]=i.useState(null),[L,m]=i.useState(!1),[y,v]=i.useState(!1),[A,F]=i.useState(!1),k={vehicle:"",maintenanceType:"",startDate:"",expectedEndDate:"",description:"",priority:"",category:"",checklist:[{task:"",completed:!1}],parts:[],requested:!0,purchased:!1},[c,V]=i.useState(k),[u,T]=i.useState([]),[R,z]=i.useState({partName:"",quantity:""}),N=new Date().toISOString().split("T")[0],o=l=>{const{id:d,value:s}=l.target;V(r=>({...r,[d]:s}))},j=l=>{const{id:d,value:s}=l.target;z(r=>({...r,[d.split(".")[1]]:s}))},p=()=>{V(l=>({...l,parts:[...l.parts,{...R}]})),z({partName:"",quantity:""})};i.useEffect(()=>{(async()=>{try{const d=await U.get("api/v1/vehicle/all");d.data.success&&T(d.data.data)}catch(d){x(d),a(d.message)}})()},[]);const H=()=>{V(l=>({...l,checklist:[...l.checklist,{task:"",completed:!1}]}))},J=l=>{V(d=>({...d,parts:d.parts.filter((s,r)=>r!==l)}))},O=l=>{V(d=>({...d,checklist:d.checklist.filter((s,r)=>r!==l)}))},se=(l,d)=>{V(s=>({...s,checklist:s.checklist.map((r,g)=>g===l?{...r,task:d}:r)}))},le=[{label:"High",value:"High"},{label:"Medium",value:"Medium"},{label:"Low",value:"Low"},{label:"Critical",value:"Critical"}],w=[{label:"Engine",value:"Engine"},{label:"Transmission",value:"Transmission"},{label:"Brakes",value:"Brakes"},{label:"Electrical",value:"Electrical"},{label:"Tiers",value:"Tiers"},{label:"Other",value:"Other"}],W=[{label:"Preventive",value:"PMS"},{label:"Corrective",value:"Corrective"},{label:"Emergency",value:"Emergency"}],re=async l=>{var s,r,g,S;if(l.preventDefault(),c.parts.length===0?c.purchased=!0:c.purchased=!1,l.currentTarget.checkValidity()===!1)l.stopPropagation(),l.preDefault();else try{const C=await U.post("api/v1/maintenance/create",c);C.data.success&&(h(C.data.message),n(C.data.data),m(!1))}catch(C){a(((r=(s=C.response)==null?void 0:s.data)==null?void 0:r.message)||C.message),x(((S=(g=C.response)==null?void 0:g.data)==null?void 0:S.message)||C.message),setTimeout(()=>{x(null)},2e3)}v(!0)},oe=({icon:l})=>{const[d,s]=i.useState(!1);return e.jsx(ie,{icon:l,bounce:d,onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1)})};return e.jsxs(e.Fragment,{children:[e.jsxs(D,{color:"primary",className:"mb-3",variant:"outline",onClick:()=>m(!0),children:[e.jsx(oe,{icon:Be})," Add Maintenance"]}),e.jsxs(ue,{visible:L,onClose:()=>m(!1),size:"lg",children:[e.jsx(pe,{closeButton:!0,children:e.jsx(fe,{children:"Add Maintenance"})}),I&&e.jsx(de,{color:"danger",children:I}),e.jsx(me,{children:e.jsxs(we,{className:"row g-3 needs-validation",noValidate:!0,validated:y,children:[e.jsxs(_,{children:[e.jsxs(K,{id:"vehicle",value:c.vehicle,onChange:o,floatingLabel:"Vehicle",placeholder:"Select Vehicle",required:!0,feedbackInvalid:"Please provide a valid vehicle.",children:[e.jsx("option",{value:"",children:"Select Vehicle"}),u.filter(l=>l.status==="in_use"||l.status==="available").map(l=>e.jsxs("option",{value:l._id,children:[l.brand," / ",l.model," / ",l.regisNumber]},l._id))]}),e.jsx(K,{id:"maintenanceType",value:c.maintenanceType,onChange:o,floatingLabel:"Maintenance Type",placeholder:"Select Maintenance Type",required:!0,options:[{label:"Select Maintenance Type",value:""},...W],feedbackInvalid:"Please provide a valid maintenance type."}),e.jsx(B,{id:"description",type:"text",floatingLabel:"Description",placeholder:"Description",required:!0,value:c.description,onChange:o,feedbackInvalid:"Please provide a valid description."})]}),e.jsxs(_,{children:[e.jsx(B,{id:"startDate",type:"date",floatingLabel:"Start Date",placeholder:"Start Date",required:!0,min:N,value:c.startDate,onChange:o,feedbackInvalid:"Please provide a valid start date."}),e.jsx(B,{id:"expectedEndDate",type:"date",floatingLabel:"Expected End Date",placeholder:"Expected End Date",required:!0,min:N,value:c.expectedEndDate,onChange:o,feedbackInvalid:"Please provide a valid expected end date."}),e.jsxs(K,{id:"priority",value:c.priority,onChange:o,floatingLabel:"Priority",placeholder:"Select Priority",required:!0,feedbackInvalid:"Please provide a valid priority.",children:[e.jsx("option",{value:"",children:"Select Priority"}),le.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))]}),e.jsxs(K,{id:"category",value:c.category,onChange:o,floatingLabel:"Category",placeholder:"Select Category",required:!0,feedbackInvalid:"Please provide a valid category.",children:[e.jsx("option",{value:"",children:"Select Category"}),w.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))]})]}),e.jsxs(xe,{className:"mb-3",children:[e.jsx(ye,{children:"Add Parts"}),e.jsxs(ne,{children:[e.jsxs(_,{className:"mb-3",children:[e.jsx(B,{id:"parts.partName",type:"text",floatingLabel:"Part Name",placeholder:"Part Name",value:R.partName,onChange:j,required:!0}),e.jsx(B,{id:"parts.quantity",type:"number",floatingLabel:"Quantity",placeholder:"Quantity",value:R.quantity,onChange:j,required:!0}),e.jsx(D,{color:"primary",onClick:p,children:"Add Part"})]}),c.parts.length>0&&e.jsxs(Te,{className:"",children:[e.jsx(Ie,{className:"text-center",children:e.jsxs(he,{children:[e.jsx(te,{children:"Part Name"}),e.jsx(te,{children:"Part Quantity"}),e.jsx(te,{children:"Remove Part"})]})}),e.jsx(Ae,{className:"text-center",children:c.parts.map((l,d)=>e.jsxs(he,{children:[e.jsx(ae,{children:l.partName}),e.jsx(ae,{children:l.quantity}),e.jsx(ae,{children:e.jsx(D,{color:"danger",size:"sm",onClick:()=>J(d),children:"Remove"})})]},d))})]})]})]}),e.jsxs($,{children:[e.jsx(Q,{children:"Checklist Items"}),e.jsx(D,{color:"primary",variant:"outline",className:"m-2",onClick:H,children:"Add Checklist Item"}),c.checklist.map((l,d)=>e.jsxs(_,{className:"mb-2",children:[e.jsx(B,{value:l.task,id:"itemCheckList",onChange:s=>se(d,s.target.value),placeholder:"Enter checklist item",required:!0}),e.jsx(D,{color:"danger",variant:"outline",onClick:()=>O(d),children:"Remove"})]},d))]}),e.jsx(qe,{id:"notes",floatingLabel:"Notes",placeholder:"Notes",value:c.notes,onChange:o,autoComplete:"off",style:{minHeight:"150px",width:"100%",resize:"vertical"},text:" leave empty if no notes.",feedbackInvalid:"Please provide a valid notes."})]})}),e.jsxs(ve,{children:[e.jsx(D,{color:"secondary",variant:"outline",onClick:()=>m(!1),children:"Close"}),e.jsx(D,{color:"primary",variant:"outline",onClick:re,children:f?e.jsx(be,{size:"sm"}):"Add Maintenance"})]})]})]})},ct=({onCompleted:n,maintenance:a})=>{var m;const{showSuccess:h,showError:f}=ce(),M=De(),I=["admin","chief mechanic"];if(!a||!a.checklist)return null;const x=()=>{const y=new Date,v=new Date(a.startDate);return y<v},L=async y=>{var v,A;try{const F=Le(),k=await U.patch(`api/v1/maintenance/complete/${y}`,{completedBy:F});k.data.success&&(h(k.data.message),n(k.data.data))}catch(F){const k=((A=(v=F.response)==null?void 0:v.data)==null?void 0:A.message)||"Error completing maintenance";f(k),console.error("Error completing maintenance:",F)}};return e.jsx(e.Fragment,{children:I.includes(M)&&e.jsxs(e.Fragment,{children:[e.jsx(D,{color:"success",variant:"outline",onClick:()=>L(a._id),disabled:!((m=a.checklist)!=null&&m.every(y=>y.completed))||x()||a.status==="Completed",title:x()?"Maintenance cannot be completed before its start date":"",children:"Complete Maintenance"}),x()&&e.jsxs("div",{className:"text-danger mt-2",children:["This maintenance cannot be completed before"," ",new Date(a.startDate).toLocaleDateString()]})]})})},ot=({onUpdateMaintenance:n,maintenance:a,disabled:h})=>{const{showError:f,showSuccess:M}=ce(),[I,x]=i.useState(!1),[L,m]=i.useState(null),[y,v]=i.useState(!1),[A,F]=i.useState(!1),[k,c]=i.useState(!1),V={vehicle:a.vehicle||{},maintenanceType:(a==null?void 0:a.maintenanceType)||"",startDate:a!=null&&a.startDate?a.startDate.split("T")[0]:"",expectedEndDate:a!=null&&a.expectedEndDate?a.expectedEndDate.split("T")[0]:"",description:(a==null?void 0:a.description)||"",priority:(a==null?void 0:a.priority)||"",category:(a==null?void 0:a.category)||"",checklist:(a==null?void 0:a.checklist)||[],parts:(a==null?void 0:a.parts)||[],notes:(a==null?void 0:a.notes)||"",requested:!0,purchased:!1},[u,T]=i.useState(V),[R,z]=i.useState([]),[N,o]=i.useState({partName:"",quantity:""}),j=new Date().toISOString().split("T")[0],p=s=>{const{id:r,value:g}=s.target;if(r==="vehicle"){const S=R.find(C=>C._id===g);T(C=>({...C,vehicle:S}))}else T(S=>({...S,[r]:g}))},H=s=>{const{id:r,value:g}=s.target,S=r.split(".")[1];o(C=>({...C,[S]:S==="quantity"?g===""?"":Number(g):g}))},J=()=>{if(!N.partName||!N.quantity){f("Please fill in both part name and quantity");return}T(s=>({...s,parts:[...s.parts,{...N}]})),o({partName:"",quantity:""})};i.useEffect(()=>{(async()=>{try{const r=await U.get("api/v1/vehicle/all");r.data.success&&z(r.data.data)}catch(r){m(r),f(r.message)}})()},[]);const O=()=>{T(s=>({...s,checklist:[...s.checklist,{task:"",completed:!1}]}))},se=s=>{T(r=>({...r,parts:r.parts.filter((g,S)=>S!==s)}))},le=s=>{T(r=>({...r,checklist:r.checklist.filter((g,S)=>S!==s)}))},w=(s,r)=>{T(g=>({...g,checklist:g.checklist.map((S,C)=>C===s?{...S,task:r}:S)}))},W=[{label:"High",value:"High"},{label:"Medium",value:"Medium"},{label:"Low",value:"Low"},{label:"Critical",value:"Critical"}],re=[{label:"Engine",value:"Engine"},{label:"Transmission",value:"Transmission"},{label:"Brakes",value:"Brakes"},{label:"Electrical",value:"Electrical"},{label:"Tiers",value:"Tiers"},{label:"Other",value:"Other"}],oe=[{label:"Preventive",value:"PMS"},{label:"Corrective",value:"Corrective"},{label:"Emergency",value:"Emergency"}],l=async s=>{var g,S,C,t;s.preventDefault(),u.parts.length===0?u.purchased=!0:u.purchased=!1;const r=s.currentTarget;if(F(!0),r.checkValidity()===!1){s.stopPropagation();return}x(!0);try{const b=await U.put(`api/v1/maintenance/update/${a._id}`,u);b.data.success&&(M(b.data.message),n(b.data.data),v(!1))}catch(b){f(((S=(g=b.response)==null?void 0:g.data)==null?void 0:S.message)||b.message),m(((t=(C=b.response)==null?void 0:C.data)==null?void 0:t.message)||b.message),setTimeout(()=>{m(null)},2e3)}finally{x(!1)}},d=({icon:s})=>{const[r,g]=i.useState(!1);return e.jsx(ie,{icon:s,bounce:r,onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1)})};return e.jsxs(e.Fragment,{children:[e.jsxs(D,{color:"primary",className:"m-1",variant:"outline",onClick:()=>v(!0),disabled:h,children:[h?e.jsx(d,{icon:ze}):e.jsx(d,{icon:He})," ",h?"Complete":"Update"]}),e.jsxs(ue,{visible:y,onClose:()=>v(!1),size:"lg",children:[e.jsx(pe,{closeButton:!0,children:e.jsx(fe,{children:"Update Maintenance"})}),L&&e.jsx(de,{color:"danger",children:L}),e.jsx(me,{children:e.jsxs(we,{className:"row g-3 needs-validation",noValidate:!0,validated:A,children:[e.jsxs(_,{children:[e.jsx(K,{id:"vehicle",floatingLabel:"Vehicle",placeholder:"Select Vehicle",required:!0,value:u.vehicle?u.vehicle._id:"",onChange:p,feedbackInvalid:"Please provide a valid vehicle.",disabled:!0,children:e.jsx("option",{value:"",children:`${a.vehicle.brand} / ${a.vehicle.model} / ${a.vehicle.regisNumber}`})}),e.jsx(K,{id:"maintenanceType",value:u.maintenanceType||"",onChange:p,floatingLabel:"Maintenance Type",placeholder:"Select Maintenance Type",required:!0,options:[{label:"Select Maintenance Type",value:""},...oe],feedbackInvalid:"Please provide a valid maintenance type."}),e.jsx(B,{id:"description",type:"text",floatingLabel:"Description",placeholder:"Description",required:!0,value:u.description,onChange:p,feedbackInvalid:"Please provide a valid description."})]}),e.jsxs(_,{children:[e.jsx(B,{id:"startDate",type:"date",floatingLabel:"Start Date",placeholder:"Start Date",required:!0,min:j,value:u.startDate,onChange:p,feedbackInvalid:"Please provide a valid start date."}),e.jsx(B,{id:"expectedEndDate",type:"date",floatingLabel:"Expected End Date",placeholder:"Expected End Date",required:!0,min:j,value:u.expectedEndDate,onChange:p,feedbackInvalid:"Please provide a valid expected end date."}),e.jsxs(K,{id:"priority",value:u.priority||"",onChange:p,floatingLabel:"Priority",placeholder:"Select Priority",required:!0,feedbackInvalid:"Please provide a valid priority.",children:[e.jsx("option",{value:"",children:"Select Priority"}),W.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),e.jsxs(K,{id:"category",value:u.category,onChange:p,floatingLabel:"Category",placeholder:"Select Category",required:!0,feedbackInvalid:"Please provide a valid category.",children:[e.jsx("option",{value:"",children:"Select Category"}),re.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]})]}),e.jsxs(xe,{className:"mb-3",children:[e.jsx(ye,{children:"Add Parts"}),e.jsxs(ne,{children:[e.jsxs(_,{className:"mb-3",children:[e.jsx(B,{id:"parts.partName",type:"text",floatingLabel:"Part Name",placeholder:"Part Name",value:N.partName||"",onChange:H}),e.jsx(B,{id:"parts.quantity",type:"number",floatingLabel:"Quantity",placeholder:"Quantity",value:N.quantity||"",onChange:H}),e.jsx(D,{color:"primary",onClick:J,children:"Add Part"})]}),u.parts.length>0&&e.jsxs(Te,{className:"",children:[e.jsx(Ie,{className:"text-center",children:e.jsxs(he,{children:[e.jsx(te,{children:"Part Name"}),e.jsx(te,{children:"Part Quantity"}),e.jsx(te,{children:"Remove Part"})]})}),e.jsx(Ae,{className:"text-center",children:u.parts.map((s,r)=>e.jsxs(he,{children:[e.jsx(ae,{children:s.partName}),e.jsx(ae,{children:s.quantity}),e.jsx(ae,{children:e.jsx(D,{color:"danger",size:"sm",onClick:()=>se(r),children:"Remove"})})]},r))})]})]})]}),e.jsxs($,{children:[e.jsx(Q,{children:"Checklist Items"}),e.jsx(D,{color:"primary",variant:"outline",className:"m-2",onClick:O,children:"Add Checklist Item"}),u.checklist.map((s,r)=>e.jsxs(_,{className:"mb-2",children:[e.jsx(B,{value:s.task,id:"itemCheckList",onChange:g=>w(r,g.target.value),placeholder:"Enter checklist item",required:!0}),e.jsx(D,{color:"danger",variant:"outline",onClick:()=>le(r),children:"Remove"})]},r))]}),e.jsx(qe,{id:"notes",floatingLabel:"Notes",placeholder:"Notes",value:u.notes,onChange:p,autoComplete:"off",style:{minHeight:"150px",width:"100%",resize:"vertical"},text:" leave empty if no notes.",feedbackInvalid:"Please provide a valid notes."})]})}),e.jsxs(ve,{children:[e.jsx(D,{color:"secondary",variant:"outline",onClick:()=>v(!1),children:"Close"}),e.jsx(D,{color:"primary",variant:"outline",onClick:l,children:I?e.jsx(be,{size:"sm"}):"Update Maintenance"})]})]})]})},dt=({onDeleteMaintenance:n,onUpdateMaintenance:a,maintenance:h,onCompleted:f,vehicles:M,loading:I,error:x,selectedMaintenanceId:L})=>{const m=De(),{showError:y,showSuccess:v}=ce(),A=["admin","chief mechanic"],[F,k]=i.useState(null),[c,V]=i.useState(""),[u,T]=i.useState([]),[R,z]=i.useState(!1),[N,o]=i.useState(1),[j]=i.useState(10),p=N*j,H=p-j,J=u.slice(H,p),O=Math.ceil(u.length/j),[se,le]=i.useState(""),[w,W]=i.useState({checklist:[]}),[re,oe]=i.useState(!0);i.useEffect(()=>{L&&(le(L.toString()),setTimeout(()=>{const t=document.getElementById(`maintenance-${L}`);t&&t.scrollIntoView({behavior:"smooth",block:"center"})},100))},[L]),i.useEffect(()=>{T(h)},[h]),console.log(h);const l=t=>{W(t),z(!0)},d=()=>{W(null),z(!1)},s=async(t,b)=>{var q,X;try{const Y=Le(),Z=await U.patch(`api/v1/maintenance/${t}/checklist/${b}`,{completedBy:Y});Z.data.success&&(T(Fe=>Fe.map(Ee=>Ee._id===t?Z.data.data:Ee)),(w==null?void 0:w._id)===t&&W(Z.data.data),v(Z.data.message))}catch(Y){console.error("Error updating checklist:",Y),y(((X=(q=Y.response)==null?void 0:q.data)==null?void 0:X.message)||"Error updating checklist item")}},r=t=>t?`${t.brand||""} ${t.model||""} ${t.regisNumber||""}`.trim():"N/A";i.useEffect(()=>{(()=>{if(o(1),c==="")T(h);else{const b=h.filter(q=>{var X,Y,Z;return((X=q.vehicle)==null?void 0:X.regisNumber.toLowerCase().includes(c.toLowerCase()))||((Y=q.vehicle)==null?void 0:Y.brand.toLowerCase().includes(c.toLowerCase()))||((Z=q.vehicle)==null?void 0:Z.model.toLowerCase().includes(c.toLowerCase()))||q.maintenanceType.toLowerCase().includes(c.toLowerCase())||q.priority.toLowerCase().includes(c.toLowerCase())||q.status.toLowerCase().includes(c.toLowerCase())});T(b),b.length===0?k("No vehicles found"):k(null)}})()},[c,h]);const g=t=>{switch(t){case"Completed":return"green";case"Scheduled":return"orange";case"In Progress":return"yellow";default:return"black"}},S=[{value:"Completed",label:"Completed"},{value:"Scheduled",label:"Scheduled"},{value:"In Progress",label:"In Progress"}],C=({icon:t})=>{const[b,q]=i.useState(!1);return e.jsx(ie,{icon:t,bounce:b,onMouseEnter:()=>q(!0),onMouseLeave:()=>q(!1)})};return e.jsxs(e.Fragment,{children:[e.jsx($,{className:"mt-3",children:e.jsxs(_,{className:"mb-3",children:[e.jsx(B,{type:"text",placeholder:"Search",id:"search",value:c,onChange:t=>V(t.target.value)}),e.jsx(Xe,{children:e.jsx(ie,{icon:Oe})})]})}),e.jsx(Ye,{activeItemKey:se||void 0,className:"m-2",children:J.map((t,b)=>e.jsxs(Ze,{itemKey:t._id.toString(),id:`maintenance-${t._id}`,children:[e.jsxs(et,{className:"d-flex justify-content-between",children:[e.jsx($,{children:e.jsxs("ul",{className:"list-unstyled",children:[e.jsxs("li",{children:["Vehicle: ",e.jsx("strong",{children:r(t.vehicle)})]}),e.jsxs("li",{children:["Priority: ",e.jsx("strong",{children:t.priority||"N/A"})]}),e.jsxs("li",{children:["Purchase Status:"," ",t.purchased?e.jsx(ge,{color:"success",children:"Complete"}):e.jsx(ge,{color:"warning",children:"Awaiting Purchase"})]})]})}),e.jsxs($,{className:"d-flex justify-content-end",children:[e.jsx(ie,{icon:$e,color:g(t.status),className:"m-2 float-end"}),e.jsx("small",{className:"m2 float-end",children:S.find(q=>q.value===t.status).label})]})]}),e.jsxs(tt,{children:[e.jsxs(Q,{children:["Maintenance Type: ",t.maintenanceType||"N/A"]}),e.jsxs(Q,{children:["Start Date:"," ",t.startDate?new Date(t.startDate).toLocaleDateString():"N/A"]}),e.jsxs(Q,{children:["Expected Date:"," ",t.expectedEndDate?new Date(t.expectedEndDate).toLocaleDateString():"N/A"]}),e.jsxs(Q,{children:["Description: ",t.description||"N/A"]}),e.jsxs(Q,{children:["Category: ",t.category||"N/A"]}),e.jsxs(Q,{children:["Notes: ",t.notes||"N/A"]}),e.jsxs(Q,{children:["Completed By: ",t.completedBy||"N/A"]}),e.jsxs(xe,{className:"mt-3",children:[e.jsx(ye,{children:e.jsx("strong",{children:"Parts Required"})}),e.jsx(ne,{children:t.parts&&t.parts.length>0?e.jsx(e.Fragment,{children:e.jsx(Ne,{children:t.parts.map((q,X)=>e.jsxs(Se,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("div",{children:e.jsx("strong",{children:q.partName})}),e.jsx("div",{className:"d-flex gap-3",children:e.jsxs(ge,{color:"primary",children:["Qty: ",q.quantity]})})]},X))})}):e.jsx(de,{color:"info",children:"No parts listed for this maintenance"})})]}),e.jsx($,{className:"d-flex align-center  mt-3",children:e.jsxs(Ue,{children:[e.jsx(Ke,{color:"secondary",variant:"outline",children:"Actions"}),e.jsx(Je,{children:e.jsxs($,{className:"d-flex flex-column justify-content-center",children:[A.includes(m)&&e.jsx(ot,{maintenance:t,onUpdateMaintenance:a,vehicles:M,disabled:t.status==="Completed"}),e.jsxs(D,{color:"success",className:"m-1",variant:"outline",onClick:()=>l(t),disabled:t.purchased===!1&&t.parts.length>0,children:[e.jsx(C,{icon:Qe})," Checklist"]}),e.jsxs(D,{color:"danger",className:"m-1",variant:"outline",onClick:()=>n(t._id),children:[e.jsx(C,{icon:Ge})," Delete"]})]})})]})})]})]},t._id))}),u.length>0&&e.jsxs($,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs($,{children:["Showing ",H+1," to ",Math.min(p,u.length)," ","of ",u.length," entries"]}),e.jsxs(at,{className:"mt-3",children:[e.jsx(je,{disabled:N===1,onClick:()=>o(t=>Math.max(t-1,1)),children:"Previous"}),Array.from({length:O},(t,b)=>b+1).map(t=>e.jsx(je,{active:t===N,onClick:()=>o(t),children:t},t)),e.jsx(je,{disabled:N===O,onClick:()=>o(t=>Math.min(t+1,O)),children:"Next"})]})]}),F&&e.jsx(de,{color:"danger",children:F}),e.jsxs(ue,{visible:R,onClose:d,size:"lg",children:[e.jsx(pe,{children:e.jsxs(fe,{children:["Maintenance Checklist - ",r(w==null?void 0:w.vehicle)]})}),e.jsx(me,{children:w!=null&&w.checklist&&w.checklist.length>0?e.jsx("div",{className:"checklist-container",children:e.jsx("ul",{className:"list-group",children:w.checklist.map((t,b)=>e.jsxs("li",{className:"list-group-item d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx(ke,{type:"checkbox",id:`checkBoxList-${b}`,checked:t.completed,onChange:()=>s(w._id,b),disabled:!A.includes(m)||w.status==="Completed",className:"me-2"})," ",t.task]}),t.completed&&e.jsxs("small",{className:"text-muted",children:["Completed by: ",t.completedBy," at"," ",new Date(t.completedAt).toLocaleString()]})]},b))})}):e.jsx("p",{className:"text-center",children:"No checklist items available"})}),e.jsxs(ve,{children:[w&&e.jsx(ct,{maintenance:w,isLoading:re,onCompleted:f,disabled:!A.includes(m)}),e.jsx(D,{color:"secondary",onClick:d,children:"Close"})]})]})]})},Ft=()=>{var N;const[n,a]=i.useState([]),[h,f]=i.useState([]),[M,I]=i.useState(!0),[x,L]=i.useState(null),{showError:m,showSuccess:y}=ce(),[v,A]=i.useState(((N=location.state)==null?void 0:N.selectedMaintenanceId)||null),[F,k]=i.useState(!1),c=async()=>{var o,j;I(!0);try{const[p,H]=await Promise.all([U.get("/api/v1/maintenance/all"),U.get("/api/v1/vehicle")]);a(p.data.data),f(H.data.date)}catch(p){L(p.message),m(((j=(o=p.response)==null?void 0:o.data)==null?void 0:j.message)||"Error fetching data")}finally{I(!1)}};if(i.useEffect(()=>{c()},[]),M)return e.jsx(be,{color:"primary",size:"sm",children:"Loading..."});const V=o=>{A(o),k(!0)},u=async()=>{try{await U.delete(`/api/v1/maintenance/delete/${v}`),a(o=>o.filter(j=>j._id!==v)),y("Maintenance deleted successfully"),k(!1)}catch(o){m(o.response.data.message)}finally{k(!1)}c()},T=o=>{a(j=>[...j,o]),c()},R=o=>{a(j=>j.map(p=>p._id===o._id?o:p)),c()},z=o=>{a(j=>j.map(p=>p._id===o._id?o:p)),c()};return e.jsxs(e.Fragment,{children:[e.jsxs($,{children:[e.jsx(Q,{children:"Maintenance Management"}),e.jsx(xe,{children:e.jsxs(ne,{children:[e.jsx($,{children:e.jsx(nt,{onAddMaintenance:T})}),e.jsxs(st,{activeItemKey:"Maintenance List",children:[e.jsx(lt,{variant:"tabs",children:e.jsx(rt,{itemKey:"Maintenance List",children:"Maintenance List"})}),e.jsx(We,{children:e.jsx(it,{itemKey:"Maintenance List",children:e.jsx(ne,{className:"md-3",children:e.jsx(dt,{vehicles:h,maintenance:n,onCompleted:R,error:x,onDeleteMaintenance:V,onUpdateMaintenance:z,loading:M,selectedMaintenanceId:v})})})})]})]})})]}),e.jsxs(ue,{visible:F,onClose:()=>k(!1),alignment:"center",children:[e.jsx(pe,{children:e.jsx(fe,{children:"Delete Maintenance"})}),e.jsx(me,{children:"Are you sure you want to delete this maintenance?"}),e.jsxs(ve,{children:[e.jsx(D,{color:"secondary",variant:"outline",onClick:()=>k(!1),children:"Cancel"}),e.jsx(D,{color:"danger",variant:"outline",onClick:u,children:"Delete"})]})]})]})};export{Ft as default};
