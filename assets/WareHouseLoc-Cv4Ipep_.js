import{r as s,_ as me,a as L,R as W,c as fe,P as c,d as he,A as pe,j as e,C as T,x as $,z as xe,i as ge}from"./index-DewLwpri.js";import{C as je,F as O,i as Ce,j as be,h as ye,g as ve}from"./index-BP5c0LE7.js";import{a as E}from"./CButton-OiCnr5Nw.js";import{C as se,a as ae,b as te,c as oe,d as re}from"./CModalTitle-NWMiK1O_.js";import{a as A,C as ne}from"./CForm-BI8XSZr1.js";import{C as R}from"./CFormInput-Ca8VBleV.js";import{C as Ne}from"./CContainer-B97CIy0o.js";import{C as Se,a as we}from"./CInputGroupText-BIW95Qg1.js";import{C as ke}from"./CCard-CFLl5Ql0.js";import{u as Pe,C as le}from"./DefaultLayout-BqKHfPL2.js";import{C as Le}from"./CCardBody-bDybmbb_.js";import{C as Te,a as We,b as Z,c as D,d as Ee,e as H}from"./CTable-cyGIrOeT.js";import{u as Ae}from"./CCloseButton-BLvC_O-1.js";import{g as Fe,e as Ie}from"./getRTLPlacement-DQw_1sA4.js";import{C as Re,a as q}from"./CPaginationItem-BFb7P7QC.js";import"./index.esm-DGgU1JFB.js";import"./cil-user-Ddrdy7PS.js";import"./CImage-nqedqkVp.js";import"./getTransitionDurationFromElement-Cpu4p4hx.js";var I=s.forwardRef(function(a,C){var b=a.children,d=a.animation,x=d===void 0?!0:d,t=a.className,u=a.container,g=a.content,f=a.delay,l=f===void 0?0:f,n=a.fallbackPlacements,i=n===void 0?["top","right","bottom","left"]:n,o=a.offset,v=o===void 0?[0,6]:o,y=a.onHide,w=a.onShow,h=a.placement,k=h===void 0?"top":h,p=a.popperConfig,N=a.trigger,j=N===void 0?["hover","focus"]:N,m=a.visible,r=me(a,["children","animation","className","container","content","delay","fallbackPlacements","offset","onHide","onShow","placement","popperConfig","trigger","visible"]),S=s.useRef(null),P=s.useRef(null),_=Ae(C,S),B="tooltip".concat(s.useId()),G=s.useState(!1),V=G[0],J=G[1],Q=s.useState(m),F=Q[0],K=Q[1],U=Pe(),ie=U.initPopper,ce=U.destroyPopper,de=U.updatePopper,X=typeof l=="number"?{show:l,hide:l}:l,Y={modifiers:[{name:"arrow",options:{element:".tooltip-arrow"}},{name:"flip",options:{fallbackPlacements:i}},{name:"offset",options:{offset:v}}],placement:Fe(k,P.current)},ue=L(L({},Y),typeof p=="function"?p(Y):p);s.useEffect(function(){if(m){M();return}z()},[m]),s.useEffect(function(){if(V&&P.current&&S.current){ie(P.current,S.current,ue),setTimeout(function(){K(!0)},X.show);return}!V&&P.current&&S.current&&ce()},[V]),s.useEffect(function(){!F&&P.current&&S.current&&Ie(function(){J(!1)},S.current)},[F]);var M=function(){J(!0),w&&w()},z=function(){setTimeout(function(){K(!1),y&&y()},X.hide)};return s.useEffect(function(){de()},[g]),W.createElement(W.Fragment,null,W.cloneElement(b,L(L(L(L(L({},F&&{"aria-describedby":B}),{ref:P}),(j==="click"||j.includes("click"))&&{onClick:function(){return F?z():M()}}),(j==="focus"||j.includes("focus"))&&{onFocus:function(){return M()},onBlur:function(){return z()}}),(j==="hover"||j.includes("hover"))&&{onMouseEnter:function(){return M()},onMouseLeave:function(){return z()}})),W.createElement(je,{container:u,portal:!0},V&&W.createElement("div",L({className:fe("tooltip","bs-tooltip-auto",{fade:x,show:F},t),id:B,ref:_,role:"tooltip"},r),W.createElement("div",{className:"tooltip-arrow"}),W.createElement("div",{className:"tooltip-inner"},g))))});I.propTypes={animation:c.bool,children:c.node,container:c.any,content:c.oneOfType([c.string,c.node]),delay:c.oneOfType([c.number,c.shape({show:c.number.isRequired,hide:c.number.isRequired})]),fallbackPlacements:pe,offset:c.any,onHide:c.func,onShow:c.func,placement:c.oneOf(["auto","top","right","bottom","left"]),popperConfig:c.oneOfType([c.func,c.object]),trigger:he,visible:c.bool};I.displayName="CTooltip";const Be=({onAddWarehouseLoc:a})=>{const[C,b]=s.useState(!1),[d,x]=s.useState(!1),[t,u]=s.useState(!1),[g,f]=s.useState(null),[l,n]=s.useState(null),i={warehouseName:"",address:""},[o,v]=s.useState(i),y=h=>{const{id:k,value:p}=h.target;v(N=>({...N,[k]:p}))},w=async h=>{const p=h.currentTarget.checkValidity();if(p||(h.preventDefault(),h.stopPropagation()),b(p),p){const j=JSON.parse(sessionStorage.getItem("user")).email;if(!j){f("User email not found. Please log in again.");return}u(!0);try{const m=await $.post("/api/v1/warehouseLoc/add",{...o,createdBy:j});m.status===201&&(n(m.data.message),a(m.data.data),setTimeout(()=>{u(!1),n(null),x(!1),f(null),v(i),b(!1)},2e3))}catch(m){f(m.response.data.message),setTimeout(()=>{f(null)},2e3)}u(!1)}};return e.jsx(e.Fragment,{children:t?e.jsx(T,{color:"primary",size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsxs(E,{color:"primary",variant:"outline",disabled:t,onClick:()=>x(!0),children:[t?e.jsx(T,{color:"secondary",size:"sm"}):e.jsx(O,{icon:Ce})," ","Add Warehouse Location"]}),e.jsxs(se,{visible:d,onClose:()=>x(!1),children:[e.jsx(ae,{closeButton:!0,children:e.jsx(te,{children:"Add Warehouse Location"})}),g&&e.jsx(A,{color:"danger",className:"m-3",children:g}),l&&e.jsx(A,{color:"success",className:"m-3",children:l}),e.jsx(oe,{children:e.jsxs(ne,{noValidate:!0,validated:C,children:[e.jsx(R,{type:"text",id:"warehouseName",className:"mb-3",placeholder:"Warehouse Name",floatingLabel:"Warehouse Name",onChange:y,value:o.warehouseName,autoComplete:"off",required:!0,feedbackInvalid:"Please enter a warehouse name",feedbackValid:"Looks good!"}),e.jsx(R,{type:"text",id:"address",className:"mb-3",placeholder:"Address",floatingLabel:"Address",onChange:y,value:o.address,autoComplete:"off",required:!0,feedbackInvalid:"Please enter an address",feedbackValid:"Looks good!"})]})}),e.jsxs(re,{children:[e.jsx(E,{color:"secondary",variant:"outline",disabled:t,onClick:()=>{x(!1),v(i),x(!1),f(null),b(!1)},children:t?e.jsx(T,{color:"secondary",size:"sm"}):"Cancel"}),e.jsx(E,{color:"primary",variant:"outline",disabled:t,onClick:w,children:t?e.jsx(T,{color:"primary",size:"sm"}):"Add"})]})]})]})})},Ve=({warehouseLoc:a,onDeleteWarehouseLoc:C})=>{const[b,d]=s.useState(!1),[x,t]=s.useState(null),u=async()=>{d(!0);try{(await $.delete(`/api/v1/warehouseLoc/delete/${a._id}`)).status===200&&(alert("Warehouse Location deleted successfully"),C(a._id),d(!1),t(null))}catch(g){t(g)}finally{d(!1)}};return x?e.jsxs(A,{color:"danger",className:"text-center mt-5 w-75 mx-auto",children:["Error: ",x.message]}):e.jsx(e.Fragment,{children:e.jsx(E,{color:"danger",disabled:b,variant:"outline",onClick:u,className:"me-2",children:b?e.jsx(T,{size:"sm"}):e.jsx(O,{icon:be})})})},Me=({warehouseLoc:a,onUpdateWarehouseLoc:C})=>{const[b,d]=s.useState(!1),[x,t]=s.useState(!1),[u,g]=s.useState(!1),[f,l]=s.useState(null),[n,i]=s.useState(null),[o,v]=s.useState({warehouseName:a.warehouseName,address:a.address}),y=h=>{const{id:k,value:p}=h.target;v(N=>({...N,[k]:p}))},w=async h=>{const p=h.currentTarget.checkValidity();p||(h.preventDefault(),h.stopPropagation()),t(p);const j=JSON.parse(sessionStorage.getItem("user")).email;if(!j){l("User email not found. Please log in again.");return}g(!0);try{const m=await $.put(`/api/v1/warehouseLoc/update/${a._id}`,{...o,createdBy:j});m.status===200&&(i("Warehouse Location updated successfully"),C(m.data.data),setTimeout(()=>{i(null),d(!1),l(null),t(!1)},2e3))}catch(m){l(m.response.data.message),setTimeout(()=>{l(null)},2e3)}g(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(E,{color:"primary",variant:"outline",disabled:u,onClick:()=>d(!0),className:"me-2",children:u?e.jsx(T,{size:"sm"}):e.jsx(O,{icon:ye})}),e.jsxs(se,{visible:b,onClose:()=>d(!1),children:[e.jsx(ae,{closeButton:!0,children:e.jsx(te,{children:"Update Warehouse Location"})}),f&&e.jsx(A,{color:"danger",className:"m-3",children:f}),n&&e.jsx(A,{color:"success",className:"m-3",children:n}),e.jsx(oe,{children:e.jsxs(ne,{noValidate:!0,validated:x,children:[e.jsx(R,{type:"text",id:"warehouseName",className:"mb-3",placeholder:"Warehouse Name",floatingLabel:"Warehouse Name",onChange:y,value:o.warehouseName,autoComplete:"off",required:!0,feedbackInvalid:"Please enter a warehouse name.",feedbackValid:"Looks good!"}),e.jsx(R,{type:"text",id:"address",className:"mb-3",placeholder:"Address",floatingLabel:"Address",onChange:y,value:o.address,autoComplete:"off",required:!0,feedbackInvalid:"Please enter an address.",feedbackValid:"Looks good!"})]})}),e.jsxs(re,{children:[e.jsx(E,{color:"secondary",variant:"outline",disabled:u,onClick:()=>{d(!1),l(null),t(!1)},children:u?e.jsx(T,{size:"sm",color:"secondary"}):"Cancel"}),e.jsx(E,{color:"primary",variant:"outline",disabled:u,onClick:w,children:u?e.jsx(T,{size:"sm",color:"success"}):"Update"})]})]})]})},ze=({warehouseLoc:a,loading:C,error:b,onDeleteWarehouseLoc:d,onUpdateWarehouseLoc:x})=>{const[t,u]=s.useState(""),[g,f]=s.useState([]),[l,n]=s.useState(1),[i,o]=s.useState(null),v=10,y=xe(),w=["manager","admin"],h="admin";if(s.useEffect(()=>{f(a)},[a]),s.useEffect(()=>{if(t==="")f(a);else{const r=a.filter(S=>{const P=S.warehouseName.toLowerCase().includes(t.toLowerCase()),_=S.address.toLowerCase().includes(t.toLowerCase()),B=w.includes(y)&&S.createdBy.toLowerCase().includes(t.toLowerCase());return P||_||B});f(r),n(1),r.length===0?o("No results found"):o(null)}},[t,a]),a.length===0)return e.jsx(A,{color:"danger",className:"text-center mt-5 w-75 mx-auto justify-content-center",children:"No Warehouse Location Found"});const k=r=>{u(r.target.value)},p=l*v,N=p-v,j=g.slice(N,p),m=Math.ceil(g.length/v);return e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"m-3",children:e.jsxs(Se,{className:"w-50 mb-3",children:[e.jsx(R,{type:"text",id:"search",value:t,onChange:k,placeholder:"Search Warehouse Location..."}),e.jsx(we,{children:e.jsx(O,{icon:ve})})]})}),e.jsxs(ke,{children:[e.jsx(le,{children:"Warehouse Location List"}),e.jsxs(Le,{className:"md-3",children:[e.jsxs(Te,{bordered:!0,hover:!0,responsive:!0,className:"mx-auto ",children:[e.jsx(We,{className:"text-center  ",children:e.jsxs(Z,{children:[e.jsx(D,{className:"fixed-width bg-secondary",children:"Warehouse Name"}),e.jsx(D,{className:"fixed-width bg-secondary",children:"Address"}),h.includes(y)&&e.jsx(D,{className:"fixed-width bg-secondary",children:"Created By"}),e.jsx(D,{className:"fixed-width bg-secondary",children:"Actions"})]})}),e.jsx(Ee,{className:"text-center",children:j.map(r=>e.jsxs(Z,{children:[e.jsx(H,{className:"fixed-width",children:e.jsx(I,{content:r.warehouseName,children:e.jsx("span",{children:r.warehouseName})})}),e.jsx(H,{className:"fixed-width",children:e.jsx(I,{content:r.address,children:e.jsx("span",{children:r.address})})}),h.includes(y)&&e.jsx(H,{className:"fixed-width",color:"danger",children:e.jsx(I,{content:r.createdBy,children:e.jsx("span",{children:r.createdBy})})}),e.jsxs(H,{className:"fixed-width",children:[e.jsx(Me,{warehouseLoc:r,onUpdateWarehouseLoc:x}),w.includes(y)&&e.jsx(Ve,{warehouseLoc:r,onDeleteWarehouseLoc:d})]})]},r._id))})]}),i&&e.jsx(A,{color:"danger",className:"text-center mt-5 w-75 mx-auto justify-content-center",children:i}),e.jsxs(Re,{align:"center",children:[e.jsx(q,{disabled:l===1,onClick:()=>n(r=>Math.max(r-1,1)),children:"Previous"}),[...Array(m).keys()].map(r=>e.jsx(q,{active:r+1===l,onClick:()=>n(r+1),children:r+1},r+1)),e.jsx(q,{disabled:l===m,onClick:()=>n(r=>Math.min(r+1,m)),children:"Next"})]})]})]})]})},ee=sessionStorage.getItem("accessToken"),De="http://localhost:5057",He=ge.create({baseURL:De,withCredentials:!0,headers:{"Content-Type":"application/json",...ee&&{Authorization:`Bearer ${ee}`}}}),ls=()=>{const[a,C]=s.useState([]),[b,d]=s.useState(!1),[x,t]=s.useState(null),u=async()=>{var n,i;d(!0);try{const o=await He.get("/api/v1/warehouseLoc/locations");o.status===200?C(o.data.data):t(o.data.message)}catch(o){t(((i=(n=o.response)==null?void 0:n.data)==null?void 0:i.message)||o.message)}finally{d(!1)}};s.useEffect(()=>{u()},[]);const g=n=>{C(i=>[...i,n])},f=n=>{C(i=>i.filter(o=>o._id!==n))},l=n=>{C(i=>i.map(o=>o._id===n._id?n:o))};return e.jsxs(e.Fragment,{children:[e.jsx(le,{children:"Warehouse location"}),e.jsx(Be,{onAddWarehouseLoc:g}),e.jsx(ze,{warehouseLoc:a,loading:b,error:x,onDeleteWarehouseLoc:f,onUpdateWarehouseLoc:l})]})};export{ls as default};
