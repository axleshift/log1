import{r as n,_ as Ce,u as Ve,R as S,a as G,c as ee,P,b as Re,l as oe,j as e,k as be,n as K,A as ye,F as Le}from"./index-CCpuMsxg.js";import{s as Be,F as ie,H as ze,t as He,m as Oe,a as ge,u as $e,M as Qe,v as _e}from"./index-BH_j_LWQ.js";import{C as Ge,a as w}from"./CButton-DmAcw923.js";import{C as ue,a as me,b as pe,c as fe}from"./CModalHeader-Rzzbjfxy.js";import{C as ve}from"./CModalTitle-B84FLqNc.js";import{C as ne}from"./CAlert-ChSBoc-l.js";import{C as we}from"./CForm-zbc4HfKx.js";import{C as U}from"./CInputGroup-CsKY1hXR.js";import{C as Y}from"./CFormSelect-BDrz7j5v.js";import{a as De,b as Me,C as O}from"./CFormInput-ICgbeGxF.js";import{C as xe}from"./CCard-DvSaj6K8.js";import{C as ke}from"./CCardHeader-BjcFUD05.js";import{C as ce}from"./CCardBody-DGw-jhsr.js";import{C as Te,a as Ie,b as he,c as te,d as Ae,e as ae}from"./CTable-BJmfdTuO.js";import{C as Q}from"./CContainer-CMja4f4T.js";import{C as _,b as Ue,c as Ke,d as Ye,a as Je}from"./DefaultLayout-C71bViqn.js";import{C as Fe}from"./CFormTextarea-D0H5vPFk.js";import{C as We}from"./CInputGroupText-0Xx9HKpT.js";import{C as Xe,a as Ze,b as et,c as tt}from"./CAccordionHeader-D6O1oWFb.js";import{C as at,a as je}from"./CPaginationItem-OtHycBAd.js";import{C as st,a as lt,b as rt,c as it}from"./CTabList-DUeiatVr.js";import"./index.esm-Ci2Fpm58.js";import"./1-B_VjtQoE.js";import"./cil-user-Ddrdy7PS.js";import"./getTransitionDurationFromElement-Cpu4p4hx.js";var Ne=n.forwardRef(function(r,a){var p=r.className,m=r.button,F=r.feedback,R=r.feedbackInvalid,f=r.feedbackValid,E=r.floatingLabel,o=r.tooltipFeedback,y=r.hitArea,v=r.id,j=r.indeterminate,B=r.inline,q=r.invalid,d=r.label,T=r.reverse,h=r.type,I=h===void 0?"checkbox":h,z=r.valid,$=Ce(r,["className","button","feedback","feedbackInvalid","feedbackValid","floatingLabel","tooltipFeedback","hitArea","id","indeterminate","inline","invalid","label","reverse","type","valid"]),D=n.useRef(null),L=Ve(a,D);n.useEffect(function(){D.current&&j&&(D.current.indeterminate=j)},[j,D.current]);var V=function(){return S.createElement("input",G({type:I,className:ee(m?"btn-check":"form-check-input",{"is-invalid":q,"is-valid":z,"me-2":y}),id:v},$,{ref:L}))},c=function(){return S.createElement(Me,{describedby:$["aria-describedby"],feedback:F,feedbackInvalid:R,feedbackValid:f,floatingLabel:E,invalid:q,tooltipFeedback:o,valid:z})},k=function(){var H;return S.createElement(De,G({customClassName:ee(m?ee("btn",m.variant?"btn-".concat(m.variant,"-").concat(m.color):"btn-".concat(m.color),(H={},H["btn-".concat(m.size)]=m.size,H),"".concat(m.shape)):"form-check-label")},v&&{htmlFor:v}),d)},A=function(){return m?S.createElement(S.Fragment,null,S.createElement(V,null),d&&S.createElement(k,null),S.createElement(c,null)):d?y?S.createElement(S.Fragment,null,S.createElement(V,null),S.createElement(De,G({customClassName:ee("form-check-label stretched-link",p)},v&&{htmlFor:v}),d),S.createElement(c,null)):S.createElement("div",{className:ee("form-check",{"form-check-inline":B,"form-check-reverse":T,"is-invalid":q,"is-valid":z},p)},S.createElement(V,null),S.createElement(k,null),S.createElement(c,null)):S.createElement(V,null)};return S.createElement(A,null)});Ne.propTypes=G({button:P.object,className:P.string,hitArea:P.oneOf(["full"]),id:P.string,indeterminate:P.bool,inline:P.bool,label:P.oneOfType([P.string,P.node]),reverse:P.bool,type:P.oneOf(["checkbox","radio"])},Me.propTypes);Ne.displayName="CFormCheck";var Se=n.forwardRef(function(r,a){var p,m=r.children,F=r.as,R=F===void 0?"ul":F,f=r.className,E=r.flush,o=r.layout,y=Ce(r,["children","as","className","flush","layout"]);return S.createElement(R,G({className:ee("list-group",(p={"list-group-flush":E},p["list-group-".concat(o)]=o,p),f)},y,{ref:a}),m)});Se.propTypes={as:P.elementType,children:P.node,className:P.string,flush:P.bool,layout:P.oneOf(["horizontal","horizontal-sm","horizontal-md","horizontal-lg","horizontal-xl","horizontal-xxl"])};Se.displayName="CListGroup";var Pe=n.forwardRef(function(r,a){var p,m=r.children,F=r.active,R=r.as,f=R===void 0?"li":R,E=r.className,o=r.disabled,y=r.color,v=Ce(r,["children","active","as","className","disabled","color"]),j=f==="a"||f==="button"?Ge:f;return v=G(G(G(G({},(f==="a"||f==="button")&&{active:F,disabled:o,as:f,ref:a}),F&&{"aria-current":!0}),o&&{"aria-disabled":!0}),v),S.createElement(j,G({className:ee("list-group-item",(p={},p["list-group-item-".concat(y)]=y,p["list-group-item-action"]=f==="a"||f==="button",p.active=F,p.disabled=o,p),E)},v),m)});Pe.propTypes={active:P.bool,as:P.elementType,children:P.node,className:P.string,color:Re,disabled:P.bool};Pe.displayName="CListGroupItem";const nt=({onAddMaintenance:r})=>{const{showError:a,showSuccess:p}=oe(),[m,F]=n.useState(!1),[R,f]=n.useState(null),[E,o]=n.useState(!1),[y,v]=n.useState(!1),[j,B]=n.useState(!1),q={vehicle:"",maintenanceType:"",startDate:"",expectedEndDate:"",description:"",priority:"",category:"",checklist:[{task:"",completed:!1}],parts:[],requested:!0,purchased:!1},[d,T]=n.useState(q),[h,I]=n.useState([]),[z,$]=n.useState({partName:"",quantity:""}),D=new Date().toISOString().split("T")[0],L=l=>{const{id:u,value:s}=l.target;T(i=>({...i,[u]:s}))},V=l=>{const{id:u,value:s}=l.target;$(i=>({...i,[u.split(".")[1]]:s}))},c=()=>{T(l=>({...l,parts:[...l.parts,{...z}]})),$({partName:"",quantity:""})};n.useEffect(()=>{(async()=>{try{const u=await K.get("api/v1/vehicle/all");u.data.success&&I(u.data.data)}catch(u){f(u),a(u.message)}})()},[]);const k=()=>{T(l=>({...l,checklist:[...l.checklist,{task:"",completed:!1}]}))},A=l=>{T(u=>({...u,parts:u.parts.filter((s,i)=>i!==l)}))},H=l=>{T(u=>({...u,checklist:u.checklist.filter((s,i)=>i!==l)}))},se=(l,u)=>{T(s=>({...s,checklist:s.checklist.map((i,x)=>x===l?{...i,task:u}:i)}))},le=[{label:"High",value:"High"},{label:"Medium",value:"Medium"},{label:"Low",value:"Low"},{label:"Critical",value:"Critical"}],M=[{label:"Engine",value:"Engine"},{label:"Transmission",value:"Transmission"},{label:"Brakes",value:"Brakes"},{label:"Electrical",value:"Electrical"},{label:"Tiers",value:"Tiers"},{label:"Other",value:"Other"}],J=[{label:"Preventive",value:"PMS"},{label:"Corrective",value:"Corrective"},{label:"Emergency",value:"Emergency"}],re=async l=>{var s,i,x,N;if(l.preventDefault(),d.parts.length===0?d.purchased=!0:d.purchased=!1,l.currentTarget.checkValidity()===!1)l.stopPropagation(),l.preDefault();else try{const C=await K.post("api/v1/maintenance/create",d);C.data.success&&(p(C.data.message),r(C.data.data),o(!1))}catch(C){a(((i=(s=C.response)==null?void 0:s.data)==null?void 0:i.message)||C.message),f(((N=(x=C.response)==null?void 0:x.data)==null?void 0:N.message)||C.message),setTimeout(()=>{f(null)},2e3)}v(!0)},de=({icon:l})=>{const[u,s]=n.useState(!1);return e.jsx(ie,{icon:l,bounce:u,onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1)})};return e.jsxs(e.Fragment,{children:[e.jsxs(w,{color:"primary",className:"mb-3",variant:"outline",onClick:()=>o(!0),children:[e.jsx(de,{icon:Be})," Add Maintenance"]}),e.jsxs(ue,{visible:E,onClose:()=>o(!1),size:"lg",children:[e.jsx(me,{closeButton:!0,children:e.jsx(ve,{children:"Add Maintenance"})}),R&&e.jsx(ne,{color:"danger",children:R}),e.jsx(pe,{children:e.jsxs(we,{className:"row g-3 needs-validation",noValidate:!0,validated:y,children:[e.jsxs(U,{children:[e.jsxs(Y,{id:"vehicle",value:d.vehicle,onChange:L,floatingLabel:"Vehicle",placeholder:"Select Vehicle",required:!0,feedbackInvalid:"Please provide a valid vehicle.",children:[e.jsx("option",{value:"",children:"Select Vehicle"}),h.filter(l=>(l.status==="in_use"||l.status==="available")&&!l.deleted).map(l=>e.jsxs("option",{value:l._id,children:[l.brand," / ",l.model," / ",l.regisNumber]},l._id))]}),e.jsx(Y,{id:"maintenanceType",value:d.maintenanceType,onChange:L,floatingLabel:"Maintenance Type",placeholder:"Select Maintenance Type",required:!0,options:[{label:"Select Maintenance Type",value:""},...J],feedbackInvalid:"Please provide a valid maintenance type."}),e.jsx(O,{id:"description",type:"text",floatingLabel:"Description",placeholder:"Description",required:!0,value:d.description,onChange:L,feedbackInvalid:"Please provide a valid description."})]}),e.jsxs(U,{children:[e.jsx(O,{id:"startDate",type:"date",floatingLabel:"Start Date",placeholder:"Start Date",required:!0,min:D,value:d.startDate,onChange:L,feedbackInvalid:"Please provide a valid start date."}),e.jsx(O,{id:"expectedEndDate",type:"date",floatingLabel:"Expected End Date",placeholder:"Expected End Date",required:!0,min:D,value:d.expectedEndDate,onChange:L,feedbackInvalid:"Please provide a valid expected end date."}),e.jsxs(Y,{id:"priority",value:d.priority,onChange:L,floatingLabel:"Priority",placeholder:"Select Priority",required:!0,feedbackInvalid:"Please provide a valid priority.",children:[e.jsx("option",{value:"",children:"Select Priority"}),le.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))]}),e.jsxs(Y,{id:"category",value:d.category,onChange:L,floatingLabel:"Category",placeholder:"Select Category",required:!0,feedbackInvalid:"Please provide a valid category.",children:[e.jsx("option",{value:"",children:"Select Category"}),M.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))]})]}),e.jsxs(xe,{className:"mb-3",children:[e.jsx(ke,{children:"Add Parts"}),e.jsxs(ce,{children:[e.jsxs(U,{className:"mb-3",children:[e.jsx(O,{id:"parts.partName",type:"text",floatingLabel:"Part Name",placeholder:"Part Name",value:z.partName,onChange:V}),e.jsx(O,{id:"parts.quantity",type:"number",floatingLabel:"Quantity",placeholder:"Quantity",value:z.quantity,onChange:V}),e.jsx(w,{color:"primary",onClick:c,children:"Add Part"})]}),d.parts.length>0&&e.jsxs(Te,{className:"",children:[e.jsx(Ie,{className:"text-center",children:e.jsxs(he,{children:[e.jsx(te,{children:"Part Name"}),e.jsx(te,{children:"Part Quantity"}),e.jsx(te,{children:"Remove Part"})]})}),e.jsx(Ae,{className:"text-center",children:d.parts.map((l,u)=>e.jsxs(he,{children:[e.jsx(ae,{children:l.partName}),e.jsx(ae,{children:l.quantity}),e.jsx(ae,{children:e.jsx(w,{color:"danger",size:"sm",onClick:()=>A(u),children:"Remove"})})]},u))})]})]})]}),e.jsxs(Q,{children:[e.jsx(_,{children:"Checklist Items"}),e.jsx(w,{color:"primary",variant:"outline",className:"m-2",onClick:k,children:"Add Checklist Item"}),d.checklist.map((l,u)=>e.jsxs(U,{className:"mb-2",children:[e.jsx(O,{value:l.task,id:"itemCheckList",onChange:s=>se(u,s.target.value),placeholder:"Enter checklist item",required:!0}),e.jsx(w,{color:"danger",variant:"outline",onClick:()=>H(u),children:"Remove"})]},u))]}),e.jsx(Fe,{id:"notes",floatingLabel:"Notes",placeholder:"Notes",value:d.notes,onChange:L,autoComplete:"off",style:{minHeight:"150px",width:"100%",resize:"vertical"},text:" leave empty if no notes.",feedbackInvalid:"Please provide a valid notes."})]})}),e.jsxs(fe,{children:[e.jsx(w,{color:"secondary",variant:"outline",onClick:()=>o(!1),children:"Close"}),e.jsx(w,{color:"primary",variant:"outline",onClick:re,children:m?e.jsx(be,{size:"sm"}):"Add Maintenance"})]})]})]})},ct=({onCompleted:r,maintenance:a})=>{var o;const{showSuccess:p,showError:m}=oe(),F=ye(),R=["admin","super admin","chief mechanic"];if(!a||!a.checklist)return null;const f=()=>{const y=new Date,v=new Date(a.startDate);return y<v},E=async y=>{var v,j;try{const B=Le(),q=await K.patch(`api/v1/maintenance/complete/${y}`,{completedBy:B});q.data.success&&(p(q.data.message),r(q.data.data))}catch(B){const q=((j=(v=B.response)==null?void 0:v.data)==null?void 0:j.message)||"Error completing maintenance";m(q),console.error("Error completing maintenance:",B)}};return e.jsx(e.Fragment,{children:R.includes(F)&&e.jsxs(e.Fragment,{children:[e.jsx(w,{color:"success",variant:"outline",onClick:()=>E(a._id),disabled:!((o=a.checklist)!=null&&o.every(y=>y.completed))||f()||a.status==="Completed",title:f()?"Maintenance cannot be completed before its start date":"",children:"Complete Maintenance"}),f()&&e.jsxs("div",{className:"text-danger mt-2",children:["This maintenance cannot be completed before"," ",new Date(a.startDate).toLocaleDateString()]})]})})},ot=({onUpdateMaintenance:r,maintenance:a,disabled:p})=>{const{showError:m,showSuccess:F}=oe(),[R,f]=n.useState(!1),[E,o]=n.useState(null),[y,v]=n.useState(!1),[j,B]=n.useState(!1),[q,d]=n.useState(!1),T={vehicle:a.vehicle||{},maintenanceType:(a==null?void 0:a.maintenanceType)||"",startDate:a!=null&&a.startDate?a.startDate.split("T")[0]:"",expectedEndDate:a!=null&&a.expectedEndDate?a.expectedEndDate.split("T")[0]:"",description:(a==null?void 0:a.description)||"",priority:(a==null?void 0:a.priority)||"",category:(a==null?void 0:a.category)||"",checklist:(a==null?void 0:a.checklist)||[],parts:(a==null?void 0:a.parts)||[],notes:(a==null?void 0:a.notes)||"",requested:!0,purchased:!1},[h,I]=n.useState(T),[z,$]=n.useState([]),[D,L]=n.useState({partName:"",quantity:""}),V=new Date().toISOString().split("T")[0],c=s=>{const{id:i,value:x}=s.target;if(i==="vehicle"){const N=z.find(C=>C._id===x);I(C=>({...C,vehicle:N}))}else I(N=>({...N,[i]:x}))},k=s=>{const{id:i,value:x}=s.target,N=i.split(".")[1];L(C=>({...C,[N]:N==="quantity"?x===""?"":Number(x):x}))},A=()=>{if(!D.partName||!D.quantity){m("Please fill in both part name and quantity");return}I(s=>({...s,parts:[...s.parts,{...D}]})),L({partName:"",quantity:""})};n.useEffect(()=>{(async()=>{try{const i=await K.get("api/v1/vehicle/all");i.data.success&&$(i.data.data)}catch(i){o(i),m(i.message)}})()},[]);const H=()=>{I(s=>({...s,checklist:[...s.checklist,{task:"",completed:!1}]}))},se=s=>{I(i=>({...i,parts:i.parts.filter((x,N)=>N!==s)}))},le=s=>{I(i=>({...i,checklist:i.checklist.filter((x,N)=>N!==s)}))},M=(s,i)=>{I(x=>({...x,checklist:x.checklist.map((N,C)=>C===s?{...N,task:i}:N)}))},J=[{label:"High",value:"High"},{label:"Medium",value:"Medium"},{label:"Low",value:"Low"},{label:"Critical",value:"Critical"}],re=[{label:"Engine",value:"Engine"},{label:"Transmission",value:"Transmission"},{label:"Brakes",value:"Brakes"},{label:"Electrical",value:"Electrical"},{label:"Tiers",value:"Tiers"},{label:"Other",value:"Other"}],de=[{label:"Preventive",value:"PMS"},{label:"Corrective",value:"Corrective"},{label:"Emergency",value:"Emergency"}],l=async s=>{var x,N,C,t;s.preventDefault(),h.parts.length===0?h.purchased=!0:h.purchased=!1;const i=s.currentTarget;if(B(!0),i.checkValidity()===!1){s.stopPropagation();return}f(!0);try{const b=await K.put(`api/v1/maintenance/update/${a._id}`,h);b.data.success&&(F(b.data.message),r(b.data.data),v(!1))}catch(b){m(((N=(x=b.response)==null?void 0:x.data)==null?void 0:N.message)||b.message),o(((t=(C=b.response)==null?void 0:C.data)==null?void 0:t.message)||b.message),setTimeout(()=>{o(null)},2e3)}finally{f(!1)}},u=({icon:s})=>{const[i,x]=n.useState(!1);return e.jsx(ie,{icon:s,bounce:i,onMouseEnter:()=>x(!0),onMouseLeave:()=>x(!1)})};return e.jsxs(e.Fragment,{children:[e.jsxs(w,{color:"primary",className:"m-1",variant:"outline",onClick:()=>v(!0),disabled:p,children:[p?e.jsx(u,{icon:ze}):e.jsx(u,{icon:He})," ",p?"Complete":"Update"]}),e.jsxs(ue,{visible:y,onClose:()=>v(!1),size:"lg",children:[e.jsx(me,{closeButton:!0,children:e.jsx(ve,{children:"Update Maintenance"})}),E&&e.jsx(ne,{color:"danger",children:E}),e.jsx(pe,{children:e.jsxs(we,{className:"row g-3 needs-validation",noValidate:!0,validated:j,children:[e.jsxs(U,{children:[e.jsx(Y,{id:"vehicle",floatingLabel:"Vehicle",placeholder:"Select Vehicle",required:!0,value:h.vehicle?h.vehicle._id:"",onChange:c,feedbackInvalid:"Please provide a valid vehicle.",disabled:!0,children:e.jsx("option",{value:"",children:`${a.vehicle.brand} / ${a.vehicle.model} / ${a.vehicle.regisNumber}`})}),e.jsx(Y,{id:"maintenanceType",value:h.maintenanceType||"",onChange:c,floatingLabel:"Maintenance Type",placeholder:"Select Maintenance Type",required:!0,options:[{label:"Select Maintenance Type",value:""},...de],feedbackInvalid:"Please provide a valid maintenance type."}),e.jsx(O,{id:"description",type:"text",floatingLabel:"Description",placeholder:"Description",required:!0,value:h.description,onChange:c,feedbackInvalid:"Please provide a valid description."})]}),e.jsxs(U,{children:[e.jsx(O,{id:"startDate",type:"date",floatingLabel:"Start Date",placeholder:"Start Date",required:!0,min:V,value:h.startDate,onChange:c,feedbackInvalid:"Please provide a valid start date."}),e.jsx(O,{id:"expectedEndDate",type:"date",floatingLabel:"Expected End Date",placeholder:"Expected End Date",required:!0,min:V,value:h.expectedEndDate,onChange:c,feedbackInvalid:"Please provide a valid expected end date."}),e.jsxs(Y,{id:"priority",value:h.priority||"",onChange:c,floatingLabel:"Priority",placeholder:"Select Priority",required:!0,feedbackInvalid:"Please provide a valid priority.",children:[e.jsx("option",{value:"",children:"Select Priority"}),J.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),e.jsxs(Y,{id:"category",value:h.category,onChange:c,floatingLabel:"Category",placeholder:"Select Category",required:!0,feedbackInvalid:"Please provide a valid category.",children:[e.jsx("option",{value:"",children:"Select Category"}),re.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]})]}),e.jsxs(xe,{className:"mb-3",children:[e.jsx(ke,{children:"Add Parts"}),e.jsxs(ce,{children:[e.jsxs(U,{className:"mb-3",children:[e.jsx(O,{id:"parts.partName",type:"text",floatingLabel:"Part Name",placeholder:"Part Name",value:D.partName||"",onChange:k}),e.jsx(O,{id:"parts.quantity",type:"number",floatingLabel:"Quantity",placeholder:"Quantity",value:D.quantity||"",onChange:k}),e.jsx(w,{color:"primary",onClick:A,children:"Add Part"})]}),h.parts.length>0&&e.jsxs(Te,{className:"",children:[e.jsx(Ie,{className:"text-center",children:e.jsxs(he,{children:[e.jsx(te,{children:"Part Name"}),e.jsx(te,{children:"Part Quantity"}),e.jsx(te,{children:"Remove Part"})]})}),e.jsx(Ae,{className:"text-center",children:h.parts.map((s,i)=>e.jsxs(he,{children:[e.jsx(ae,{children:s.partName}),e.jsx(ae,{children:s.quantity}),e.jsx(ae,{children:e.jsx(w,{color:"danger",size:"sm",onClick:()=>se(i),children:"Remove"})})]},i))})]})]})]}),e.jsxs(Q,{children:[e.jsx(_,{children:"Checklist Items"}),e.jsx(w,{color:"primary",variant:"outline",className:"m-2",onClick:H,children:"Add Checklist Item"}),h.checklist.map((s,i)=>e.jsxs(U,{className:"mb-2",children:[e.jsx(O,{value:s.task,id:"itemCheckList",onChange:x=>M(i,x.target.value),placeholder:"Enter checklist item",required:!0}),e.jsx(w,{color:"danger",variant:"outline",onClick:()=>le(i),children:"Remove"})]},i))]}),e.jsx(Fe,{id:"notes",floatingLabel:"Notes",placeholder:"Notes",value:h.notes,onChange:c,autoComplete:"off",style:{minHeight:"150px",width:"100%",resize:"vertical"},text:" leave empty if no notes.",feedbackInvalid:"Please provide a valid notes."})]})}),e.jsxs(fe,{children:[e.jsx(w,{color:"secondary",variant:"outline",onClick:()=>v(!1),children:"Close"}),e.jsx(w,{color:"primary",variant:"outline",onClick:l,children:R?e.jsx(be,{size:"sm"}):"Update Maintenance"})]})]})]})},dt=({onDeleteMaintenance:r,onUpdateMaintenance:a,maintenance:p,onCompleted:m,vehicles:F,loading:R,error:f,selectedMaintenanceId:E})=>{const o=ye(),{showError:y,showSuccess:v}=oe(),j=["admin","chief mechanic","super admin","fleet manager"],[B,q]=n.useState(null),[d,T]=n.useState(""),[h,I]=n.useState([]),[z,$]=n.useState(!1),[D,L]=n.useState(1),[V]=n.useState(10),c=D*V,k=c-V,A=h.slice(k,c),H=Math.ceil(h.length/V),[se,le]=n.useState(""),[M,J]=n.useState({checklist:[]}),[re,de]=n.useState(!0);new Date().toISOString().split("T")[0],n.useEffect(()=>{E&&(le(E.toString()),setTimeout(()=>{const t=document.getElementById(`maintenance-${E}`);t&&t.scrollIntoView({behavior:"smooth",block:"center"})},100))},[E]),n.useEffect(()=>{I(p)},[p]);const l=t=>{J(t),$(!0)},u=()=>{J(null),$(!1)},s=async(t,b)=>{var g,W;try{const X=Le(),Z=await K.patch(`api/v1/maintenance/${t}/checklist/${b}`,{completedBy:X});Z.data.success&&(I(qe=>qe.map(Ee=>Ee._id===t?Z.data.data:Ee)),(M==null?void 0:M._id)===t&&J(Z.data.data),v(Z.data.message))}catch(X){console.error("Error updating checklist:",X),y(((W=(g=X.response)==null?void 0:g.data)==null?void 0:W.message)||"Error updating checklist item")}},i=t=>t?`${t.brand||""} ${t.model||""} ${t.regisNumber||""}`.trim():"N/A";n.useEffect(()=>{(()=>{if(L(1),d==="")I(p);else{const b=p.filter(g=>{var W,X,Z;return((W=g.vehicle)==null?void 0:W.regisNumber.toLowerCase().includes(d.toLowerCase()))||((X=g.vehicle)==null?void 0:X.brand.toLowerCase().includes(d.toLowerCase()))||((Z=g.vehicle)==null?void 0:Z.model.toLowerCase().includes(d.toLowerCase()))||g.maintenanceType.toLowerCase().includes(d.toLowerCase())||g.priority.toLowerCase().includes(d.toLowerCase())||g.status.toLowerCase().includes(d.toLowerCase())});I(b),b.length===0?q("No vehicles found"):q(null)}})()},[d,p]);const x=t=>{switch(t){case"Completed":return"green";case"Scheduled":return"orange";case"In Progress":return"yellow";default:return"black"}},N=[{value:"Completed",label:"Completed"},{value:"Scheduled",label:"Scheduled"},{value:"In Progress",label:"In Progress"}],C=({icon:t})=>{const[b,g]=n.useState(!1);return e.jsx(ie,{icon:t,bounce:b,onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1)})};return e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"mt-3",children:e.jsxs(U,{className:"mb-3",children:[e.jsx(O,{type:"text",placeholder:"Search",id:"search",value:d,onChange:t=>T(t.target.value)}),e.jsx(We,{children:e.jsx(ie,{icon:Oe})})]})}),e.jsx(Xe,{activeItemKey:se||void 0,className:"m-2",children:A.map((t,b)=>e.jsxs(Ze,{itemKey:t._id.toString(),id:`maintenance-${t._id}`,children:[e.jsxs(et,{className:"d-flex justify-content-between",children:[e.jsx(Q,{children:e.jsxs("ul",{className:"list-unstyled",children:[e.jsxs("li",{children:["Vehicle: ",e.jsx("strong",{children:i(t.vehicle)})]}),e.jsxs("li",{children:["Priority: ",e.jsx("strong",{children:t.priority||"N/A"})]}),e.jsxs("li",{children:["Purchase Status:"," ",t.purchased?e.jsx(ge,{color:"success",children:"Complete"}):e.jsx(ge,{color:"warning",children:"Awaiting Purchase"})]})]})}),e.jsxs(Q,{className:"d-flex justify-content-end",children:[e.jsx(ie,{icon:$e,color:x(t.status),className:"m-2 float-end"}),e.jsx("small",{className:"m2 float-end",children:N.find(g=>g.value===t.status).label})]})]}),e.jsxs(tt,{children:[e.jsxs(_,{children:["Maintenance Type: ",t.maintenanceType||"N/A"]}),e.jsxs(_,{children:["Start Date:"," ",t.startDate?new Date(t.startDate).toLocaleDateString():"N/A"]}),e.jsxs(_,{children:["Expected Date:"," ",t.expectedEndDate?new Date(t.expectedEndDate).toLocaleDateString():"N/A"]}),e.jsxs(_,{children:["Description: ",t.description||"N/A"]}),e.jsxs(_,{children:["Category: ",t.category||"N/A"]}),e.jsxs(_,{children:["Notes: ",t.notes||"N/A"]}),e.jsxs(_,{children:["Completed By: ",t.completedBy||"N/A"]}),e.jsxs(xe,{className:"mt-3",children:[e.jsx(ke,{children:e.jsx("strong",{children:"Parts Required"})}),e.jsx(ce,{children:t.parts&&t.parts.length>0?e.jsx(e.Fragment,{children:e.jsx(Se,{children:t.parts.map((g,W)=>e.jsxs(Pe,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("div",{children:e.jsx("strong",{children:g.partName})}),e.jsx("div",{className:"d-flex gap-3",children:e.jsxs(ge,{color:"primary",children:["Qty: ",g.quantity]})})]},W))})}):e.jsx(ne,{color:"info",children:"No parts listed for this maintenance"})})]}),e.jsx(Q,{className:"d-flex align-center  mt-3",children:e.jsxs(Ue,{children:[e.jsx(Ke,{color:"secondary",variant:"outline",children:"Actions"}),e.jsx(Ye,{children:e.jsxs(Q,{className:"d-flex flex-column justify-content-center",children:[o&&j.includes(o)&&j.filter(g=>g!=="chief mechanic").includes(o)&&e.jsx(ot,{maintenance:t,onUpdateMaintenance:a,vehicles:F,disabled:t.status==="Completed"}),o&&j.includes(o)&&j.filter(g=>g!=="fleet manager").includes(o)&&e.jsxs(w,{color:"success",className:"m-1",variant:"outline",onClick:()=>l(t),disabled:t.purchased===!1&&t.parts.length>0,children:[e.jsx(C,{icon:Qe})," Checklist"]}),o&&j.includes(o)&&j.filter(g=>g!=="chief mechanic").includes(o)&&e.jsxs(w,{color:"danger",className:"m-1",variant:"outline",onClick:()=>r(t._id),children:[e.jsx(C,{icon:_e})," Delete"]})]})})]})})]})]},t._id))}),h.length>0&&e.jsxs(Q,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs(Q,{children:["Showing ",k+1," to ",Math.min(c,h.length)," ","of ",h.length," entries"]}),e.jsxs(at,{className:"mt-3",children:[e.jsx(je,{disabled:D===1,onClick:()=>L(t=>Math.max(t-1,1)),children:"Previous"}),Array.from({length:H},(t,b)=>b+1).map(t=>e.jsx(je,{active:t===D,onClick:()=>L(t),children:t},t)),e.jsx(je,{disabled:D===H,onClick:()=>L(t=>Math.min(t+1,H)),children:"Next"})]})]}),B&&e.jsx(ne,{color:"danger",children:B}),e.jsxs(ue,{visible:z,onClose:u,size:"lg",children:[e.jsx(me,{children:e.jsxs(ve,{children:["Maintenance Checklist - ",i(M==null?void 0:M.vehicle)]})}),e.jsx(pe,{children:M!=null&&M.checklist&&M.checklist.length>0?e.jsx("div",{className:"checklist-container",children:e.jsx("ul",{className:"list-group",children:M.checklist.map((t,b)=>e.jsxs("li",{className:"list-group-item d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx(Ne,{type:"checkbox",id:`checkBoxList-${b}`,checked:t.completed,onChange:()=>s(M._id,b),disabled:!j.includes(o)||M.status==="Completed",className:"me-2"})," ",t.task]}),t.completed&&e.jsxs("small",{className:"text-muted",children:["Completed by: ",t.completedBy," at"," ",new Date(t.completedAt).toLocaleString()]})]},b))})}):e.jsx("p",{className:"text-center",children:"No checklist items available"})}),e.jsxs(fe,{children:[M&&e.jsx(ct,{maintenance:M,isLoading:re,onCompleted:m,disabled:!j.includes(o)}),e.jsx(w,{color:"secondary",onClick:u,children:"Close"})]})]})]})},qt=()=>{var V;const r=ye(),a=["super admin","admin","manager","fleet manager","chief mechanic"],[p,m]=n.useState([]),[F,R]=n.useState([]),[f,E]=n.useState(!0),[o,y]=n.useState(null),{showError:v,showSuccess:j}=oe(),[B,q]=n.useState(((V=location.state)==null?void 0:V.selectedMaintenanceId)||null),[d,T]=n.useState(!1),h=async()=>{var c,k;E(!0);try{const[A,H]=await Promise.all([K.get("/api/v1/maintenance/all"),K.get("/api/v1/vehicle")]);m(A.data.data),R(H.data.date)}catch(A){y(A.message),v(((k=(c=A.response)==null?void 0:c.data)==null?void 0:k.message)||"Error fetching data")}finally{E(!1)}};if(n.useEffect(()=>{h()},[]),f)return e.jsx(be,{color:"primary",size:"sm",children:"Loading..."});const I=c=>{q(c),T(!0)},z=async()=>{try{await K.delete(`/api/v1/maintenance/delete/${B}`),m(c=>c.filter(k=>k._id!==B)),j("Maintenance deleted successfully"),T(!1)}catch(c){v(c.response.data.message)}finally{T(!1)}h()},$=c=>{m(k=>[...k,c]),h()},D=c=>{m(k=>k.map(A=>A._id===c._id?c:A)),h()},L=c=>{m(k=>k.map(A=>A._id===c._id?c:A)),h()};return e.jsx(e.Fragment,{children:r&&a.includes(r)?e.jsxs(e.Fragment,{children:[" ",e.jsxs(Q,{children:[e.jsx(_,{children:"Maintenance Management"}),e.jsx(xe,{children:e.jsxs(ce,{children:[e.jsx(Q,{children:e.jsx(Q,{children:r&&a.includes(r)&&a.filter(c=>c!=="chief mechanic").includes(r)&&e.jsx(nt,{onAddMaintenance:$})})}),e.jsxs(st,{activeItemKey:"Maintenance List",children:[e.jsx(lt,{variant:"tabs",children:e.jsx(rt,{itemKey:"Maintenance List",children:"Maintenance List"})}),e.jsx(Je,{children:e.jsx(it,{itemKey:"Maintenance List",children:e.jsx(ce,{className:"md-3",children:e.jsx(dt,{vehicles:F,maintenance:p,onCompleted:D,error:o,onDeleteMaintenance:I,onUpdateMaintenance:L,loading:f,selectedMaintenanceId:B})})})})]})]})})]}),e.jsxs(ue,{visible:d,onClose:()=>T(!1),alignment:"center",children:[e.jsx(me,{children:e.jsx(ve,{children:"Delete Maintenance"})}),e.jsx(pe,{children:"Are you sure you want to delete this maintenance?"}),e.jsxs(fe,{children:[e.jsx(w,{color:"secondary",variant:"outline",onClick:()=>T(!1),children:"Cancel"}),e.jsx(w,{color:"danger",variant:"outline",onClick:z,children:"Delete"})]})]})]}):e.jsx(ne,{color:"danger",className:"text-center w-100 mx-auto mt-5 justify-content-center",children:"You are not authorized to access this page."})})};export{qt as default};
