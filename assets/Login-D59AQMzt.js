import{l as R,r as a,m as D,j as e,n as M}from"./index-CF9gHjeM.js";import{C as L}from"./index.esm-DmFUrC5D.js";import{C as $}from"./CContainer-BY7cLoaB.js";import{a as b,C as k}from"./CRow-7_wOyWOf.js";import{C as q}from"./CCardGroup-Czs34YUi.js";import{C as G}from"./CCard-Cfi8v2D6.js";import{C as O}from"./CCardBody-D2mdvBZK.js";import{C as W}from"./CForm-CkgHk8oj.js";import{C as u}from"./CAlert-BN8R94Sy.js";import{C as T}from"./CInputGroup-CjEnY8uL.js";import{C as N}from"./CInputGroupText-Dk4b-IVO.js";import{c as z}from"./cil-user-Ddrdy7PS.js";import{C as I}from"./CFormInput-M9_eFzSI.js";import{c as B}from"./cil-lock-locked-DmxpJbVL.js";import{a as V}from"./CButton-D30G5vDX.js";const le=()=>{const{showSuccess:C,showError:i}=R(),x={username:"",password:"",isActive:!0},[f,g]=a.useState(x),[o,h]=a.useState(!1),[n,j]=a.useState(0),[l,w]=a.useState(5),[A,E]=a.useState(null),[d,v]=a.useState(!1),[S,P]=a.useState(""),U=D(),y=s=>{const{id:t,value:m}=s.target;g(r=>({...r,[t]:m}))};a.useEffect(()=>{let s;return o&&n>0&&(s=setInterval(()=>{j(t=>t<=1?(h(!1),0):t-1)},1e3)),()=>{s&&clearInterval(s)}},[o,n]),a.useEffect(()=>((()=>{const t=document.createElement("script");t.src="https://www.google.com/recaptcha/api.js?render=6LeWQQQrAAAAAFt2e1zO5uXtCfmMxF1ohU5VgUYf",t.async=!0,t.defer=!0,t.onload=()=>{console.log("reCAPTCHA v3 script loaded"),C("reCAPTCHA v3 script loaded")},t.onerror=()=>{console.error("Error loading reCAPTCHA v3 script"),i("Error loading reCAPTCHA v3 script")},document.head.appendChild(t)})(),()=>{const t=document.querySelector('script[src*="recaptcha"]');t&&t.remove()}),[]);const F=async()=>{try{return await window.grecaptcha.execute("6LeWQQQrAAAAAFt2e1zO5uXtCfmMxF1ohU5VgUYf",{action:"login"})}catch(s){throw console.error("reCAPTCHA execution error:",s),i("reCAPTCHA execution error",s),s}},H=async s=>{var m;s.preventDefault(),v(!0),P("");const t=await F();try{const r=await M.post("api/v1/user/login",{...f,recaptchaToken:t});if(r.data.success){const{accessToken:c,refreshToken:p,user:Q}=r.data;if(w(5),h(!1),!p)throw new Error("Refresh token not received from server");sessionStorage.setItem("accessToken",c),sessionStorage.setItem("refreshToken",p),sessionStorage.setItem("user",JSON.stringify(Q)),C(r.data.message),g(x),setTimeout(()=>{U("/dashboard"),E(null)},2e3)}}catch(r){if(r.response){const{data:c}=r.response;if(c.isLocked){h(!0);const p=Math.ceil((new Date(c.lockUntil)-new Date)/1e3);j(p)}c.isDeactivated&&i("Account has been deactivated. Please contact an administrator."),c.attemptsLeft!==void 0&&(w(c.attemptsLeft),i(`Invalid credentials. ${c.attemptsLeft} attempts left`)),((m=r.response)==null?void 0:m.status)===403&&i(r.response.data.message)}}finally{v(!1)}};return e.jsx("div",{className:"bg-body-tertiary min-vh-100 d-flex flex-row align-items-center",children:e.jsx($,{children:e.jsx(b,{className:"justify-content-center",children:e.jsx(k,{xs:12,sm:10,md:8,lg:6,xl:4,children:e.jsx(q,{children:e.jsx(G,{className:"p-4",children:e.jsx(O,{children:e.jsxs(W,{onSubmit:H,children:[e.jsx("h1",{className:"text-center mb-3",children:"Login"}),e.jsx("p",{className:"text-body-secondary text-center mb-4",children:"Sign In to your account"}),A&&e.jsx(u,{color:"success",className:"text-success mb-3",children:A}),S&&e.jsx(u,{color:"danger",className:"text-danger mb-3",children:S}),o&&e.jsxs(u,{color:"warning",className:"mb-3",children:["Account temporarily locked. Please wait ",Math.floor(n/60),":",(n%60).toString().padStart(2,"0")," minutes."]}),!o&&l<5&&l>0&&e.jsxs(u,{color:"warning",className:"mb-3",children:["Warning: ",l," ",l===1?"attempt":"attempts"," ","remaining before temporary lock"]}),e.jsxs(T,{className:"mb-3",children:[e.jsx(N,{children:e.jsx(L,{icon:z})}),e.jsx(I,{type:"text",placeholder:"Username",autoComplete:"off",id:"username",required:!0,value:f.username,onChange:y,disabled:o||d})]}),e.jsxs(T,{className:"mb-4",children:[e.jsx(N,{children:e.jsx(L,{icon:B})}),e.jsx(I,{type:"password",placeholder:"Password",autoComplete:"off",id:"password",required:!0,value:f.password,onChange:y,disabled:o||d})]}),e.jsx("div",{ref:window.recaptchaContainer}),e.jsx(b,{children:e.jsx(k,{xs:6,children:e.jsx(V,{type:"submit",color:"primary",className:"px-4",disabled:o||d,children:o?`Locked (${Math.floor(n/60)}:${(n%60).toString().padStart(2,"0")})`:d?"Logging in...":"Login"})})})]})})})})})})})})};export{le as default};
