import{r as i,_ as xe,u as we,R as b,a as Q,c as Y,P as k,b as Ie,B as le,j as e,k as ve,A as _,D as ke,F as Ne}from"./index-C-sdhNt_.js";import{F as Z,h as Ae,q as Fe,i as qe,j as Ve,k as Re,a as Be,r as ze,l as Oe}from"./index-DHMr1Prz.js";import{C as He,a as S}from"./CButton-vHxQG6j9.js";import{C as ce,a as ne,b as de,c as he,d as ue}from"./CModalTitle-Bh1uVOyk.js";import{C as ie}from"./CAlert-DqEP3Oat.js";import{C as Se}from"./CForm-2fUcDVUu.js";import{C as G,a as Qe}from"./CInputGroupText-B9Tt2MPK.js";import{C as K}from"./CFormSelect-CDaTgBkA.js";import{a as be,b as Ee,C as R}from"./CFormInput-Cg5bWKaJ.js";import{C as pe}from"./CCard-DJ6f86In.js";import{C as fe}from"./CCardHeader-DS-SogXT.js";import{C as se}from"./CCardBody-tcIcrQ9N.js";import{C as Pe,a as Le,b as oe,c as ee,d as De,e as te}from"./CTable-v2P-y9Ct.js";import{C as H}from"./CContainer-BLIRAIjg.js";import{C as O,a as $e}from"./DefaultLayout-_TnLr0S4.js";import{C as Te}from"./CFormTextarea-CaRWp6cQ.js";import{C as Ge,a as _e,b as Ue,c as Ke}from"./CAccordionHeader-DSQYk66h.js";import{C as Je,a as me}from"./CPaginationItem-DqBcjzFj.js";import{C as We,a as Xe,b as Ye,c as Ze}from"./CTabList-1V94qxmW.js";import"./index.esm-CC_PZW40.js";import"./1-BiUyAf0e.js";import"./cil-user-Ddrdy7PS.js";import"./getTransitionDurationFromElement-Cpu4p4hx.js";var ge=i.forwardRef(function(r,t){var d=r.className,m=r.button,T=r.feedback,I=r.feedbackInvalid,g=r.feedbackValid,E=r.floatingLabel,x=r.tooltipFeedback,M=r.hitArea,v=r.id,P=r.indeterminate,u=r.inline,h=r.invalid,f=r.label,L=r.reverse,V=r.type,z=V===void 0?"checkbox":V,A=r.valid,y=xe(r,["className","button","feedback","feedbackInvalid","feedbackValid","floatingLabel","tooltipFeedback","hitArea","id","indeterminate","inline","invalid","label","reverse","type","valid"]),c=i.useRef(null),p=we(t,c);i.useEffect(function(){c.current&&P&&(c.current.indeterminate=P)},[P,c.current]);var j=function(){return b.createElement("input",Q({type:z,className:Y(m?"btn-check":"form-check-input",{"is-invalid":h,"is-valid":A,"me-2":M}),id:v},y,{ref:p}))},B=function(){return b.createElement(Ee,{describedby:y["aria-describedby"],feedback:T,feedbackInvalid:I,feedbackValid:g,floatingLabel:E,invalid:h,tooltipFeedback:x,valid:A})},U=function(){var C;return b.createElement(be,Q({customClassName:Y(m?Y("btn",m.variant?"btn-".concat(m.variant,"-").concat(m.color):"btn-".concat(m.color),(C={},C["btn-".concat(m.size)]=m.size,C),"".concat(m.shape)):"form-check-label")},v&&{htmlFor:v}),f)},$=function(){return m?b.createElement(b.Fragment,null,b.createElement(j,null),f&&b.createElement(U,null),b.createElement(B,null)):f?M?b.createElement(b.Fragment,null,b.createElement(j,null),b.createElement(be,Q({customClassName:Y("form-check-label stretched-link",d)},v&&{htmlFor:v}),f),b.createElement(B,null)):b.createElement("div",{className:Y("form-check",{"form-check-inline":u,"form-check-reverse":L,"is-invalid":h,"is-valid":A},d)},b.createElement(j,null),b.createElement(U,null),b.createElement(B,null)):b.createElement(j,null)};return b.createElement($,null)});ge.propTypes=Q({button:k.object,className:k.string,hitArea:k.oneOf(["full"]),id:k.string,indeterminate:k.bool,inline:k.bool,label:k.oneOfType([k.string,k.node]),reverse:k.bool,type:k.oneOf(["checkbox","radio"])},Ee.propTypes);ge.displayName="CFormCheck";var je=i.forwardRef(function(r,t){var d,m=r.children,T=r.as,I=T===void 0?"ul":T,g=r.className,E=r.flush,x=r.layout,M=xe(r,["children","as","className","flush","layout"]);return b.createElement(I,Q({className:Y("list-group",(d={"list-group-flush":E},d["list-group-".concat(x)]=x,d),g)},M,{ref:t}),m)});je.propTypes={as:k.elementType,children:k.node,className:k.string,flush:k.bool,layout:k.oneOf(["horizontal","horizontal-sm","horizontal-md","horizontal-lg","horizontal-xl","horizontal-xxl"])};je.displayName="CListGroup";var Ce=i.forwardRef(function(r,t){var d,m=r.children,T=r.active,I=r.as,g=I===void 0?"li":I,E=r.className,x=r.disabled,M=r.color,v=xe(r,["children","active","as","className","disabled","color"]),P=g==="a"||g==="button"?He:g;return v=Q(Q(Q(Q({},(g==="a"||g==="button")&&{active:T,disabled:x,as:g,ref:t}),T&&{"aria-current":!0}),x&&{"aria-disabled":!0}),v),b.createElement(P,Q({className:Y("list-group-item",(d={},d["list-group-item-".concat(M)]=M,d["list-group-item-action"]=g==="a"||g==="button",d.active=T,d.disabled=x,d),E)},v),m)});Ce.propTypes={active:k.bool,as:k.elementType,children:k.node,className:k.string,color:Ie,disabled:k.bool};Ce.displayName="CListGroupItem";const et=({onAddMaintenance:r})=>{const{showError:t,showSuccess:d}=le(),[m,T]=i.useState(!1),[I,g]=i.useState(null),[E,x]=i.useState(!1),[M,v]=i.useState(!1),P={vehicle:"",maintenanceType:"",startDate:"",expectedEndDate:"",description:"",priority:"",category:"",checklist:[{task:"",completed:!1}],parts:[]},[u,h]=i.useState(P),[f,L]=i.useState([]),[V,z]=i.useState({partName:"",quantity:""}),A=new Date().toISOString().split("T")[0],y=l=>{const{id:n,value:w}=l.target;h(s=>({...s,[n]:w}))},c=l=>{const{id:n,value:w}=l.target;z(s=>({...s,[n.split(".")[1]]:w}))},p=()=>{h(l=>({...l,parts:[...l.parts,{...V}]})),z({partName:"",quantity:""})};i.useEffect(()=>{(async()=>{try{const n=await _.get("/api/v1/vehicle/all");n.data.success&&L(n.data.data)}catch(n){g(n),t(n.message)}})()},[]);const j=()=>{h(l=>({...l,checklist:[...l.checklist,{task:"",completed:!1}]}))},B=l=>{h(n=>({...n,parts:n.parts.filter((w,s)=>s!==l)}))},U=l=>{h(n=>({...n,checklist:n.checklist.filter((w,s)=>s!==l)}))},$=(l,n)=>{h(w=>({...w,checklist:w.checklist.map((s,o)=>o===l?{...s,task:n}:s)}))},C=[{label:"High",value:"High"},{label:"Medium",value:"Medium"},{label:"Low",value:"Low"},{label:"Critical",value:"Critical"}],J=[{label:"Engine",value:"Engine"},{label:"Transmission",value:"Transmission"},{label:"Brakes",value:"Brakes"},{label:"Electrical",value:"Electrical"},{label:"Tiers",value:"Tiers"},{label:"Other",value:"Other"}],ae=[{label:"Preventive",value:"PMS"},{label:"Corrective",value:"Corrective"},{label:"Emergency",value:"Emergency"}],re=async l=>{var w,s,o,N;if(l.currentTarget.checkValidity()===!1)l.stopPropagation(),l.preDefault();else try{const a=await _.post("/api/v1/maintenance/create",u);a.data.success&&(d(a.data.message),r(a.data.data),x(!1))}catch(a){t(((s=(w=a.response)==null?void 0:w.data)==null?void 0:s.message)||a.message),g(((N=(o=a.response)==null?void 0:o.data)==null?void 0:N.message)||a.message),setTimeout(()=>{g(null)},2e3)}v(!0)};return e.jsxs(e.Fragment,{children:[e.jsxs(S,{color:"primary",className:"mb-3",variant:"outline",onClick:()=>x(!0),children:[e.jsx(Z,{icon:Ae})," Add Maintenance"]}),e.jsxs(ce,{visible:E,onClose:()=>x(!1),size:"lg",children:[e.jsx(ne,{closeButton:!0,children:e.jsx(de,{children:"Add Maintenance"})}),I&&e.jsx(ie,{color:"danger",children:I}),e.jsx(he,{children:e.jsxs(Se,{className:"row g-3 needs-validation",noValidate:!0,validated:M,children:[e.jsxs(G,{children:[e.jsxs(K,{id:"vehicle",value:u.vehicle,onChange:y,floatingLabel:"Vehicle",placeholder:"Select Vehicle",required:!0,feedbackInvalid:"Please provide a valid vehicle.",children:[e.jsx("option",{value:"",children:"Select Vehicle"}),f.map(l=>e.jsxs("option",{value:l._id,children:[l.brand," / ",l.model," / ",l.regisNumber]},l._id))]}),e.jsx(K,{id:"maintenanceType",value:u.maintenanceType,onChange:y,floatingLabel:"Maintenance Type",placeholder:"Select Maintenance Type",required:!0,options:[{label:"Select Maintenance Type",value:""},...ae],feedbackInvalid:"Please provide a valid maintenance type."}),e.jsx(R,{id:"description",type:"text",floatingLabel:"Description",placeholder:"Description",required:!0,value:u.description,onChange:y,feedbackInvalid:"Please provide a valid description."})]}),e.jsxs(G,{children:[e.jsx(R,{id:"startDate",type:"date",floatingLabel:"Start Date",placeholder:"Start Date",required:!0,min:A,value:u.startDate,onChange:y,feedbackInvalid:"Please provide a valid start date."}),e.jsx(R,{id:"expectedEndDate",type:"date",floatingLabel:"Expected End Date",placeholder:"Expected End Date",required:!0,min:A,value:u.expectedEndDate,onChange:y,feedbackInvalid:"Please provide a valid expected end date."}),e.jsxs(K,{id:"priority",value:u.priority,onChange:y,floatingLabel:"Priority",placeholder:"Select Priority",required:!0,feedbackInvalid:"Please provide a valid priority.",children:[e.jsx("option",{value:"",children:"Select Priority"}),C.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))]}),e.jsxs(K,{id:"category",value:u.category,onChange:y,floatingLabel:"Category",placeholder:"Select Category",required:!0,feedbackInvalid:"Please provide a valid category.",children:[e.jsx("option",{value:"",children:"Select Category"}),J.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))]})]}),e.jsxs(pe,{className:"mb-3",children:[e.jsx(fe,{children:"Add Parts"}),e.jsxs(se,{children:[e.jsxs(G,{className:"mb-3",children:[e.jsx(R,{id:"parts.partName",type:"text",floatingLabel:"Part Name",placeholder:"Part Name",value:V.partName,onChange:c}),e.jsx(R,{id:"parts.quantity",type:"number",floatingLabel:"Quantity",placeholder:"Quantity",value:V.quantity,onChange:c}),e.jsx(S,{color:"primary",onClick:p,children:"Add Part"})]}),u.parts.length>0&&e.jsxs(Pe,{className:"",children:[e.jsx(Le,{className:"text-center",children:e.jsxs(oe,{children:[e.jsx(ee,{children:"Part Name"}),e.jsx(ee,{children:"Part Quantity"}),e.jsx(ee,{children:"Remove Part"})]})}),e.jsx(De,{className:"text-center",children:u.parts.map((l,n)=>e.jsxs(oe,{children:[e.jsx(te,{children:l.partName}),e.jsx(te,{children:l.quantity}),e.jsx(te,{children:e.jsx(S,{color:"danger",size:"sm",onClick:()=>B(n),children:"Remove"})})]},n))})]})]})]}),e.jsxs(H,{children:[e.jsx(O,{children:"Checklist Items"}),e.jsx(S,{color:"primary",variant:"outline",className:"m-2",onClick:j,children:"Add Checklist Item"}),u.checklist.map((l,n)=>e.jsxs(G,{className:"mb-2",children:[e.jsx(R,{value:l.task,id:"itemCheckList",onChange:w=>$(n,w.target.value),placeholder:"Enter checklist item",required:!0}),e.jsx(S,{color:"danger",variant:"outline",onClick:()=>U(n),children:"Remove"})]},n))]}),e.jsx(Te,{id:"notes",floatingLabel:"Notes",placeholder:"Notes",value:u.notes,onChange:y,autoComplete:"off",style:{minHeight:"150px",width:"100%",resize:"vertical"},text:" leave empty if no notes.",feedbackInvalid:"Please provide a valid notes."})]})}),e.jsxs(ue,{children:[e.jsx(S,{color:"secondary",variant:"outline",onClick:()=>x(!1),children:"Close"}),e.jsx(S,{color:"primary",variant:"outline",onClick:re,children:m?e.jsx(ve,{size:"sm"}):"Add Maintenance"})]})]})]})},tt=({onCompleted:r,maintenance:t})=>{var E;const{showSuccess:d,showError:m}=le(),T=ke(),I=["admin","chief mechanic"];if(!t||!t.checklist)return null;const g=async x=>{var M,v;try{const P=Ne(),u=await _.patch(`/api/v1/maintenance/complete/${x}`,{completedBy:P});u.data.success&&(d(u.data.message),r(u.data.data))}catch(P){const u=((v=(M=P.response)==null?void 0:M.data)==null?void 0:v.message)||"Error completing maintenance";m(u),console.error("Error completing maintenance:",P)}};return e.jsx(e.Fragment,{children:I.includes(T)&&e.jsx(S,{color:"success",variant:"outline",onClick:()=>g(t._id),disabled:!((E=t.checklist)!=null&&E.every(x=>x.completed)),children:"Complete Maintenance"})})},at=({onUpdateMaintenance:r,maintenance:t,disabled:d})=>{var w;const{showError:m,showSuccess:T}=le(),[I,g]=i.useState(!1),[E,x]=i.useState(null),[M,v]=i.useState(!1),[P,u]=i.useState(!1),h={vehicle:((w=t==null?void 0:t.vehicle)==null?void 0:w._id)||"",maintenanceType:(t==null?void 0:t.maintenanceType)||"",startDate:t!=null&&t.startDate?t.startDate.split("T")[0]:"",expectedEndDate:t!=null&&t.expectedEndDate?t.expectedEndDate.split("T")[0]:"",description:(t==null?void 0:t.description)||"",priority:(t==null?void 0:t.priority)||"",category:(t==null?void 0:t.category)||"",checklist:(t==null?void 0:t.checklist)||[],parts:(t==null?void 0:t.parts)||[],notes:(t==null?void 0:t.notes)||""},[f,L]=i.useState(h),[V,z]=i.useState([]),[A,y]=i.useState({partName:"",quantity:""}),c=new Date().toISOString().split("T")[0],p=s=>{const{id:o,value:N}=s.target;L(a=>({...a,[o]:N}))},j=s=>{const{id:o,value:N}=s.target,a=o.split(".")[1];y(D=>({...D,[a]:a==="quantity"?N===""?"":Number(N):N}))},B=()=>{if(!A.partName||!A.quantity){m("Please fill in both part name and quantity");return}L(s=>({...s,parts:[...s.parts,{...A}]})),y({partName:"",quantity:""})};i.useEffect(()=>{var s;t&&L({vehicle:((s=t==null?void 0:t.vehicle)==null?void 0:s._id)||"",maintenanceType:(t==null?void 0:t.maintenanceType)||"",startDate:t!=null&&t.startDate?t.startDate.split("T")[0]:"",expectedEndDate:t!=null&&t.expectedEndDate?t.expectedEndDate.split("T")[0]:"",description:(t==null?void 0:t.description)||"",priority:(t==null?void 0:t.priority)||"",category:(t==null?void 0:t.category)||"",checklist:(t==null?void 0:t.checklist)||[],parts:(t==null?void 0:t.parts)||[],notes:(t==null?void 0:t.notes)||""})},[t]),i.useEffect(()=>{(async()=>{try{const o=await _.get("/api/v1/vehicle/all");o.data.success&&z(o.data.data)}catch(o){x(o),m(o.message)}})()},[]);const U=()=>{L(s=>({...s,checklist:[...s.checklist,{task:"",completed:!1}]}))},$=s=>{L(o=>({...o,parts:o.parts.filter((N,a)=>a!==s)}))},C=s=>{L(o=>({...o,checklist:o.checklist.filter((N,a)=>a!==s)}))},J=(s,o)=>{L(N=>({...N,checklist:N.checklist.map((a,D)=>D===s?{...a,task:o}:a)}))},ae=[{label:"High",value:"High"},{label:"Medium",value:"Medium"},{label:"Low",value:"Low"},{label:"Critical",value:"Critical"}],re=[{label:"Engine",value:"Engine"},{label:"Transmission",value:"Transmission"},{label:"Brakes",value:"Brakes"},{label:"Electrical",value:"Electrical"},{label:"Tiers",value:"Tiers"},{label:"Other",value:"Other"}],l=[{label:"Preventive",value:"PMS"},{label:"Corrective",value:"Corrective"},{label:"Emergency",value:"Emergency"}],n=async s=>{var N,a,D,F;s.preventDefault();const o=s.currentTarget;if(u(!0),o.checkValidity()===!1){s.stopPropagation();return}g(!0);try{const q=await _.put(`/api/v1/maintenance/update/${t._id}`,f);q.data.success&&(T(q.data.message),r(q.data.data),v(!1))}catch(q){m(((a=(N=q.response)==null?void 0:N.data)==null?void 0:a.message)||q.message),x(((F=(D=q.response)==null?void 0:D.data)==null?void 0:F.message)||q.message),setTimeout(()=>{x(null)},2e3)}finally{g(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(S,{color:"primary",className:"me-1 unset",variant:"outline",onClick:()=>v(!0),disabled:d,children:d?e.jsx(Z,{icon:Fe}):e.jsx(Z,{icon:qe})}),e.jsxs(ce,{visible:M,onClose:()=>v(!1),size:"lg",children:[e.jsx(ne,{closeButton:!0,children:e.jsx(de,{children:"Update Maintenance"})}),E&&e.jsx(ie,{color:"danger",children:E}),e.jsx(he,{children:e.jsxs(Se,{className:"row g-3 needs-validation",noValidate:!0,validated:P,children:[e.jsxs(G,{children:[e.jsxs(K,{id:"vehicle",value:f.vehicle||"",onChange:p,floatingLabel:"Vehicle",placeholder:"Select Vehicle",required:!0,feedbackInvalid:"Please provide a valid vehicle.",children:[e.jsx("option",{value:"",children:"Select Vehicle"}),V.map(s=>e.jsxs("option",{value:s._id,children:[s.brand," / ",s.model," / ",s.regisNumber]},s._id))]}),e.jsx(K,{id:"maintenanceType",value:f.maintenanceType||"",onChange:p,floatingLabel:"Maintenance Type",placeholder:"Select Maintenance Type",required:!0,options:[{label:"Select Maintenance Type",value:""},...l],feedbackInvalid:"Please provide a valid maintenance type."}),e.jsx(R,{id:"description",type:"text",floatingLabel:"Description",placeholder:"Description",required:!0,value:f.description,onChange:p,feedbackInvalid:"Please provide a valid description."})]}),e.jsxs(G,{children:[e.jsx(R,{id:"startDate",type:"date",floatingLabel:"Start Date",placeholder:"Start Date",required:!0,min:c,value:f.startDate,onChange:p,feedbackInvalid:"Please provide a valid start date."}),e.jsx(R,{id:"expectedEndDate",type:"date",floatingLabel:"Expected End Date",placeholder:"Expected End Date",required:!0,min:c,value:f.expectedEndDate,onChange:p,feedbackInvalid:"Please provide a valid expected end date."}),e.jsxs(K,{id:"priority",value:f.priority||"",onChange:p,floatingLabel:"Priority",placeholder:"Select Priority",required:!0,feedbackInvalid:"Please provide a valid priority.",children:[e.jsx("option",{value:"",children:"Select Priority"}),ae.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),e.jsxs(K,{id:"category",value:f.category,onChange:p,floatingLabel:"Category",placeholder:"Select Category",required:!0,feedbackInvalid:"Please provide a valid category.",children:[e.jsx("option",{value:"",children:"Select Category"}),re.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]})]}),e.jsxs(pe,{className:"mb-3",children:[e.jsx(fe,{children:"Add Parts"}),e.jsxs(se,{children:[e.jsxs(G,{className:"mb-3",children:[e.jsx(R,{id:"parts.partName",type:"text",floatingLabel:"Part Name",placeholder:"Part Name",value:A.partName||"",onChange:j}),e.jsx(R,{id:"parts.quantity",type:"number",floatingLabel:"Quantity",placeholder:"Quantity",value:A.quantity||"",onChange:j}),e.jsx(S,{color:"primary",onClick:B,children:"Add Part"})]}),f.parts.length>0&&e.jsxs(Pe,{className:"",children:[e.jsx(Le,{className:"text-center",children:e.jsxs(oe,{children:[e.jsx(ee,{children:"Part Name"}),e.jsx(ee,{children:"Part Quantity"}),e.jsx(ee,{children:"Remove Part"})]})}),e.jsx(De,{className:"text-center",children:f.parts.map((s,o)=>e.jsxs(oe,{children:[e.jsx(te,{children:s.partName}),e.jsx(te,{children:s.quantity}),e.jsx(te,{children:e.jsx(S,{color:"danger",size:"sm",onClick:()=>$(o),children:"Remove"})})]},o))})]})]})]}),e.jsxs(H,{children:[e.jsx(O,{children:"Checklist Items"}),e.jsx(S,{color:"primary",variant:"outline",className:"m-2",onClick:U,children:"Add Checklist Item"}),f.checklist.map((s,o)=>e.jsxs(G,{className:"mb-2",children:[e.jsx(R,{value:s.task,id:"itemCheckList",onChange:N=>J(o,N.target.value),placeholder:"Enter checklist item",required:!0}),e.jsx(S,{color:"danger",variant:"outline",onClick:()=>C(o),children:"Remove"})]},o))]}),e.jsx(Te,{id:"notes",floatingLabel:"Notes",placeholder:"Notes",value:f.notes,onChange:p,autoComplete:"off",style:{minHeight:"150px",width:"100%",resize:"vertical"},text:" leave empty if no notes.",feedbackInvalid:"Please provide a valid notes."})]})}),e.jsxs(ue,{children:[e.jsx(S,{color:"secondary",variant:"outline",onClick:()=>v(!1),children:"Close"}),e.jsx(S,{color:"primary",variant:"outline",onClick:n,children:I?e.jsx(ve,{size:"sm"}):"Update Maintenance"})]})]})]})},st=({onDeleteMaintenance:r,onUpdateMaintenance:t,maintenance:d,onCompleted:m,vehicles:T,loading:I,error:g})=>{const E=ke(),{showError:x,showSuccess:M}=le(),v=["admin","chief mechanic"],[P,u]=i.useState(null),[h,f]=i.useState(""),[L,V]=i.useState([]),[z,A]=i.useState(!1),[y,c]=i.useState(1),[p]=i.useState(10),j=y*p,B=j-p,U=L.slice(B,j),$=Math.ceil(L.length/p),[C,J]=i.useState({checklist:[]}),[ae,re]=i.useState(!0);i.useEffect(()=>{V(d)},[d]);const l=a=>{J(a),A(!0)},n=()=>{J(null),A(!1)},w=async(a,D)=>{var F,q;try{const W=Ne(),X=await _.patch(`/api/v1/maintenance/${a}/checklist/${D}`,{completedBy:W});X.data.success&&(V(Me=>Me.map(ye=>ye._id===a?X.data.data:ye)),(C==null?void 0:C._id)===a&&J(X.data.data),M(X.data.message))}catch(W){console.error("Error updating checklist:",W),x(((q=(F=W.response)==null?void 0:F.data)==null?void 0:q.message)||"Error updating checklist item")}},s=a=>a?`${a.brand||""} ${a.model||""} ${a.regisNumber||""}`.trim():"N/A";i.useEffect(()=>{(()=>{if(c(1),h==="")V(d);else{const D=d.filter(F=>{var q,W,X;return((q=F.vehicle)==null?void 0:q.regisNumber.toLowerCase().includes(h.toLowerCase()))||((W=F.vehicle)==null?void 0:W.brand.toLowerCase().includes(h.toLowerCase()))||((X=F.vehicle)==null?void 0:X.model.toLowerCase().includes(h.toLowerCase()))||F.maintenanceType.toLowerCase().includes(h.toLowerCase())||F.priority.toLowerCase().includes(h.toLowerCase())||F.status.toLowerCase().includes(h.toLowerCase())});V(D),D.length===0?u("No vehicles found"):u(null)}})()},[h,d]);const o=a=>{switch(a){case"Completed":return"green";case"Scheduled":return"orange";case"In Progress":return"yellow";default:return"black"}},N=[{value:"Completed",label:"Completed"},{value:"Scheduled",label:"Scheduled"},{value:"In Progress",label:"In Progress"}];return e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"mt-3",children:e.jsxs(G,{className:"mb-3",children:[e.jsx(R,{type:"text",placeholder:"Search",id:"search",value:h,onChange:a=>f(a.target.value)}),e.jsx(Qe,{children:e.jsx(Z,{icon:Ve})})]})}),e.jsx(Ge,{className:"m-2",children:U.map((a,D)=>e.jsxs(_e,{children:[e.jsxs(Ue,{className:"d-flex justify-content-between",children:[e.jsx(H,{children:e.jsxs("ul",{className:"list-unstyled",children:[e.jsxs("li",{children:["Vehicle: ",e.jsx("strong",{children:s(a.vehicle)})]}),e.jsxs("li",{children:["Priority: ",e.jsx("strong",{children:a.priority||"N/A"})]})]})}),e.jsxs(H,{className:"d-flex justify-content-end",children:[e.jsx(Z,{icon:Re,color:o(a.status),className:"m-2 float-end"}),e.jsx("small",{className:"m2 float-end",children:N.find(F=>F.value===a.status).label})]})]}),e.jsxs(Ke,{children:[e.jsxs(O,{children:["Maintenance Type: ",a.maintenanceType||"N/A"]}),e.jsxs(O,{children:["Start Date:"," ",a.startDate?new Date(a.startDate).toLocaleDateString():"N/A"]}),e.jsxs(O,{children:["Expected Date:"," ",a.expectedEndDate?new Date(a.expectedEndDate).toLocaleDateString():"N/A"]}),e.jsxs(O,{children:["Description: ",a.description||"N/A"]}),e.jsxs(O,{children:["Category: ",a.category||"N/A"]}),e.jsxs(O,{children:["Notes: ",a.notes||"N/A"]}),e.jsxs(O,{children:["Completed By: ",a.completedBy||"N/A"]}),e.jsxs(pe,{className:"mt-3",children:[e.jsx(fe,{children:e.jsx("strong",{children:"Parts Required"})}),e.jsx(se,{children:a.parts&&a.parts.length>0?e.jsx(e.Fragment,{children:e.jsx(je,{children:a.parts.map((F,q)=>e.jsxs(Ce,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("div",{children:e.jsx("strong",{children:F.partName})}),e.jsx("div",{className:"d-flex gap-3",children:e.jsxs(Be,{color:"primary",children:["Qty: ",F.quantity]})})]},q))})}):e.jsx(ie,{color:"info",children:"No parts listed for this maintenance"})})]}),e.jsxs(H,{className:"d-flex justify-content-end mt-3",children:[v.includes(E)&&e.jsx(at,{maintenance:a,onUpdateMaintenance:t,vehicles:T,disabled:a.status==="Completed"}),e.jsx(S,{color:"primary",className:"m-1",variant:"outline",onClick:()=>l(a),children:e.jsx(Z,{icon:ze})}),e.jsx(S,{color:"danger",className:"m-1",variant:"outline",onClick:()=>r(a._id),children:e.jsx(Z,{icon:Oe})})]})]})]},a._id||D))}),L.length>0&&e.jsxs(H,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs(H,{children:["Showing ",B+1," to ",Math.min(j,L.length)," ","of ",L.length," entries"]}),e.jsxs(Je,{className:"mt-3",children:[e.jsx(me,{disabled:y===1,onClick:()=>c(a=>Math.max(a-1,1)),children:"Previous"}),Array.from({length:$},(a,D)=>D+1).map(a=>e.jsx(me,{active:a===y,onClick:()=>c(a),children:a},a)),e.jsx(me,{disabled:y===$,onClick:()=>c(a=>Math.min(a+1,$)),children:"Next"})]})]}),P&&e.jsx(ie,{color:"danger",children:P}),e.jsxs(ce,{visible:z,onClose:n,size:"lg",children:[e.jsx(ne,{children:e.jsxs(de,{children:["Maintenance Checklist - ",s(C==null?void 0:C.vehicle)]})}),e.jsx(he,{children:C!=null&&C.checklist&&C.checklist.length>0?e.jsx("div",{className:"checklist-container",children:e.jsx("ul",{className:"list-group",children:C.checklist.map((a,D)=>e.jsxs("li",{className:"list-group-item d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx(ge,{type:"checkbox",id:`checkBoxList-${D}`,checked:a.completed,onChange:()=>w(C._id,D),disabled:!v.includes(E),className:"me-2"})," ",a.task]}),a.completed&&e.jsxs("small",{className:"text-muted",children:["Completed by: ",a.completedBy," at"," ",new Date(a.completedAt).toLocaleString()]})]},D))})}):e.jsx("p",{className:"text-center",children:"No checklist items available"})}),e.jsxs(ue,{children:[C&&e.jsx(tt,{maintenance:C,isLoading:ae,onCompleted:m,disabled:!v.includes(E)}),e.jsx(S,{color:"secondary",onClick:n,children:"Close"})]})]})]})},Pt=()=>{const[r,t]=i.useState([]),[d,m]=i.useState([]),[T,I]=i.useState(!0),[g,E]=i.useState(null),{showError:x,showSuccess:M}=le(),[v,P]=i.useState(null),[u,h]=i.useState(!1),f=async()=>{var c,p;I(!0);try{const[j,B]=await Promise.all([_.get("/api/v1/maintenance/all"),_.get("/api/v1/vehicle")]);t(j.data.data),m(B.data.date)}catch(j){E(j.message),x(((p=(c=j.response)==null?void 0:c.data)==null?void 0:p.message)||"Error fetching data")}finally{I(!1)}};if(i.useEffect(()=>{f()},[]),T)return e.jsx(ve,{color:"primary",size:"sm",children:"Loading..."});const L=c=>{P(c),h(!0)},V=async()=>{try{await _.delete(`/api/v1/maintenance/delete/${v}`),t(c=>c.filter(p=>p._id!==v)),M("Maintenance deleted successfully"),h(!1)}catch(c){x(c.response.data.message)}finally{h(!1)}},z=c=>{t(p=>[...p,c]),f()},A=c=>{t(p=>p.map(j=>j._id===c._id?c:j)),f()},y=c=>{t(p=>p.map(j=>j._id===c._id?c:j)),f()};return e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsx(O,{children:"Maintenance Management"}),e.jsx(pe,{children:e.jsxs(se,{children:[e.jsx(H,{children:e.jsx(et,{onAddMaintenance:z})}),e.jsxs(We,{activeItemKey:"Maintenance List",children:[e.jsx(Xe,{variant:"tabs",children:e.jsx(Ye,{itemKey:"Maintenance List",children:"Maintenance List"})}),e.jsx($e,{children:e.jsx(Ze,{itemKey:"Maintenance List",children:e.jsx(se,{className:"md-3",children:e.jsx(st,{vehicles:d,maintenance:r,onCompleted:A,error:g,onDeleteMaintenance:L,onUpdateMaintenance:y,loading:T})})})})]})]})})]}),e.jsxs(ce,{visible:u,onClose:()=>h(!1),alignment:"center",children:[e.jsx(ne,{children:e.jsx(de,{children:"Delete Maintenance"})}),e.jsx(he,{children:"Are you sure you want to delete this maintenance?"}),e.jsxs(ue,{children:[e.jsx(S,{color:"secondary",variant:"outline",onClick:()=>h(!1),children:"Cancel"}),e.jsx(S,{color:"danger",variant:"outline",onClick:V,children:"Delete"})]})]})]})};export{Pt as default};
