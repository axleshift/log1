import{B as xe,r as l,j as e,k as oe,A as z,D as Te}from"./index-BsAuDz7v.js";import{F as re,h as we,e as Ee,n as ye,o as Ne,a as De,p as Re,g as Me,i as Qe}from"./index-DdzPpfT1.js";import{a as R}from"./CButton-1aJwC6WA.js";import{C as ce,a as ue,b as Pe,c as me,d as pe}from"./CModalTitle-9RnGyc5_.js";import{a as ie,C as Le}from"./CForm-DJmgfv4a.js";import{C as E,a as $e}from"./CInputGroupText-scgwoFmL.js";import{C as u,a as ke}from"./CFormInput-De0-5chn.js";import{C as he}from"./CFormSelect-C2W4ju5D.js";import{C as be}from"./1-DdutqShQ.js";import{C as Fe}from"./CFormTextarea-C0ahOwU_.js";import{C as G}from"./CContainer-D4HQE-qk.js";import{C as _e,a as Oe,b as Ie,c as Y,d as Ae,e as Z}from"./CTable-CA166WLX.js";import{b as qe,c as Ue,d as Ge,C as ze}from"./DefaultLayout-DeL5tmJy.js";import{C as Be,a as ve}from"./CPaginationItem-CeIFQBOh.js";import{C as He}from"./CCard-BQgonU39.js";import{C as We}from"./CCardBody-D4BA6tNM.js";import"./index.esm-CMByg3QK.js";import"./cil-user-Ddrdy7PS.js";const Je=({onAddFuelog:n})=>{var f,X;const{showSuccess:K,showError:M}=xe(),[$,k]=l.useState(!1),[_,V]=l.useState(null),[O,A]=l.useState(!1),[ae,g]=l.useState(!1),[B,F]=l.useState(!1),[q,H]=l.useState(null),[ee,S]=l.useState([]),[I,W]=l.useState([]),se=new Date().toISOString().split("T")[0],Q={vehicleId:"",driverId:"",vehicleDetails:{brand:"",model:"",regisNumber:"",fuelType:""},driverDetails:{driverName:""},date:"",receiptNumber:"",fuelQuantity:"",fuelType:"",costPerLiter:"",totalCost:"",currentMileage:"",receiptImage:null,route:{start:"",end:"",distance:""},notes:"",litersPer100km:"",kmPerLiter:"",mpg:""},[r,s]=l.useState(Q);l.useEffect(()=>{(async()=>{try{k(!0);const[t,a]=await Promise.all([z.get("/api/v1/driver"),z.get("/api/v1/vehicle/in-use")]);S(t.data.data),W(a.data.data)}catch{M("Error fetching initial data")}finally{k(!1)}})()},[]);const c=p=>{const{id:t,value:a}=p.target;if(t.includes("route.")){const i=t.split(".")[1];s(v=>{const h={...v,route:{...v.route,[i]:a}};if(h.route.distance&&h.fuelQuantity){const d=parseFloat(h.route.distance),m=parseFloat(h.fuelQuantity);if(d>0&&m>0){const x=m/d*100;h.litersPer100km=x.toFixed(2);const U=d/m;h.kmPerLiter=U.toFixed(2);const te=m*.264172,ne=d*.621371/te;h.mpg=ne.toFixed(2)}}return h})}else if(t==="vehicleId"){const i=I.find(h=>h._id===a),v=ee.find(h=>h._id===(i==null?void 0:i.assignedDriver));s(h=>({...h,vehicleId:a,driverId:(i==null?void 0:i.assignedDriver)||"",vehicleDetails:{brand:(i==null?void 0:i.brand)||"",model:(i==null?void 0:i.model)||"",regisNumber:(i==null?void 0:i.regisNumber)||"",fuelType:(i==null?void 0:i.fuelType)||""},driverDetails:{driverName:(v==null?void 0:v.driverName)||""},currentMileage:(i==null?void 0:i.currentMileage)||"",fuelType:(i==null?void 0:i.fuelType)||""}))}else s(t==="fuelQuantity"||t==="costPerLiter"?i=>{const v={...i,[t]:a},h=parseFloat(t==="fuelQuantity"?a:i.fuelQuantity),d=parseFloat(t==="costPerLiter"?a:i.costPerLiter);if(!isNaN(h)&&!isNaN(d)&&(v.totalCost=(h*d).toFixed(2)),t==="fuelQuantity"&&v.route.distance){const m=parseFloat(v.route.distance),x=parseFloat(a);if(m>0&&x>0){const U=x/m*100;v.litersPer100km=U.toFixed(2);const te=m/x;v.kmPerLiter=te.toFixed(2);const le=x*.264172,de=m*.621371/le;v.mpg=de.toFixed(2)}}return v}:i=>({...i,[t]:a}))},L=p=>{const t=p.target.files[0];if(t){s(i=>({...i,receiptImage:t}));const a=new FileReader;a.onloadend=()=>{H(a.result)},a.readAsDataURL(t)}},J=async p=>{if(p.preventDefault(),p.stopPropagation(),p.currentTarget.checkValidity()===!1){F(!0);return}k(!0);try{const a=new FormData;a.append("vehicleId",r.vehicleId),a.append("driverId",r.driverId),a.append("vehicleDetails[brand]",r.vehicleDetails.brand),a.append("vehicleDetails[model]",r.vehicleDetails.model),a.append("vehicleDetails[regisNumber]",r.vehicleDetails.regisNumber),a.append("vehicleDetails[fuelType]",r.vehicleDetails.fuelType),a.append("driverDetails[driverName]",r.driverDetails.driverName),a.append("date",r.date),a.append("receiptNumber",r.receiptNumber),a.append("fuelQuantity",r.fuelQuantity),a.append("fuelType",r.fuelType),a.append("costPerLiter",r.costPerLiter),a.append("totalCost",r.totalCost),a.append("currentMileage",r.currentMileage),a.append("notes",r.notes),a.append("litersPer100km",r.litersPer100km),a.append("kmPerLiter",r.kmPerLiter),a.append("mpg",r.mpg),a.append("route[start]",r.route.start),a.append("route[end]",r.route.end),a.append("route[distance]",r.route.distance),r.receiptImage&&a.append("receiptImage",r.receiptImage);const i=await z.post("/api/v1/fuelLogs/fuel-logs",a);i.data.success&&(n(i.data.data),K(i.data.message),A(i.data.message),setTimeout(()=>{A(!1),s(Q),H(null),g(!1)},2e3))}catch(a){M(a.response.data.message),V(a.response.data.message),setTimeout(()=>{V(null)},5e3)}finally{k(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs(R,{color:"primary",variant:"outline",disabled:$,onClick:()=>g(!0),children:[$?e.jsx(oe,{color:"primary",size:"sm"}):e.jsx(re,{icon:we}),"Add Fuel Log"]}),e.jsxs(ce,{visible:ae,onClose:()=>g(!1),size:"lg",children:[e.jsx(ue,{children:e.jsx(Pe,{children:"Add Fuel Log"})}),_&&e.jsx(ie,{color:"danger",className:"m-3",children:_}),O&&e.jsx(ie,{color:"success",className:"m-3",children:O}),e.jsx(me,{children:e.jsxs(Le,{noValidate:!0,validated:B,children:[e.jsxs(E,{children:[e.jsx(u,{type:"date",className:"mb-3",floatingLabel:"date",label:"Receipt Number",id:"date",max:se,value:r.date,onChange:c,required:!0}),e.jsxs(he,{className:"mb-3",floatingLabel:"Vehicle",label:"Vehicle",id:"vehicleId",value:r.vehicleId,onChange:c,required:!0,children:[e.jsx("option",{value:"",children:"Select Vehicle"}),I==null?void 0:I.map(p=>e.jsx("option",{value:p._id,children:`${p.brand} / ${p.model} / ${p.regisNumber}`},p._id))]}),e.jsx(u,{className:"mb-3",floatingLabel:"Driver",label:"Driver",id:"driverId",value:((f=ee.find(p=>p._id===r.driverId))==null?void 0:f.driverName)||"",onChange:c,disabled:!0}),e.jsxs(he,{className:"mb-3",floatingLabel:"Fuel Type",label:"Fuel Type",id:"fuelType",required:!0,value:((X=I.find(p=>p._id===r.vehicleId))==null?void 0:X.fuelType)||"",onChange:c,disabled:!0,children:[e.jsx("option",{value:"",children:"Select Fuel Type"}),e.jsx("option",{value:"Gasoline",children:"Gasoline"}),e.jsx("option",{value:"Diesel",children:"Diesel"})]})]}),e.jsxs(E,{children:[e.jsx(u,{className:"mb-3",type:"text",floatingLabel:"Official Reciept",placeholder:"Official Reciept",id:"receiptNumber",value:r.receiptNumber,onChange:c,required:!0,autoComplete:"off"}),e.jsx(u,{className:"mb-3",type:"number",floatingLabel:"Fuel Quantity",placeholder:"Fuel Quantity",id:"fuelQuantity",value:r.fuelQuantity,onChange:c,required:!0,autoComplete:"off",min:"0",step:"0.01",feedbackInvalid:"Please enter a valid fuel quantity"}),e.jsx(u,{className:"mb-3",type:"number",floatingLabel:"Cost Per Liter",placeholder:"Cost Per Liter",id:"costPerLiter",value:r.costPerLiter,onChange:c,autoComplete:"off",feedbackInvalid:"Please enter a valid cost per liter"}),e.jsx(u,{className:"mb-3",type:"number",floatingLabel:"Total Cost",placeholder:"Total Cost",id:"totalCost",value:r.totalCost,onChange:c,autoComplete:"off",min:"0",step:"0.01",disabled:!0,feedbackInvalid:"Please enter a valid total cost"})]}),e.jsxs(E,{children:[e.jsx(u,{className:"mb-3",type:"number",floatingLabel:"Odometer Reading",placeholder:"Odometer Reading",id:"currentMileage",value:r.currentMileage,onChange:c,autoComplete:"off",feedbackInvalid:"Please enter a valid odometer reading"}),e.jsx(u,{className:"mb-3",type:"text",floatingLabel:"Start Location",placeholder:"Start Location",id:"route.start",value:r.route.start,onChange:c,autoComplete:"off",feedbackInvalid:"Please enter a valid start location"}),e.jsx(u,{className:"mb-3",type:"text",floatingLabel:"End Location",placeholder:"End Location",id:"route.end",value:r.route.end,onChange:c,autoComplete:"off",feedbackInvalid:"Please enter a valid end location"}),e.jsx(u,{className:"mb-3",type:"number",floatingLabel:"Distance/kilometers",placeholder:"Distance",id:"route.distance",value:r.route.distance,onChange:c,autoComplete:"off",feedbackInvalid:"Please enter a valid distance"})]}),e.jsxs(E,{className:"mb-3",children:[e.jsx(u,{type:"text",floatingLabel:"L/100km",placeholder:"Liters per 100km",id:"litersPer100km",value:r.litersPer100km,disabled:!0}),e.jsx(u,{type:"text",floatingLabel:"km/L",placeholder:"Kilometers per Liter",id:"kmPerLiter",value:r.kmPerLiter,disabled:!0}),e.jsx(u,{type:"text",floatingLabel:"MPG",placeholder:"Miles per Gallon",id:"mpg",value:r.mpg,disabled:!0})]}),e.jsx(ke,{htmlFor:"receipt",children:"Picture Of Receipts"}),e.jsx(E,{className:"mb-3",children:e.jsx(u,{type:"file",id:"receipt",accept:"images/*",onChange:L})}),q&&e.jsx("div",{className:"mb-3",children:e.jsx(be,{src:q,rounded:!0,align:"center",alt:"Receipts",width:200,height:200})}),e.jsx(Fe,{className:"mb-3",type:"text",floatingLabel:"Notes",placeholder:"Notes",rows:3,id:"notes",value:r.notes,autoCapitalize:"on",autoComplete:"off",onChange:c,feedbackInvalid:"Please enter a valid notes"})]})}),e.jsxs(pe,{children:[e.jsx(R,{color:"secondary",onClick:()=>g(!1),children:"Close"}),e.jsx(R,{color:"primary",onClick:J,disabled:$,children:$?e.jsx(oe,{color:"primary",size:"sm"}):"Add"})]})]})]})},Xe=({fuelLogs:n,vehicles:K,drivers:M,loading:$,error:k,onDeleteFuelLog:_,onUpdateFuelLog:V,onViewReceipt:O})=>{const[A,ae]=l.useState(""),[g,B]=l.useState("date"),[F,q]=l.useState("desc"),[H,ee]=l.useState(""),[S,I]=l.useState(1),[W]=l.useState(10),[se,Q]=l.useState(null),r=Te(),s=["manager","admin"],c=t=>{g===t?q(F==="asc"?"desc":"asc"):(B(t),q("asc"))},L=n.filter(t=>{var h,d,m;if(!t)return!1;const a=A.toLowerCase(),i=t.vehicleId?`${t.vehicleId.brand} ${t.vehicleId.model} ${t.vehicleId.regisNumber}`:`${t.vehicleDetails.brand} ${t.vehicleDetails.model} ${t.vehicleDetails.regisNumber}`,v=t.driverId?t.driverId.driverName:t.driverDetails.driverName;return i.toLowerCase().includes(a)||v.toLowerCase().includes(a)||(((h=t.receiptNumber)==null?void 0:h.toLowerCase())||"").includes(a)||(t.date?new Date(t.date).toLocaleDateString().includes(a):!1)||(((d=t.fuelQuantity)==null?void 0:d.toString())||"").includes(a)||(((m=t.totalCost)==null?void 0:m.toString())||"").includes(a)}),J=S*W,f=J-W,X=L.slice(f,J),p=Math.ceil(L.length/W);return l.useEffect(()=>{I(1)},[A,H]),l.useEffect(()=>{L.length===0?Q("No matching records found"):Q(null)},[L]),$?e.jsx(oe,{}):k?e.jsx(ie,{color:"danger",children:k}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"mb-3",children:e.jsx(G,{className:"row g-3 mb-3",children:e.jsx(G,{className:"col-md-6 mt-3",children:e.jsxs(E,{children:[e.jsx(u,{placeholder:"Search by receipt #, vehicle, driver, date...",value:A,onChange:t=>ae(t.target.value),id:"search"}),e.jsx($e,{children:e.jsx(re,{icon:Ee})})]})})})}),e.jsxs(_e,{hover:!0,responsive:!0,className:"text-center",children:[e.jsx(Oe,{children:e.jsxs(Ie,{children:[e.jsxs(Y,{onClick:()=>c("date"),style:{cursor:"pointer"},children:["Date"," ",g==="date"&&e.jsx(re,{icon:F==="asc"?ye:Ne})]}),e.jsxs(Y,{onClick:()=>c("receiptNumber"),style:{cursor:"pointer"},children:["Receipt #"," ",g==="receiptNumber"&&e.jsx(re,{icon:F==="asc"?ye:Ne})]}),e.jsxs(Y,{onClick:()=>c("vehicle"),style:{cursor:"pointer"},children:["Vehicle ",g==="vehicle"&&(F==="asc"?"↑":"↓")]}),e.jsxs(Y,{onClick:()=>c("driver"),style:{cursor:"pointer"},children:["Driver ",g==="driver"&&(F==="asc"?"↑":"↓")]}),e.jsxs(Y,{onClick:()=>c("fuelQuantity"),style:{cursor:"pointer"},children:["Quantity (L) ",g==="fuelQuantity"&&(F==="asc"?"↑":"↓")]}),e.jsxs(Y,{onClick:()=>c("costPerLiter"),style:{cursor:"pointer"},children:["Cost/L ",g==="costPerLiter"&&(F==="asc"?"↑":"↓")]}),e.jsxs(Y,{onClick:()=>c("totalCost"),style:{cursor:"pointer"},children:["Total Cost ",g==="totalCost"&&(F==="asc"?"↑":"↓")]}),e.jsx(Y,{children:"Fuel Efficiency"}),e.jsx(Y,{children:"Actions"})]})}),e.jsx(Ae,{className:"align-middle",children:X.map(t=>e.jsxs(Ie,{children:[e.jsx(Z,{children:new Date(t.date).toLocaleDateString()}),e.jsx(Z,{children:t.receiptNumber}),e.jsx(Z,{children:t.vehicleId?`${t.vehicleId.brand} ${t.vehicleId.model} (${t.vehicleId.regisNumber})`:e.jsxs(e.Fragment,{children:[`${t.vehicleDetails.brand} ${t.vehicleDetails.model} (${t.vehicleDetails.regisNumber}) `,e.jsx(De,{color:"danger",className:"ms-2",children:"Deleted"})]})}),e.jsx(Z,{children:t.driverId?t.driverId.driverName:e.jsxs(e.Fragment,{children:[t.driverDetails.driverName," ",e.jsx(De,{color:"danger",className:"ms-2",children:"Deleted"})]})}),e.jsx(Z,{children:t.fuelQuantity}),e.jsx(Z,{children:t.costPerLiter}),e.jsx(Z,{children:t.totalCost}),e.jsxs(Z,{children:[e.jsxs(G,{children:[t.litersPer100km," L/100km"]}),e.jsxs(G,{children:[t.kmPerLiter," km/L"]}),e.jsxs(G,{children:[t.mpg," MPG"]})]}),e.jsx(Z,{children:e.jsxs(qe,{variant:"input-group",children:[e.jsx(Ue,{color:"secondary",variant:"outline",children:"Actions"}),e.jsxs(Ge,{children:[e.jsxs(R,{color:"primary",variant:"ghost",className:"m-2",onClick:()=>O(t),children:[e.jsx(re,{icon:Re})," View Receipt"]}),e.jsxs(R,{color:"info",variant:"ghost",className:"m-2",onClick:()=>V(t),children:[e.jsx(re,{icon:Me})," Edit"]}),s.includes(r)&&e.jsxs(R,{color:"danger",variant:"ghost",className:"m-2",onClick:()=>_(t._id),children:[e.jsx(re,{icon:Qe})," Delete"]})]})]})})]},t._id))})]}),L.length>0&&e.jsxs(G,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs(G,{children:["Showing ",f+1," to"," ",Math.min(J,L.length)," of"," ",L.length," entries"]}),e.jsxs(Be,{className:"mt-3",children:[e.jsx(ve,{disabled:S===1,onClick:()=>I(t=>Math.max(t-1,1)),children:"Previous"}),Array.from({length:p},(t,a)=>a+1).map(t=>e.jsx(ve,{active:t===S,onClick:()=>I(t),children:t},t)),e.jsx(ve,{disabled:S===p,onClick:()=>I(t=>Math.min(t+1,p)),children:"Next"})]})]}),se&&e.jsx(ie,{color:"info",className:"text-center",children:se})]})},Ye=({fuelLog:n,visible:K,onClose:M,onUpdate:$,vehicles:k,drivers:_})=>{var a,i,v,h,d,m,x,U,te,le,ne,de,ge;const{showSuccess:V,showError:O}=xe(),A="http://localhost:5057",[ae,g]=l.useState(!1),[B,F]=l.useState(null),[q,H]=l.useState(null),[ee,S]=l.useState(null),[I,W]=l.useState([]),[se,Q]=l.useState([]),r=new Date().toISOString().split("T")[0],[s,c]=l.useState({date:new Date(n.date).toISOString().split("T")[0],receiptNumber:n.receiptNumber,vehicleId:((a=n.vehicleId)==null?void 0:a._id)||n.vehicleId,driverId:((i=n.driverId)==null?void 0:i._id)||n.driverId,vehicleDetails:{brand:((v=n.vehicleId)==null?void 0:v.brand)||((h=n.vehicleDetails)==null?void 0:h.brand)||"",model:((d=n.vehicleId)==null?void 0:d.model)||((m=n.vehicleDetails)==null?void 0:m.model)||"",regisNumber:((x=n.vehicleId)==null?void 0:x.regisNumber)||((U=n.vehicleDetails)==null?void 0:U.regisNumber)||"",fuelType:((te=n.vehicleId)==null?void 0:te.fuelType)||((le=n.vehicleDetails)==null?void 0:le.fuelType)||""},driverDetails:{driverName:((ne=n.driverId)==null?void 0:ne.driverName)||((de=n.driverDetails)==null?void 0:de.driverName)||""},fuelQuantity:n.fuelQuantity,costPerLiter:n.costPerLiter,totalCost:n.totalCost,currentMileage:n.currentMileage||"",fuelType:n.fuelType||"",route:{start:n.route.start,end:n.route.end,distance:n.route.distance},litersPer100km:n.litersPer100km,kmPerLiter:n.kmPerLiter,mpg:n.mpg,notes:n.notes||""}),[L,J]=l.useState(!1);l.useEffect(()=>{n!=null&&n.receiptImage&&H(`${A}/uploads/receipts/${n.receiptImage}`)},[n]),l.useEffect(()=>{(async()=>{try{g(!0);const[C,y]=await Promise.all([z.get("/api/v1/driver"),z.get("/api/v1/vehicle/in-use")]);Q(C.data.data),W(y.data.data)}catch{O("Error fetching initial data")}finally{g(!1)}})()},[]);const f=j=>{const{id:C,value:y}=j.target;if(C.includes("route.")){const o=C.split(".")[1];c(N=>{const b={...N,route:{...N.route,[o]:y}};if(b.route.distance&&b.fuelQuantity){const D=parseFloat(b.route.distance),T=parseFloat(b.fuelQuantity);if(D>0&&T>0){const P=T/D*100;b.litersPer100km=P.toFixed(2);const w=D/T;b.kmPerLiter=w.toFixed(2);const fe=T*.264172,Ce=D*.621371/fe;b.mpg=Ce.toFixed(2)}}return b})}else if(C==="vehicleId"){const o=I.find(b=>b._id===y),N=_.find(b=>b._id===(o==null?void 0:o.assignedDriver));c(b=>({...b,vehicleId:y,driverId:(o==null?void 0:o.assignedDriver)||"",vehicleDetails:{brand:(o==null?void 0:o.brand)||"",model:(o==null?void 0:o.model)||"",regisNumber:(o==null?void 0:o.regisNumber)||"",fuelType:(o==null?void 0:o.fuelType)||""},driverDetails:{driverName:(N==null?void 0:N.driverName)||""},currentMileage:(o==null?void 0:o.currentMileage)||"",fuelType:(o==null?void 0:o.fuelType)||""}))}else c(C==="fuelQuantity"||C==="costPerLiter"?o=>{const N={...o,[C]:y},b=parseFloat(C==="fuelQuantity"?y:o.fuelQuantity),D=parseFloat(C==="costPerLiter"?y:o.costPerLiter);if(!isNaN(b)&&!isNaN(D)&&(N.totalCost=(b*D).toFixed(2)),C==="fuelQuantity"&&N.route.distance){const T=parseFloat(N.route.distance),P=parseFloat(y);if(T>0&&P>0){const w=P/T*100;N.litersPer100km=w.toFixed(2);const fe=T/P;N.kmPerLiter=fe.toFixed(2);const je=P*.264172,Se=T*.621371/je;N.mpg=Se.toFixed(2)}}return N}:o=>({...o,[C]:y}))},X=j=>{const C=j.target.files[0];if(C){c(o=>({...o,receiptImage:C}));const y=new FileReader;y.onloadend=()=>{H(y.result)},y.readAsDataURL(C)}},p=async j=>{var y,o,N,b;if(j.preventDefault(),!j.currentTarget.checkValidity()){j.stopPropagation(),J(!0);return}g(!0);try{const D=new FormData;Object.keys(s).forEach(P=>{P==="route"?Object.keys(s.route).forEach(w=>{D.append(`route[${w}]`,s.route[w])}):P==="vehicleDetails"?Object.keys(s.vehicleDetails).forEach(w=>{D.append(`vehicleDetails[${w}]`,s.vehicleDetails[w])}):P==="driverDetails"?Object.keys(s.driverDetails).forEach(w=>{D.append(`driverDetails[${w}]`,s.driverDetails[w])}):(P==="receiptImage"&&s[P],D.append(P,s[P]))});const T=await z.put(`/api/v1/fuelLogs/fuel-logs/${n._id}`,D);T.data.success&&(V(T.data.message),$({...T.data.data,vehicleId:{_id:s.vehicleId,brand:s.vehicleDetails.brand,model:s.vehicleDetails.model,regisNumber:s.vehicleDetails.regisNumber},driverId:{_id:s.driverId,driverName:s.driverDetails.driverName}}),M())}catch(D){O(((o=(y=D.response)==null?void 0:y.data)==null?void 0:o.message)||"Error updating fuel log"),S(((b=(N=D.response)==null?void 0:N.data)==null?void 0:b.message)||"Error updating fuel log")}finally{g(!1)}},t=!k.some(j=>j._id===s.vehicleId);return e.jsxs(ce,{visible:K,onClose:M,size:"lg",backdrop:"static",children:[e.jsx(ue,{children:e.jsx(Pe,{children:"Add Fuel Log"})}),ee&&e.jsx(ie,{color:"danger",className:"m-3",children:ee}),B&&e.jsx(ie,{color:"success",className:"m-3",children:B}),e.jsx(me,{children:e.jsxs(Le,{noValidate:!0,validated:L,children:[e.jsxs(E,{children:[" ",e.jsx(u,{type:"date",className:"mb-3",floatingLabel:"date",label:"Receipt Number",id:"date",max:r,value:s.date,onChange:f,required:!0,disabled:t}),e.jsxs(he,{className:"mb-3",floatingLabel:"Vehicle",label:"Vehicle",id:"vehicleId",value:s.vehicleId||"",onChange:f,required:!0,disabled:!0,children:[I.map(j=>e.jsxs("option",{value:j._id,children:[j.brand," / ",j.model," / ",j.regisNumber]},j._id)),e.jsxs("option",{value:"",children:[" ",`${s.vehicleDetails.brand} / ${s.vehicleDetails.model} / ${s.vehicleDetails.regisNumber} [DELETED]`]})]})]}),e.jsxs(E,{children:[e.jsx(u,{className:"mb-3",type:"text",floatingLabel:"Driver Name",placeholder:"Driver Name",id:"driverName",value:((ge=_.find(j=>j._id===s.driverId))==null?void 0:ge.driverName)||`${s.driverDetails.driverName} [DELETED]`,onChange:f,disabled:!0}),e.jsxs(he,{className:"mb-3",floatingLabel:"Fuel Type",label:"Fuel Type",id:"fuelType",required:!0,value:s.fuelType||"",onChange:f,disabled:!0,children:[e.jsx("option",{value:"",children:"Select Fuel Type"}),e.jsx("option",{value:"Gasoline",children:"Gasoline"}),e.jsx("option",{value:"Diesel",children:"Diesel"})]})]}),e.jsxs(E,{children:[e.jsx(u,{className:"mb-3",type:"text",floatingLabel:"Official Reciept",placeholder:"Official Reciept",id:"receiptNumber",value:s.receiptNumber,onChange:f,required:!0,autoComplete:"off",disabled:t}),e.jsx(u,{className:"mb-3",type:"number",floatingLabel:"Fuel Quantity",placeholder:"Fuel Quantity",id:"fuelQuantity",value:s.fuelQuantity,onChange:f,required:!0,autoComplete:"off",min:"0",step:"0.01",feedbackInvalid:"Please enter a valid fuel quantity",disabled:t}),e.jsx(u,{className:"mb-3",type:"number",floatingLabel:"Cost Per Liter",placeholder:"Cost Per Liter",id:"costPerLiter",value:s.costPerLiter,onChange:f,autoComplete:"off",feedbackInvalid:"Please enter a valid cost per liter",disabled:t}),e.jsx(u,{className:"mb-3",type:"number",floatingLabel:"Total Cost",placeholder:"Total Cost",id:"totalCost",value:s.totalCost,onChange:f,autoComplete:"off",min:"0",step:"0.01",disabled:!0,feedbackInvalid:"Please enter a valid total cost"})]}),e.jsxs(E,{children:[e.jsx(u,{className:"mb-3",type:"number",floatingLabel:"Odometer Reading",placeholder:"Odometer Reading",id:"currentMileage",value:s.currentMileage,onChange:f,autoComplete:"off",feedbackInvalid:"Please enter a valid odometer reading",disabled:t}),e.jsx(u,{className:"mb-3",type:"text",floatingLabel:"Start Location",placeholder:"Start Location",id:"route.start",value:s.route.start,onChange:f,autoComplete:"off",feedbackInvalid:"Please enter a valid start location",disabled:t}),e.jsx(u,{className:"mb-3",type:"text",floatingLabel:"End Location",placeholder:"End Location",id:"route.end",value:s.route.end,onChange:f,autoComplete:"off",feedbackInvalid:"Please enter a valid end location",disabled:t}),e.jsx(u,{className:"mb-3",type:"number",floatingLabel:"Distance/kilometers",placeholder:"Distance",id:"route.distance",value:s.route.distance,onChange:f,autoComplete:"off",min:"0",step:"0.01",feedbackInvalid:"Please enter a valid distance",disabled:t})]}),e.jsxs(E,{className:"mb-3",children:[e.jsx(u,{type:"text",floatingLabel:"L/100km",placeholder:"Liters per 100km",id:"litersPer100km",value:s.litersPer100km,disabled:!0}),e.jsx(u,{type:"text",floatingLabel:"km/L",placeholder:"Kilometers per Liter",id:"kmPerLiter",value:s.kmPerLiter,disabled:!0}),e.jsx(u,{type:"text",floatingLabel:"MPG",placeholder:"Miles per Gallon",id:"mpg",value:s.mpg,disabled:!0})]}),e.jsx(ke,{htmlFor:"receipt",children:"Picture Of Receipts"}),e.jsx(E,{className:"mb-3",children:e.jsx(u,{type:"file",id:"receipt",accept:"images/*",onChange:X,disabled:t})}),q&&e.jsx("div",{className:"mb-3",children:e.jsx(be,{src:q,rounded:!0,align:"center",alt:"Receipts",width:200,height:200})}),e.jsx(Fe,{className:"mb-3",type:"text",floatingLabel:"Notes",placeholder:"Notes",rows:3,id:"notes",value:s.notes,autoCapitalize:"on",autoComplete:"off",onChange:f,feedbackInvalid:"Please enter a valid notes",disabled:t})]})}),e.jsxs(pe,{children:[e.jsx(R,{color:"secondary",onClick:M,children:"Close"}),e.jsx(R,{color:"primary",onClick:p,disabled:ae||t,children:ae?e.jsx(oe,{color:"primary",size:"sm"}):"Add"})]})]})},ft=()=>{const n="http://localhost:5057",{showSuccess:K,showError:M}=xe(),[$,k]=l.useState([]),[_,V]=l.useState([]),[O,A]=l.useState([]),[ae,g]=l.useState(null),[B,F]=l.useState(!1),[q,H]=l.useState(null),[ee,S]=l.useState(!1),[I,W]=l.useState(null),[se,Q]=l.useState(!1),[r,s]=l.useState(null),[c,L]=l.useState(!1),[J,f]=l.useState(null),X=async()=>{var d,m;F(!0);try{const[x,U,te]=await Promise.all([z.get("/api/v1/fuelLogs/fuel-logs"),z.get("/api/v1/vehicle/in-use"),z.get("/api/v1/driver")]);k(x.data.data),V(U.data.data),A(te.data.data),K("Data fetched successfully")}catch(x){M(((m=(d=x.response)==null?void 0:d.data)==null?void 0:m.message)||"Error fetching data"),H(x.message)}finally{F(!1)}},p=d=>{W(d),S(!0)},t=async()=>{var d,m;try{await z.delete(`/api/v1/fuelLogs/fuel-logs/${I}`),k(x=>x.filter(U=>U._id!==I)),K("Fuel log deleted successfully"),S(!1)}catch(x){M(((m=(d=x.response)==null?void 0:d.data)==null?void 0:m.message)||"Error deleting fuel log")}},a=d=>{f(d),L(!0)},i=d=>{k(m=>m.map(x=>x._id===d._id?d:x)),L(!1),f(null)},v=d=>{if(d.receiptImage){const m=`${n}/uploads/receipts/${d.receiptImage}`;s(m),Q(!0),K("Receipt image loaded successfully")}else M("No receipt image available")};if(l.useEffect(()=>{X()},[]),B)return e.jsx(oe,{color:"primary",size:"sm",children:"Loading..."});const h=d=>{k(m=>[...m,d]),X()};return e.jsx(e.Fragment,{children:e.jsxs(G,{children:[e.jsx(ze,{children:"Fuel Management"}),e.jsx(He,{children:e.jsxs(We,{children:[e.jsx(G,{className:"mb-3",children:e.jsx(Je,{onAddFuelog:h})}),e.jsx(Xe,{fuelLogs:$,vehicles:_,drivers:O,loading:B,error:q,onDeleteFuelLog:p,onUpdateFuelLog:a,onViewReceipt:v})]})}),c&&e.jsx(Ye,{fuelLog:J,visible:c,onClose:()=>{L(!1),f(null)},onUpdate:i,vehicles:_,drivers:O}),e.jsxs(ce,{visible:ee,onClose:()=>S(!1),alignment:"center",children:[e.jsx(ue,{closeButton:!0,children:"Confirm Delete"}),e.jsx(me,{children:"Are you sure you want to delete this fuel log? This action cannot be undone."}),e.jsxs(pe,{children:[e.jsx(R,{color:"secondary",variant:"outline",onClick:()=>S(!1),children:"Cancel"}),e.jsx(R,{color:"danger",variant:"outline",onClick:t,children:"Delete"})]})]}),e.jsxs(ce,{visible:se,onClose:()=>{Q(!1),s(null)},size:"lg",alignment:"center",children:[e.jsx(ue,{closeButton:!0,children:"Receipt Image"}),e.jsx(me,{className:"text-center",children:r&&e.jsx(be,{src:r,alt:"Receipt",style:{maxWidth:"100%",maxHeight:"70vh",objectFit:"contain"},onError:d=>{toast.error("Error loading image"),d.target.src="placeholder-image-url.jpg"}})}),e.jsxs(pe,{children:[e.jsx(R,{color:"secondary",variant:"outline",onClick:()=>{Q(!1),s(null)},children:"Close"}),e.jsx(R,{color:"primary",variant:"outline",onClick:()=>window.open(r,"_blank"),children:"Open in New Tab"})]})]})]})})};export{ft as default};
