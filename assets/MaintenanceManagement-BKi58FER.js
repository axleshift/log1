import{r as i,_ as ge,u as Fe,R as y,a as _,c as ee,P as k,b as qe,A as oe,j as e,k as je,m as U,B as Ee,F as De}from"./index-D-r3SwWE.js";import{F as te,n as Ve,v as Re,o as Be,h as ze,p as Oe,a as He,w as $e,q as Qe}from"./index-DkpIxDEf.js";import{C as _e,a as E}from"./CButton-BWcN8_B8.js";import{C as he,a as ue,b as pe,c as me,d as xe}from"./CModalTitle-FBRC4ML3.js";import{C as ne}from"./CAlert-_XTBEDmE.js";import{C as Pe}from"./CForm-C3GjUB0m.js";import{C as G}from"./CInputGroup-Dkl_-Pet.js";import{C as J}from"./CFormSelect-foydsQMf.js";import{a as Se,b as Le,C as B}from"./CFormInput-CB7xe1Jz.js";import{C as ve}from"./CCard-DGVyD1PY.js";import{C as Ce}from"./CCardHeader-CugUrxSR.js";import{C as ie}from"./CCardBody-DitVf1Qc.js";import{C as Te,a as we,b as de,c as ae,d as Me,e as se}from"./CTable-Dwy4wl14.js";import{C as Q}from"./CContainer-Cn60p-_G.js";import{C as $,a as Ge}from"./DefaultLayout-DGHJqxJH.js";import{C as Ie}from"./CFormTextarea-eKx_WaeU.js";import{C as Ue}from"./CInputGroupText-DHxwz2Hn.js";import{C as Ke,a as Je,b as We,c as Xe}from"./CAccordionHeader-DThZWNtA.js";import{C as Ye,a as fe}from"./CPaginationItem-oNFJkbcX.js";import{C as Ze,a as et,b as tt,c as at}from"./CTabList-C0eRLflp.js";import"./index.esm-DvXRRzm4.js";import"./1-CvzzKQ8s.js";import"./cil-user-Ddrdy7PS.js";import"./getTransitionDurationFromElement-Cpu4p4hx.js";var be=i.forwardRef(function(r,t){var h=r.className,x=r.button,P=r.feedback,M=r.feedbackInvalid,v=r.feedbackValid,N=r.floatingLabel,u=r.tooltipFeedback,b=r.hitArea,p=r.id,L=r.indeterminate,f=r.inline,m=r.invalid,o=r.label,q=r.reverse,A=r.type,R=A===void 0?"checkbox":A,F=r.valid,D=ge(r,["className","button","feedback","feedbackInvalid","feedbackValid","floatingLabel","tooltipFeedback","hitArea","id","indeterminate","inline","invalid","label","reverse","type","valid"]),T=i.useRef(null),c=Fe(t,T);i.useEffect(function(){T.current&&L&&(T.current.indeterminate=L)},[L,T.current]);var j=function(){return y.createElement("input",_({type:R,className:ee(x?"btn-check":"form-check-input",{"is-invalid":m,"is-valid":F,"me-2":b}),id:p},D,{ref:c}))},C=function(){return y.createElement(Le,{describedby:D["aria-describedby"],feedback:P,feedbackInvalid:M,feedbackValid:v,floatingLabel:N,invalid:m,tooltipFeedback:u,valid:F})},z=function(){var O;return y.createElement(Se,_({customClassName:ee(x?ee("btn",x.variant?"btn-".concat(x.variant,"-").concat(x.color):"btn-".concat(x.color),(O={},O["btn-".concat(x.size)]=x.size,O),"".concat(x.shape)):"form-check-label")},p&&{htmlFor:p}),o)},W=function(){return x?y.createElement(y.Fragment,null,y.createElement(j,null),o&&y.createElement(z,null),y.createElement(C,null)):o?b?y.createElement(y.Fragment,null,y.createElement(j,null),y.createElement(Se,_({customClassName:ee("form-check-label stretched-link",h)},p&&{htmlFor:p}),o),y.createElement(C,null)):y.createElement("div",{className:ee("form-check",{"form-check-inline":f,"form-check-reverse":q,"is-invalid":m,"is-valid":F},h)},y.createElement(j,null),y.createElement(z,null),y.createElement(C,null)):y.createElement(j,null)};return y.createElement(W,null)});be.propTypes=_({button:k.object,className:k.string,hitArea:k.oneOf(["full"]),id:k.string,indeterminate:k.bool,inline:k.bool,label:k.oneOfType([k.string,k.node]),reverse:k.bool,type:k.oneOf(["checkbox","radio"])},Le.propTypes);be.displayName="CFormCheck";var ye=i.forwardRef(function(r,t){var h,x=r.children,P=r.as,M=P===void 0?"ul":P,v=r.className,N=r.flush,u=r.layout,b=ge(r,["children","as","className","flush","layout"]);return y.createElement(M,_({className:ee("list-group",(h={"list-group-flush":N},h["list-group-".concat(u)]=u,h),v)},b,{ref:t}),x)});ye.propTypes={as:k.elementType,children:k.node,className:k.string,flush:k.bool,layout:k.oneOf(["horizontal","horizontal-sm","horizontal-md","horizontal-lg","horizontal-xl","horizontal-xxl"])};ye.displayName="CListGroup";var ke=i.forwardRef(function(r,t){var h,x=r.children,P=r.active,M=r.as,v=M===void 0?"li":M,N=r.className,u=r.disabled,b=r.color,p=ge(r,["children","active","as","className","disabled","color"]),L=v==="a"||v==="button"?_e:v;return p=_(_(_(_({},(v==="a"||v==="button")&&{active:P,disabled:u,as:v,ref:t}),P&&{"aria-current":!0}),u&&{"aria-disabled":!0}),p),y.createElement(L,_({className:ee("list-group-item",(h={},h["list-group-item-".concat(b)]=b,h["list-group-item-action"]=v==="a"||v==="button",h.active=P,h.disabled=u,h),N)},p),x)});ke.propTypes={active:k.bool,as:k.elementType,children:k.node,className:k.string,color:qe,disabled:k.bool};ke.displayName="CListGroupItem";const st=({onAddMaintenance:r})=>{const{showError:t,showSuccess:h}=oe(),[x,P]=i.useState(!1),[M,v]=i.useState(null),[N,u]=i.useState(!1),[b,p]=i.useState(!1),L={vehicle:"",maintenanceType:"",startDate:"",expectedEndDate:"",description:"",priority:"",category:"",checklist:[{task:"",completed:!1}],parts:[]},[f,m]=i.useState(L),[o,q]=i.useState([]),[A,R]=i.useState({partName:"",quantity:""}),F=new Date().toISOString().split("T")[0],D=l=>{const{id:d,value:I}=l.target;m(s=>({...s,[d]:I}))},T=l=>{const{id:d,value:I}=l.target;R(s=>({...s,[d.split(".")[1]]:I}))},c=()=>{m(l=>({...l,parts:[...l.parts,{...A}]})),R({partName:"",quantity:""})};i.useEffect(()=>{(async()=>{try{const d=await U.get("api/v1/vehicle/all");d.data.success&&q(d.data.data)}catch(d){v(d),t(d.message)}})()},[]);const j=()=>{m(l=>({...l,checklist:[...l.checklist,{task:"",completed:!1}]}))},C=l=>{m(d=>({...d,parts:d.parts.filter((I,s)=>s!==l)}))},z=l=>{m(d=>({...d,checklist:d.checklist.filter((I,s)=>s!==l)}))},W=(l,d)=>{m(I=>({...I,checklist:I.checklist.map((s,n)=>n===l?{...s,task:d}:s)}))},O=[{label:"High",value:"High"},{label:"Medium",value:"Medium"},{label:"Low",value:"Low"},{label:"Critical",value:"Critical"}],le=[{label:"Engine",value:"Engine"},{label:"Transmission",value:"Transmission"},{label:"Brakes",value:"Brakes"},{label:"Electrical",value:"Electrical"},{label:"Tiers",value:"Tiers"},{label:"Other",value:"Other"}],re=[{label:"Preventive",value:"PMS"},{label:"Corrective",value:"Corrective"},{label:"Emergency",value:"Emergency"}],w=async l=>{var I,s,n,S;if(l.currentTarget.checkValidity()===!1)l.stopPropagation(),l.preDefault();else try{const g=await U.post("api/v1/maintenance/create",f);g.data.success&&(h(g.data.message),r(g.data.data),u(!1))}catch(g){t(((s=(I=g.response)==null?void 0:I.data)==null?void 0:s.message)||g.message),v(((S=(n=g.response)==null?void 0:n.data)==null?void 0:S.message)||g.message),setTimeout(()=>{v(null)},2e3)}p(!0)};return e.jsxs(e.Fragment,{children:[e.jsxs(E,{color:"primary",className:"mb-3",variant:"outline",onClick:()=>u(!0),children:[e.jsx(te,{icon:Ve})," Add Maintenance"]}),e.jsxs(he,{visible:N,onClose:()=>u(!1),size:"lg",children:[e.jsx(ue,{closeButton:!0,children:e.jsx(pe,{children:"Add Maintenance"})}),M&&e.jsx(ne,{color:"danger",children:M}),e.jsx(me,{children:e.jsxs(Pe,{className:"row g-3 needs-validation",noValidate:!0,validated:b,children:[e.jsxs(G,{children:[e.jsxs(J,{id:"vehicle",value:f.vehicle,onChange:D,floatingLabel:"Vehicle",placeholder:"Select Vehicle",required:!0,feedbackInvalid:"Please provide a valid vehicle.",children:[e.jsx("option",{value:"",children:"Select Vehicle"}),o.map(l=>e.jsxs("option",{value:l._id,children:[l.brand," / ",l.model," / ",l.regisNumber]},l._id))]}),e.jsx(J,{id:"maintenanceType",value:f.maintenanceType,onChange:D,floatingLabel:"Maintenance Type",placeholder:"Select Maintenance Type",required:!0,options:[{label:"Select Maintenance Type",value:""},...re],feedbackInvalid:"Please provide a valid maintenance type."}),e.jsx(B,{id:"description",type:"text",floatingLabel:"Description",placeholder:"Description",required:!0,value:f.description,onChange:D,feedbackInvalid:"Please provide a valid description."})]}),e.jsxs(G,{children:[e.jsx(B,{id:"startDate",type:"date",floatingLabel:"Start Date",placeholder:"Start Date",required:!0,min:F,value:f.startDate,onChange:D,feedbackInvalid:"Please provide a valid start date."}),e.jsx(B,{id:"expectedEndDate",type:"date",floatingLabel:"Expected End Date",placeholder:"Expected End Date",required:!0,min:F,value:f.expectedEndDate,onChange:D,feedbackInvalid:"Please provide a valid expected end date."}),e.jsxs(J,{id:"priority",value:f.priority,onChange:D,floatingLabel:"Priority",placeholder:"Select Priority",required:!0,feedbackInvalid:"Please provide a valid priority.",children:[e.jsx("option",{value:"",children:"Select Priority"}),O.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))]}),e.jsxs(J,{id:"category",value:f.category,onChange:D,floatingLabel:"Category",placeholder:"Select Category",required:!0,feedbackInvalid:"Please provide a valid category.",children:[e.jsx("option",{value:"",children:"Select Category"}),le.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))]})]}),e.jsxs(ve,{className:"mb-3",children:[e.jsx(Ce,{children:"Add Parts"}),e.jsxs(ie,{children:[e.jsxs(G,{className:"mb-3",children:[e.jsx(B,{id:"parts.partName",type:"text",floatingLabel:"Part Name",placeholder:"Part Name",value:A.partName,onChange:T}),e.jsx(B,{id:"parts.quantity",type:"number",floatingLabel:"Quantity",placeholder:"Quantity",value:A.quantity,onChange:T}),e.jsx(E,{color:"primary",onClick:c,children:"Add Part"})]}),f.parts.length>0&&e.jsxs(Te,{className:"",children:[e.jsx(we,{className:"text-center",children:e.jsxs(de,{children:[e.jsx(ae,{children:"Part Name"}),e.jsx(ae,{children:"Part Quantity"}),e.jsx(ae,{children:"Remove Part"})]})}),e.jsx(Me,{className:"text-center",children:f.parts.map((l,d)=>e.jsxs(de,{children:[e.jsx(se,{children:l.partName}),e.jsx(se,{children:l.quantity}),e.jsx(se,{children:e.jsx(E,{color:"danger",size:"sm",onClick:()=>C(d),children:"Remove"})})]},d))})]})]})]}),e.jsxs(Q,{children:[e.jsx($,{children:"Checklist Items"}),e.jsx(E,{color:"primary",variant:"outline",className:"m-2",onClick:j,children:"Add Checklist Item"}),f.checklist.map((l,d)=>e.jsxs(G,{className:"mb-2",children:[e.jsx(B,{value:l.task,id:"itemCheckList",onChange:I=>W(d,I.target.value),placeholder:"Enter checklist item",required:!0}),e.jsx(E,{color:"danger",variant:"outline",onClick:()=>z(d),children:"Remove"})]},d))]}),e.jsx(Ie,{id:"notes",floatingLabel:"Notes",placeholder:"Notes",value:f.notes,onChange:D,autoComplete:"off",style:{minHeight:"150px",width:"100%",resize:"vertical"},text:" leave empty if no notes.",feedbackInvalid:"Please provide a valid notes."})]})}),e.jsxs(xe,{children:[e.jsx(E,{color:"secondary",variant:"outline",onClick:()=>u(!1),children:"Close"}),e.jsx(E,{color:"primary",variant:"outline",onClick:w,children:x?e.jsx(je,{size:"sm"}):"Add Maintenance"})]})]})]})},lt=({onCompleted:r,maintenance:t})=>{var u;const{showSuccess:h,showError:x}=oe(),P=Ee(),M=["admin","chief mechanic"];if(!t||!t.checklist)return null;const v=()=>{const b=new Date,p=new Date(t.startDate);return b<p},N=async b=>{var p,L;try{const f=De(),m=await U.patch(`api/v1/maintenance/complete/${b}`,{completedBy:f});m.data.success&&(h(m.data.message),r(m.data.data))}catch(f){const m=((L=(p=f.response)==null?void 0:p.data)==null?void 0:L.message)||"Error completing maintenance";x(m),console.error("Error completing maintenance:",f)}};return e.jsx(e.Fragment,{children:M.includes(P)&&e.jsxs(e.Fragment,{children:[e.jsx(E,{color:"success",variant:"outline",onClick:()=>N(t._id),disabled:!((u=t.checklist)!=null&&u.every(b=>b.completed))||v(),title:v()?"Maintenance cannot be completed before its start date":"",children:"Complete Maintenance"}),v()&&e.jsxs("div",{className:"text-danger mt-2",children:["This maintenance cannot be completed before"," ",new Date(t.startDate).toLocaleDateString()]})]})})},rt=({onUpdateMaintenance:r,maintenance:t,disabled:h})=>{var I;const{showError:x,showSuccess:P}=oe(),[M,v]=i.useState(!1),[N,u]=i.useState(null),[b,p]=i.useState(!1),[L,f]=i.useState(!1),m={vehicle:((I=t==null?void 0:t.vehicle)==null?void 0:I._id)||"",maintenanceType:(t==null?void 0:t.maintenanceType)||"",startDate:t!=null&&t.startDate?t.startDate.split("T")[0]:"",expectedEndDate:t!=null&&t.expectedEndDate?t.expectedEndDate.split("T")[0]:"",description:(t==null?void 0:t.description)||"",priority:(t==null?void 0:t.priority)||"",category:(t==null?void 0:t.category)||"",checklist:(t==null?void 0:t.checklist)||[],parts:(t==null?void 0:t.parts)||[],notes:(t==null?void 0:t.notes)||""},[o,q]=i.useState(m),[A,R]=i.useState([]),[F,D]=i.useState({partName:"",quantity:""}),T=new Date().toISOString().split("T")[0],c=s=>{const{id:n,value:S}=s.target;q(g=>({...g,[n]:S}))},j=s=>{const{id:n,value:S}=s.target,g=n.split(".")[1];D(K=>({...K,[g]:g==="quantity"?S===""?"":Number(S):S}))},C=()=>{if(!F.partName||!F.quantity){x("Please fill in both part name and quantity");return}q(s=>({...s,parts:[...s.parts,{...F}]})),D({partName:"",quantity:""})};i.useEffect(()=>{var s;t&&q({vehicle:((s=t==null?void 0:t.vehicle)==null?void 0:s._id)||"",maintenanceType:(t==null?void 0:t.maintenanceType)||"",startDate:t!=null&&t.startDate?t.startDate.split("T")[0]:"",expectedEndDate:t!=null&&t.expectedEndDate?t.expectedEndDate.split("T")[0]:"",description:(t==null?void 0:t.description)||"",priority:(t==null?void 0:t.priority)||"",category:(t==null?void 0:t.category)||"",checklist:(t==null?void 0:t.checklist)||[],parts:(t==null?void 0:t.parts)||[],notes:(t==null?void 0:t.notes)||""})},[t]),i.useEffect(()=>{(async()=>{try{const n=await U.get("api/v1/vehicle/all");n.data.success&&R(n.data.data)}catch(n){u(n),x(n.message)}})()},[]);const z=()=>{q(s=>({...s,checklist:[...s.checklist,{task:"",completed:!1}]}))},W=s=>{q(n=>({...n,parts:n.parts.filter((S,g)=>g!==s)}))},O=s=>{q(n=>({...n,checklist:n.checklist.filter((S,g)=>g!==s)}))},le=(s,n)=>{q(S=>({...S,checklist:S.checklist.map((g,K)=>K===s?{...g,task:n}:g)}))},re=[{label:"High",value:"High"},{label:"Medium",value:"Medium"},{label:"Low",value:"Low"},{label:"Critical",value:"Critical"}],w=[{label:"Engine",value:"Engine"},{label:"Transmission",value:"Transmission"},{label:"Brakes",value:"Brakes"},{label:"Electrical",value:"Electrical"},{label:"Tiers",value:"Tiers"},{label:"Other",value:"Other"}],l=[{label:"Preventive",value:"PMS"},{label:"Corrective",value:"Corrective"},{label:"Emergency",value:"Emergency"}],d=async s=>{var S,g,K,ce;s.preventDefault();const n=s.currentTarget;if(f(!0),n.checkValidity()===!1){s.stopPropagation();return}v(!0);try{const a=await U.put(`api/v1/maintenance/update/${t._id}`,o);a.data.success&&(P(a.data.message),r(a.data.data),p(!1))}catch(a){x(((g=(S=a.response)==null?void 0:S.data)==null?void 0:g.message)||a.message),u(((ce=(K=a.response)==null?void 0:K.data)==null?void 0:ce.message)||a.message),setTimeout(()=>{u(null)},2e3)}finally{v(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(E,{color:"primary",className:"me-1 unset",variant:"outline",onClick:()=>p(!0),disabled:h,children:h?e.jsx(te,{icon:Re}):e.jsx(te,{icon:Be})}),e.jsxs(he,{visible:b,onClose:()=>p(!1),size:"lg",children:[e.jsx(ue,{closeButton:!0,children:e.jsx(pe,{children:"Update Maintenance"})}),N&&e.jsx(ne,{color:"danger",children:N}),e.jsx(me,{children:e.jsxs(Pe,{className:"row g-3 needs-validation",noValidate:!0,validated:L,children:[e.jsxs(G,{children:[e.jsxs(J,{id:"vehicle",value:o.vehicle||"",onChange:c,floatingLabel:"Vehicle",placeholder:"Select Vehicle",required:!0,feedbackInvalid:"Please provide a valid vehicle.",children:[e.jsx("option",{value:"",children:"Select Vehicle"}),A.map(s=>e.jsxs("option",{value:s._id,children:[s.brand," / ",s.model," / ",s.regisNumber]},s._id))]}),e.jsx(J,{id:"maintenanceType",value:o.maintenanceType||"",onChange:c,floatingLabel:"Maintenance Type",placeholder:"Select Maintenance Type",required:!0,options:[{label:"Select Maintenance Type",value:""},...l],feedbackInvalid:"Please provide a valid maintenance type."}),e.jsx(B,{id:"description",type:"text",floatingLabel:"Description",placeholder:"Description",required:!0,value:o.description,onChange:c,feedbackInvalid:"Please provide a valid description."})]}),e.jsxs(G,{children:[e.jsx(B,{id:"startDate",type:"date",floatingLabel:"Start Date",placeholder:"Start Date",required:!0,min:T,value:o.startDate,onChange:c,feedbackInvalid:"Please provide a valid start date."}),e.jsx(B,{id:"expectedEndDate",type:"date",floatingLabel:"Expected End Date",placeholder:"Expected End Date",required:!0,min:T,value:o.expectedEndDate,onChange:c,feedbackInvalid:"Please provide a valid expected end date."}),e.jsxs(J,{id:"priority",value:o.priority||"",onChange:c,floatingLabel:"Priority",placeholder:"Select Priority",required:!0,feedbackInvalid:"Please provide a valid priority.",children:[e.jsx("option",{value:"",children:"Select Priority"}),re.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),e.jsxs(J,{id:"category",value:o.category,onChange:c,floatingLabel:"Category",placeholder:"Select Category",required:!0,feedbackInvalid:"Please provide a valid category.",children:[e.jsx("option",{value:"",children:"Select Category"}),w.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]})]}),e.jsxs(ve,{className:"mb-3",children:[e.jsx(Ce,{children:"Add Parts"}),e.jsxs(ie,{children:[e.jsxs(G,{className:"mb-3",children:[e.jsx(B,{id:"parts.partName",type:"text",floatingLabel:"Part Name",placeholder:"Part Name",value:F.partName||"",onChange:j}),e.jsx(B,{id:"parts.quantity",type:"number",floatingLabel:"Quantity",placeholder:"Quantity",value:F.quantity||"",onChange:j}),e.jsx(E,{color:"primary",onClick:C,children:"Add Part"})]}),o.parts.length>0&&e.jsxs(Te,{className:"",children:[e.jsx(we,{className:"text-center",children:e.jsxs(de,{children:[e.jsx(ae,{children:"Part Name"}),e.jsx(ae,{children:"Part Quantity"}),e.jsx(ae,{children:"Remove Part"})]})}),e.jsx(Me,{className:"text-center",children:o.parts.map((s,n)=>e.jsxs(de,{children:[e.jsx(se,{children:s.partName}),e.jsx(se,{children:s.quantity}),e.jsx(se,{children:e.jsx(E,{color:"danger",size:"sm",onClick:()=>W(n),children:"Remove"})})]},n))})]})]})]}),e.jsxs(Q,{children:[e.jsx($,{children:"Checklist Items"}),e.jsx(E,{color:"primary",variant:"outline",className:"m-2",onClick:z,children:"Add Checklist Item"}),o.checklist.map((s,n)=>e.jsxs(G,{className:"mb-2",children:[e.jsx(B,{value:s.task,id:"itemCheckList",onChange:S=>le(n,S.target.value),placeholder:"Enter checklist item",required:!0}),e.jsx(E,{color:"danger",variant:"outline",onClick:()=>O(n),children:"Remove"})]},n))]}),e.jsx(Ie,{id:"notes",floatingLabel:"Notes",placeholder:"Notes",value:o.notes,onChange:c,autoComplete:"off",style:{minHeight:"150px",width:"100%",resize:"vertical"},text:" leave empty if no notes.",feedbackInvalid:"Please provide a valid notes."})]})}),e.jsxs(xe,{children:[e.jsx(E,{color:"secondary",variant:"outline",onClick:()=>p(!1),children:"Close"}),e.jsx(E,{color:"primary",variant:"outline",onClick:d,children:M?e.jsx(je,{size:"sm"}):"Update Maintenance"})]})]})]})},it=({onDeleteMaintenance:r,onUpdateMaintenance:t,maintenance:h,onCompleted:x,vehicles:P,loading:M,error:v,selectedMaintenanceId:N})=>{const u=Ee(),{showError:b,showSuccess:p}=oe(),L=["admin","chief mechanic"],[f,m]=i.useState(null),[o,q]=i.useState(""),[A,R]=i.useState([]),[F,D]=i.useState(!1),[T,c]=i.useState(1),[j]=i.useState(10),C=T*j,z=C-j,W=A.slice(z,C),O=Math.ceil(A.length/j),[le,re]=i.useState([]),[w,l]=i.useState({checklist:[]}),[d,I]=i.useState(!0);i.useEffect(()=>{N&&(console.log("Selected Maintenance ID:",N),re([N]),setTimeout(()=>{const a=document.getElementById(`maintenance-${N}`);a&&a.scrollIntoView({behavior:"smooth",block:"center"})},100))},[N]),i.useEffect(()=>{R(h)},[h]);const s=a=>{l(a),D(!0)},n=()=>{l(null),D(!1)},S=async(a,H)=>{var V,X;try{const Y=De(),Z=await U.patch(`api/v1/maintenance/${a}/checklist/${H}`,{completedBy:Y});Z.data.success&&(R(Ae=>Ae.map(Ne=>Ne._id===a?Z.data.data:Ne)),(w==null?void 0:w._id)===a&&l(Z.data.data),p(Z.data.message))}catch(Y){console.error("Error updating checklist:",Y),b(((X=(V=Y.response)==null?void 0:V.data)==null?void 0:X.message)||"Error updating checklist item")}},g=a=>a?`${a.brand||""} ${a.model||""} ${a.regisNumber||""}`.trim():"N/A";i.useEffect(()=>{(()=>{if(c(1),o==="")R(h);else{const H=h.filter(V=>{var X,Y,Z;return((X=V.vehicle)==null?void 0:X.regisNumber.toLowerCase().includes(o.toLowerCase()))||((Y=V.vehicle)==null?void 0:Y.brand.toLowerCase().includes(o.toLowerCase()))||((Z=V.vehicle)==null?void 0:Z.model.toLowerCase().includes(o.toLowerCase()))||V.maintenanceType.toLowerCase().includes(o.toLowerCase())||V.priority.toLowerCase().includes(o.toLowerCase())||V.status.toLowerCase().includes(o.toLowerCase())});R(H),H.length===0?m("No vehicles found"):m(null)}})()},[o,h]);const K=a=>{switch(a){case"Completed":return"green";case"Scheduled":return"orange";case"In Progress":return"yellow";default:return"black"}},ce=[{value:"Completed",label:"Completed"},{value:"Scheduled",label:"Scheduled"},{value:"In Progress",label:"In Progress"}];return e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"mt-3",children:e.jsxs(G,{className:"mb-3",children:[e.jsx(B,{type:"text",placeholder:"Search",id:"search",value:o,onChange:a=>q(a.target.value)}),e.jsx(Ue,{children:e.jsx(te,{icon:ze})})]})}),e.jsx(Ke,{activeItems:le,className:"m-2",children:W.map((a,H)=>e.jsxs(Je,{itemKey:a._id,id:`maintenance-${a._id}`,children:[e.jsxs(We,{className:"d-flex justify-content-between",children:[e.jsx(Q,{children:e.jsxs("ul",{className:"list-unstyled",children:[e.jsxs("li",{children:["Vehicle: ",e.jsx("strong",{children:g(a.vehicle)})]}),e.jsxs("li",{children:["Priority: ",e.jsx("strong",{children:a.priority||"N/A"})]})]})}),e.jsxs(Q,{className:"d-flex justify-content-end",children:[e.jsx(te,{icon:Oe,color:K(a.status),className:"m-2 float-end"}),e.jsx("small",{className:"m2 float-end",children:ce.find(V=>V.value===a.status).label})]})]}),e.jsxs(Xe,{children:[e.jsxs($,{children:["Maintenance Type: ",a.maintenanceType||"N/A"]}),e.jsxs($,{children:["Start Date:"," ",a.startDate?new Date(a.startDate).toLocaleDateString():"N/A"]}),e.jsxs($,{children:["Expected Date:"," ",a.expectedEndDate?new Date(a.expectedEndDate).toLocaleDateString():"N/A"]}),e.jsxs($,{children:["Description: ",a.description||"N/A"]}),e.jsxs($,{children:["Category: ",a.category||"N/A"]}),e.jsxs($,{children:["Notes: ",a.notes||"N/A"]}),e.jsxs($,{children:["Completed By: ",a.completedBy||"N/A"]}),e.jsxs(ve,{className:"mt-3",children:[e.jsx(Ce,{children:e.jsx("strong",{children:"Parts Required"})}),e.jsx(ie,{children:a.parts&&a.parts.length>0?e.jsx(e.Fragment,{children:e.jsx(ye,{children:a.parts.map((V,X)=>e.jsxs(ke,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("div",{children:e.jsx("strong",{children:V.partName})}),e.jsx("div",{className:"d-flex gap-3",children:e.jsxs(He,{color:"primary",children:["Qty: ",V.quantity]})})]},X))})}):e.jsx(ne,{color:"info",children:"No parts listed for this maintenance"})})]}),e.jsxs(Q,{className:"d-flex justify-content-end mt-3",children:[L.includes(u)&&e.jsx(rt,{maintenance:a,onUpdateMaintenance:t,vehicles:P,disabled:a.status==="Completed"}),e.jsx(E,{color:"primary",className:"m-1",variant:"outline",onClick:()=>s(a),children:e.jsx(te,{icon:$e})}),e.jsx(E,{color:"danger",className:"m-1",variant:"outline",onClick:()=>r(a._id),children:e.jsx(te,{icon:Qe})})]})]})]},a._id))}),A.length>0&&e.jsxs(Q,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs(Q,{children:["Showing ",z+1," to ",Math.min(C,A.length)," ","of ",A.length," entries"]}),e.jsxs(Ye,{className:"mt-3",children:[e.jsx(fe,{disabled:T===1,onClick:()=>c(a=>Math.max(a-1,1)),children:"Previous"}),Array.from({length:O},(a,H)=>H+1).map(a=>e.jsx(fe,{active:a===T,onClick:()=>c(a),children:a},a)),e.jsx(fe,{disabled:T===O,onClick:()=>c(a=>Math.min(a+1,O)),children:"Next"})]})]}),f&&e.jsx(ne,{color:"danger",children:f}),e.jsxs(he,{visible:F,onClose:n,size:"lg",children:[e.jsx(ue,{children:e.jsxs(pe,{children:["Maintenance Checklist - ",g(w==null?void 0:w.vehicle)]})}),e.jsx(me,{children:w!=null&&w.checklist&&w.checklist.length>0?e.jsx("div",{className:"checklist-container",children:e.jsx("ul",{className:"list-group",children:w.checklist.map((a,H)=>e.jsxs("li",{className:"list-group-item d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx(be,{type:"checkbox",id:`checkBoxList-${H}`,checked:a.completed,onChange:()=>S(w._id,H),disabled:!L.includes(u),className:"me-2"})," ",a.task]}),a.completed&&e.jsxs("small",{className:"text-muted",children:["Completed by: ",a.completedBy," at"," ",new Date(a.completedAt).toLocaleString()]})]},H))})}):e.jsx("p",{className:"text-center",children:"No checklist items available"})}),e.jsxs(xe,{children:[w&&e.jsx(lt,{maintenance:w,isLoading:d,onCompleted:x,disabled:!L.includes(u)}),e.jsx(E,{color:"secondary",onClick:n,children:"Close"})]})]})]})},wt=()=>{var T;const[r,t]=i.useState([]),[h,x]=i.useState([]),[P,M]=i.useState(!0),[v,N]=i.useState(null),{showError:u,showSuccess:b}=oe(),[p,L]=i.useState(((T=location.state)==null?void 0:T.selectedMaintenanceId)||null),[f,m]=i.useState(!1),o=async()=>{var c,j;M(!0);try{const[C,z]=await Promise.all([U.get("/api/v1/maintenance/all"),U.get("/api/v1/vehicle")]);t(C.data.data),x(z.data.date)}catch(C){N(C.message),u(((j=(c=C.response)==null?void 0:c.data)==null?void 0:j.message)||"Error fetching data")}finally{M(!1)}};if(i.useEffect(()=>{o()},[]),P)return e.jsx(je,{color:"primary",size:"sm",children:"Loading..."});const q=c=>{L(c),m(!0)},A=async()=>{try{await U.delete(`/api/v1/maintenance/delete/${p}`),t(c=>c.filter(j=>j._id!==p)),b("Maintenance deleted successfully"),m(!1)}catch(c){u(c.response.data.message)}finally{m(!1)}},R=c=>{t(j=>[...j,c]),o()},F=c=>{t(j=>j.map(C=>C._id===c._id?c:C)),o()},D=c=>{t(j=>j.map(C=>C._id===c._id?c:C)),o()};return e.jsxs(e.Fragment,{children:[e.jsxs(Q,{children:[e.jsx($,{children:"Maintenance Management"}),e.jsx(ve,{children:e.jsxs(ie,{children:[e.jsx(Q,{children:e.jsx(st,{onAddMaintenance:R})}),e.jsxs(Ze,{activeItemKey:"Maintenance List",children:[e.jsx(et,{variant:"tabs",children:e.jsx(tt,{itemKey:"Maintenance List",children:"Maintenance List"})}),e.jsx(Ge,{children:e.jsx(at,{itemKey:"Maintenance List",children:e.jsx(ie,{className:"md-3",children:e.jsx(it,{vehicles:h,maintenance:r,onCompleted:F,error:v,onDeleteMaintenance:q,onUpdateMaintenance:D,loading:P,selectedMaintenanceId:p})})})})]})]})})]}),e.jsxs(he,{visible:f,onClose:()=>m(!1),alignment:"center",children:[e.jsx(ue,{children:e.jsx(pe,{children:"Delete Maintenance"})}),e.jsx(me,{children:"Are you sure you want to delete this maintenance?"}),e.jsxs(xe,{children:[e.jsx(E,{color:"secondary",variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsx(E,{color:"danger",variant:"outline",onClick:A,children:"Delete"})]})]})]})};export{wt as default};
