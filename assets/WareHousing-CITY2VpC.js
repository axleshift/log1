import{r as a,D as he,j as e,k as z,n as le,l as ue,F as V}from"./index-Dhfr7Mgv.js";import{F as J,e as X,a as ce}from"./index-Cj-9IccM.js";import{C as W}from"./CAlert-DnAqXuMZ.js";import{C as A}from"./CContainer-BKw8-WhC.js";import{C as Z}from"./CInputGroup-Cu2gbTNP.js";import{C as ee}from"./CFormInput-BVTt8IfD.js";import{C as se}from"./CInputGroupText-dA7O-RtV.js";import{C as me,a as xe,b as je,c as fe}from"./CAccordionHeader-Dzz2nJ4r.js";import{C as te,a as re,b as q,c as p,d as ae,e as v}from"./CTable-DsboRqTp.js";import{C as ne,a as _}from"./CPaginationItem-CtYQeeU9.js";import{a as ge}from"./CButton-Cku8I2Fk.js";import{C as pe,a as ve,b as G,c as Y}from"./CTabList-DWNqCWaC.js";import{a as Ne,C as oe}from"./DefaultLayout-CQIqykMK.js";import{C as ie}from"./CCard-DFyHE6Ue.js";import"./getTransitionDurationFromElement-Cpu4p4hx.js";import"./index.esm-DloWyP-4.js";import"./1-B5_0tl7Z.js";import"./cil-user-Ddrdy7PS.js";const we=({warehousing:N,loading:y,error:E,onDeleteItem:u,onUpdateItem:C})=>{const[m,b]=a.useState([]),[I,f]=a.useState(null),[S,w]=a.useState("");he();const[g,P]=a.useState(1),[O]=a.useState(10),[d,c]=a.useState([]),x=Math.ceil(m.length/O),L=m.filter(s=>s.received===!0),k=g*O,r=k-O,j=L.slice(r,k);a.useEffect(()=>{try{if(S===""){b(N),f(null);return}const s=S.toLowerCase().trim(),h=N.filter(t=>{var o,n,i,R,M,Q,U,K,H;try{return((o=t.poNumber)==null?void 0:o.toLowerCase().includes(s))||((i=(n=t.vendor)==null?void 0:n.businessName)==null?void 0:i.toLowerCase().includes(s))||((M=(R=t.vendor)==null?void 0:R.businessAddress)==null?void 0:M.toLowerCase().includes(s))||((U=(Q=t.vendor)==null?void 0:Q.contactNumber)==null?void 0:U.includes(s))||t.orderDate&&new Date(t.orderDate).toLocaleDateString().includes(s)||t.dateOfReceived&&new Date(t.receiveDate).toLocaleDateString().includes(s)||((K=l(t.warehouseId))==null?void 0:K.toLowerCase().includes(s))||((H=t.details)==null?void 0:H.some(F=>{var $,T,B;return(($=F.description)==null?void 0:$.toLowerCase().includes(s))||((T=F.quantity)==null?void 0:T.toString().includes(s))||((B=F.unitPrice)==null?void 0:B.toString().includes(s))}))}catch(F){return console.error("Error filtering item:",F),!1}});b(h),P(1),h.length===0?f("No data found"):f(null)}catch(s){console.error("Error in search effect:",s),f("Error occurred while searching")}},[S,N]),a.useEffect(()=>{(async()=>{var h;try{const t=await le.get("/api/v1/warehouseLoc/locations");t.data.data&&c(t.data.data)}catch(t){f((h=t==null?void 0:t.response)==null?void 0:h.data.message)}})()},[]);const l=s=>{if(!d.length)return"Loading...";const h=d.find(t=>t._id===s);return h?h.warehouseName:"Unknown Warehouse"},D=s=>{w(s.target.value)};return y?e.jsx(z,{color:"primary",className:"mt-5 w-15 mx-auto justify-content-center"}):N.length===0?e.jsx(W,{color:"warning",className:"text-center mt-5 w-75 mx-auto",children:"No data available"}):E?e.jsxs(W,{color:"danger",className:"text-center mt-5 w-75 mx-auto",children:["Error: ",E.message]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"mt-3",children:e.jsxs(Z,{className:"w-50 mb-3",children:[e.jsx(ee,{type:"text",placeholder:"Search by PO Number, Vendor, or Products...",value:S,id:"searchItem",onChange:D}),e.jsx(se,{children:e.jsx(J,{icon:X})})]})}),y?e.jsx(z,{color:"primary",className:"mt-5 w-15 mx-auto justify-content-center"}):N.length===0?e.jsx(W,{color:"warning",className:"text-center mt-5 w-75 mx-auto",children:"No data available"}):e.jsxs(e.Fragment,{children:[I&&e.jsx(W,{color:"danger",className:"text-center mt-5 w-75 mx-auto",children:I}),e.jsx(me,{className:"m-2",children:j.filter(s=>s.received).map(s=>e.jsxs(xe,{children:[e.jsx(je,{children:e.jsxs("div",{className:"d-flex justify-content-between w-100 align-items-center",children:[e.jsx("div",{children:e.jsxs("ul",{className:"list-unstyled",children:[e.jsxs("li",{children:["PO Number: ",e.jsx("strong",{children:s.poNumber})]}),e.jsxs("li",{children:["Warehuse Location:"," ",e.jsx("strong",{children:l(s.warehouse_id)})]})]})}),e.jsxs("div",{className:"text-medium-emphasis",children:["Order Date: ",new Date(s.orderDate).toLocaleDateString()]})]})}),e.jsxs(fe,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{children:"Vendor Information"}),e.jsxs("div",{className:"ms-3",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Name:"})," ",s.vendor.businessName]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Address:"})," ",s.vendor.businessAddress]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Contact:"})," ",s.vendor.contactNumber]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{children:"Shipping Details"}),e.jsxs("div",{className:"ms-3",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Carrier:"})," ",s.carrier]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Expected Delivery Date:"})," ",new Date(s.receiveDate).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{children:"Products"}),e.jsxs(te,{responsive:!0,small:!0,className:"mt-2",children:[e.jsx(re,{children:e.jsxs(q,{children:[e.jsx(p,{children:"Description"}),e.jsx(p,{children:"Quantity"}),e.jsx(p,{children:"Received Date"})]})}),e.jsx(ae,{children:s.details.map((h,t)=>e.jsxs(q,{children:[e.jsx(v,{children:h.description}),e.jsx(v,{children:h.quantity}),e.jsx(v,{children:s.receiveDate?new Date(s.receiveDate).toLocaleDateString():"N/A"})]},t))})]})]}),s.additionalNotes&&e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{children:"Additional Notes"}),e.jsx("div",{className:"ms-3",children:s.additionalNotes})]})]})]},s._id))}),j.length>0&&e.jsxs(A,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:["Showing ",L.length>0?r+1:0," to"," ",Math.min(k,L.length)," of ",L.length," received entries"]}),e.jsxs(ne,{className:"mt-3",children:[e.jsx(_,{disabled:g===1,onClick:()=>P(s=>Math.max(s-1,1)),children:"Previous"}),Array.from({length:x},(s,h)=>h+1).map(s=>e.jsx(_,{active:s===g,onClick:()=>P(s),children:s},s)),e.jsx(_,{disabled:g===x,onClick:()=>P(s=>Math.min(s+1,x)),children:"Next"})]})]})]})]})},ye=({onAddItem:N})=>{const{showError:y,showSuccess:E}=ue(),[u,C]=a.useState([]),[m,b]=a.useState(1),[I,f]=a.useState(null),[S,w]=a.useState(!0),[g,P]=a.useState(""),[O,d]=a.useState([]),[c,x]=a.useState([]),L=10;a.useEffect(()=>{(async()=>{var o;try{const n=await V.get("https://log2_backend.chysev.cloud/api/v1/purchaseOrder");n.status===200?C(n.data):f(n.data.message||"Error fetching data")}catch(n){console.error("Error fetching data:",n),f(((o=n==null?void 0:n.response)==null?void 0:o.data.message)||"Error fetching data")}})()},[]);const k=async t=>{var o,n;try{if((await V.put(`https://log2_backend.chysev.cloud/api/v1/purchaseOrder/${t}`,{received:!0,receiveDate:new Date().toISOString()})).status===200){const R=await V.get("https://log2_backend.chysev.cloud/api/v1/purchaseOrder");C(R.data),E("Item received successfully")}}catch(i){console.error("Error updating purchase order:",i),y(((n=(o=i==null?void 0:i.response)==null?void 0:o.data)==null?void 0:n.message)||"Error updating purchase order")}};a.useEffect(()=>{(async()=>{var o,n;try{const i=await le.get("/api/v1/warehouseLoc/locations");i.data.data&&(x(i.data.data),E(i.data.message))}catch(i){f((o=i==null?void 0:i.response)==null?void 0:o.data.message),y(((n=i==null?void 0:i.response)==null?void 0:n.data.message)||"Error fetching warehouses")}})()},[]);const r=t=>{if(!c.length)return"Loading...";const o=c.find(n=>n._id===t);return o?o.warehouseName:"Unknown Warehouse"};if(a.useEffect(()=>{w(!1)},[]),a.useEffect(()=>{if(g===""){C(u);return}const t=g.toLowerCase().trim(),o=u.filter(n=>{var i,R,M,Q,U,K,H,F,$;try{return((i=n.poNumber)==null?void 0:i.toLowerCase().includes(t))||((M=(R=n.vendor)==null?void 0:R.businessName)==null?void 0:M.toLowerCase().includes(t))||((U=(Q=n.vendor)==null?void 0:Q.businessAddress)==null?void 0:U.toLowerCase().includes(t))||((H=(K=n.vendor)==null?void 0:K.contactNumber)==null?void 0:H.toLowerCase().includes(t))||((F=n.carrier)==null?void 0:F.toLowerCase().includes(t))||n.orderDate&&new Date(n.orderDate).toLocaleDateString().includes(t)||n.receiveDate&&new Date(n.receiveDate).toLocaleDateString().includes(t)||(($=n.details)==null?void 0:$.some(T=>{var B;return(B=T.description)==null?void 0:B.toLowerCase().includes(t)}))}catch(T){return console.error("Error filtering data:",T),!1}});C(o),b(1),f(o.length===0?"No results found":null)},[g]),S)return e.jsx(z,{color:"primary",className:"mt-5 w-15 mx-auto justify-content-center"});const j=m*L,l=j-L,D=u.slice(l,j),s=Math.ceil(u.length/L),h=t=>{P(t.target.value)};return u.filter(t=>!t.received).length===0?e.jsx(W,{color:"danger",className:"text-center mt-3 w-75 mx-auto",children:"No items to receive."}):e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"mt-3",children:e.jsxs(Z,{className:"w-50 mb-3",children:[e.jsx(ee,{type:"text",placeholder:"Search by PO Number, Supplier, or Item Name",value:g,id:"searchInput",onChange:h}),e.jsx(se,{children:e.jsx(J,{icon:X})})]})}),e.jsxs(te,{hover:!0,responsive:!0,children:[e.jsx(re,{children:e.jsxs(q,{children:[e.jsx(p,{children:"PO Number"}),e.jsx(p,{children:"Order Date"}),e.jsx(p,{children:"Date to Receive"}),e.jsx(p,{children:"Carrier"}),e.jsx(p,{children:"Warehouse"}),e.jsx(p,{children:"Vendor"}),e.jsx(p,{children:"Products"}),e.jsx(p,{children:"Receive"}),e.jsx(p,{children:"Actions"})]})}),e.jsx(ae,{children:D.filter(t=>!t.received).map(t=>e.jsxs(q,{children:[e.jsx(v,{children:t.poNumber}),e.jsx(v,{children:new Date(t.orderDate).toLocaleDateString()}),e.jsx(v,{children:new Date(t.receiveDate).toLocaleDateString()}),e.jsx(v,{children:t.carrier}),e.jsx(v,{children:r(t.warehouse_id)}),e.jsxs(v,{children:[e.jsx("div",{children:t.vendor.businessName}),e.jsx("small",{className:"text-medium-emphasis",children:t.vendor.contactNumber})]}),e.jsx(v,{children:t.details.map(o=>e.jsxs("div",{children:[o.description," ( pcs: ",o.quantity," x"," ",o.unitPrice.toFixed(2)," )"]},o.productId))}),e.jsx(v,{children:t.received?"Yes":"No"}),e.jsx(v,{children:e.jsx(ge,{color:"primary",className:"mt-2",onClick:()=>k(t._id),children:"Complete"})})]},t._id))})]}),u.filter(t=>!t.received).length>0&&e.jsxs(A,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs(A,{children:["Showing ",l+1," to ",Math.min(j,u.length)," of"," ",u.length," entries"]}),e.jsxs(ne,{className:"mt-3",children:[e.jsx(_,{disabled:m===1,onClick:()=>b(t=>Math.max(t-1,1)),children:"Previous"}),[...Array(s).keys()].map(t=>e.jsx(_,{active:t+1===m,onClick:()=>b(t+1),children:t+1},t+1)),e.jsx(_,{disabled:m===s,onClick:()=>b(t=>Math.min(t+1,s)),children:"Next"})]})]}),I&&e.jsx(W,{color:"danger",className:"text-center mt-5 w-75 mx-auto justify-content-center",children:I})]})},Ce=({items:N,loading:y,error:E})=>{const[u,C]=a.useState([]),[m,b]=a.useState(""),[I,f]=a.useState(null),S=10,[w,g]=a.useState(1),P=r=>{switch(r){case"Stocked":return"success";case"Out of Stock":return"danger";default:return"secondary"}};a.useEffect(()=>{C(N)},[N]),a.useEffect(()=>{if(m==="")C(N),f(null);else{const r=N.filter(j=>{const l=j.itemName.toLowerCase().includes(m.toLowerCase()),D=j.locations.some(s=>{const h=s.warehouse;return h.warehouseName.toLowerCase().includes(m.toLowerCase())||h.address.toLowerCase().includes(m.toLowerCase())});return l||D});C(r),g(1),r.length===0?f("No results found"):f(null)}},[m,N]);const O=r=>{b(r.target.value)},d=r=>{if(!r||!Array.isArray(r))return[];const j=new Map;return r.forEach(l=>{if(!(l!=null&&l.warehouse))return;const D=l.warehouse._id||"deleted";if(!j.has(D))j.set(D,{warehouse:{...l.warehouse,deleted:l.warehouse.deleted||!l.warehouse._id},quantity:l.quantity||0});else{const s=j.get(D);s.quantity+=l.quantity||0,j.set(D,s)}}),Array.from(j.values())};if(y)return e.jsx(z,{color:"primary",className:"text-center mt-5 w-75 mx-auto justify-content-center"});if(E)return e.jsxs(W,{color:"danger",className:"text-center mt-5 w-75 mx-auto justify-content-center",children:["Error: ",E]});const c=w*S,x=c-S,L=u.slice(x,c),k=Math.ceil(u.length/S);return e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"m-3",children:e.jsxs(Z,{className:"w-50 mb-3",children:[e.jsx(ee,{type:"text",id:"search",value:m,onChange:O,placeholder:"Search by item name or warehouse..."}),e.jsx(se,{children:e.jsx(J,{icon:X})})]})}),e.jsxs("strong",{className:"m-3 align-self-start",children:["Total Items: ",L.length]}),I?e.jsx(W,{color:"warning",children:I}):e.jsxs(te,{hover:!0,responsive:!0,striped:!0,className:"text-center",children:[e.jsx(re,{children:e.jsxs(q,{children:[e.jsx(p,{scope:"col",children:"Item Name"}),e.jsx(p,{scope:"col",children:"Total Quantity"}),e.jsx(p,{scope:"col",children:"Warehouse Locations"}),e.jsx(p,{scope:"col",children:"Status"})]})}),e.jsx(ae,{children:L.map((r,j)=>e.jsxs(q,{children:[e.jsx(v,{children:r.itemName}),e.jsx(v,{children:e.jsx("strong",{children:r.quantity})}),e.jsx(v,{children:e.jsx(A,{className:"locations-list",children:d(r.locations).map((l,D)=>{const s=l.warehouse;return e.jsx(A,{className:"location-item",children:e.jsxs(A,{className:"location-details",children:[e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("span",{className:"warehouse-name",children:(s==null?void 0:s.warehouseName)||"Unknown Warehouse"}),e.jsx(ce,{color:s!=null&&s.deleted?"danger":"success",className:"ms-2",children:s!=null&&s.deleted?"Deleted":"Active"})]}),e.jsx("span",{className:"warehouse-address",children:(s==null?void 0:s.address)||"No address available"}),e.jsxs("span",{className:"quantity-badge",children:["Qty: ",l.quantity]})]})},(s==null?void 0:s._id)||`deleted-${D}`)})})}),e.jsx(v,{children:e.jsx(ce,{color:P(r.status||(r.quantity>0?"Stocked":"Out of Stock")),children:r.status||(r.quantity>0?"Stocked":"Out of Stock")})})]},r._id||j))})]}),u.length===0&&!I&&e.jsx(W,{color:"warning",className:"text-center mt-5 w-75 mx-auto",children:"No items found."}),e.jsxs(ne,{align:"center",children:[e.jsx(_,{disabled:w===1,onClick:()=>g(r=>Math.max(r-1,1)),children:"Previous"}),[...Array(k).keys()].map(r=>e.jsx(_,{active:r+1===w,onClick:()=>g(r+1),children:r+1},r+1)),e.jsx(_,{disabled:w===k,onClick:()=>g(r=>Math.min(r+1,k)),children:"Next"})]})]})},be=`
  .locations-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .location-item {
    display: flex;
    flex-direction: column;
    padding: 8px;
    background-color: #f8f9fa;
    border-radius: 4px;
    width: fit-content;

  }

  .location-details {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 4px;
  }

  .warehouse-name {
    font-weight: 500;
    color: #495057;
  }

  .warehouse-address {
    color: #6c757d;
    font-size: 0.9em;
    font-style: italic;
  }

  .quantity-badge {
    background-color: #e9ecef;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 0.85em;
    color: #495057;
  }

`,de=document.createElement("style");de.innerText=be;document.head.appendChild(de);const Ke=()=>{const[N,y]=a.useState([]),[E,u]=a.useState([]),[C,m]=a.useState(!1),[b,I]=a.useState(null),[f,S]=a.useState(0);a.useEffect(()=>{(async()=>{m(!0);try{const c=await V.get("https://log2_backend.chysev.cloud/api/v1/purchaseOrder");c.status===200&&y(c.data)}catch(c){I(c.message)}finally{m(!1)}})()},[f]);const w=()=>{S(d=>d+1)},g=d=>{y(c=>[...c,d]),u(c=>[...c,d]),w()},P=d=>{y(c=>c.filter(x=>x._id!==d)),u(c=>c.filter(x=>x._id!==d)),w()},O=d=>{y(c=>c.map(x=>x._id===d._id?d:x)),u(c=>c.map(x=>x._id===d._id?d:x)),w()};return e.jsx(e.Fragment,{children:e.jsxs(pe,{activeItemKey:"Warehouse Items Details",children:[e.jsxs(ve,{variant:"tabs",children:[e.jsx(G,{itemKey:"Warehouse Items Details",children:"Warehouse Items Details"}),e.jsx(G,{itemKey:"For Receiving",children:"For Receiving"}),e.jsx(G,{itemKey:"Items",children:"Items"})]}),e.jsxs(Ne,{children:[e.jsx(Y,{className:"p-3",itemKey:"Warehouse Items Details",children:e.jsx(we,{warehousing:N,loading:C,error:b,onDeleteItem:P,onUpdateItem:O,onRefresh:w})}),e.jsx(Y,{className:"p-3",itemKey:"For Receiving",children:e.jsxs(ie,{children:[e.jsx(oe,{children:"Item Reiceving"}),e.jsx(ye,{onAddItem:g})]})}),e.jsx(Y,{className:"p-3",itemKey:"Items",children:e.jsxs(ie,{children:[e.jsx(oe,{children:"Items"}),e.jsx(Ce,{items:E,loading:C,error:b})]})})]})]})})};export{Ke as default};
