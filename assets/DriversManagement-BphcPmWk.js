import{r as t,j as e,C as N}from"./index-B_xgiZND.js";import{a as w}from"./index-DW_MHI2K.js";import{F as A,f as T,b as $,a as B,c as G,d as H,C as v}from"./DefaultLayout-DJqhCF6w.js";import{a as C}from"./CButton-Dmu7yp3G.js";import{C as E,a as F,b as q,c as M,d as k}from"./CModalTitle-DLCZrMTR.js";import{C as P}from"./CAlert-D7AY2vid.js";import{C as O}from"./CForm-Q4NE6lr7.js";import{C as u}from"./CFormInput-CxEswD9g.js";import{C as I}from"./CFormSelect-DB8WT_qC.js";import{C as _}from"./index.esm-CSCu4-FO.js";import{C as Q,a as J}from"./CInputGroupText-MCOOFdiC.js";import{C as K,a as W}from"./CRow-7s3L4eiP.js";import{C as X,a as Y,b as Z,c as ee}from"./CAccordionHeader-KeT69GvL.js";import{C as ae,a as se}from"./CCardBody-CJNqt8f3.js";import"./CCloseButton-Cv6f_OZH.js";import"./cil-user-Ddrdy7PS.js";const le=({vehicles:o})=>{const f=w.create({baseURL:"http://localhost:5057"}),[m,p]=t.useState(!1),[g,h]=t.useState(null),[y,b]=t.useState(!1),[x,n]=t.useState([]),[V,j]=t.useState(!1),c={idNum:Math.floor(Math.random()*1e6).toString(),driverName:"",email:"",phone:"",address:"",licenseNumber:"",status:"available",assignedVehicle:""},[i,d]=t.useState(c),l=async()=>{try{const s=await f.get("/api/v1/vehicle/available");n(s.data.data)}catch(s){console.error("Error fetching vehicles:",s)}};t.useEffect(()=>{l()},[]);const a=async s=>{var U,R;p(!0),h(null),s.currentTarget.checkValidity()===!1&&(s.preDefault(),s.stopPropagation()),j(!0),{...i};try{const S=await f.post("/api/v1/driver",i);S.data.success?(alert("Driver added successfully"),d(c),j(!1)):h(S.data.message)}catch(S){const z=((R=(U=S.response)==null?void 0:U.data)==null?void 0:R.message)||S.message||"An error occurred";h(z)}finally{p(!1)}};return e.jsx(e.Fragment,{children:m?e.jsx(N,{color:"primary",size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsxs(C,{color:"primary",variant:"outline",onClick:()=>b(!0),children:[e.jsx(A,{icon:T})," Add Driver"]}),e.jsxs(E,{visible:y,onClose:()=>b(!1),children:[e.jsx(F,{children:e.jsx(q,{children:"Add Driver"})}),g&&e.jsx(P,{color:"danger",className:"m-3",children:g}),e.jsx(M,{children:e.jsxs(O,{noValidate:!0,validated:V,children:[e.jsx(u,{className:"mb-3",floatingLabel:"ID Number",placeholder:"ID Number",type:"text",id:"idNum",label:"ID Number",value:i.idNum,disabled:!0}),e.jsx(u,{className:"mb-3",floatingLabel:"Name",placeholder:"Name",type:"text",id:"Name",label:"Name",autoComplete:"off",required:!0,value:i.driverName,onChange:s=>d({...i,driverName:s.target.value})}),e.jsx(u,{className:"mb-3",floatingLabel:"email",placeholder:"Model",type:"email",id:"email",label:"Email",autoComplete:"off",required:!0,value:i.email,onChange:s=>d({...i,email:s.target.value})}),e.jsx(u,{type:"phone",className:"mb-3",floatingLabel:"phone",placeholder:"phone",id:"phone",label:"Phone",title:"Please enter a valid phone number",autoComplete:"off",value:i.phone,required:!0,onChange:s=>d({...i,phone:s.target.value})}),e.jsx(u,{className:"mb-3",floatingLabel:"Address",placeholder:"Address",type:"text",id:"address",label:"Address",autoComplete:"off",required:!0,value:i.address,onChange:s=>d({...i,address:s.target.value})}),e.jsx(u,{className:"mb-3",floatingLabel:"License Number",placeholder:"License Number",type:"text",id:"licenseNumber",label:"License Number",autoComplete:"off",required:!0,value:i.licenseNumber,onChange:s=>d({...i,licenseNumber:s.target.value})}),e.jsxs(I,{className:"mb-3",floatingLabel:"Vehicle",label:"Vehicle",id:"vehicle",required:!0,value:i.assignedVehicle,onChange:s=>d({...i,assignedVehicle:s.target.value}),children:[e.jsx("option",{value:null,children:"Select Vehicle"}),x.map(s=>e.jsxs("option",{value:s._id,children:[s.brand," /",s.model," /",s.regisNumber]},s._id))]})]})}),e.jsxs(k,{children:[e.jsx(C,{color:"secondary",variant:"outline",onClick:()=>{b(!1),d(c),h(null),j(!1)},disabled:m,children:m?e.jsx(N,{color:"primary",size:"sm"}):"Cancel"}),e.jsx(C,{color:"primary",variant:"outline",onClick:a,disabled:m,children:m?e.jsx(N,{color:"primary",size:"sm"}):"Add Driver"})]})]})]})})},re=o=>{const[L,f]=t.useState(!1),[m,p]=t.useState([]),[g,h]=t.useState(!1),[y,b]=t.useState(null),[x,n]=t.useState(!1),j=w.create({baseURL:"http://localhost:5057",withCredentials:!0}),[r,c]=t.useState({idNum:o.driver.idNum,driverName:o.driver.driverName,email:o.driver.email,phone:o.driver.phone,address:o.driver.address,licenseNumber:o.driver.licenseNumber,status:o.driver.status,assignedVehicle:o.driver.assignedVehicle}),i=async()=>{try{const a=await j.get("/api/v1/vehicle/available");p(a.data.data)}catch(a){console.error("Error fetching vehicles:",a)}};t.useEffect(()=>{i()},[]);const d=async a=>{n(!0),a.currentTarget.checkValidity()===!1&&a.stopPropagation(),h(!0),{...r};try{await j.put(`/api/v1/driver/${o.driver._id}`,r),f(!1),h(!1)}catch(D){console.error("Error updating driver:",D),b(D.response.data.message)}finally{n(!1),i()}},l=[{value:"available",label:"Available"},{value:"on_duty",label:"On Duty"},{value:"off_duty",label:"Off Duty"}];return e.jsx(e.Fragment,{children:e.jsxs(e.Fragment,{children:[e.jsx(C,{color:"primary",variant:"outline",disabled:x,onClick:()=>f(!0),className:"me-2",children:x?e.jsx(N,{size:"sm"}):e.jsx(A,{icon:$})}),e.jsxs(E,{visible:L,onClose:()=>f(!1),children:[e.jsx(F,{children:e.jsx(q,{children:"Update Driver"})}),y&&e.jsx(P,{color:"danger",className:"m-3",children:y}),e.jsx(M,{children:e.jsxs(O,{validated:g,children:[e.jsx(u,{className:"mb-3",floatingLabel:"ID Number",placeholder:"ID Number",type:"text",id:"idNum",label:"ID Number",value:r.idNum,disabled:!0}),e.jsx(u,{className:"mb-3",floatingLabel:"Name",placeholder:"Name",type:"text",id:"Name",label:"Name",autoComplete:"off",required:!0,value:r.driverName,onChange:a=>c({...r,driverName:a.target.value})}),e.jsx(u,{className:"mb-3",floatingLabel:"email",placeholder:"Model",type:"email",id:"email",label:"Email",autoComplete:"off",required:!0,value:r.email,onChange:a=>c({...r,email:a.target.value})}),e.jsx(u,{type:"phone",className:"mb-3",floatingLabel:"phone",placeholder:"phone",id:"phone",label:"Phone",title:"Please enter a valid phone number",autoComplete:"off",value:r.phone,required:!0,onChange:a=>c({...r,phone:a.target.value})}),e.jsx(u,{className:"mb-3",floatingLabel:"Address",placeholder:"Address",type:"text",id:"address",label:"Address",autoComplete:"off",required:!0,value:r.address,onChange:a=>c({...r,address:a.target.value})}),e.jsx(u,{className:"mb-3",floatingLabel:"License Number",placeholder:"License Number",type:"text",id:"licenseNumber",label:"License Number",autoComplete:"off",required:!0,value:r.licenseNumber,onChange:a=>c({...r,licenseNumber:a.target.value})}),e.jsx(I,{className:"mb-3",floatingLabel:"Status",placeholder:"Status",id:"status",label:"Status",autoComplete:"off",required:!0,value:r.status,onChange:a=>c({...r,status:a.target.value}),children:l.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))}),r.status==="available"||r.status==="on_duty"&&e.jsxs(I,{className:"mb-3",floatingLabel:"Vehicle",label:"Vehicle",id:"vehicle",value:r.assignedVehicle||"",onChange:a=>c({...r,assignedVehicle:a.target.value}),children:[e.jsx("option",{value:null,children:"Select Vehicle"}),m.map(a=>e.jsxs("option",{value:a._id,children:[a.brand," / ",a.model," / ",a.regisNumber]},a._id))]})]})}),e.jsxs(k,{children:[e.jsx(C,{color:"secondary",variant:"outline",disabled:x,onClick:()=>{f(!1),b(null),c(o.driver),h(!1)},children:x?e.jsx(N,{color:"secondary",size:"sm"}):"Close"}),e.jsx(C,{color:"success",variant:"outline",disabled:x,onClick:d,children:x?e.jsx(N,{color:"success",size:"sm"}):"Save Changes"})]})]})]})})},te=o=>{const f=w.create({baseURL:"http://localhost:5057",withCredentials:!0}),[m,p]=t.useState(!1),g=async()=>{p(!0),(await f.delete(`/api/v1/driver/${o.driver._id}`)).status===200&&(alert("Driver deleted successfully"),p(!1))};return e.jsx(e.Fragment,{children:e.jsx(C,{color:"danger",variant:"outline",onClick:g,className:"me-2",disabled:m,children:m?e.jsx(N,{size:"sm"}):e.jsx(A,{icon:B})})})},ie=()=>{const L=w.create({baseURL:"http://localhost:5057",withCredentials:!0}),f=JSON.parse(sessionStorage.getItem("user")),m=["manager","admin"],[p,g]=t.useState(null),[h,y]=t.useState(!0),[b,x]=t.useState([]),[n,V]=t.useState(""),[j,r]=t.useState([]),c=async()=>{const l=await L.get("/api/v1/driver");l.status===200&&(x(l.data.data),y(!1))};t.useEffect(()=>{(async()=>{if(n==="")r(b);else{const a=b.filter(s=>s.driverName.toLowerCase().includes(n.toLowerCase())||s.idNum.toString().includes(n)||s.email.toLowerCase().includes(n.toLowerCase())||s.phone.toString().includes(n)||s.address.toLowerCase().includes(n.toLowerCase())||s.licenseNumber.toString().includes(n)||d.find(D=>D.value===s.status).label.toLowerCase().includes(n.toLowerCase()));r(a),a.length===0?g("No results found"):g(null)}})(),c()},[n,b]);const i=l=>{switch(l){case"available":return"green";case"on_duty":return"red";case"off_duty":return"orange";default:return"black"}},d=[{label:"Available",value:"available"},{label:"On Duty",value:"on_duty"},{label:"Off Duty",value:"off_duty"}];return e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"mt-3",children:e.jsxs(Q,{className:"w-50 mb-3 ",children:[e.jsx(u,{type:"text",placeholder:"Search Drivers...",id:"search",value:n,onChange:l=>V(l.target.value),className:"w-50 me-2 "}),e.jsx(J,{children:e.jsx(A,{icon:G})})]})}),h&&e.jsx(K,{className:" mt-5 d-flex justify-content-center ",children:e.jsx(W,{sm:"12",md:"8",children:e.jsx(N,{color:"primary"})})}),j.length>0?e.jsx(X,{className:"m-2",children:j.map(l=>e.jsxs(Y,{children:[e.jsx(Z,{children:e.jsxs("p",{className:"w-100 m-1",children:["Driver Name: ",e.jsxs("strong",{children:[" ",l.driverName," "]}),e.jsx(A,{icon:H,color:i(l.status),className:"m-2 float-end"}),e.jsxs("small",{className:"m-2 float-end",children:[" ",d.find(a=>a.value===l.status).label]})]})}),e.jsxs(ee,{children:[e.jsxs(v,{children:["ID: ",l.idNum]}),e.jsxs(v,{children:["Email: ",l.email]}),e.jsxs(v,{children:["Phone: ",l.phone]}),e.jsxs(v,{children:["Address: ",l.address]}),e.jsxs(v,{children:["License Number: ",l.licenseNumber]}),e.jsxs(v,{children:["Vehicle:"," ",l.assignedVehicle?`${l.assignedVehicle.regisNumber} - ${l.assignedVehicle.brand} ${l.assignedVehicle.model}`:"No vehicle assigned"]}),e.jsxs(v,{children:["Status: ",d.find(a=>a.value===l.status).label]}),e.jsxs(_,{className:"d-flex justify-content-end mt-3",children:[h?e.jsx(N,{color:"primary",size:"sm"}):e.jsx(re,{driver:l}),m.includes(f.data.user.role)&&e.jsx(te,{driver:l})]})]})]},l._id))}):e.jsx(v,{className:"justify-content-center",children:"0 results found"}),p&&e.jsx(P,{color:"danger",className:"text-center justify-content-center",children:p})]})},ye=()=>e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"text-center",children:"Driver Management"}),e.jsx(_,{className:"m-3",children:e.jsx(le,{})}),e.jsxs(ae,{children:[e.jsx(v,{children:"Drivers list"}),e.jsx(se,{className:"md-3",children:e.jsx(ie,{})})]})]});export{ye as default};
