import{r as o,j as e,C as H,x as O,P as M}from"./index-Dyx0DIrn.js";import{F as J,i as ne,o as de,h as ce,j as ue}from"./index-NM-69ELr.js";import{a as k}from"./CButton-CtKjPV20.js";import{C as K,a as X,b as me,c as Y,d as Z}from"./CModalTitle-DJL1L4Gu.js";import{a as G,C as ie}from"./CForm-irlHWoP0.js";import{C as U}from"./CInputGroup-WaV9Ijsw.js";import{C as W}from"./CFormSelect-CWJq5OYB.js";import{C as f,a as I}from"./CFormInput-I2HVwpLx.js";import{C as ee}from"./1-xAHH-UTp.js";import{C as pe}from"./CFormTextarea-DBmifK8l.js";import{C as he,a as fe,b as re,c as q,d as xe,e as V}from"./CTable-RM01cEyT.js";import{b as je,c as ge,d as ve,C as Ce}from"./DefaultLayout-1ioHhC6-.js";import{C as ae}from"./CContainer-BtUNE6VJ.js";import{C as be}from"./CCard-yvBdmMdt.js";import{C as ye}from"./CCardBody-CgPGZ8CB.js";import"./CCloseButton-CJAvPORm.js";import"./index.esm-Xnxbx9J7.js";import"./cil-user-Ddrdy7PS.js";const Ne=({onAddFuelog:c})=>{var n,i;const[S,N]=o.useState(!1),[w,F]=o.useState(null),[T,$]=o.useState(!1),[z,D]=o.useState(!1),[Q,j]=o.useState(!1),[p,g]=o.useState(null),[_,L]=o.useState([]),[x,A]=o.useState([]),R={vehicleId:"",driverId:"",receiptNumber:"",fuelQuantity:"",fuelType:"",costPerLiter:"",totalCost:"",odometerReading:"",receiptImage:null,route:{start:"",end:"",distance:""},notes:"",litersPer100km:"",kmPerLiter:"",mpg:""},[s,u]=o.useState(R);o.useEffect(()=>{(async()=>{try{N(!0);const[m,r]=await Promise.all([O.get("/api/v1/driver"),O.get("/api/v1/vehicle/in-use")]);L(m.data.data),A(r.data.data)}catch(m){console.error("Error fetching initial data:",m),F(m.message)}finally{N(!1)}})()},[]);const a=l=>{const{id:m,value:r}=l.target;if(m.includes("route.")){const h=m.split(".")[1];u(y=>{const C={...y,route:{...y.route,[h]:r}};if(C.route.distance&&C.fuelQuantity){const E=parseFloat(C.route.distance),d=parseFloat(C.fuelQuantity);if(E>0&&d>0){const b=d/E*100;C.litersPer100km=b.toFixed(2);const P=E/d;C.kmPerLiter=P.toFixed(2);const B=d*.264172,se=E*.621371/B;C.mpg=se.toFixed(2)}}return C})}else if(m==="vehicleId"){const h=x.find(C=>C._id===r),y=_.find(C=>C._id===(h==null?void 0:h.assignedDriver));u(C=>({...C,vehicleId:r,driverId:(h==null?void 0:h.assignedDriver)||"",fuelType:(h==null?void 0:h.fuelType)||"",driverName:(y==null?void 0:y.name)||""}))}else u(m==="fuelQuantity"||m==="costPerLiter"?h=>{const y={...h,[m]:r},C=parseFloat(m==="fuelQuantity"?r:h.fuelQuantity),E=parseFloat(m==="costPerLiter"?r:h.costPerLiter);if(!isNaN(C)&&!isNaN(E)&&(y.totalCost=(C*E).toFixed(2)),m==="fuelQuantity"&&y.route.distance){const d=parseFloat(y.route.distance),b=parseFloat(r);if(d>0&&b>0){const P=b/d*100;y.litersPer100km=P.toFixed(2);const B=d/b;y.kmPerLiter=B.toFixed(2);const te=b*.264172,oe=d*.621371/te;y.mpg=oe.toFixed(2)}}return y}:h=>({...h,[m]:r}))},v=l=>{const m=l.target.files[0];if(m){u(h=>({...h,receiptImage:m}));const r=new FileReader;r.onloadend=()=>{g(r.result)},r.readAsDataURL(m)}},t=async l=>{if(l.preventDefault(),l.stopPropagation(),l.currentTarget.checkValidity()===!1){j(!0);return}N(!0);try{const r=new FormData;r.append("vehicleId",s.vehicleId),r.append("driverId",s.driverId),r.append("receiptNumber",s.receiptNumber),r.append("fuelQuantity",s.fuelQuantity),r.append("fuelType",s.fuelType),r.append("costPerLiter",s.costPerLiter),r.append("totalCost",s.totalCost),r.append("odometerReading",s.odometerReading),r.append("notes",s.notes),r.append("litersPer100km",s.litersPer100km),r.append("kmPerLiter",s.kmPerLiter),r.append("mpg",s.mpg),r.append("route[start]",s.route.start),r.append("route[end]",s.route.end),r.append("route[distance]",s.route.distance),s.receiptImage&&r.append("receiptImage",s.receiptImage);const h=await O.post("/api/v1/fuelLogs/fuel-logs",r);h.data.success&&(c(h.data.data),$(h.data.message),setTimeout(()=>{$(!1),u(R),g(null),D(!1)},2e3))}catch(r){F(r.response.data.message),setTimeout(()=>{F(null)},5e3)}finally{N(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs(k,{color:"primary",variant:"outline",disabled:S,onClick:()=>D(!0),children:[S?e.jsx(H,{color:"primary",size:"sm"}):e.jsx(J,{icon:ne}),"Add Fuel Log"]}),e.jsxs(K,{visible:z,onClose:()=>D(!1),size:"lg",children:[e.jsx(X,{children:e.jsx(me,{children:"Add Fuel Log"})}),w&&e.jsx(G,{color:"danger",className:"m-3",children:w}),T&&e.jsx(G,{color:"success",className:"m-3",children:T}),e.jsx(Y,{children:e.jsxs(ie,{noValidate:!0,validated:Q,children:[e.jsxs(U,{children:[e.jsxs(W,{className:"mb-3",floatingLabel:"Vehicle",label:"Vehicle",id:"vehicleId",value:s.vehicleId,onChange:a,required:!0,children:[e.jsx("option",{value:"",children:"Select Vehicle"}),x==null?void 0:x.map(l=>e.jsx("option",{value:l._id,children:`${l.brand} / ${l.model} / ${l.regisNumber}`},l._id))]}),e.jsx(f,{className:"mb-3",floatingLabel:"Driver",label:"Driver",id:"driverId",value:((n=_.find(l=>l._id===s.driverId))==null?void 0:n.driverName)||"",onChange:a,disabled:!0}),e.jsxs(W,{className:"mb-3",floatingLabel:"Fuel Type",label:"Fuel Type",id:"fuelType",required:!0,value:((i=x.find(l=>l._id===s.vehicleId))==null?void 0:i.fuelType)||"",onChange:a,disabled:!0,children:[e.jsx("option",{value:"",children:"Select Fuel Type"}),e.jsx("option",{value:"Gasoline",children:"Gasoline"}),e.jsx("option",{value:"Diesel",children:"Diesel"})]})]}),e.jsxs(U,{children:[e.jsx(f,{className:"mb-3",type:"text",floatingLabel:"Official Reciept",placeholder:"Official Reciept",id:"receiptNumber",value:s.receiptNumber,onChange:a,required:!0,autoComplete:"off"}),e.jsx(f,{className:"mb-3",type:"number",floatingLabel:"Fuel Quantity",placeholder:"Fuel Quantity",id:"fuelQuantity",value:s.fuelQuantity,onChange:a,required:!0,autoComplete:"off",min:"0",step:"0.01",feedbackInvalid:"Please enter a valid fuel quantity"}),e.jsx(f,{className:"mb-3",type:"number",floatingLabel:"Cost Per Liter",placeholder:"Cost Per Liter",id:"costPerLiter",value:s.costPerLiter,onChange:a,autoComplete:"off",feedbackInvalid:"Please enter a valid cost per liter"}),e.jsx(f,{className:"mb-3",type:"number",floatingLabel:"Total Cost",placeholder:"Total Cost",id:"totalCost",value:s.totalCost,onChange:a,autoComplete:"off",min:"0",step:"0.01",disabled:!0,feedbackInvalid:"Please enter a valid total cost"})]}),e.jsxs(U,{children:[e.jsx(f,{className:"mb-3",type:"number",floatingLabel:"Odometer Reading",placeholder:"Odometer Reading",id:"odometerReading",value:s.odometerReading,onChange:a,autoComplete:"off",feedbackInvalid:"Please enter a valid odometer reading"}),e.jsx(f,{className:"mb-3",type:"text",floatingLabel:"Start Location",placeholder:"Start Location",id:"route.start",value:s.route.start,onChange:a,autoComplete:"off",feedbackInvalid:"Please enter a valid start location"}),e.jsx(f,{className:"mb-3",type:"text",floatingLabel:"End Location",placeholder:"End Location",id:"route.end",value:s.route.end,onChange:a,autoComplete:"off",feedbackInvalid:"Please enter a valid end location"}),e.jsx(f,{className:"mb-3",type:"number",floatingLabel:"Distance/kilometers",placeholder:"Distance",id:"route.distance",value:s.route.distance,onChange:a,autoComplete:"off",feedbackInvalid:"Please enter a valid distance"})]}),e.jsxs(U,{className:"mb-3",children:[e.jsx(f,{type:"text",floatingLabel:"L/100km",placeholder:"Liters per 100km",id:"litersPer100km",value:s.litersPer100km,disabled:!0}),e.jsx(f,{type:"text",floatingLabel:"km/L",placeholder:"Kilometers per Liter",id:"kmPerLiter",value:s.kmPerLiter,disabled:!0}),e.jsx(f,{type:"text",floatingLabel:"MPG",placeholder:"Miles per Gallon",id:"mpg",value:s.mpg,disabled:!0})]}),e.jsx(I,{htmlFor:"receipt",children:"Picture Of Receipts"}),e.jsx(U,{className:"mb-3",children:e.jsx(f,{type:"file",id:"receipt",accept:"images/*",onChange:v})}),p&&e.jsx("div",{className:"mb-3",children:e.jsx(ee,{src:p,rounded:!0,align:"center",alt:"Receipts",width:200,height:200})}),e.jsx(pe,{className:"mb-3",type:"text",floatingLabel:"Notes",placeholder:"Notes",rows:3,id:"notes",value:s.notes,autoCapitalize:"on",autoComplete:"off",onChange:a,feedbackInvalid:"Please enter a valid notes"})]})}),e.jsxs(Z,{children:[e.jsx(k,{color:"secondary",onClick:()=>D(!1),children:"Close"}),e.jsx(k,{color:"primary",onClick:t,disabled:S,children:S?e.jsx(H,{color:"primary",size:"sm"}):"Add"})]})]})]})},le=({fuelLogs:c,vehicles:S,drivers:N,loading:w,error:F,onDeleteFuelLog:T,onUpdateFuelLog:$,onViewReceipt:z})=>{const[D,Q]=o.useState(""),[j,p]=o.useState("date"),[g,_]=o.useState("desc"),[L,x]=o.useState(""),[A,R]=o.useState(null),s=t=>{if(typeof t=="object"&&t.brand&&t.model&&t.regisNumber)return`${t.brand} ${t.model} (${t.regisNumber})`;const n=S.find(i=>i._id===t);return n?`${n.brand} ${n.model} (${n.regisNumber})`:"N/A"},u=t=>{if(typeof t=="object"&&t.driverName)return t.driverName;const n=N.find(i=>i._id===t);return(n==null?void 0:n.driverName)||"N/A"},a=t=>{j===t?_(g==="asc"?"desc":"asc"):(p(t),_("asc"))},v=c.filter(t=>{const n=s(t.vehicleId).toLowerCase(),i=u(t.driverId).toLowerCase(),l=D.toLowerCase(),m=t.receiptNumber.toLowerCase().includes(l)||n.includes(l)||i.includes(l),r=L?(typeof t.vehicleId=="object"?t.vehicleId._id:t.vehicleId)===L:!0;return m&&r}).sort((t,n)=>{let i,l;return j==="vehicle"?(i=s(t.vehicleId),l=s(n.vehicleId)):j==="driver"?(i=u(t.driverId),l=u(n.driverId)):(i=t[j],l=n[j]),g==="asc"?i>l?1:-1:i<l?1:-1});return o.useEffect(()=>{v.length===0?R("No data found"):R(null)},[v]),c.length===0?e.jsx(G,{color:"info",className:"text-center",children:"No fuel logs found."}):w?e.jsx(H,{size:"sm"}):F?e.jsxs("div",{className:"text-danger",children:["Error: ",F]}):e.jsxs(e.Fragment,{children:[e.jsxs(U,{className:"mb-3",children:[e.jsx(f,{placeholder:"Search by receipt #, vehicle, or driver...",value:D,onChange:t=>Q(t.target.value),id:"search"}),e.jsxs(W,{id:"allVehicles",value:L,onChange:t=>x(t.target.value),children:[e.jsx("option",{value:"",children:"All Vehicles"}),S.map(t=>e.jsx("option",{value:t._id,children:`${t.brand} / ${t.model} / ${t.regisNumber}`},t._id))]})]}),e.jsxs(he,{hover:!0,responsive:!0,className:"text-center",children:[e.jsx(fe,{children:e.jsxs(re,{children:[e.jsxs(q,{onClick:()=>a("date"),style:{cursor:"pointer"},children:["Date ",j==="date"&&(g==="asc"?"↑":"↓")]}),e.jsxs(q,{onClick:()=>a("receiptNumber"),style:{cursor:"pointer"},children:["Receipt # ",j==="receiptNumber"&&(g==="asc"?"↑":"↓")]}),e.jsxs(q,{onClick:()=>a("vehicle"),style:{cursor:"pointer"},children:["Vehicle ",j==="vehicle"&&(g==="asc"?"↑":"↓")]}),e.jsxs(q,{onClick:()=>a("driver"),style:{cursor:"pointer"},children:["Driver ",j==="driver"&&(g==="asc"?"↑":"↓")]}),e.jsxs(q,{onClick:()=>a("fuelQuantity"),style:{cursor:"pointer"},children:["Quantity (L) ",j==="fuelQuantity"&&(g==="asc"?"↑":"↓")]}),e.jsxs(q,{onClick:()=>a("costPerLiter"),style:{cursor:"pointer"},children:["Cost/L ",j==="costPerLiter"&&(g==="asc"?"↑":"↓")]}),e.jsxs(q,{onClick:()=>a("totalCost"),style:{cursor:"pointer"},children:["Total Cost ",j==="totalCost"&&(g==="asc"?"↑":"↓")]}),e.jsx(q,{children:"Fuel Efficiency"}),e.jsx(q,{children:"Actions"})]})}),e.jsx(xe,{children:v.map(t=>e.jsxs(re,{children:[e.jsx(V,{children:new Date(t.date).toLocaleDateString()}),e.jsx(V,{children:t.receiptNumber}),e.jsx(V,{children:s(t.vehicleId)}),e.jsx(V,{children:u(t.driverId)}),e.jsx(V,{children:t.fuelQuantity}),e.jsx(V,{children:t.costPerLiter}),e.jsx(V,{children:t.totalCost}),e.jsxs(V,{children:[e.jsxs("div",{children:[t.litersPer100km," L/100km"]}),e.jsxs("div",{children:[t.kmPerLiter," km/L"]}),e.jsxs("div",{children:[t.mpg," MPG"]})]}),e.jsx(V,{children:e.jsxs(je,{variant:"input-group",className:"align-items-center",children:[e.jsx(ge,{color:"secondary",variant:"outline",children:"Actions"}),e.jsxs(ve,{children:[e.jsxs(k,{color:"primary",variant:"ghost",className:"me-2",onClick:()=>z(t),children:[e.jsx(J,{icon:de})," View Receipt"]}),e.jsxs(k,{color:"info",variant:"ghost",className:"me-2",onClick:()=>$(t),children:[e.jsx(J,{icon:ce})," Edit"]}),e.jsxs(k,{color:"danger",variant:"ghost",onClick:()=>T(t._id),children:[e.jsx(J,{icon:ue})," Delete"]})]})]})})]},t._id))})]}),F&&e.jsx(G,{color:"danger",className:"text-center",children:F}),A&&e.jsx(G,{color:"info",className:"text-center",children:A})]})};le.propTypes={fuelLogs:M.array.isRequired,vehicles:M.array.isRequired,drivers:M.array.isRequired,loading:M.bool.isRequired,error:M.string,onDeleteFuelLog:M.func.isRequired,onUpdateFuelLog:M.func.isRequired,onViewReceipt:M.func.isRequired};const Fe=({fuelLog:c,visible:S,onClose:N,onUpdate:w,vehicles:F,drivers:T})=>{const $="http://localhost:5057",[z,D]=o.useState(!1),[Q,j]=o.useState(null),[p,g]=o.useState({date:"",receiptNumber:"",vehicleId:"",driverId:"",fuelQuantity:"",costPerLiter:"",totalCost:"",odometerReading:"",route:{start:"",end:"",distance:""},litersPer100km:"",kmPerLiter:"",mpg:"",notes:"",receiptImage:null}),[_,L]=o.useState(!1);o.useEffect(()=>{c&&(g({date:new Date(c.date).toISOString().split("T")[0],receiptNumber:c.receiptNumber,vehicleId:c.vehicleId._id||c.vehicleId,driverId:c.driverId._id||c.driverId,fuelQuantity:c.fuelQuantity,costPerLiter:c.costPerLiter,totalCost:c.totalCost,odometerReading:c.odometerReading,route:{start:c.route.start,end:c.route.end,distance:c.route.distance},litersPer100km:c.litersPer100km,kmPerLiter:c.kmPerLiter,mpg:c.mpg,notes:c.notes||""}),c.receiptImage&&j(`${$}/uploads/receipts/${c.receiptImage}`))},[c]);const x=s=>{const{id:u,value:a}=s.target;if(u.includes("route.")){const v=u.split(".")[1];g(t=>({...t,route:{...t.route,[v]:a}}))}else g(u==="fuelQuantity"||u==="costPerLiter"?v=>{const t={...v,[u]:a};if(u==="fuelQuantity"&&t.costPerLiter){const n=parseFloat(a),i=parseFloat(t.costPerLiter);t.totalCost=(n*i).toFixed(2)}else if(u==="costPerLiter"&&t.fuelQuantity){const n=parseFloat(t.fuelQuantity),i=parseFloat(a);t.totalCost=(n*i).toFixed(2)}if(t.fuelQuantity&&t.route.distance){const n=parseFloat(t.route.distance),i=parseFloat(t.fuelQuantity);if(n>0&&i>0){t.litersPer100km=(i/n*100).toFixed(2),t.kmPerLiter=(n/i).toFixed(2);const l=i*.264172,m=n*.621371;t.mpg=(m/l).toFixed(2)}}return t}:v=>({...v,[u]:a}))},A=s=>{const u=s.target.files[0];if(u){g(v=>({...v,receiptImage:u}));const a=new FileReader;a.onloadend=()=>{j(a.result)},a.readAsDataURL(u)}},R=async s=>{var a,v;if(s.preventDefault(),!s.currentTarget.checkValidity()){s.stopPropagation(),L(!0);return}D(!0);try{const t=new FormData;Object.keys(p).forEach(i=>{i==="route"?Object.keys(p.route).forEach(l=>{t.append(`route[${l}]`,p.route[l])}):(i==="receiptImage"&&p[i],t.append(i,p[i]))});const n=await O.put(`/api/v1/fuelLogs/fuel-logs/${c._id}`,t);n.data.success&&(w(n.data.data),N())}catch(t){toast.error(((v=(a=t.response)==null?void 0:a.data)==null?void 0:v.message)||"Error updating fuel log")}finally{D(!1)}};return e.jsxs(K,{visible:S,onClose:N,size:"lg",backdrop:"static",children:[e.jsx(X,{closeButton:!0,children:"Update Fuel Log"}),e.jsx(Y,{children:e.jsxs(ie,{className:"row g-3 needs-validation",noValidate:!0,validated:_,onSubmit:R,children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx(I,{htmlFor:"date",children:"Date"}),e.jsx(f,{type:"date",id:"date",value:p.date,onChange:x,required:!0})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx(I,{htmlFor:"receiptNumber",children:"Receipt Number"}),e.jsx(f,{type:"text",id:"receiptNumber",value:p.receiptNumber,onChange:x,required:!0})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx(I,{htmlFor:"vehicleId",children:"Vehicle"}),e.jsxs(W,{id:"vehicleId",value:p.vehicleId,onChange:x,required:!0,children:[e.jsx("option",{value:"",children:"Select Vehicle"}),F.map(s=>e.jsx("option",{value:s._id,children:`${s.brand} ${s.model} (${s.regisNumber})`},s._id))]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx(I,{htmlFor:"driverId",children:"Driver"}),e.jsxs(W,{id:"driverId",value:p.driverId,onChange:x,required:!0,children:[e.jsx("option",{value:"",children:"Select Driver"}),T.map(s=>e.jsx("option",{value:s._id,children:s.driverName},s._id))]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx(I,{htmlFor:"fuelQuantity",children:"Fuel Quantity (L)"}),e.jsx(f,{type:"number",id:"fuelQuantity",value:p.fuelQuantity,onChange:x,required:!0,min:"0",step:"0.01"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx(I,{htmlFor:"costPerLiter",children:"Cost per Liter"}),e.jsx(f,{type:"number",id:"costPerLiter",value:p.costPerLiter,onChange:x,required:!0,min:"0",step:"0.01"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx(I,{htmlFor:"totalCost",children:"Total Cost"}),e.jsx(U,{children:e.jsx(f,{type:"number",id:"totalCost",value:p.totalCost,disabled:!0})})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx(I,{htmlFor:"odometerReading",children:"Odometer Reading"}),e.jsx(U,{children:e.jsx(f,{type:"number",id:"odometerReading",value:p.odometerReading})})]}),e.jsxs("div",{className:"col-md-12",children:[e.jsx(I,{htmlFor:"route.start",children:"Route Information"}),e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-md-4",children:e.jsx(f,{type:"text",id:"route.start",placeholder:"Start Location",value:p.route.start,onChange:x,required:!0})}),e.jsx("div",{className:"col-md-4",children:e.jsx(f,{type:"text",id:"route.end",placeholder:"End Location",value:p.route.end,onChange:x,required:!0})}),e.jsx("div",{className:"col-md-4",children:e.jsx(f,{type:"number",id:"route.distance",placeholder:"Distance (km)",value:p.route.distance,onChange:x,required:!0,min:"0",step:"0.1"})})]})]}),e.jsxs("div",{className:"col-md-12",children:[e.jsx(I,{htmlFor:"receiptImage",children:"Receipt Image"}),e.jsx(f,{type:"file",id:"receiptImage",onChange:A,accept:"image/*"})]}),Q&&e.jsx("div",{className:"col-md-12 text-center",children:e.jsx(ee,{id:"receipt-preview",name:"receipt-preview",src:Q,alt:"Receipt Preview",rounded:!0,align:"center",width:200,height:200})}),e.jsxs("div",{className:"col-md-12",children:[e.jsx(I,{htmlFor:"notes",children:"Notes"}),e.jsx(f,{type:"text",id:"notes",value:p.notes,onChange:x})]})]})}),e.jsxs(Z,{children:[e.jsx(k,{color:"secondary",onClick:N,children:"Cancel"}),e.jsx(k,{color:"primary",onClick:R,disabled:z,children:z?e.jsx(H,{size:"sm"}):"Update"})]})]})},Oe=()=>{const c="http://localhost:5057",[S,N]=o.useState([]),[w,F]=o.useState([]),[T,$]=o.useState([]),[z,D]=o.useState(null),[Q,j]=o.useState(!1),[p,g]=o.useState(null),[_,L]=o.useState(!1),[x,A]=o.useState(null),[R,s]=o.useState(!1),[u,a]=o.useState(null),[v,t]=o.useState(!1),[n,i]=o.useState(null),l=async()=>{j(!0);try{const[d,b,P]=await Promise.all([O.get("/api/v1/fuelLogs/fuel-logs"),O.get("/api/v1/vehicle/in-use"),O.get("/api/v1/driver")]);N(d.data.data),F(b.data.data),$(P.data.data)}catch(d){g(d.message)}finally{j(!1)}},m=d=>{A(d),L(!0)},r=async()=>{var d,b;try{await O.delete(`/api/v1/fuelLogs/fuel-logs/${x}`),N(P=>P.filter(B=>B._id!==x)),L(!1)}catch(P){toast.error(((b=(d=P.response)==null?void 0:d.data)==null?void 0:b.message)||"Error deleting fuel log")}},h=d=>{i(d),t(!0)},y=d=>{N(b=>b.map(P=>P._id===d._id?d:P)),t(!1),i(null)},C=d=>{if(d.receiptImage){const b=`${c}/uploads/receipts/${d.receiptImage}`;a(b),s(!0)}else toast.info("No receipt image available")};if(o.useEffect(()=>{l()},[]),Q)return e.jsx(H,{color:"primary",size:"sm",children:"Loading..."});const E=d=>{N(b=>[...b,d])};return e.jsx(e.Fragment,{children:e.jsxs(ae,{children:[e.jsx(Ce,{children:"Fuel Management"}),e.jsx(be,{children:e.jsxs(ye,{children:[e.jsx(ae,{className:"mb-3",children:e.jsx(Ne,{onAddFuelog:E})}),e.jsx(le,{fuelLogs:S,vehicles:w,drivers:T,loading:Q,error:p,onDeleteFuelLog:m,onUpdateFuelLog:h,onViewReceipt:C})]})}),v&&e.jsx(Fe,{fuelLog:n,visible:v,onClose:()=>{t(!1),i(null)},onUpdate:y,vehicles:w,drivers:T}),e.jsxs(K,{visible:_,onClose:()=>L(!1),alignment:"center",children:[e.jsx(X,{closeButton:!0,children:"Confirm Delete"}),e.jsx(Y,{children:"Are you sure you want to delete this fuel log? This action cannot be undone."}),e.jsxs(Z,{children:[e.jsx(k,{color:"secondary",onClick:()=>L(!1),children:"Cancel"}),e.jsx(k,{color:"danger",onClick:r,children:"Delete"})]})]}),e.jsxs(K,{visible:R,onClose:()=>{s(!1),a(null)},size:"lg",alignment:"center",children:[e.jsx(X,{closeButton:!0,children:"Receipt Image"}),e.jsx(Y,{className:"text-center",children:u&&e.jsx(ee,{src:u,alt:"Receipt",style:{maxWidth:"100%",maxHeight:"70vh",objectFit:"contain"},onError:d=>{toast.error("Error loading image"),d.target.src="placeholder-image-url.jpg"}})}),e.jsxs(Z,{children:[e.jsx(k,{color:"secondary",onClick:()=>{s(!1),a(null)},children:"Close"}),e.jsx(k,{color:"primary",onClick:()=>window.open(u,"_blank"),children:"Open in New Tab"})]})]})]})})};export{Oe as default};
