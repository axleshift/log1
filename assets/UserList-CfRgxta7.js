import{r,j as e,k as K,n as G,A as re,m as oe}from"./index-Csb6LGYQ.js";import{F as $,j as ne,k as le,a as ie,l as ce}from"./index-DR__Bmlu.js";import{C as de,a as z}from"./1-B_HZyjvk.js";import{C as me,a as ue,b as he,c as pe}from"./CModalHeader-Ddas35qS.js";import{C as fe}from"./CModalTitle-BDh5wlQf.js";import{C as D}from"./CAlert-C3In0CUE.js";import{C as xe}from"./CForm-BxUbakQG.js";import{C as S,a as je}from"./CFormInput-f2a8oeA-.js";import{C as Ce}from"./CFormSelect-C1r65ghA.js";import{a as p}from"./CButton-xYfsFmXD.js";import"./index.esm-DK3JKpBW.js";import{C as E}from"./CContainer-B-zbMWDF.js";import{C as ge}from"./CInputGroup-CffURYMu.js";import{C as ve}from"./CInputGroupText-DDMJ-5MD.js";import{C as we}from"./CButtonGroup-DQQ4vhSO.js";import{C as be}from"./CCard-NorjZmAT.js";import{C as ye}from"./CCardHeader-B11k8edq.js";import{C as Se}from"./CCardBody-BJZZWNkB.js";import{C as Ne,a as Ae,b as J,c as v,d as Pe,e as w}from"./CTable-C_kZkx49.js";import{C as Ue,a as q}from"./CPaginationItem-B4fcx8ha.js";const Ee=({user:o,visible:k,onClose:N,onUpdate:M})=>{const[a,f]=r.useState({username:"",email:"",password:"",confirmPassword:"",role:"",photo:""}),[b,x]=r.useState(!1),[A,u]=r.useState(null),[j,y]=r.useState(null),[C,P]=r.useState(null),U="https://backend-log1.axleshift.com/";sessionStorage.getItem("accessToken"),r.useEffect(()=>{if(o)if(f({username:o.username||"",email:o.email||"",password:"",confirmPassword:"",role:o.role||"",photo:null}),o.photo){const l=o.photo.startsWith("http")?o.photo:`${U}uploads/profiles/${o.photo}`;P(l)}else P(null)},[o,U]);const c=async l=>{var i,d;l.preventDefault(),x(!0),u(null);try{if((a.password||a.confirmPassword)&&a.password!==a.confirmPassword)throw new Error("Passwords do not match");if(!o||!o._id){console.error("No user ID available");return}const n=new FormData;n.append("username",a.username),n.append("email",a.email),n.append("role",a.role),a.password&&n.append("password",a.password),a.photo&&n.append("photo",a.photo);const R=await G.put(`api/v1/user/update-user/${o._id}`,n);R.data.success&&(y("User updated successfully"),M(R.data.data),setTimeout(()=>{N()},2e3))}catch(n){console.error("Error updating user:",n),u(((d=(i=n.response)==null?void 0:i.data)==null?void 0:d.message)||n.message||"Failed to update user")}finally{x(!1)}},h=l=>{const{id:i,value:d}=l.target;f(n=>({...n,[i]:d}))},L=l=>{const i=l.target.files[0];if(i){f(n=>({...n,photo:i}));const d=new FileReader;d.onloadend=()=>{P(d.result)},d.readAsDataURL(i)}};return e.jsxs(me,{visible:k,onClose:N,children:[e.jsx(ue,{children:e.jsxs(fe,{children:["Edit User: ",o==null?void 0:o.username]})}),e.jsxs(he,{children:[A&&e.jsx(D,{color:"danger",children:A}),j&&e.jsx(D,{color:"success",children:j}),e.jsxs(xe,{onSubmit:c,children:[e.jsx(S,{id:"username",value:a.username,onChange:h,className:"mb-3",placeholder:"Enter username",autoComplete:"off",floatingLabel:"Username",required:!0}),e.jsx(S,{type:"email",id:"email",value:a.email,onChange:h,className:"mb-3",placeholder:"Enter email",autoComplete:"off",floatingLabel:"Email",required:!0}),e.jsx(je,{htmlFor:"password",children:"New Password (leave blank to keep current)"}),e.jsx(S,{type:"password",id:"password",value:a.password,onChange:h,className:"mb-3",autoComplete:"off",placeholder:"New Password",floatingLabel:"New Password"}),e.jsx(S,{type:"password",id:"confirmPassword",value:a.confirmPassword,onChange:h,className:"mb-3",autoComplete:"off",placeholder:"Confirm Password",floatingLabel:"Confirm Password"}),e.jsxs(Ce,{id:"role",label:"Role",value:a.role,onChange:h,className:"mb-3",required:!0,children:[e.jsx("option",{value:"",children:"Select Role"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"manager",children:"Manager"}),e.jsx("option",{value:"chief mechanic",children:"Chief mechanic"}),e.jsx("option",{value:"fleet manager",children:"Fleet Manager"}),e.jsx("option",{value:"scheduler",children:"Scheduler"}),e.jsx("option",{value:"warehouse manager",children:"Warehouse Manager"}),e.jsx("option",{value:"receiving clerk",children:"Receiving Clerk"})]}),e.jsx(S,{type:"file",id:"photo",label:"Profile Photo",onChange:L,accept:"image/*",className:"mb-3"}),C&&e.jsx("div",{className:"mb-3",children:e.jsx(de,{src:C||z,alt:"Preview",align:"center",rounded:!0,width:200,height:200,crossOrigin:"anonymous",onError:l=>{l.target.onerror=null,l.target.src=z}})})]})]}),e.jsxs(pe,{children:[e.jsx(p,{color:"secondary",onClick:N,children:"Cancel"}),e.jsx(p,{color:"primary",onClick:c,disabled:b,children:b?e.jsx(K,{size:"sm"}):"Save Changes"})]})]})},Xe=({onUpdateUser:o})=>{const k=re(),N="super admin",M=oe(),[a,f]=r.useState([]),[b,x]=r.useState(!0),[A,u]=r.useState([]),[j,y]=r.useState(1),[C,P]=r.useState(""),[U,c]=r.useState(null),[h,L]=r.useState(null),[l,i]=r.useState(!1),[d,n]=r.useState(!1),[R,ke]=r.useState(null),[O,Q]=r.useState(null),[F,_]=r.useState("all"),B=10,X=s=>{switch(F){case"active":return s.filter(t=>t.isActive);case"inactive":return s.filter(t=>!t.isActive);default:return s}},Y=async()=>{x(!0);try{const t=(await G.get("api/v1/user/all-user")).data.data;f(t),u(t)}catch(s){console.error("Error fetching users:",s),c("Error fetching users")}finally{x(!1)}};r.useEffect(()=>{Y()},[]),r.useEffect(()=>{if(C==="")u(a);else{const s=a.filter(t=>{const m=C.toLowerCase(),g=t.isActive?"active":"inactive",I=t.isActive?"deactivate":"activate";return t.username.toLowerCase().includes(m)||t.email.toLowerCase().includes(m)||t.role.toLowerCase().includes(m)||g.includes(m)||I.includes(m)||t.createdAt.toLowerCase().includes(m)});u(s),y(1),s.length===0?c("No matching users found"):c(null)}},[C,a]);const Z=async s=>{var t,m;x(!0);try{const g=await G.post(`api/v1/user/in-active-user/${s}`);if(g.data.success){const I=a.map(T=>T._id===s?{...T,isActive:!T.isActive}:T);f(I),u(I),L(g.data.message)}else c(g.data.message);setTimeout(()=>{L(null),c(null)},3e3)}catch(g){c(((m=(t=g.response)==null?void 0:t.data)==null?void 0:m.message)||"Failed to update user status"),setTimeout(()=>c(null),3e3)}finally{x(!1)}},ee=s=>{Q(s),i(!0)},se=s=>{f(a.map(t=>t._id===s._id?s:t)),u(A.map(t=>t._id===s._id?s:t))};if(b)return e.jsx(K,{className:"m-5 d-flex justify-content-center"});const V=X(A),W=j*B,ae=W-B,te=V.slice(ae,W),H=Math.ceil(V.length/B);return e.jsx(e.Fragment,{children:e.jsxs(E,{className:" justify-content-center align-items-center",children:[e.jsx(E,{className:"m-3 d-flex justify-content-center align-items-center",children:e.jsx("h1",{children:"Accounts"})}),e.jsx(E,{className:"m-3 d-flex justify-content-between",children:e.jsx(p,{color:"primary",className:"m-3 ",disabled:b,onClick:()=>M("/dashboard"),children:b?"Loading...":e.jsx($,{icon:ne})})}),e.jsxs(E,{className:"m-3",children:[U&&e.jsx(D,{color:"danger",className:"mb-3",children:U}),h&&e.jsx(D,{color:"success",className:"mb-3",children:h}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs(ge,{className:"w-50",children:[e.jsx(S,{type:"text",value:C,id:"search",onChange:s=>P(s.target.value),placeholder:"Search users..."}),e.jsx(ve,{children:e.jsx($,{icon:le})})]}),e.jsxs(we,{children:[e.jsx(p,{color:F==="all"?"primary":"secondary",onClick:()=>_("all"),children:"All"}),e.jsx(p,{color:F==="active"?"primary":"secondary",onClick:()=>_("active"),children:"Active"}),e.jsx(p,{color:F==="inactive"?"primary":"secondary",onClick:()=>_("inactive"),children:"Inactive"})]})]}),e.jsx("div",{className:"text-muted small mb-3",children:"Search by: username, email, role, status (active/inactive), or action (activate/deactivate)"}),e.jsxs(be,{children:[e.jsx(ye,{children:e.jsx("h4",{children:"User List"})}),e.jsxs(Se,{children:[e.jsxs(Ne,{hover:!0,responsive:!0,className:"text-center",children:[e.jsx(Ae,{children:e.jsxs(J,{children:[e.jsx(v,{children:"Username"}),e.jsx(v,{children:"Email"}),e.jsx(v,{children:"Role"}),e.jsx(v,{children:"Created Date"}),e.jsx(v,{children:"Status"}),e.jsx(v,{children:"Date of Login"}),e.jsx(v,{children:"Actions"})]})}),e.jsx(Pe,{children:te.filter(s=>s.role!=="super admin").map(s=>e.jsxs(J,{children:[e.jsx(w,{children:s.username}),e.jsx(w,{children:s.email}),e.jsx(w,{children:s.role}),e.jsx(w,{children:s.createdAt.slice(0,10)}),e.jsx(w,{children:e.jsx(ie,{color:s.isActive?"success":"danger",children:s.isActive?"Active":"Deactivated"})}),e.jsx(w,{children:s.lastLoginTime||"-"}),e.jsx(w,{children:e.jsxs(E,{className:" d-flex justify-content-center align-items-center",children:[e.jsx(p,{variant:"outline",className:"me-2",color:s.isActive?"danger":"success",onClick:()=>Z(s._id),children:s.isActive?"Deactivate":"Activate"}),k&&N.includes(k)&&e.jsx(p,{variant:"outline",className:"me-2",color:"primary",onClick:()=>ee(s),children:e.jsx($,{icon:ce})})]})})]},s._id))})]}),O&&e.jsx(Ee,{user:O,visible:l,onClose:()=>{i(!1),Q(null)},onUpdate:se}),e.jsxs(Ue,{align:"center",children:[e.jsx(q,{disabled:j===1,onClick:()=>y(s=>Math.max(s-1,1)),children:"Previous"}),[...Array(H).keys()].map(s=>e.jsx(q,{active:s+1===j,onClick:()=>y(s+1),children:s+1},s+1)),e.jsx(q,{disabled:j===H,onClick:()=>y(s=>Math.min(s+1,H)),children:"Next"})]})]})]})]})]})})};export{Xe as default};
