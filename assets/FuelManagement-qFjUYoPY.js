import{B as be,r as o,j as e,k as oe,A as H,D as Te}from"./index-C7-7e5-E.js";import{F as le,h as we,e as Ee,n as ye,o as Ne,a as De,p as Re,g as Me,l as Qe}from"./index-fNgkwGG_.js";import{a as R}from"./CButton-B1L2hUUT.js";import{C as ce,a as ue,b as Le,c as me,d as pe}from"./CModalTitle-B2ulMcfF.js";import{C as ne}from"./CAlert-DDaUgORz.js";import{C as ke}from"./CForm-V7CzR5ZN.js";import{C as E,a as $e}from"./CInputGroupText-DPPEEOX5.js";import{C as p,a as Fe}from"./CFormInput-BPK24x59.js";import{C as fe}from"./CFormSelect-ReEHie-E.js";import{C as xe}from"./1-CZXJIHX7.js";import{C as Se}from"./CFormTextarea-UPzGKxTZ.js";import{C as ie}from"./CContainer-BpX4jhtE.js";import{C as _e,a as Oe,b as Pe,c as V,d as Ae,e as ee}from"./CTable-DPqoVqvg.js";import{b as qe,c as Ue,d as Ge,C as ze}from"./DefaultLayout-C2ms1WJm.js";import{C as Be,a as ve}from"./CPaginationItem-B_pb4D6o.js";import{C as He}from"./CCard-b6K37m7r.js";import{C as We}from"./CCardBody-8HaOyaU9.js";import"./index.esm-Ctxio8fK.js";import"./cil-user-Ddrdy7PS.js";const Je=({onAddFuelog:d})=>{var h,B;const{showSuccess:W,showError:S}=be(),[_,L]=o.useState(!1),[O,te]=o.useState(null),[A,q]=o.useState(!1),[J,f]=o.useState(!1),[ae,k]=o.useState(!1),[U,F]=o.useState(null),[X,G]=o.useState([]),[P,M]=o.useState([]),Y=new Date().toISOString().split("T")[0],Q={vehicleId:"",driverId:"",vehicleDetails:{brand:"",model:"",regisNumber:"",fuelType:""},driverDetails:{driverName:""},date:"",receiptNumber:"",fuelQuantity:"",fuelType:"",costPerLiter:"",totalCost:"",currentMileage:"",receiptImage:null,route:{start:"",end:"",distance:""},notes:"",litersPer100km:"",kmPerLiter:"",mpg:""},[l,r]=o.useState(Q);o.useEffect(()=>{(async()=>{try{L(!0);const[u,i]=await Promise.all([H.get("/api/v1/driver"),H.get("/api/v1/vehicle/in-use")]);G(u.data.data),M(i.data.data)}catch{S("Error fetching initial data")}finally{L(!1)}})()},[]);const m=v=>{const{id:u,value:i}=v.target;if(u.includes("route.")){const t=u.split(".")[1];r(a=>{const s={...a,route:{...a.route,[t]:i}};if(s.route.distance&&s.fuelQuantity){const n=parseFloat(s.route.distance),b=parseFloat(s.fuelQuantity);if(n>0&&b>0){const I=b/n*100;s.litersPer100km=I.toFixed(2);const Z=n/b;s.kmPerLiter=Z.toFixed(2);const K=b*.264172,re=n*.621371/K;s.mpg=re.toFixed(2)}}return s})}else if(u==="vehicleId"){const t=P.find(s=>s._id===i),a=X.find(s=>s._id===(t==null?void 0:t.assignedDriver));r(s=>({...s,vehicleId:i,driverId:(t==null?void 0:t.assignedDriver)||"",vehicleDetails:{brand:(t==null?void 0:t.brand)||"",model:(t==null?void 0:t.model)||"",regisNumber:(t==null?void 0:t.regisNumber)||"",fuelType:(t==null?void 0:t.fuelType)||""},driverDetails:{driverName:(a==null?void 0:a.driverName)||""},currentMileage:(t==null?void 0:t.currentMileage)||"",fuelType:(t==null?void 0:t.fuelType)||""}))}else r(u==="fuelQuantity"||u==="costPerLiter"?t=>{const a={...t,[u]:i},s=parseFloat(u==="fuelQuantity"?i:t.fuelQuantity),n=parseFloat(u==="costPerLiter"?i:t.costPerLiter);if(!isNaN(s)&&!isNaN(n)&&(a.totalCost=(s*n).toFixed(2)),u==="fuelQuantity"&&a.route.distance){const b=parseFloat(a.route.distance),I=parseFloat(i);if(b>0&&I>0){const Z=I/b*100;a.litersPer100km=Z.toFixed(2);const K=b/I;a.kmPerLiter=K.toFixed(2);const se=I*.264172,de=b*.621371/se;a.mpg=de.toFixed(2)}}return a}:t=>({...t,[u]:i}))},$=v=>{const u=v.target.files[0];if(u){r(t=>({...t,receiptImage:u}));const i=new FileReader;i.onloadend=()=>{F(i.result)},i.readAsDataURL(u)}},z=async v=>{if(v.preventDefault(),v.stopPropagation(),v.currentTarget.checkValidity()===!1){k(!0);return}L(!0);try{const i=new FormData;i.append("vehicleId",l.vehicleId),i.append("driverId",l.driverId),i.append("vehicleDetails[brand]",l.vehicleDetails.brand),i.append("vehicleDetails[model]",l.vehicleDetails.model),i.append("vehicleDetails[regisNumber]",l.vehicleDetails.regisNumber),i.append("vehicleDetails[fuelType]",l.vehicleDetails.fuelType),i.append("driverDetails[driverName]",l.driverDetails.driverName),i.append("date",l.date),i.append("receiptNumber",l.receiptNumber),i.append("fuelQuantity",l.fuelQuantity),i.append("fuelType",l.fuelType),i.append("costPerLiter",l.costPerLiter),i.append("totalCost",l.totalCost),i.append("currentMileage",l.currentMileage),i.append("notes",l.notes),i.append("litersPer100km",l.litersPer100km),i.append("kmPerLiter",l.kmPerLiter),i.append("mpg",l.mpg),i.append("route[start]",l.route.start),i.append("route[end]",l.route.end),i.append("route[distance]",l.route.distance),l.receiptImage&&i.append("receiptImage",l.receiptImage);const t=await H.post("/api/v1/fuelLogs/fuel-logs",i);t.data.success&&(d(t.data.data),W(t.data.message),q(t.data.message),setTimeout(()=>{q(!1),r(Q),F(null),f(!1)},2e3))}catch(i){S(i.response.data.message),te(i.response.data.message),setTimeout(()=>{te(null)},5e3)}finally{L(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs(R,{color:"primary",variant:"outline",disabled:_,onClick:()=>f(!0),children:[_?e.jsx(oe,{color:"primary",size:"sm"}):e.jsx(le,{icon:we}),"Add Fuel Log"]}),e.jsxs(ce,{visible:J,onClose:()=>f(!1),size:"lg",children:[e.jsx(ue,{children:e.jsx(Le,{children:"Add Fuel Log"})}),O&&e.jsx(ne,{color:"danger",className:"m-3",children:O}),A&&e.jsx(ne,{color:"success",className:"m-3",children:A}),e.jsx(me,{children:e.jsxs(ke,{noValidate:!0,validated:ae,children:[e.jsxs(E,{children:[e.jsx(p,{type:"date",className:"mb-3",floatingLabel:"date",label:"Receipt Number",id:"date",max:Y,value:l.date,onChange:m,required:!0}),e.jsxs(fe,{className:"mb-3",floatingLabel:"Vehicle",label:"Vehicle",id:"vehicleId",value:l.vehicleId,onChange:m,required:!0,children:[e.jsx("option",{value:"",children:"Select Vehicle"}),P==null?void 0:P.map(v=>e.jsx("option",{value:v._id,children:`${v.brand} / ${v.model} / ${v.regisNumber}`},v._id))]}),e.jsx(p,{className:"mb-3",floatingLabel:"Driver",label:"Driver",id:"driverId",value:((h=X.find(v=>v._id===l.driverId))==null?void 0:h.driverName)||"",onChange:m,disabled:!0}),e.jsxs(fe,{className:"mb-3",floatingLabel:"Fuel Type",label:"Fuel Type",id:"fuelType",required:!0,value:((B=P.find(v=>v._id===l.vehicleId))==null?void 0:B.fuelType)||"",onChange:m,disabled:!0,children:[e.jsx("option",{value:"",children:"Select Fuel Type"}),e.jsx("option",{value:"Gasoline",children:"Gasoline"}),e.jsx("option",{value:"Diesel",children:"Diesel"})]})]}),e.jsxs(E,{children:[e.jsx(p,{className:"mb-3",type:"text",floatingLabel:"Official Reciept",placeholder:"Official Reciept",id:"receiptNumber",value:l.receiptNumber,onChange:m,required:!0,autoComplete:"off"}),e.jsx(p,{className:"mb-3",type:"number",floatingLabel:"Fuel Quantity",placeholder:"Fuel Quantity",id:"fuelQuantity",value:l.fuelQuantity,onChange:m,required:!0,autoComplete:"off",min:"0",step:"0.01",feedbackInvalid:"Please enter a valid fuel quantity"}),e.jsx(p,{className:"mb-3",type:"number",floatingLabel:"Cost Per Liter",placeholder:"Cost Per Liter",id:"costPerLiter",value:l.costPerLiter,onChange:m,autoComplete:"off",feedbackInvalid:"Please enter a valid cost per liter"}),e.jsx(p,{className:"mb-3",type:"number",floatingLabel:"Total Cost",placeholder:"Total Cost",id:"totalCost",value:l.totalCost,onChange:m,autoComplete:"off",min:"0",step:"0.01",disabled:!0,feedbackInvalid:"Please enter a valid total cost"})]}),e.jsxs(E,{children:[e.jsx(p,{className:"mb-3",type:"number",floatingLabel:"Odometer Reading",placeholder:"Odometer Reading",id:"currentMileage",value:l.currentMileage,onChange:m,autoComplete:"off",feedbackInvalid:"Please enter a valid odometer reading"}),e.jsx(p,{className:"mb-3",type:"text",floatingLabel:"Start Location",placeholder:"Start Location",id:"route.start",value:l.route.start,onChange:m,autoComplete:"off",feedbackInvalid:"Please enter a valid start location"}),e.jsx(p,{className:"mb-3",type:"text",floatingLabel:"End Location",placeholder:"End Location",id:"route.end",value:l.route.end,onChange:m,autoComplete:"off",feedbackInvalid:"Please enter a valid end location"}),e.jsx(p,{className:"mb-3",type:"number",floatingLabel:"Distance/kilometers",placeholder:"Distance",id:"route.distance",value:l.route.distance,onChange:m,autoComplete:"off",feedbackInvalid:"Please enter a valid distance"})]}),e.jsxs(E,{className:"mb-3",children:[e.jsx(p,{type:"text",floatingLabel:"L/100km",placeholder:"Liters per 100km",id:"litersPer100km",value:l.litersPer100km,disabled:!0}),e.jsx(p,{type:"text",floatingLabel:"km/L",placeholder:"Kilometers per Liter",id:"kmPerLiter",value:l.kmPerLiter,disabled:!0}),e.jsx(p,{type:"text",floatingLabel:"MPG",placeholder:"Miles per Gallon",id:"mpg",value:l.mpg,disabled:!0})]}),e.jsx(Fe,{htmlFor:"receipt",children:"Picture Of Receipts"}),e.jsx(E,{className:"mb-3",children:e.jsx(p,{type:"file",id:"receipt",accept:"images/*",onChange:$})}),U&&e.jsx("div",{className:"mb-3",children:e.jsx(xe,{src:U,rounded:!0,align:"center",alt:"Receipts",width:200,height:200})}),e.jsx(Se,{className:"mb-3",type:"text",floatingLabel:"Notes",placeholder:"Notes",rows:3,id:"notes",value:l.notes,autoCapitalize:"on",autoComplete:"off",onChange:m,feedbackInvalid:"Please enter a valid notes"})]})}),e.jsxs(pe,{children:[e.jsx(R,{color:"secondary",onClick:()=>f(!1),children:"Close"}),e.jsx(R,{color:"primary",onClick:z,disabled:_,children:_?e.jsx(oe,{color:"primary",size:"sm"}):"Add"})]})]})]})},Xe=({fuelLogs:d,vehicles:W,drivers:S,loading:_,error:L,onDeleteFuelLog:O,onUpdateFuelLog:te,onViewReceipt:A})=>{const[q,J]=o.useState(""),[f,ae]=o.useState("date"),[k,U]=o.useState("desc"),[F,X]=o.useState(""),[G,P]=o.useState(1),[M]=o.useState(10),[Y,Q]=o.useState(null),l=Te(),r=["manager","admin"],m=t=>{f===t?U(k==="asc"?"desc":"asc"):(ae(t),U("asc"))},$=(t,a)=>{if(typeof t=="object"&&(t!=null&&t.brand)&&(t!=null&&t.model)&&(t!=null&&t.regisNumber))return`${t.brand} ${t.model} (${t.regisNumber})`;if(!t&&(a!=null&&a.vehicleDetails))return`${a.vehicleDetails.brand} ${a.vehicleDetails.model} (${a.vehicleDetails.regisNumber}) [Deleted]`;const s=W.find(n=>n._id===t);if(s)return`${s.brand} ${s.model} (${s.regisNumber})`},z=(t,a)=>{var n;if(typeof t=="object"&&(t!=null&&t.driverName))return t.driverName;if(!t&&((n=a==null?void 0:a.driverDetails)!=null&&n.driverName))return`${a.driverDetails.driverName} [Deleted]`;const s=S.find(b=>b._id===t);if(s!=null&&s.driverName)return s.driverName},h=d.filter(t=>{var Z,K,se,re;if(!t)return!1;const a=$(t.vehicleId,t).toLowerCase(),s=z(t.driverId,t).toLowerCase(),n=q.toLowerCase(),b=(((Z=t.receiptNumber)==null?void 0:Z.toLowerCase())||"").includes(n)||a.includes(n)||s.includes(n)||(t.date?new Date(t.date).toLocaleDateString().includes(n):!1)||(((K=t.fuelQuantity)==null?void 0:K.toString())||"").includes(n)||(((se=t.totalCost)==null?void 0:se.toString())||"").includes(n),I=F?(typeof t.vehicleId=="object"?(re=t.vehicleId)==null?void 0:re._id:t.vehicleId)===F:!0;return b&&I}).sort((t,a)=>{let s,n;switch(f){case"vehicle":s=$(t.vehicleId,t),n=$(a.vehicleId,a);break;case"driver":s=z(t.driverId,t),n=z(a.driverId,a);break;case"date":s=new Date(t.date||"").getTime(),n=new Date(a.date||"").getTime();break;case"fuelQuantity":case"costPerLiter":case"totalCost":s=parseFloat(t[f]||0),n=parseFloat(a[f]||0);break;default:s=t[f]||"",n=a[f]||""}return!s&&!n?0:s?n?k==="asc"?s>n?1:-1:s<n?1:-1:-1:1}),B=G*M,v=B-M,u=h.slice(v,B),i=Math.ceil(h.length/M);return o.useEffect(()=>{P(1)},[q,F]),o.useEffect(()=>{h.length===0?Q("No matching records found"):Q(null)},[h]),_?e.jsx(oe,{}):L?e.jsx(ne,{color:"danger",children:L}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"col-6 mt-3 mb-3",children:e.jsxs(E,{children:[e.jsx(p,{placeholder:"Search by receipt #, vehicle, driver, date...",value:q,onChange:t=>J(t.target.value),id:"search"}),e.jsx($e,{children:e.jsx(le,{icon:Ee})})]})}),e.jsxs(_e,{hover:!0,responsive:!0,className:"text-center",children:[e.jsx(Oe,{children:e.jsxs(Pe,{children:[e.jsxs(V,{onClick:()=>m("date"),style:{cursor:"pointer"},children:["Date"," ",f==="date"&&e.jsx(le,{icon:k==="asc"?ye:Ne})]}),e.jsxs(V,{onClick:()=>m("receiptNumber"),style:{cursor:"pointer"},children:["Receipt #"," ",f==="receiptNumber"&&e.jsx(le,{icon:k==="asc"?ye:Ne})]}),e.jsxs(V,{onClick:()=>m("vehicle"),style:{cursor:"pointer"},children:["Vehicle ",f==="vehicle"&&(k==="asc"?"↑":"↓")]}),e.jsxs(V,{onClick:()=>m("driver"),style:{cursor:"pointer"},children:["Driver ",f==="driver"&&(k==="asc"?"↑":"↓")]}),e.jsxs(V,{onClick:()=>m("fuelQuantity"),style:{cursor:"pointer"},children:["Quantity (L) ",f==="fuelQuantity"&&(k==="asc"?"↑":"↓")]}),e.jsxs(V,{onClick:()=>m("costPerLiter"),style:{cursor:"pointer"},children:["Cost/L ",f==="costPerLiter"&&(k==="asc"?"↑":"↓")]}),e.jsxs(V,{onClick:()=>m("totalCost"),style:{cursor:"pointer"},children:["Total Cost ",f==="totalCost"&&(k==="asc"?"↑":"↓")]}),e.jsx(V,{children:"Fuel Efficiency"}),e.jsx(V,{children:"Actions"})]})}),e.jsx(Ae,{className:"align-middle",children:u.map(t=>e.jsxs(Pe,{children:[e.jsx(ee,{children:new Date(t.date).toLocaleDateString()}),e.jsx(ee,{children:t.receiptNumber}),e.jsx(ee,{children:t.vehicleId?`${t.vehicleId.brand} ${t.vehicleId.model} (${t.vehicleId.regisNumber})`:e.jsxs(e.Fragment,{children:[`${t.vehicleDetails.brand} ${t.vehicleDetails.model} (${t.vehicleDetails.regisNumber}) `,e.jsx(De,{color:"danger",className:"ms-2",children:"Deleted"})]})}),e.jsx(ee,{children:t.driverId?t.driverId.driverName:e.jsxs(e.Fragment,{children:[t.driverDetails.driverName," ",e.jsx(De,{color:"danger",className:"ms-2",children:"Deleted"})]})}),e.jsx(ee,{children:t.fuelQuantity}),e.jsx(ee,{children:t.costPerLiter}),e.jsx(ee,{children:t.totalCost}),e.jsxs(ee,{children:[e.jsxs(ie,{children:[t.litersPer100km," L/100km"]}),e.jsxs(ie,{children:[t.kmPerLiter," km/L"]}),e.jsxs(ie,{children:[t.mpg," MPG"]})]}),e.jsx(ee,{children:e.jsxs(qe,{variant:"input-group",children:[e.jsx(Ue,{color:"secondary",variant:"outline",children:"Actions"}),e.jsxs(Ge,{children:[e.jsxs(R,{color:"primary",variant:"ghost",className:"m-2",onClick:()=>A(t),children:[e.jsx(le,{icon:Re})," View Receipt"]}),e.jsxs(R,{color:"info",variant:"ghost",className:"m-2",onClick:()=>te(t),children:[e.jsx(le,{icon:Me})," Edit"]}),r.includes(l)&&e.jsxs(R,{color:"danger",variant:"ghost",className:"m-2",onClick:()=>O(t._id),children:[e.jsx(le,{icon:Qe})," Delete"]})]})]})})]},t._id))})]}),h.length>0&&e.jsxs(ie,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs(ie,{children:["Showing ",v+1," to"," ",Math.min(B,h.length)," of"," ",h.length," entries"]}),e.jsxs(Be,{className:"mt-3",children:[e.jsx(ve,{disabled:G===1,onClick:()=>P(t=>Math.max(t-1,1)),children:"Previous"}),Array.from({length:i},(t,a)=>a+1).map(t=>e.jsx(ve,{active:t===G,onClick:()=>P(t),children:t},t)),e.jsx(ve,{disabled:G===i,onClick:()=>P(t=>Math.min(t+1,i)),children:"Next"})]})]}),Y&&e.jsx(ne,{color:"info",className:"text-center",children:Y})]})},Ye=({fuelLog:d,visible:W,onClose:S,onUpdate:_,vehicles:L,drivers:O})=>{var i,t,a,s,n,b,I,Z,K,se,re,de,ge;const{showSuccess:te,showError:A}=be(),q="http://localhost:5057",[J,f]=o.useState(!1),[ae,k]=o.useState(null),[U,F]=o.useState(null),[X,G]=o.useState(null),[P,M]=o.useState([]),[Y,Q]=o.useState([]),l=new Date().toISOString().split("T")[0],[r,m]=o.useState({date:new Date(d.date).toISOString().split("T")[0],receiptNumber:d.receiptNumber,vehicleId:((i=d.vehicleId)==null?void 0:i._id)||d.vehicleId,driverId:((t=d.driverId)==null?void 0:t._id)||d.driverId,vehicleDetails:{brand:((a=d.vehicleId)==null?void 0:a.brand)||((s=d.vehicleDetails)==null?void 0:s.brand)||"",model:((n=d.vehicleId)==null?void 0:n.model)||((b=d.vehicleDetails)==null?void 0:b.model)||"",regisNumber:((I=d.vehicleId)==null?void 0:I.regisNumber)||((Z=d.vehicleDetails)==null?void 0:Z.regisNumber)||"",fuelType:((K=d.vehicleId)==null?void 0:K.fuelType)||((se=d.vehicleDetails)==null?void 0:se.fuelType)||""},driverDetails:{driverName:((re=d.driverId)==null?void 0:re.driverName)||((de=d.driverDetails)==null?void 0:de.driverName)||""},fuelQuantity:d.fuelQuantity,costPerLiter:d.costPerLiter,totalCost:d.totalCost,currentMileage:d.currentMileage||"",fuelType:d.fuelType||"",route:{start:d.route.start,end:d.route.end,distance:d.route.distance},litersPer100km:d.litersPer100km,kmPerLiter:d.kmPerLiter,mpg:d.mpg,notes:d.notes||""}),[$,z]=o.useState(!1);o.useEffect(()=>{d!=null&&d.receiptImage&&F(`${q}/uploads/receipts/${d.receiptImage}`)},[d]),o.useEffect(()=>{(async()=>{try{f(!0);const[j,C]=await Promise.all([H.get("/api/v1/driver"),H.get("/api/v1/vehicle/in-use")]);Q(j.data.data),M(C.data.data)}catch{A("Error fetching initial data")}finally{f(!1)}})()},[]);const h=g=>{const{id:j,value:C}=g.target;if(j.includes("route.")){const c=j.split(".")[1];m(y=>{const x={...y,route:{...y.route,[c]:C}};if(x.route.distance&&x.fuelQuantity){const N=parseFloat(x.route.distance),T=parseFloat(x.fuelQuantity);if(N>0&&T>0){const D=T/N*100;x.litersPer100km=D.toFixed(2);const w=N/T;x.kmPerLiter=w.toFixed(2);const he=T*.264172,Ce=N*.621371/he;x.mpg=Ce.toFixed(2)}}return x})}else if(j==="vehicleId"){const c=P.find(x=>x._id===C),y=O.find(x=>x._id===(c==null?void 0:c.assignedDriver));m(x=>({...x,vehicleId:C,driverId:(c==null?void 0:c.assignedDriver)||"",vehicleDetails:{brand:(c==null?void 0:c.brand)||"",model:(c==null?void 0:c.model)||"",regisNumber:(c==null?void 0:c.regisNumber)||"",fuelType:(c==null?void 0:c.fuelType)||""},driverDetails:{driverName:(y==null?void 0:y.driverName)||""},currentMileage:(c==null?void 0:c.currentMileage)||"",fuelType:(c==null?void 0:c.fuelType)||""}))}else m(j==="fuelQuantity"||j==="costPerLiter"?c=>{const y={...c,[j]:C},x=parseFloat(j==="fuelQuantity"?C:c.fuelQuantity),N=parseFloat(j==="costPerLiter"?C:c.costPerLiter);if(!isNaN(x)&&!isNaN(N)&&(y.totalCost=(x*N).toFixed(2)),j==="fuelQuantity"&&y.route.distance){const T=parseFloat(y.route.distance),D=parseFloat(C);if(T>0&&D>0){const w=D/T*100;y.litersPer100km=w.toFixed(2);const he=T/D;y.kmPerLiter=he.toFixed(2);const je=D*.264172,Ie=T*.621371/je;y.mpg=Ie.toFixed(2)}}return y}:c=>({...c,[j]:C}))},B=g=>{const j=g.target.files[0];if(j){m(c=>({...c,receiptImage:j}));const C=new FileReader;C.onloadend=()=>{F(C.result)},C.readAsDataURL(j)}},v=async g=>{var C,c,y,x;if(g.preventDefault(),!g.currentTarget.checkValidity()){g.stopPropagation(),z(!0);return}f(!0);try{const N=new FormData;Object.keys(r).forEach(D=>{D==="route"?Object.keys(r.route).forEach(w=>{N.append(`route[${w}]`,r.route[w])}):D==="vehicleDetails"?Object.keys(r.vehicleDetails).forEach(w=>{N.append(`vehicleDetails[${w}]`,r.vehicleDetails[w])}):D==="driverDetails"?Object.keys(r.driverDetails).forEach(w=>{N.append(`driverDetails[${w}]`,r.driverDetails[w])}):(D==="receiptImage"&&r[D],N.append(D,r[D]))});const T=await H.put(`/api/v1/fuelLogs/fuel-logs/${d._id}`,N);T.data.success&&(te(T.data.message),_({...T.data.data,vehicleId:{_id:r.vehicleId,brand:r.vehicleDetails.brand,model:r.vehicleDetails.model,regisNumber:r.vehicleDetails.regisNumber},driverId:{_id:r.driverId,driverName:r.driverDetails.driverName}}),S())}catch(N){A(((c=(C=N.response)==null?void 0:C.data)==null?void 0:c.message)||"Error updating fuel log"),G(((x=(y=N.response)==null?void 0:y.data)==null?void 0:x.message)||"Error updating fuel log")}finally{f(!1)}},u=!L.some(g=>g._id===r.vehicleId);return e.jsxs(ce,{visible:W,onClose:S,size:"lg",backdrop:"static",children:[e.jsx(ue,{children:e.jsx(Le,{children:"Add Fuel Log"})}),X&&e.jsx(ne,{color:"danger",className:"m-3",children:X}),ae&&e.jsx(ne,{color:"success",className:"m-3",children:ae}),e.jsx(me,{children:e.jsxs(ke,{noValidate:!0,validated:$,children:[e.jsxs(E,{children:[" ",e.jsx(p,{type:"date",className:"mb-3",floatingLabel:"date",label:"Receipt Number",id:"date",max:l,value:r.date,onChange:h,required:!0,disabled:u}),e.jsxs(fe,{className:"mb-3",floatingLabel:"Vehicle",label:"Vehicle",id:"vehicleId",value:r.vehicleId||"",onChange:h,required:!0,disabled:!0,children:[P.map(g=>e.jsxs("option",{value:g._id,children:[g.brand," / ",g.model," / ",g.regisNumber]},g._id)),e.jsxs("option",{value:"",children:[" ",`${r.vehicleDetails.brand} / ${r.vehicleDetails.model} / ${r.vehicleDetails.regisNumber} [DELETED]`]})]})]}),e.jsxs(E,{children:[e.jsx(p,{className:"mb-3",type:"text",floatingLabel:"Driver Name",placeholder:"Driver Name",id:"driverName",value:((ge=O.find(g=>g._id===r.driverId))==null?void 0:ge.driverName)||`${r.driverDetails.driverName} [DELETED]`,onChange:h,disabled:!0}),e.jsxs(fe,{className:"mb-3",floatingLabel:"Fuel Type",label:"Fuel Type",id:"fuelType",required:!0,value:r.fuelType||"",onChange:h,disabled:!0,children:[e.jsx("option",{value:"",children:"Select Fuel Type"}),e.jsx("option",{value:"Gasoline",children:"Gasoline"}),e.jsx("option",{value:"Diesel",children:"Diesel"})]})]}),e.jsxs(E,{children:[e.jsx(p,{className:"mb-3",type:"text",floatingLabel:"Official Reciept",placeholder:"Official Reciept",id:"receiptNumber",value:r.receiptNumber,onChange:h,required:!0,autoComplete:"off",disabled:u}),e.jsx(p,{className:"mb-3",type:"number",floatingLabel:"Fuel Quantity",placeholder:"Fuel Quantity",id:"fuelQuantity",value:r.fuelQuantity,onChange:h,required:!0,autoComplete:"off",min:"0",step:"0.01",feedbackInvalid:"Please enter a valid fuel quantity",disabled:u}),e.jsx(p,{className:"mb-3",type:"number",floatingLabel:"Cost Per Liter",placeholder:"Cost Per Liter",id:"costPerLiter",value:r.costPerLiter,onChange:h,autoComplete:"off",feedbackInvalid:"Please enter a valid cost per liter",disabled:u}),e.jsx(p,{className:"mb-3",type:"number",floatingLabel:"Total Cost",placeholder:"Total Cost",id:"totalCost",value:r.totalCost,onChange:h,autoComplete:"off",min:"0",step:"0.01",disabled:!0,feedbackInvalid:"Please enter a valid total cost"})]}),e.jsxs(E,{children:[e.jsx(p,{className:"mb-3",type:"number",floatingLabel:"Odometer Reading",placeholder:"Odometer Reading",id:"currentMileage",value:r.currentMileage,onChange:h,autoComplete:"off",feedbackInvalid:"Please enter a valid odometer reading",disabled:u}),e.jsx(p,{className:"mb-3",type:"text",floatingLabel:"Start Location",placeholder:"Start Location",id:"route.start",value:r.route.start,onChange:h,autoComplete:"off",feedbackInvalid:"Please enter a valid start location",disabled:u}),e.jsx(p,{className:"mb-3",type:"text",floatingLabel:"End Location",placeholder:"End Location",id:"route.end",value:r.route.end,onChange:h,autoComplete:"off",feedbackInvalid:"Please enter a valid end location",disabled:u}),e.jsx(p,{className:"mb-3",type:"number",floatingLabel:"Distance/kilometers",placeholder:"Distance",id:"route.distance",value:r.route.distance,onChange:h,autoComplete:"off",min:"0",step:"0.01",feedbackInvalid:"Please enter a valid distance",disabled:u})]}),e.jsxs(E,{className:"mb-3",children:[e.jsx(p,{type:"text",floatingLabel:"L/100km",placeholder:"Liters per 100km",id:"litersPer100km",value:r.litersPer100km,disabled:!0}),e.jsx(p,{type:"text",floatingLabel:"km/L",placeholder:"Kilometers per Liter",id:"kmPerLiter",value:r.kmPerLiter,disabled:!0}),e.jsx(p,{type:"text",floatingLabel:"MPG",placeholder:"Miles per Gallon",id:"mpg",value:r.mpg,disabled:!0})]}),e.jsx(Fe,{htmlFor:"receipt",children:"Picture Of Receipts"}),e.jsx(E,{className:"mb-3",children:e.jsx(p,{type:"file",id:"receipt",accept:"images/*",onChange:B,disabled:u})}),U&&e.jsx("div",{className:"mb-3",children:e.jsx(xe,{src:U,rounded:!0,align:"center",alt:"Receipts",width:200,height:200})}),e.jsx(Se,{className:"mb-3",type:"text",floatingLabel:"Notes",placeholder:"Notes",rows:3,id:"notes",value:r.notes,autoCapitalize:"on",autoComplete:"off",onChange:h,feedbackInvalid:"Please enter a valid notes",disabled:u})]})}),e.jsxs(pe,{children:[e.jsx(R,{color:"secondary",onClick:S,children:"Close"}),e.jsx(R,{color:"primary",onClick:v,disabled:J||u,children:J?e.jsx(oe,{color:"primary",size:"sm"}):"Add"})]})]})},vt=()=>{const d="http://localhost:5057",{showSuccess:W,showError:S}=be(),[_,L]=o.useState([]),[O,te]=o.useState([]),[A,q]=o.useState([]),[J,f]=o.useState(!1),[ae,k]=o.useState(null),[U,F]=o.useState(!1),[X,G]=o.useState(null),[P,M]=o.useState(!1),[Y,Q]=o.useState(null),[l,r]=o.useState(!1),[m,$]=o.useState(null),z=async()=>{var a,s;f(!0);try{const[n,b,I]=await Promise.all([H.get("/api/v1/fuelLogs/fuel-logs"),H.get("/api/v1/vehicle/in-use"),H.get("/api/v1/driver")]);L(n.data.data),te(b.data.data),q(I.data.data),W("Data fetched successfully")}catch(n){S(((s=(a=n.response)==null?void 0:a.data)==null?void 0:s.message)||"Error fetching data"),k(n.message)}finally{f(!1)}},h=a=>{G(a),F(!0)},B=async()=>{var a,s;try{await H.delete(`/api/v1/fuelLogs/fuel-logs/${X}`),L(n=>n.filter(b=>b._id!==X)),W("Fuel log deleted successfully"),F(!1)}catch(n){S(((s=(a=n.response)==null?void 0:a.data)==null?void 0:s.message)||"Error deleting fuel log")}},v=a=>{$(a),r(!0)},u=a=>{L(s=>s.map(n=>n._id===a._id?a:n)),r(!1),$(null)},i=a=>{if(a.receiptImage){const s=`${d}/uploads/receipts/${a.receiptImage}`;Q(s),M(!0),W("Receipt image loaded successfully")}else S("No receipt image available")};if(o.useEffect(()=>{z()},[]),J)return e.jsx(oe,{color:"primary",size:"sm",children:"Loading..."});const t=a=>{L(s=>[...s,a]),z()};return e.jsx(e.Fragment,{children:e.jsxs(ie,{children:[e.jsx(ze,{children:"Fuel Management"}),e.jsx(He,{children:e.jsxs(We,{children:[e.jsx(ie,{className:"mb-3",children:e.jsx(Je,{onAddFuelog:t})}),e.jsx(Xe,{fuelLogs:_,vehicles:O,drivers:A,loading:J,error:ae,onDeleteFuelLog:h,onUpdateFuelLog:v,onViewReceipt:i})]})}),l&&e.jsx(Ye,{fuelLog:m,visible:l,onClose:()=>{r(!1),$(null)},onUpdate:u,vehicles:O,drivers:A}),e.jsxs(ce,{visible:U,onClose:()=>F(!1),alignment:"center",children:[e.jsx(ue,{closeButton:!0,children:"Confirm Delete"}),e.jsx(me,{children:"Are you sure you want to delete this fuel log? This action cannot be undone."}),e.jsxs(pe,{children:[e.jsx(R,{color:"secondary",variant:"outline",onClick:()=>F(!1),children:"Cancel"}),e.jsx(R,{color:"danger",variant:"outline",onClick:B,children:"Delete"})]})]}),e.jsxs(ce,{visible:P,onClose:()=>{M(!1),Q(null)},size:"lg",alignment:"center",children:[e.jsx(ue,{closeButton:!0,children:"Receipt Image"}),e.jsx(me,{className:"text-center",children:Y&&e.jsx(xe,{src:Y,alt:"Receipt",style:{maxWidth:"100%",maxHeight:"70vh",objectFit:"contain"},onError:a=>{S("Error loading image"),a.target.src="placeholder-image-url.jpg"}})}),e.jsxs(pe,{children:[e.jsx(R,{color:"secondary",variant:"outline",onClick:()=>{M(!1),Q(null)},children:"Close"}),e.jsx("a",{href:Y,target:"_blank",rel:"noopener noreferrer",children:e.jsx(R,{color:"primary",variant:"outline",children:"Open in New Tab"})})]})]})]})})};export{vt as default};
