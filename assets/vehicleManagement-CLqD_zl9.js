import{B as P,r,j as e,k as L,A,D as O}from"./index-ArzCe3um.js";import{F as q,h as Q,i as J,j as K,k as W,a as X,l as Z}from"./index-Bet-n50s.js";import{a as M}from"./CButton-D2mPBrms.js";import{C as _,a as z,b as $,c as G,d as U}from"./CModalTitle-oqAoUja7.js";import{C as F}from"./CAlert-CXP_QGUc.js";import{C as H}from"./CForm-obpLIGSd.js";import{C as k,a as ee}from"./CInputGroupText-BHaX8qfa.js";import{C as c}from"./CFormInput-BQwvlYjn.js";import{C as B}from"./CFormSelect-BU9xLrSG.js";import{C as I}from"./CContainer-Bx98185S.js";import{C as ae,a as se,b as te,c as re}from"./CAccordionHeader-BLC9aZJf.js";import{C as h}from"./DefaultLayout-CLW79OJs.js";import{C as le}from"./CCard-D_DPJuc0.js";import{C as ne}from"./CCardBody-C-gv0bZa.js";import"./index.esm-Cqmjbxa9.js";import"./1-ChQFWwaA.js";import"./cil-user-Ddrdy7PS.js";const ie=({onAddVehicle:l})=>{const{showSuccess:j,showError:V}=P(),[y,x]=r.useState(!1),[d,u]=r.useState(!1),[w,b]=r.useState(null),[m,C]=r.useState(null),[n,T]=r.useState(!1),N={idNum:Math.floor(Math.random()*1e6).toString(),brand:"",model:"",year:"",regisExprationDate:"",regisNumber:"",capacity:"",fuelType:"",currentMileage:"",status:"available"},[i,a]=r.useState(N),s=f=>{const{id:p,value:o}=f.target;a(g=>({...g,[p]:o}))},t=[{label:"Van",value:"van"},{label:"Pickup Truck",value:"pickup"},{label:"Box Truck",value:"box"},{label:"Straight Truck",value:"straight"},{label:"Semi-Trailer Trucks",value:"semi"},{label:"Refrigerated Trucks",value:"refrigerated"},{label:"Tanker Trucks",value:"tanker"},{label:"Flatbed Trucks",value:"flatbed"}],D=[{label:"Diesel",value:"Diesel"},{label:"Gasoline",value:"Gasoline"}],R=async f=>{f.currentTarget.checkValidity()===!1&&(f.preDefault(),f.stopPropagation()),x(!0),T(!0);try{const o=await A.post("/api/v1/vehicle",i);o.data.success&&(j(o.data.message),l(o.data.data),setTimeout(()=>{a(N),T(!1),x(!1),u(!1)},2e3))}catch(o){b(o.response.data.message),V(o.response.data.message),setTimeout(()=>{b(null)},2e3)}T(!1)},E=new Date().getFullYear(),S=1990,v=new Date().toISOString().split("T")[0];return e.jsx(e.Fragment,{children:n?e.jsx(L,{color:"primary",size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsxs(M,{color:"primary",variant:"outline",onClick:()=>u(!0),children:[e.jsx(q,{icon:Q})," Add Vehicle"]}),e.jsxs(_,{visible:d,onClose:()=>u(!1),size:"lg",children:[e.jsx(z,{closeButton:!0,children:e.jsx($,{children:"Add Vehicle"})}),w&&e.jsx(F,{color:"danger",className:"m-3",children:w}),m&&e.jsx(F,{color:"success",className:"m-3",children:m}),e.jsx(G,{children:e.jsxs(H,{noValidate:!0,validated:y,children:[e.jsxs(k,{children:[e.jsx(c,{className:"mb-3",floatingLabel:"ID Number",placeholder:"ID Number",type:"text",id:"idNum",label:"ID Number",value:i.idNum,disabled:!0}),e.jsx(c,{className:"mb-3",floatingLabel:"Brand",placeholder:"Brand",type:"text",id:"brand",label:"Brand",autoComplete:"off",required:!0,value:i.brand,onChange:s}),e.jsx(c,{className:"mb-3",floatingLabel:"Model",placeholder:"Model",type:"text",id:"model",label:"Model",autoComplete:"off",required:!0,value:i.model,onChange:s})]}),e.jsxs(k,{children:[e.jsx(c,{type:"number",className:"mb-3",floatingLabel:"Year",placeholder:"Year",id:"year",value:i.year,required:!0,min:S,max:E,onChange:s,onBlur:f=>{const p=parseInt(f.target.value);p>=S&&p<=E&&!isNaN(p)||(alert(`Please enter a year between ${S} and ${E}`),a({...i,year:S}))}}),e.jsx(c,{className:"mb-3",floatingLabel:"Registration Number",placeholder:"Registration Number",type:"text",id:"regisNumber",label:"Registration Number",autoComplete:"off",required:!0,value:i.regisNumber,onChange:s}),e.jsx(c,{className:"mb-3",floatingLabel:"Registration Expiration Date",placeholder:"Registration Expiration Date",type:"date",id:"regisExprationDate",label:"Registration Expiration Date",autoComplete:"off",required:!0,min:v,value:i.regisExprationDate,onChange:s})]}),e.jsxs(k,{children:[e.jsx(B,{className:"mb-3",floatingLabel:"Vehicle Type",placeholder:"Vehicle Type",id:"type",value:i.type,required:!0,onChange:s,options:[{label:"Select Vehicle Type",value:""},...t]}),e.jsx(c,{className:"mb-2",type:"number",floatingLabel:"Capacity",placeholder:"Capacity",id:"capacity",label:"Capacity",autoComplete:"off",required:!0,min:"0",value:i.capacity,onChange:s}),e.jsx(B,{className:"mb-3",floatingLabel:"Fuel Type",placeholder:"Fuel Type",id:"fuelType",value:i.fuelType,required:!0,onChange:s,options:[{label:"Select Fuel Type",value:""},...D]})]}),e.jsx(c,{className:"mb-3",floatingLabel:"Current Mileage",placeholder:"Current Mileage",type:"number",id:"currentMileage",label:"Current Mileage",autoComplete:"off",required:!0,value:i.currentMileage,min:"0",max:"100000000000",onChange:s})]})}),e.jsxs(U,{children:[e.jsx(M,{color:"secondary",variant:"outline",disabled:n,onClick:()=>{u(!1),a(N),x(!1),b(null)},children:n?e.jsx(L,{color:"secondary",size:"sm"}):"Cancel"}),e.jsx(M,{color:"primary",variant:"outline",disabled:n,onClick:R,children:n?e.jsx(L,{color:"primary",size:"sm"}):"Save"})]})]})]})})},oe=({vehicle:l,onDeleteVehicle:j})=>{const{showSuccess:V,showErrors:y}=P(),[x,d]=r.useState(!1),[u,w]=r.useState(null),b=async()=>{d(!0);try{const m=await A.delete(`/api/v1/vehicle/${l._id}`);m.data.success&&(V(m.data.message),d(!1),j(l._id),d(!1),w(null))}catch(m){w(m),y(m.response.data.message)}finally{d(!1)}};return u?e.jsxs(F,{color:"danger",className:"text-center mt-5 w-75 mx-auto",children:["Error: ",u.message]}):e.jsx(e.Fragment,{children:e.jsx(M,{color:"danger",variant:"outline",disabled:x,onClick:b,className:"me-2",children:x?e.jsx(L,{size:"sm"}):e.jsx(q,{icon:J})})})},ce=({vehicle:l,onUpdateVehicle:j})=>{const{showSuccess:V,showError:y}=P(),[x,d]=r.useState(!1),[u,w]=r.useState(null),[b,m]=r.useState(null),[C,n]=r.useState(!1),[T,N]=r.useState(!1),i={idNum:l.idNum,brand:l.brand,model:l.model,year:l.year,regisExprationDate:l.regisExprationDate,regisNumber:l.regisNumber,capacity:l.capacity,fuelType:l.fuelType,currentMileage:l.currentMileage},[a,s]=r.useState(i),t=p=>{const{id:o,value:g}=p.target;s(Y=>({...Y,[o]:g}))},D=[{label:"Van",value:"van"},{label:"Pickup Truck",value:"pickup"},{label:"Box Truck",value:"box"},{label:"Straight Truck",value:"straight"},{label:"Semi-Trailer Trucks",value:"semi"},{label:"Refrigerated Trucks",value:"refrigerated"},{label:"Tanker Trucks",value:"tanker"},{label:"Flatbed Trucks",value:"flatbed"}],R=[{label:"Diesel",value:"Diesel"},{label:"Gasoline",value:"Gasoline"}],E=async p=>{n(!0),p.currentTarget.checkValidity()===!1&&p.stopPropagation(),N(!0);try{const g=await A.put(`/api/v1/vehicle/${l._id}`,a);g.data.success&&(V(g.data.message),j(g.data.data),setTimeout(()=>{n(!1),N(!1),d(!1)},2e3))}catch(g){y(g.response.data.message),m(g.response.data.message),setTimeout(()=>{m(null)},2e3)}finally{n(!1)}},S=new Date().getFullYear(),v=1990,f=new Date().toISOString().split("T")[0];return e.jsxs(e.Fragment,{children:[e.jsx(M,{color:"primary",variant:"outline",disabled:C,onClick:()=>d(!0),className:"me-2",children:C?e.jsx(L,{size:"sm"}):e.jsx(q,{icon:K})}),e.jsxs(_,{visible:x,onClose:()=>d(!1),size:"lg",children:[e.jsx(z,{closeButton:!0,children:e.jsx($,{children:"Update Vehicle"})}),b&&e.jsx(F,{color:"danger",className:"m-3",children:b}),u&&e.jsx(F,{color:"success",className:"m-3",children:u}),e.jsx(G,{children:e.jsxs(H,{noValidate:!0,validated:T,children:[e.jsxs(k,{children:[e.jsx(c,{className:"mb-3",floatingLabel:"ID Number",placeholder:"ID Number",type:"text",id:"idNum",label:"ID Number",value:a.idNum,disabled:!0}),e.jsx(c,{className:"mb-3",floatingLabel:"Brand",placeholder:"Brand",type:"text",id:"brand",label:"Brand",required:!0,value:a.brand,onChange:t}),e.jsx(c,{className:"mb-3",floatingLabel:"Model",placeholder:"Model",type:"text",id:"model",label:"Model",required:!0,value:a.model,onChange:t})]}),e.jsxs(k,{children:[e.jsx(c,{type:"number",className:"mb-3",floatingLabel:"Year",placeholder:"Year",id:"year",value:a.year,required:!0,min:v,max:S,onChange:t,onBlur:p=>{const o=parseInt(p.target.value);o>=v&&o<=S&&!isNaN(o)||(alert(`Please enter a year between ${v} and ${S}`),s({...a,year:v}))}}),e.jsx(c,{className:"mb-3",floatingLabel:"Registration Number",placeholder:"Registration Number",type:"text",id:"regisNumber",label:"Registration Number",required:!0,value:a.regisNumber,onChange:t}),e.jsx(c,{className:"mb-3",floatingLabel:"Registration Expiration Date",placeholder:"Registration Expiration Date",type:"date",id:"regisExprationDate",label:"Registration Expiration Date",autoComplete:"off",required:!0,min:f,value:a.regisExprationDate.split("T")[0],onChange:t})]}),e.jsxs(k,{children:[e.jsx(B,{className:"mb-3",floatingLabel:"Vehicle Type",placeholder:"Vehicle Type",id:"type",value:a.fuelType,required:!0,onChange:t,options:[...D]}),e.jsx(c,{className:"mb-2",type:"number",floatingLabel:"Capacity",placeholder:"Capacity",id:"capacity",label:"Capacity",required:!0,min:"0",value:a.capacity,onChange:t}),e.jsx(B,{className:"mb-3",floatingLabel:"Fuel Type",placeholder:"Fuel Type",id:"fuelType",label:"Fuel Type",value:a.fuelType,required:!0,onChange:t,options:[,...R]})]}),e.jsx(c,{className:"mb-3",floatingLabel:"Current Mileage",placeholder:"Current Mileage",type:"number",id:"currentMileage",label:"Current Mileage",required:!0,min:"0",max:"100000000000",value:a.currentMileage,onChange:t})]})}),e.jsxs(U,{children:[e.jsx(M,{color:"secondary",variant:"outline",disabled:C,onClick:()=>{d(!1),m(null),s(l),N(!1)},children:C?e.jsx(L,{size:"sm",color:"secondary"}):"Cancel"}),e.jsx(M,{color:"success",variant:"outline",disabled:C,onClick:E,children:C?e.jsx(L,{size:"sm",color:"success"}):"Save Changes"})]})]})]})},de=({vehicle:l,error:j,loading:V,onDeleteVehicle:y,onUpdateVehicle:x})=>{const[d,u]=r.useState([]),w=O(),b=["manager","admin"],[m,C]=r.useState(null),[n,T]=r.useState("");r.useEffect(()=>{u(l)},[l]),r.useEffect(()=>{(()=>{if(n==="")u(l);else{const s=l.filter(t=>{var D,R,E,S,v,f,p,o,g;return((D=t.idNum)==null?void 0:D.toString().includes(n))||((R=t.brand)==null?void 0:R.toLowerCase().includes(n.toLowerCase()))||((E=t.model)==null?void 0:E.toLowerCase().includes(n.toLowerCase()))||((S=t.year)==null?void 0:S.toString().includes(n))||((v=t.regisExprationDate)==null?void 0:v.toLowerCase().includes(n.toLowerCase()))||((f=t.type)==null?void 0:f.toLowerCase().includes(n.toLowerCase()))||((p=t.regisNumber)==null?void 0:p.toLowerCase().includes(n.toLowerCase()))||((o=t.capacity)==null?void 0:o.toString().includes(n))||(((g=i.find(Y=>Y.value===t.status))==null?void 0:g.label)||"").toLowerCase().includes(n.toLowerCase())});u(s),s.length===0?C("No vehicles found"):C(null)}})()},[n,l]);const N=a=>{switch(a){case"available":return"green";case"in_use":return"red";case"maintenance":return"orange";case"inspection":return"yellow";case"forRegistration":return"grey";default:return"black"}},i=[{value:"available",label:"Available"},{value:"in_use",label:"In Use"},{value:"maintenance",label:"Maintenance"},{value:"inactive",label:"Inactive"},{value:"inspection",label:"Inspection"},{value:"forRegistration",label:"For Registration"}];return l.length===0?e.jsx(F,{color:"danger",className:"text-center justify-content-center",children:"No vehicles found"}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"mt-3",children:e.jsxs(k,{className:"w-50 mb-3",children:[e.jsx(c,{type:"text",placeholder:"Search vehicles",id:"search",value:n,onChange:a=>T(a.target.value),className:"w-50 me-2 "}),e.jsx(ee,{children:e.jsx(q,{icon:W})})]})}),e.jsx(ae,{className:"m-2",children:d.map((a,s)=>e.jsxs(se,{children:[e.jsxs(te,{className:"d-flex justify-content-between",children:[e.jsx(I,{children:e.jsxs("ul",{children:[e.jsxs("li",{children:["Registration Number: ",e.jsx("strong",{children:a.regisNumber})]}),e.jsxs("li",{children:["Driver:"," ",e.jsx("strong",{children:a.assignedDriver?`${a.assignedDriver.driverName} - ${a.assignedDriver.licenseNumber}`:"Not assigned"})]}),e.jsxs("li",{children:["Registration expiration Date:"," ",e.jsx("strong",{children:a.regisExprationDate?e.jsxs(e.Fragment,{children:[new Date(a.regisExprationDate).toISOString().split("T")[0]," ",e.jsx(X,{color:new Date(a.regisExprationDate).toDateString()===new Date().toDateString()?"danger":new Date(a.regisExprationDate)<=new Date(new Date().getTime()+14*24*60*60*1e3)&&new Date(a.regisExprationDate)>new Date?"warning":"success",children:new Date(a.regisExprationDate).toDateString()===new Date().toDateString()?"Expires Today":new Date(a.regisExprationDate)<=new Date(new Date().getTime()+14*24*60*60*1e3)&&new Date(a.regisExprationDate)>new Date?"Expires in 2 weeks":"Registered"})]}):"No expiration date"})]})]})}),e.jsxs(I,{className:"d-flex justify-content-end",children:[e.jsx(q,{icon:Z,color:N(a.status),className:"m-2 float-end"}),e.jsx("small",{className:"m-2 float-end",children:i.find(t=>t.value===a.status).label})]})]}),e.jsxs(re,{children:[e.jsxs(h,{children:["ID: ",a.idNum]}),e.jsxs(h,{children:["Brand: ",a.brand]}),e.jsxs(h,{children:["Model: ",a.model]}),e.jsxs(h,{children:["Year: ",a.year]}),e.jsxs(h,{children:["Type: ",a.type]}),e.jsxs(h,{children:["Capacity: ",a.capacity]}),e.jsxs(h,{children:["Status: ",i.find(t=>t.value===a.status).label]}),e.jsxs(h,{children:["Driver:"," ",a.assignedDriver?`${a.assignedDriver.driverName} - ${a.assignedDriver.licenseNumber}`:"Not assigned"]}),e.jsxs(h,{children:["Fuel Type: ",a.fuelType]}),e.jsxs(h,{children:["Current Mileage: ",a.currentMileage]}),e.jsxs(I,{className:"d-flex justify-content-end mt-3",children:[e.jsx(ce,{vehicle:a,onUpdateVehicle:x}),b.includes(w)&&e.jsx(oe,{vehicle:a,onDeleteVehicle:y})]})]})]},a._id||s))}),m&&e.jsx(F,{color:"danger",className:"text-center justify-content-center",children:m})]})},Ve=()=>{const[l,j]=r.useState([]),[V,y]=r.useState(!0),[x,d]=r.useState(null),[u,w]=r.useState({}),[b,m]=r.useState({}),[C,n]=r.useState("initializing"),T=async()=>{y(!0);try{const s=await A.get("/api/v1/vehicle");s.status===200?(j(s.data.data),y(!1)):d(s.data.message)}catch(s){d(s.message)}finally{y(!1)}};r.useEffect(()=>{T()},[]);const N=s=>{j(t=>[...t,s])},i=s=>{j(t=>t.filter(D=>D._id!==s))},a=s=>{j(t=>t.map(D=>D._id===s._id?s:D),T())};return e.jsxs(e.Fragment,{children:[e.jsx(h,{className:"text-center",children:"Vehicle Management"}),e.jsx(I,{className:"m-3",children:e.jsx(ie,{onAddVehicle:N})}),e.jsxs(le,{children:[e.jsx(h,{children:"Vehicle List"}),e.jsx(ne,{className:"md-3",children:e.jsx(de,{vehicle:l,error:x,onDeleteVehicle:i,onUpdateVehicle:a,maintenancePredictions:u,fuelPredictions:b,loading:V})})]})]})};export{Ve as default};
