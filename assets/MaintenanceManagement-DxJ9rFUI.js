import{r,_ as re,u as oe,R as l,a as w,c as T,P as a,C as ve,d as Ce,E as xe,l as H,j as e,k as M}from"./index-BElC7Iah.js";import{F as R,h as je,i as ye,k as ke,l as Se,m as Ie}from"./index-C1mT4LDC.js";import{a as F}from"./CButton-DzbbCv2e.js";import{C as le,a as ce,b as ie,c as de,d as ue}from"./CModalTitle-42RmhkTZ.js";import{a as V,C as fe}from"./CForm-DG9u0lFa.js";import{a as te,b as pe,C as q}from"./CFormInput-BkwhWuY3.js";import{C as Ne}from"./CFormSelect-DEs4ck2h.js";import{C as U}from"./CContainer-htpbj9Ya.js";import{C as we,a as Ee}from"./CInputGroupText-B9OyZYiS.js";import{C as Le,a as Pe,b as Fe,c as Te}from"./CAccordionHeader-C3TjG0rw.js";import{u as De,C as $}from"./DefaultLayout-BgzkAF5b.js";import{g as Ae,e as Me}from"./getRTLPlacement-DIjjwaPU.js";import{C as Re}from"./CCard-CdfwD7Ih.js";import{C as Ve}from"./CCardBody-O4cU2JiN.js";import"./index.esm-BuUAuGL-.js";import"./1-DTyOmbo5.js";import"./cil-user-Ddrdy7PS.js";import"./getTransitionDurationFromElement-Cpu4p4hx.js";var G=r.forwardRef(function(t,I){var m=t.className,c=t.button,h=t.feedback,x=t.feedbackInvalid,j=t.feedbackValid,v=t.floatingLabel,u=t.tooltipFeedback,C=t.hitArea,i=t.id,N=t.indeterminate,k=t.inline,f=t.invalid,g=t.label,L=t.reverse,y=t.type,b=y===void 0?"checkbox":y,d=t.valid,n=re(t,["className","button","feedback","feedbackInvalid","feedbackValid","floatingLabel","tooltipFeedback","hitArea","id","indeterminate","inline","invalid","label","reverse","type","valid"]),s=r.useRef(null),o=oe(I,s);r.useEffect(function(){s.current&&N&&(s.current.indeterminate=N)},[N,s.current]);var p=function(){return l.createElement("input",w({type:b,className:T(c?"btn-check":"form-check-input",{"is-invalid":f,"is-valid":d,"me-2":C}),id:i},n,{ref:o}))},E=function(){return l.createElement(pe,{describedby:n["aria-describedby"],feedback:h,feedbackInvalid:x,feedbackValid:j,floatingLabel:v,invalid:f,tooltipFeedback:u,valid:d})},S=function(){var D;return l.createElement(te,w({customClassName:T(c?T("btn",c.variant?"btn-".concat(c.variant,"-").concat(c.color):"btn-".concat(c.color),(D={},D["btn-".concat(c.size)]=c.size,D),"".concat(c.shape)):"form-check-label")},i&&{htmlFor:i}),g)},P=function(){return c?l.createElement(l.Fragment,null,l.createElement(p,null),g&&l.createElement(S,null),l.createElement(E,null)):g?C?l.createElement(l.Fragment,null,l.createElement(p,null),l.createElement(te,w({customClassName:T("form-check-label stretched-link",m)},i&&{htmlFor:i}),g),l.createElement(E,null)):l.createElement("div",{className:T("form-check",{"form-check-inline":k,"form-check-reverse":L,"is-invalid":f,"is-valid":d},m)},l.createElement(p,null),l.createElement(S,null),l.createElement(E,null)):l.createElement(p,null)};return l.createElement(P,null)});G.propTypes=w({button:a.object,className:a.string,hitArea:a.oneOf(["full"]),id:a.string,indeterminate:a.bool,inline:a.bool,label:a.oneOfType([a.string,a.node]),reverse:a.bool,type:a.oneOf(["checkbox","radio"])},pe.propTypes);G.displayName="CFormCheck";var Q=r.forwardRef(function(t,I){var m=t.children,c=t.animation,h=c===void 0?!0:c,x=t.className,j=t.container,v=t.content,u=t.delay,C=u===void 0?0:u,i=t.fallbackPlacements,N=i===void 0?["top","right","bottom","left"]:i,k=t.offset,f=k===void 0?[0,8]:k,g=t.onHide,L=t.onShow,y=t.placement,b=y===void 0?"top":y,d=t.popperConfig,n=t.title,s=t.trigger,o=s===void 0?"click":s,p=t.visible,E=re(t,["children","animation","className","container","content","delay","fallbackPlacements","offset","onHide","onShow","placement","popperConfig","title","trigger","visible"]),S=r.useRef(null),P=r.useRef(null),D=oe(I,S),J="popover".concat(r.useId()),K=r.useState(!1),z=K[0],W=K[1],X=r.useState(p),A=X[0],Y=X[1],Z=De(),he=Z.initPopper,ge=Z.destroyPopper,_=typeof C=="number"?{show:C,hide:C}:C,ee={modifiers:[{name:"arrow",options:{element:".popover-arrow"}},{name:"flip",options:{fallbackPlacements:N}},{name:"offset",options:{offset:f}}],placement:Ae(b,P.current)},be=w(w({},ee),typeof d=="function"?d(ee):d);r.useEffect(function(){if(p){O();return}B()},[p]),r.useEffect(function(){if(z&&P.current&&S.current){he(P.current,S.current,be),setTimeout(function(){Y(!0)},_.show);return}!z&&P.current&&S.current&&ge()},[z]),r.useEffect(function(){!A&&P.current&&S.current&&Me(function(){W(!1)},S.current)},[A]);var O=function(){W(!0),L&&L()},B=function(){setTimeout(function(){Y(!1),g&&g()},_.hide)};return l.createElement(l.Fragment,null,l.cloneElement(m,w(w(w(w(w({},A&&{"aria-describedby":J}),{ref:P}),(o==="click"||o.includes("click"))&&{onClick:function(){return A?B():O()}}),(o==="focus"||o.includes("focus"))&&{onFocus:function(){return O()},onBlur:function(){return B()}}),(o==="hover"||o.includes("hover"))&&{onMouseEnter:function(){return O()},onMouseLeave:function(){return B()}})),l.createElement(ve,{container:j,portal:!0},z&&l.createElement("div",w({className:T("popover","bs-popover-auto",{fade:h,show:A},x),id:J,ref:D,role:"tooltip"},E),l.createElement("div",{className:"popover-arrow"}),l.createElement("div",{className:"popover-header"},n),l.createElement("div",{className:"popover-body"},v))))});Q.propTypes={animation:a.bool,children:a.node,className:a.string,container:a.any,content:a.oneOfType([a.string,a.node]),delay:a.oneOfType([a.number,a.shape({show:a.number.isRequired,hide:a.number.isRequired})]),fallbackPlacements:xe,offset:a.any,onHide:a.func,onShow:a.func,placement:a.oneOf(["auto","top","right","bottom","left"]),popperConfig:a.oneOfType([a.func,a.object]),title:a.oneOfType([a.string,a.node]),trigger:Ce,visible:a.bool};Q.displayName="CPopover";const $e=()=>{const t=sessionStorage.getItem("accessToken"),m=H.create({baseURL:"http://localhost:5057",withCredentials:!0,headers:{"Content-Type":"application/json",...t&&{Authorization:`Bearer ${t}`}}}),c=new Date().toISOString().split("T")[0],h={inspector:"",vehicleId:"",status:"Pending",scheduledDate:c},[x,j]=r.useState(!1),[v,u]=r.useState(!1),[C,i]=r.useState(null),[N,k]=r.useState([]),[f,g]=r.useState(h),[L,y]=r.useState(!1),b=async()=>{try{const n=await m.get("/api/v1/vehicle/inspection");n.status===200?(k(n.data.data),j(!1)):i(n.data.message)}catch(n){i(n.message)}};r.useEffect(()=>{b()},[]);const d=async n=>{j(!0),n.currentTarget.checkValidity()===!1&&(n.preventDefault(),n.stopPropagation()),y(!0);try{const o=await m.post("/api/v1/maintenance/inspection",f);console.log(o),o.data.success?(g(h),u(!1)):i(o.data.message)}catch(o){i(o.response.data.message)}finally{j(!1)}};return e.jsxs(e.Fragment,{children:[x?e.jsx(M,{color:"primary",size:"sm"}):e.jsxs(F,{color:"primary",className:"mb-3",variant:"outline",onClick:()=>u(!v),children:[e.jsx(R,{icon:je})," Add Inspection"]}),e.jsxs(le,{visible:v,onClose:()=>u(!1),children:[e.jsx(ce,{children:e.jsx(ie,{children:"Add Inspection"})}),C&&e.jsx(V,{color:"danger",className:"m-3",children:C}),e.jsx(de,{children:e.jsxs(fe,{noValidate:!0,validated:L,children:[e.jsx(q,{className:"mb-3",type:"text",floatingLabel:"Inspector",name:"inspector",placeholder:"Inspector",required:!0,value:f.inspector,onChange:n=>g({...f,inspector:n.target.value})}),e.jsxs(Ne,{className:"mb-3","aria-label":"Select Vehicle",name:"vehicleId",required:!0,value:f.vehicleId,onChange:n=>g({...f,vehicleId:n.target.value}),children:[e.jsx("option",{value:"",children:"Select Vehicle"}),N.map(n=>e.jsxs("option",{value:n._id,children:[n.brand," - ",n.model," - ",n.regisNumber]},n._id))]}),e.jsx(q,{className:"mb-3",type:"date",name:"scheduledDate",placeholder:"Scheduled Date",required:!0,min:c,value:f.scheduledDate,onChange:n=>g({...f,scheduledDate:n.target.value})}),e.jsxs(ue,{children:[x?e.jsx(M,{color:"secondary",size:"sm"}):e.jsx(F,{color:"secondary",variant:"outline",onClick:()=>{u(!1),g(h),i(null),y(!1)},children:"Cancel"}),x?e.jsx(M,{color:"primary",size:"sm"}):e.jsx(F,{color:"primary",variant:"outline",onClick:d,children:"Add Inspection"})]})]})})]})]})},ne=sessionStorage.getItem("accessToken"),ze="http://localhost:5057",Oe=H.create({baseURL:ze,withCredentials:!0,headers:{"Content-Type":"application/json",...ne&&{Authorization:`Bearer ${ne}`}}}),Be=t=>{const[I,m]=r.useState(!1),[c,h]=r.useState(null),x=async()=>{m(!0);const j=await Oe.delete(`/api/v1/maintenance/inspection/${t.item._id}`);j.status===200?(alert("Maintenance Inspection deleted successfully"),m(!1),h(null)):(m(!1),h(j.data.message))};return e.jsx(e.Fragment,{children:e.jsx(F,{color:"danger",variant:"outline",disabled:I,onClick:x,className:"me-2",children:I?e.jsx(M,{size:"sm"}):e.jsx(R,{icon:ye})})})},ae=sessionStorage.getItem("accessToken"),He="http://localhost:5057",qe=H.create({baseURL:He,withCredentials:!0,headers:{"Content-Type":"application/json",...ae&&{Authorization:`Bearer ${ae}`}}}),me=({item:t,visible:I,onClose:m,onUpdate:c})=>{const[h,x]=r.useState(!1),[j,v]=r.useState(null),[u,C]=r.useState(null),[i,N]=r.useState(!1),[k,f]=r.useState({visualInspection:{physical:{cracks:!1,corrosion:!1,wear:!1,damage:!1},operational:{noise:!1,leaks:!1,misalignment:!1,looseFasteners:!1},safety:{guards:!1,emergencyStop:!1,lockoutTagout:!1,fireSafety:!1},mechanical:{bearings:{play:!1,overheating:!1,metalShavings:!1},belts:{tension:!1,wear:!1,damage:!1},motors:{noise:!1,overheating:!1,looseConnections:!1}},electrical:{wiring:{insulation:!1,termination:!1,overheating:!1},controlPanels:{functionality:!1,labeling:!1,damage:!1}},fluidSystems:{lubrication:{oilLevel:!1,lubrication:!1,cleanliness:!1},hydraulicFluid:{level:!1,condition:!1,filter:!1}},documents:{registration:!1,insurance:!1}},notes:""});r.useEffect(()=>{const b=()=>{if(t!=null&&t.scheduledDate){const n=new Date,s=new Date(t.scheduledDate);N(n>=s)}};b();const d=setInterval(b,6e4);return()=>clearInterval(d)},[t]),r.useEffect(()=>{t&&t.visualInspection&&f({visualInspection:t.visualInspection})},[t]);const g=b=>{if(!i){v("Cannot update inspection before scheduled date");return}const{name:d,checked:n}=b.target;f(s=>{const o={...s},p=d.split(".");let E=o;for(let S=0;S<p.length-1;S++)E=E[p[S]];return E[p[p.length-1]]=n,o})},L=async()=>{var b,d;if(!(t!=null&&t._id)){v("Invalid item ID");return}try{x(!0),v(null),C(null),console.log("Sending data:",{inspectionId:t._id,checkList:k}),(await qe.put(`/api/v1/maintenance/inspection/${t._id}`,k)).status===200&&(C("Maintenance checklist updated successfully"),c&&c(),setTimeout(()=>{m()},2e3))}catch(n){v(((d=(b=n.response)==null?void 0:b.data)==null?void 0:d.message)||"An error occurred while updating the checklist")}finally{x(!1)}},y=(b,d="")=>Object.entries(b).map(([n,s])=>{const o=d?`${d}.${n}`:n;return typeof s=="object"&&s!==null?e.jsxs("div",{className:"ms-3",children:[e.jsx("h6",{className:"text-capitalize",children:n}),y(s,o)]},o):e.jsx(G,{id:o,label:n.charAt(0).toUpperCase()+n.slice(1),name:o,checked:s,onChange:g,disabled:!i},o)});return e.jsxs(le,{visible:I,onClose:m,children:[e.jsx(ce,{children:e.jsx(ie,{children:"Maintenance Check List"})}),j&&e.jsx(V,{color:"danger",className:"m-3",children:j}),u&&e.jsx(V,{color:"success",className:"m-3",children:u}),!i&&e.jsxs(V,{color:"warning",className:"m-3",children:["This inspection cannot be updated until"," ",new Date(t==null?void 0:t.scheduledDate).toLocaleDateString()]}),e.jsx(de,{children:e.jsx(fe,{children:y(k.visualInspection,"visualInspection")})}),e.jsxs(ue,{children:[e.jsx(F,{color:"secondary",onClick:m,children:"Close"}),e.jsx(F,{color:"primary",onClick:L,disabled:h||!i,children:h?e.jsxs(e.Fragment,{children:[e.jsx(M,{size:"sm",className:"me-2"}),"Saving..."]}):"Save Changes"})]})]})};me.propTypes={item:a.shape({_id:a.string,visualInspection:a.object}),visible:a.bool.isRequired,onClose:a.func.isRequired,onUpdate:a.func};const se=sessionStorage.getItem("accessToken"),Ue="http://localhost:5057",Ge=H.create({baseURL:Ue,withCredentials:!0,headers:{"Content-Type":"application/json",...se&&{Authorization:`Bearer ${se}`}}}),Qe=()=>{const[t,I]=r.useState(!1),[m,c]=r.useState(null),[h,x]=r.useState([]),[j,v]=r.useState(!0),[u,C]=r.useState(""),[i,N]=r.useState([]),[k,f]=r.useState(null),g=JSON.parse(sessionStorage.getItem("user")),L=["manager","admin"],y=async()=>{v(!0);try{const s=await Ge.get("/api/v1/maintenance/inspections");x(s.data.data),v(!1)}catch(s){console.error("Error fetching data:",s),v(!1)}},b=()=>{y()};r.useEffect(()=>{(async()=>{if(u==="")N(h);else{const o=h.filter(p=>p.vehicleId.toLowerCase().includes(u.toLowerCase())||p.vehicleId.regisNumber.toLowerCase().includes(u.toLowerCase())||p.scheduledDate.toLowerCase().includes(u.toLowerCase())||p.inspector.toLowerCase().includes(u.toLowerCase())||d.find(E=>E.value===p.status).label.toLowerCase().includes(u.toLowerCase()));N(o),o.length===0?f("No results found"):f(null)}})(),y()},[u,h]);const d=[{value:"Pending",label:"Pending"},{value:"Completed",label:"Completed"},{value:"Cancelled",label:"Cancelled"},{value:"In Progress",label:"In Progress"}],n=s=>{switch(s){case"Pending":return"yellow";case"Completed":return"green";case"In Progress":return"orange";case"Cancelled":return"red";default:return"black"}};return e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"mt-3",children:e.jsxs(we,{className:"w-50 mb-3",children:[e.jsx(q,{type:"text",placeholder:"Search vehicles",id:"search",value:u,onChange:s=>C(s.target.value),className:"w-50 me-2 "}),e.jsx(Ee,{children:e.jsx(R,{icon:ke})})]})}),t&&e.jsx(me,{item:m,visible:t,onClose:()=>I(!1),onUpdate:b}),i.length>0?e.jsx(Le,{className:"m-2",children:i.map(s=>e.jsxs(Pe,{children:[e.jsxs(Fe,{children:[e.jsxs("p",{className:"w-100 m-1 ",children:["Registration Number:",e.jsx("strong",{className:"ms-2",children:s.vehicleId?`${s.vehicleId.regisNumber} - ${s.vehicleId.model}`:""})]}),e.jsx(R,{icon:Se,color:n(s.status),className:"m-2 float-end"}),e.jsxs("small",{className:"m-2 float-end",children:[" ",d.find(o=>o.value===s.status).label]})]}),e.jsxs(Te,{children:[e.jsxs($,{children:["Scheduled Date: ",new Date(s.scheduledDate).toLocaleDateString()]}),e.jsxs($,{children:["Name of Inspector: ",s.inspector]}),e.jsxs(U,{className:"d-flex justify-content-end mt-3",children:[e.jsx(Q,{content:"It is disable if the status is completed",placement:"right",trigger:["hover","focus"],children:e.jsx("span",{className:"d-inline-block",tabIndex:0,children:e.jsx(F,{color:"primary",className:"me-2",variant:"outline",disabled:s.status==="Completed",onClick:()=>{c(s),I(!0)},children:e.jsx(R,{icon:Ie})})})}),L.includes(g.role)&&e.jsx(Be,{item:s})]})]})]},s._id))}):e.jsx($,{className:"justify-content-center",children:"0 results found"}),k&&e.jsx(V,{color:"danger",className:"text-center justify-content-center",children:k})]})},ut=()=>e.jsxs(e.Fragment,{children:[e.jsx($,{className:"text-center",children:"Maintenance Management"}),e.jsx(U,{className:"m-3",children:e.jsx($e,{})}),e.jsxs(Re,{children:[e.jsx($,{children:"Schedule List"}),e.jsx(Ve,{className:"md-3",children:e.jsx(Qe,{})})]})]});export{ut as default};
