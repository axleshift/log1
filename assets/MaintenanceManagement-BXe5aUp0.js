import{r as n,_ as je,u as Fe,R as S,a as G,c as ee,P,b as Ve,B as ce,j as e,k as Ce,m as U,D as Ee,G as De}from"./index-9q14rM7R.js";import{F as te,n as Re,v as Be,o as ze,h as Oe,a as xe,p as $e,w as He,q as Qe}from"./index-Dh_uSIGz.js";import{C as Ge,a as D}from"./CButton-BT1rWau9.js";import{C as he,a as ue,b as pe,c as me,d as ve}from"./CModalTitle-DFQUuEFe.js";import{C as oe}from"./CAlert-BY32Zm3C.js";import{C as Le}from"./CForm-CCEBrrPn.js";import{C as _}from"./CInputGroup-VZBprtOO.js";import{C as K}from"./CFormSelect-BJGzYABc.js";import{a as Pe,b as we,C as B}from"./CFormInput-CiLBdQhH.js";import{C as fe}from"./CCard-B85_9HOU.js";import{C as be}from"./CCardHeader-ZUBZZjlI.js";import{C as ne}from"./CCardBody-DFigFAK5.js";import{C as Te,a as Me,b as de,c as ae,d as Ie,e as se}from"./CTable-DAEx-CZU.js";import{C as H}from"./CContainer-Bx_IidIf.js";import{C as Q,c as _e,d as Ue,e as Ke,a as Je}from"./DefaultLayout-Dd5iyPkL.js";import{C as Ae}from"./CFormTextarea-BHFKWNEM.js";import{C as We}from"./CInputGroupText-CtLay3vB.js";import{C as Xe,a as Ye,b as Ze,c as et}from"./CAccordionHeader-DszraVUi.js";import{C as tt,a as ge}from"./CPaginationItem-DpEMu8-b.js";import{C as at,a as st,b as lt,c as rt}from"./CTabList-DTKtNKCe.js";import"./index.esm-Yn3Ds21R.js";import"./1-Gp7zrvLB.js";import"./cil-user-Ddrdy7PS.js";import"./getTransitionDurationFromElement-Cpu4p4hx.js";var ye=n.forwardRef(function(i,a){var d=i.className,f=i.button,T=i.feedback,I=i.feedbackInvalid,x=i.feedbackValid,L=i.floatingLabel,m=i.tooltipFeedback,C=i.hitArea,v=i.id,A=i.indeterminate,q=i.inline,b=i.invalid,c=i.label,F=i.reverse,h=i.type,M=h===void 0?"checkbox":h,R=i.valid,z=je(i,["className","button","feedback","feedbackInvalid","feedbackValid","floatingLabel","tooltipFeedback","hitArea","id","indeterminate","inline","invalid","label","reverse","type","valid"]),y=n.useRef(null),o=Fe(a,y);n.useEffect(function(){y.current&&A&&(y.current.indeterminate=A)},[A,y.current]);var g=function(){return S.createElement("input",G({type:M,className:ee(f?"btn-check":"form-check-input",{"is-invalid":b,"is-valid":R,"me-2":C}),id:v},z,{ref:o}))},u=function(){return S.createElement(we,{describedby:z["aria-describedby"],feedback:T,feedbackInvalid:I,feedbackValid:x,floatingLabel:L,invalid:b,tooltipFeedback:m,valid:R})},O=function(){var $;return S.createElement(Pe,G({customClassName:ee(f?ee("btn",f.variant?"btn-".concat(f.variant,"-").concat(f.color):"btn-".concat(f.color),($={},$["btn-".concat(f.size)]=f.size,$),"".concat(f.shape)):"form-check-label")},v&&{htmlFor:v}),c)},J=function(){return f?S.createElement(S.Fragment,null,S.createElement(g,null),c&&S.createElement(O,null),S.createElement(u,null)):c?C?S.createElement(S.Fragment,null,S.createElement(g,null),S.createElement(Pe,G({customClassName:ee("form-check-label stretched-link",d)},v&&{htmlFor:v}),c),S.createElement(u,null)):S.createElement("div",{className:ee("form-check",{"form-check-inline":q,"form-check-reverse":F,"is-invalid":b,"is-valid":R},d)},S.createElement(g,null),S.createElement(O,null),S.createElement(u,null)):S.createElement(g,null)};return S.createElement(J,null)});ye.propTypes=G({button:P.object,className:P.string,hitArea:P.oneOf(["full"]),id:P.string,indeterminate:P.bool,inline:P.bool,label:P.oneOfType([P.string,P.node]),reverse:P.bool,type:P.oneOf(["checkbox","radio"])},we.propTypes);ye.displayName="CFormCheck";var ke=n.forwardRef(function(i,a){var d,f=i.children,T=i.as,I=T===void 0?"ul":T,x=i.className,L=i.flush,m=i.layout,C=je(i,["children","as","className","flush","layout"]);return S.createElement(I,G({className:ee("list-group",(d={"list-group-flush":L},d["list-group-".concat(m)]=m,d),x)},C,{ref:a}),f)});ke.propTypes={as:P.elementType,children:P.node,className:P.string,flush:P.bool,layout:P.oneOf(["horizontal","horizontal-sm","horizontal-md","horizontal-lg","horizontal-xl","horizontal-xxl"])};ke.displayName="CListGroup";var Ne=n.forwardRef(function(i,a){var d,f=i.children,T=i.active,I=i.as,x=I===void 0?"li":I,L=i.className,m=i.disabled,C=i.color,v=je(i,["children","active","as","className","disabled","color"]),A=x==="a"||x==="button"?Ge:x;return v=G(G(G(G({},(x==="a"||x==="button")&&{active:T,disabled:m,as:x,ref:a}),T&&{"aria-current":!0}),m&&{"aria-disabled":!0}),v),S.createElement(A,G({className:ee("list-group-item",(d={},d["list-group-item-".concat(C)]=C,d["list-group-item-action"]=x==="a"||x==="button",d.active=T,d.disabled=m,d),L)},v),f)});Ne.propTypes={active:P.bool,as:P.elementType,children:P.node,className:P.string,color:Ve,disabled:P.bool};Ne.displayName="CListGroupItem";const it=({onAddMaintenance:i})=>{const{showError:a,showSuccess:d}=ce(),[f,T]=n.useState(!1),[I,x]=n.useState(null),[L,m]=n.useState(!1),[C,v]=n.useState(!1),[A,q]=n.useState(!1),b={vehicle:"",maintenanceType:"",startDate:"",expectedEndDate:"",description:"",priority:"",category:"",checklist:[{task:"",completed:!1}],parts:[],requested:!0,purchased:!1},[c,F]=n.useState(b),[h,M]=n.useState([]),[R,z]=n.useState({partName:"",quantity:""}),y=new Date().toISOString().split("T")[0],o=l=>{const{id:p,value:s}=l.target;F(r=>({...r,[p]:s}))},g=l=>{const{id:p,value:s}=l.target;z(r=>({...r,[p.split(".")[1]]:s}))},u=()=>{F(l=>({...l,parts:[...l.parts,{...R}]})),z({partName:"",quantity:""})};n.useEffect(()=>{(async()=>{try{const p=await U.get("api/v1/vehicle/all");p.data.success&&M(p.data.data)}catch(p){x(p),a(p.message)}})()},[]);const O=()=>{F(l=>({...l,checklist:[...l.checklist,{task:"",completed:!1}]}))},J=l=>{F(p=>({...p,parts:p.parts.filter((s,r)=>r!==l)}))},$=l=>{F(p=>({...p,checklist:p.checklist.filter((s,r)=>r!==l)}))},le=(l,p)=>{F(s=>({...s,checklist:s.checklist.map((r,j)=>j===l?{...r,task:p}:r)}))},re=[{label:"High",value:"High"},{label:"Medium",value:"Medium"},{label:"Low",value:"Low"},{label:"Critical",value:"Critical"}],w=[{label:"Engine",value:"Engine"},{label:"Transmission",value:"Transmission"},{label:"Brakes",value:"Brakes"},{label:"Electrical",value:"Electrical"},{label:"Tiers",value:"Tiers"},{label:"Other",value:"Other"}],W=[{label:"Preventive",value:"PMS"},{label:"Corrective",value:"Corrective"},{label:"Emergency",value:"Emergency"}],ie=async l=>{var s,r,j,k;if(l.preventDefault(),c.parts.length===0?c.purchased=!0:c.purchased=!1,l.currentTarget.checkValidity()===!1)l.stopPropagation(),l.preDefault();else try{const N=await U.post("api/v1/maintenance/create",c);N.data.success&&(d(N.data.message),i(N.data.data),m(!1))}catch(N){a(((r=(s=N.response)==null?void 0:s.data)==null?void 0:r.message)||N.message),x(((k=(j=N.response)==null?void 0:j.data)==null?void 0:k.message)||N.message),setTimeout(()=>{x(null)},2e3)}v(!0)};return e.jsxs(e.Fragment,{children:[e.jsxs(D,{color:"primary",className:"mb-3",variant:"outline",onClick:()=>m(!0),children:[e.jsx(te,{icon:Re})," Add Maintenance"]}),e.jsxs(he,{visible:L,onClose:()=>m(!1),size:"lg",children:[e.jsx(ue,{closeButton:!0,children:e.jsx(pe,{children:"Add Maintenance"})}),I&&e.jsx(oe,{color:"danger",children:I}),e.jsx(me,{children:e.jsxs(Le,{className:"row g-3 needs-validation",noValidate:!0,validated:C,children:[e.jsxs(_,{children:[e.jsxs(K,{id:"vehicle",value:c.vehicle,onChange:o,floatingLabel:"Vehicle",placeholder:"Select Vehicle",required:!0,feedbackInvalid:"Please provide a valid vehicle.",children:[e.jsx("option",{value:"",children:"Select Vehicle"}),h.filter(l=>l.status==="in_use"||l.status==="available").map(l=>e.jsxs("option",{value:l._id,children:[l.brand," / ",l.model," / ",l.regisNumber]},l._id))]}),e.jsx(K,{id:"maintenanceType",value:c.maintenanceType,onChange:o,floatingLabel:"Maintenance Type",placeholder:"Select Maintenance Type",required:!0,options:[{label:"Select Maintenance Type",value:""},...W],feedbackInvalid:"Please provide a valid maintenance type."}),e.jsx(B,{id:"description",type:"text",floatingLabel:"Description",placeholder:"Description",required:!0,value:c.description,onChange:o,feedbackInvalid:"Please provide a valid description."})]}),e.jsxs(_,{children:[e.jsx(B,{id:"startDate",type:"date",floatingLabel:"Start Date",placeholder:"Start Date",required:!0,min:y,value:c.startDate,onChange:o,feedbackInvalid:"Please provide a valid start date."}),e.jsx(B,{id:"expectedEndDate",type:"date",floatingLabel:"Expected End Date",placeholder:"Expected End Date",required:!0,min:y,value:c.expectedEndDate,onChange:o,feedbackInvalid:"Please provide a valid expected end date."}),e.jsxs(K,{id:"priority",value:c.priority,onChange:o,floatingLabel:"Priority",placeholder:"Select Priority",required:!0,feedbackInvalid:"Please provide a valid priority.",children:[e.jsx("option",{value:"",children:"Select Priority"}),re.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))]}),e.jsxs(K,{id:"category",value:c.category,onChange:o,floatingLabel:"Category",placeholder:"Select Category",required:!0,feedbackInvalid:"Please provide a valid category.",children:[e.jsx("option",{value:"",children:"Select Category"}),w.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))]})]}),e.jsxs(fe,{className:"mb-3",children:[e.jsx(be,{children:"Add Parts"}),e.jsxs(ne,{children:[e.jsxs(_,{className:"mb-3",children:[e.jsx(B,{id:"parts.partName",type:"text",floatingLabel:"Part Name",placeholder:"Part Name",value:R.partName,onChange:g,required:!0}),e.jsx(B,{id:"parts.quantity",type:"number",floatingLabel:"Quantity",placeholder:"Quantity",value:R.quantity,onChange:g,required:!0}),e.jsx(D,{color:"primary",onClick:u,children:"Add Part"})]}),c.parts.length>0&&e.jsxs(Te,{className:"",children:[e.jsx(Me,{className:"text-center",children:e.jsxs(de,{children:[e.jsx(ae,{children:"Part Name"}),e.jsx(ae,{children:"Part Quantity"}),e.jsx(ae,{children:"Remove Part"})]})}),e.jsx(Ie,{className:"text-center",children:c.parts.map((l,p)=>e.jsxs(de,{children:[e.jsx(se,{children:l.partName}),e.jsx(se,{children:l.quantity}),e.jsx(se,{children:e.jsx(D,{color:"danger",size:"sm",onClick:()=>J(p),children:"Remove"})})]},p))})]})]})]}),e.jsxs(H,{children:[e.jsx(Q,{children:"Checklist Items"}),e.jsx(D,{color:"primary",variant:"outline",className:"m-2",onClick:O,children:"Add Checklist Item"}),c.checklist.map((l,p)=>e.jsxs(_,{className:"mb-2",children:[e.jsx(B,{value:l.task,id:"itemCheckList",onChange:s=>le(p,s.target.value),placeholder:"Enter checklist item",required:!0}),e.jsx(D,{color:"danger",variant:"outline",onClick:()=>$(p),children:"Remove"})]},p))]}),e.jsx(Ae,{id:"notes",floatingLabel:"Notes",placeholder:"Notes",value:c.notes,onChange:o,autoComplete:"off",style:{minHeight:"150px",width:"100%",resize:"vertical"},text:" leave empty if no notes.",feedbackInvalid:"Please provide a valid notes."})]})}),e.jsxs(ve,{children:[e.jsx(D,{color:"secondary",variant:"outline",onClick:()=>m(!1),children:"Close"}),e.jsx(D,{color:"primary",variant:"outline",onClick:ie,children:f?e.jsx(Ce,{size:"sm"}):"Add Maintenance"})]})]})]})},nt=({onCompleted:i,maintenance:a})=>{var m;const{showSuccess:d,showError:f}=ce(),T=Ee(),I=["admin","chief mechanic"];if(!a||!a.checklist)return null;const x=()=>{const C=new Date,v=new Date(a.startDate);return C<v},L=async C=>{var v,A;try{const q=De(),b=await U.patch(`api/v1/maintenance/complete/${C}`,{completedBy:q});b.data.success&&(d(b.data.message),i(b.data.data))}catch(q){const b=((A=(v=q.response)==null?void 0:v.data)==null?void 0:A.message)||"Error completing maintenance";f(b),console.error("Error completing maintenance:",q)}};return e.jsx(e.Fragment,{children:I.includes(T)&&e.jsxs(e.Fragment,{children:[e.jsx(D,{color:"success",variant:"outline",onClick:()=>L(a._id),disabled:!((m=a.checklist)!=null&&m.every(C=>C.completed))||x()||a.status==="Completed",title:x()?"Maintenance cannot be completed before its start date":"",children:"Complete Maintenance"}),x()&&e.jsxs("div",{className:"text-danger mt-2",children:["This maintenance cannot be completed before"," ",new Date(a.startDate).toLocaleDateString()]})]})})},ct=({onUpdateMaintenance:i,maintenance:a,disabled:d})=>{const{showError:f,showSuccess:T}=ce(),[I,x]=n.useState(!1),[L,m]=n.useState(null),[C,v]=n.useState(!1),[A,q]=n.useState(!1),[b,c]=n.useState(!1),F={vehicle:a.vehicle||{},maintenanceType:(a==null?void 0:a.maintenanceType)||"",startDate:a!=null&&a.startDate?a.startDate.split("T")[0]:"",expectedEndDate:a!=null&&a.expectedEndDate?a.expectedEndDate.split("T")[0]:"",description:(a==null?void 0:a.description)||"",priority:(a==null?void 0:a.priority)||"",category:(a==null?void 0:a.category)||"",checklist:(a==null?void 0:a.checklist)||[],parts:(a==null?void 0:a.parts)||[],notes:(a==null?void 0:a.notes)||"",requested:!0,purchased:!1},[h,M]=n.useState(F),[R,z]=n.useState([]),[y,o]=n.useState({partName:"",quantity:""}),g=new Date().toISOString().split("T")[0],u=s=>{const{id:r,value:j}=s.target;if(r==="vehicle"){const k=R.find(N=>N._id===j);M(N=>({...N,vehicle:k}))}else M(k=>({...k,[r]:j}))},O=s=>{const{id:r,value:j}=s.target,k=r.split(".")[1];o(N=>({...N,[k]:k==="quantity"?j===""?"":Number(j):j}))},J=()=>{if(!y.partName||!y.quantity){f("Please fill in both part name and quantity");return}M(s=>({...s,parts:[...s.parts,{...y}]})),o({partName:"",quantity:""})};n.useEffect(()=>{(async()=>{try{const r=await U.get("api/v1/vehicle/all");r.data.success&&z(r.data.data)}catch(r){m(r),f(r.message)}})()},[]);const $=()=>{M(s=>({...s,checklist:[...s.checklist,{task:"",completed:!1}]}))},le=s=>{M(r=>({...r,parts:r.parts.filter((j,k)=>k!==s)}))},re=s=>{M(r=>({...r,checklist:r.checklist.filter((j,k)=>k!==s)}))},w=(s,r)=>{M(j=>({...j,checklist:j.checklist.map((k,N)=>N===s?{...k,task:r}:k)}))},W=[{label:"High",value:"High"},{label:"Medium",value:"Medium"},{label:"Low",value:"Low"},{label:"Critical",value:"Critical"}],ie=[{label:"Engine",value:"Engine"},{label:"Transmission",value:"Transmission"},{label:"Brakes",value:"Brakes"},{label:"Electrical",value:"Electrical"},{label:"Tiers",value:"Tiers"},{label:"Other",value:"Other"}],l=[{label:"Preventive",value:"PMS"},{label:"Corrective",value:"Corrective"},{label:"Emergency",value:"Emergency"}],p=async s=>{var j,k,N,t;s.preventDefault(),h.parts.length===0?h.purchased=!0:h.purchased=!1;const r=s.currentTarget;if(q(!0),r.checkValidity()===!1){s.stopPropagation();return}x(!0);try{const E=await U.put(`api/v1/maintenance/update/${a._id}`,h);E.data.success&&(T(E.data.message),i(E.data.data),v(!1))}catch(E){f(((k=(j=E.response)==null?void 0:j.data)==null?void 0:k.message)||E.message),m(((t=(N=E.response)==null?void 0:N.data)==null?void 0:t.message)||E.message),setTimeout(()=>{m(null)},2e3)}finally{x(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs(D,{color:"primary",className:"m-1",variant:"outline",onClick:()=>v(!0),disabled:d,children:[d?e.jsx(te,{icon:Be}):e.jsx(te,{icon:ze})," ",d?"Complete":"Update"]}),e.jsxs(he,{visible:C,onClose:()=>v(!1),size:"lg",children:[e.jsx(ue,{closeButton:!0,children:e.jsx(pe,{children:"Update Maintenance"})}),L&&e.jsx(oe,{color:"danger",children:L}),e.jsx(me,{children:e.jsxs(Le,{className:"row g-3 needs-validation",noValidate:!0,validated:A,children:[e.jsxs(_,{children:[e.jsx(K,{id:"vehicle",floatingLabel:"Vehicle",placeholder:"Select Vehicle",required:!0,value:h.vehicle?h.vehicle._id:"",onChange:u,feedbackInvalid:"Please provide a valid vehicle.",disabled:!0,children:e.jsx("option",{value:"",children:`${a.vehicle.brand} / ${a.vehicle.model} / ${a.vehicle.regisNumber}`})}),e.jsx(K,{id:"maintenanceType",value:h.maintenanceType||"",onChange:u,floatingLabel:"Maintenance Type",placeholder:"Select Maintenance Type",required:!0,options:[{label:"Select Maintenance Type",value:""},...l],feedbackInvalid:"Please provide a valid maintenance type."}),e.jsx(B,{id:"description",type:"text",floatingLabel:"Description",placeholder:"Description",required:!0,value:h.description,onChange:u,feedbackInvalid:"Please provide a valid description."})]}),e.jsxs(_,{children:[e.jsx(B,{id:"startDate",type:"date",floatingLabel:"Start Date",placeholder:"Start Date",required:!0,min:g,value:h.startDate,onChange:u,feedbackInvalid:"Please provide a valid start date."}),e.jsx(B,{id:"expectedEndDate",type:"date",floatingLabel:"Expected End Date",placeholder:"Expected End Date",required:!0,min:g,value:h.expectedEndDate,onChange:u,feedbackInvalid:"Please provide a valid expected end date."}),e.jsxs(K,{id:"priority",value:h.priority||"",onChange:u,floatingLabel:"Priority",placeholder:"Select Priority",required:!0,feedbackInvalid:"Please provide a valid priority.",children:[e.jsx("option",{value:"",children:"Select Priority"}),W.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),e.jsxs(K,{id:"category",value:h.category,onChange:u,floatingLabel:"Category",placeholder:"Select Category",required:!0,feedbackInvalid:"Please provide a valid category.",children:[e.jsx("option",{value:"",children:"Select Category"}),ie.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]})]}),e.jsxs(fe,{className:"mb-3",children:[e.jsx(be,{children:"Add Parts"}),e.jsxs(ne,{children:[e.jsxs(_,{className:"mb-3",children:[e.jsx(B,{id:"parts.partName",type:"text",floatingLabel:"Part Name",placeholder:"Part Name",value:y.partName||"",onChange:O}),e.jsx(B,{id:"parts.quantity",type:"number",floatingLabel:"Quantity",placeholder:"Quantity",value:y.quantity||"",onChange:O}),e.jsx(D,{color:"primary",onClick:J,children:"Add Part"})]}),h.parts.length>0&&e.jsxs(Te,{className:"",children:[e.jsx(Me,{className:"text-center",children:e.jsxs(de,{children:[e.jsx(ae,{children:"Part Name"}),e.jsx(ae,{children:"Part Quantity"}),e.jsx(ae,{children:"Remove Part"})]})}),e.jsx(Ie,{className:"text-center",children:h.parts.map((s,r)=>e.jsxs(de,{children:[e.jsx(se,{children:s.partName}),e.jsx(se,{children:s.quantity}),e.jsx(se,{children:e.jsx(D,{color:"danger",size:"sm",onClick:()=>le(r),children:"Remove"})})]},r))})]})]})]}),e.jsxs(H,{children:[e.jsx(Q,{children:"Checklist Items"}),e.jsx(D,{color:"primary",variant:"outline",className:"m-2",onClick:$,children:"Add Checklist Item"}),h.checklist.map((s,r)=>e.jsxs(_,{className:"mb-2",children:[e.jsx(B,{value:s.task,id:"itemCheckList",onChange:j=>w(r,j.target.value),placeholder:"Enter checklist item",required:!0}),e.jsx(D,{color:"danger",variant:"outline",onClick:()=>re(r),children:"Remove"})]},r))]}),e.jsx(Ae,{id:"notes",floatingLabel:"Notes",placeholder:"Notes",value:h.notes,onChange:u,autoComplete:"off",style:{minHeight:"150px",width:"100%",resize:"vertical"},text:" leave empty if no notes.",feedbackInvalid:"Please provide a valid notes."})]})}),e.jsxs(ve,{children:[e.jsx(D,{color:"secondary",variant:"outline",onClick:()=>v(!1),children:"Close"}),e.jsx(D,{color:"primary",variant:"outline",onClick:p,children:I?e.jsx(Ce,{size:"sm"}):"Update Maintenance"})]})]})]})},ot=({onDeleteMaintenance:i,onUpdateMaintenance:a,maintenance:d,onCompleted:f,vehicles:T,loading:I,error:x,selectedMaintenanceId:L})=>{const m=Ee(),{showError:C,showSuccess:v}=ce(),A=["admin","chief mechanic"],[q,b]=n.useState(null),[c,F]=n.useState(""),[h,M]=n.useState([]),[R,z]=n.useState(!1),[y,o]=n.useState(1),[g]=n.useState(10),u=y*g,O=u-g,J=h.slice(O,u),$=Math.ceil(h.length/g),[le,re]=n.useState(""),[w,W]=n.useState({checklist:[]}),[ie,l]=n.useState(!0);n.useEffect(()=>{L&&(re(L.toString()),setTimeout(()=>{const t=document.getElementById(`maintenance-${L}`);t&&t.scrollIntoView({behavior:"smooth",block:"center"})},100))},[L]),n.useEffect(()=>{M(d)},[d]),console.log(d);const p=t=>{W(t),z(!0)},s=()=>{W(null),z(!1)},r=async(t,E)=>{var V,X;try{const Y=De(),Z=await U.patch(`api/v1/maintenance/${t}/checklist/${E}`,{completedBy:Y});Z.data.success&&(M(qe=>qe.map(Se=>Se._id===t?Z.data.data:Se)),(w==null?void 0:w._id)===t&&W(Z.data.data),v(Z.data.message))}catch(Y){console.error("Error updating checklist:",Y),C(((X=(V=Y.response)==null?void 0:V.data)==null?void 0:X.message)||"Error updating checklist item")}},j=t=>t?`${t.brand||""} ${t.model||""} ${t.regisNumber||""}`.trim():"N/A";n.useEffect(()=>{(()=>{if(o(1),c==="")M(d);else{const E=d.filter(V=>{var X,Y,Z;return((X=V.vehicle)==null?void 0:X.regisNumber.toLowerCase().includes(c.toLowerCase()))||((Y=V.vehicle)==null?void 0:Y.brand.toLowerCase().includes(c.toLowerCase()))||((Z=V.vehicle)==null?void 0:Z.model.toLowerCase().includes(c.toLowerCase()))||V.maintenanceType.toLowerCase().includes(c.toLowerCase())||V.priority.toLowerCase().includes(c.toLowerCase())||V.status.toLowerCase().includes(c.toLowerCase())});M(E),E.length===0?b("No vehicles found"):b(null)}})()},[c,d]);const k=t=>{switch(t){case"Completed":return"green";case"Scheduled":return"orange";case"In Progress":return"yellow";default:return"black"}},N=[{value:"Completed",label:"Completed"},{value:"Scheduled",label:"Scheduled"},{value:"In Progress",label:"In Progress"}];return e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"mt-3",children:e.jsxs(_,{className:"mb-3",children:[e.jsx(B,{type:"text",placeholder:"Search",id:"search",value:c,onChange:t=>F(t.target.value)}),e.jsx(We,{children:e.jsx(te,{icon:Oe})})]})}),e.jsx(Xe,{activeItemKey:le||void 0,className:"m-2",children:J.map((t,E)=>e.jsxs(Ye,{itemKey:t._id.toString(),id:`maintenance-${t._id}`,children:[e.jsxs(Ze,{className:"d-flex justify-content-between",children:[e.jsx(H,{children:e.jsxs("ul",{className:"list-unstyled",children:[e.jsxs("li",{children:["Vehicle: ",e.jsx("strong",{children:j(t.vehicle)})]}),e.jsxs("li",{children:["Priority: ",e.jsx("strong",{children:t.priority||"N/A"})]}),e.jsxs("li",{children:["Purchase Status:"," ",t.purchased?e.jsx(xe,{color:"success",children:"Complete"}):e.jsx(xe,{color:"warning",children:"Awaiting Purchase"})]})]})}),e.jsxs(H,{className:"d-flex justify-content-end",children:[e.jsx(te,{icon:$e,color:k(t.status),className:"m-2 float-end"}),e.jsx("small",{className:"m2 float-end",children:N.find(V=>V.value===t.status).label})]})]}),e.jsxs(et,{children:[e.jsxs(Q,{children:["Maintenance Type: ",t.maintenanceType||"N/A"]}),e.jsxs(Q,{children:["Start Date:"," ",t.startDate?new Date(t.startDate).toLocaleDateString():"N/A"]}),e.jsxs(Q,{children:["Expected Date:"," ",t.expectedEndDate?new Date(t.expectedEndDate).toLocaleDateString():"N/A"]}),e.jsxs(Q,{children:["Description: ",t.description||"N/A"]}),e.jsxs(Q,{children:["Category: ",t.category||"N/A"]}),e.jsxs(Q,{children:["Notes: ",t.notes||"N/A"]}),e.jsxs(Q,{children:["Completed By: ",t.completedBy||"N/A"]}),e.jsxs(fe,{className:"mt-3",children:[e.jsx(be,{children:e.jsx("strong",{children:"Parts Required"})}),e.jsx(ne,{children:t.parts&&t.parts.length>0?e.jsx(e.Fragment,{children:e.jsx(ke,{children:t.parts.map((V,X)=>e.jsxs(Ne,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("div",{children:e.jsx("strong",{children:V.partName})}),e.jsx("div",{className:"d-flex gap-3",children:e.jsxs(xe,{color:"primary",children:["Qty: ",V.quantity]})})]},X))})}):e.jsx(oe,{color:"info",children:"No parts listed for this maintenance"})})]}),e.jsx(H,{className:"d-flex align-center  mt-3",children:e.jsxs(_e,{children:[e.jsx(Ue,{color:"secondary",variant:"outline",children:"Actions"}),e.jsx(Ke,{children:e.jsxs(H,{className:"d-flex flex-column justify-content-center",children:[A.includes(m)&&e.jsx(ct,{maintenance:t,onUpdateMaintenance:a,vehicles:T,disabled:t.status==="Completed"}),e.jsxs(D,{color:"success",className:"m-1",variant:"outline",onClick:()=>p(t),disabled:t.purchased===!1&&t.parts.length>0,children:[e.jsx(te,{icon:He})," Checklist"]}),e.jsxs(D,{color:"danger",className:"m-1",variant:"outline",onClick:()=>i(t._id),children:[e.jsx(te,{icon:Qe})," Delete"]})]})})]})})]})]},t._id))}),h.length>0&&e.jsxs(H,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs(H,{children:["Showing ",O+1," to ",Math.min(u,h.length)," ","of ",h.length," entries"]}),e.jsxs(tt,{className:"mt-3",children:[e.jsx(ge,{disabled:y===1,onClick:()=>o(t=>Math.max(t-1,1)),children:"Previous"}),Array.from({length:$},(t,E)=>E+1).map(t=>e.jsx(ge,{active:t===y,onClick:()=>o(t),children:t},t)),e.jsx(ge,{disabled:y===$,onClick:()=>o(t=>Math.min(t+1,$)),children:"Next"})]})]}),q&&e.jsx(oe,{color:"danger",children:q}),e.jsxs(he,{visible:R,onClose:s,size:"lg",children:[e.jsx(ue,{children:e.jsxs(pe,{children:["Maintenance Checklist - ",j(w==null?void 0:w.vehicle)]})}),e.jsx(me,{children:w!=null&&w.checklist&&w.checklist.length>0?e.jsx("div",{className:"checklist-container",children:e.jsx("ul",{className:"list-group",children:w.checklist.map((t,E)=>e.jsxs("li",{className:"list-group-item d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx(ye,{type:"checkbox",id:`checkBoxList-${E}`,checked:t.completed,onChange:()=>r(w._id,E),disabled:!A.includes(m)||w.status==="Completed",className:"me-2"})," ",t.task]}),t.completed&&e.jsxs("small",{className:"text-muted",children:["Completed by: ",t.completedBy," at"," ",new Date(t.completedAt).toLocaleString()]})]},E))})}):e.jsx("p",{className:"text-center",children:"No checklist items available"})}),e.jsxs(ve,{children:[w&&e.jsx(nt,{maintenance:w,isLoading:ie,onCompleted:f,disabled:!A.includes(m)}),e.jsx(D,{color:"secondary",onClick:s,children:"Close"})]})]})]})},At=()=>{var y;const[i,a]=n.useState([]),[d,f]=n.useState([]),[T,I]=n.useState(!0),[x,L]=n.useState(null),{showError:m,showSuccess:C}=ce(),[v,A]=n.useState(((y=location.state)==null?void 0:y.selectedMaintenanceId)||null),[q,b]=n.useState(!1),c=async()=>{var o,g;I(!0);try{const[u,O]=await Promise.all([U.get("/api/v1/maintenance/all"),U.get("/api/v1/vehicle")]);a(u.data.data),f(O.data.date)}catch(u){L(u.message),m(((g=(o=u.response)==null?void 0:o.data)==null?void 0:g.message)||"Error fetching data")}finally{I(!1)}};if(n.useEffect(()=>{c()},[]),T)return e.jsx(Ce,{color:"primary",size:"sm",children:"Loading..."});const F=o=>{A(o),b(!0)},h=async()=>{try{await U.delete(`/api/v1/maintenance/delete/${v}`),a(o=>o.filter(g=>g._id!==v)),C("Maintenance deleted successfully"),b(!1)}catch(o){m(o.response.data.message)}finally{b(!1)}c()},M=o=>{a(g=>[...g,o]),c()},R=o=>{a(g=>g.map(u=>u._id===o._id?o:u)),c()},z=o=>{a(g=>g.map(u=>u._id===o._id?o:u)),c()};return e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsx(Q,{children:"Maintenance Management"}),e.jsx(fe,{children:e.jsxs(ne,{children:[e.jsx(H,{children:e.jsx(it,{onAddMaintenance:M})}),e.jsxs(at,{activeItemKey:"Maintenance List",children:[e.jsx(st,{variant:"tabs",children:e.jsx(lt,{itemKey:"Maintenance List",children:"Maintenance List"})}),e.jsx(Je,{children:e.jsx(rt,{itemKey:"Maintenance List",children:e.jsx(ne,{className:"md-3",children:e.jsx(ot,{vehicles:d,maintenance:i,onCompleted:R,error:x,onDeleteMaintenance:F,onUpdateMaintenance:z,loading:T,selectedMaintenanceId:v})})})})]})]})})]}),e.jsxs(he,{visible:q,onClose:()=>b(!1),alignment:"center",children:[e.jsx(ue,{children:e.jsx(pe,{children:"Delete Maintenance"})}),e.jsx(me,{children:"Are you sure you want to delete this maintenance?"}),e.jsxs(ve,{children:[e.jsx(D,{color:"secondary",variant:"outline",onClick:()=>b(!1),children:"Cancel"}),e.jsx(D,{color:"danger",variant:"outline",onClick:h,children:"Delete"})]})]})]})};export{At as default};
