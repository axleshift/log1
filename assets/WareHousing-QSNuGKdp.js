import{r as a,D as ue,j as e,k as z,m as de,A as me,F as V}from"./index-DYVnpWz4.js";import{F as J,e as X,a as oe}from"./index-w3JmnCJB.js";import{C as P}from"./CAlert-QKOAw-qh.js";import{C as _}from"./CContainer-BPQkFBJZ.js";import{C as Z}from"./CInputGroup-yF6ctRaz.js";import{C as ee}from"./CFormInput-jQ33qRuY.js";import{C as se}from"./CInputGroupText-tHLLF6B9.js";import{C as xe,a as je,b as fe,c as ge}from"./CAccordionHeader-Banxblnf.js";import{C as te,a as re,b as M,c as p,d as ae,e as v}from"./CTable-CIluYc-z.js";import{C as ne,a as O}from"./CPaginationItem-B5YNGF-y.js";import{a as pe}from"./CButton-BV9fJGGb.js";import{C as ve,a as Ne,b as G,c as Y}from"./CTabList-D6_uWukU.js";import{a as we,C as ie}from"./DefaultLayout-BpkOyKEv.js";import{C as le}from"./CCard-AvlTtjdo.js";import"./getTransitionDurationFromElement-Cpu4p4hx.js";import"./index.esm-B2en4ce3.js";import"./1-BFe6Q1cY.js";import"./cil-user-Ddrdy7PS.js";const ye=({warehousing:N,loading:S,error:k,onDeleteItem:u,onUpdateItem:I})=>{const[x,D]=a.useState([]),[y,w]=a.useState(null),[L,C]=a.useState("");ue();const[g,W]=a.useState(1),[R]=a.useState(10),[h,n]=a.useState([]),j=Math.ceil(x.length/R),E=x.filter(s=>s.received===!0),A=g*R,r=A-R,f=E.slice(r,A);a.useEffect(()=>{try{if(L===""){D(N),w(null);return}const s=L.toLowerCase().trim(),m=N.filter(o=>{var t,c,l,i,T,Q,U,K,H;try{return((t=o.poNumber)==null?void 0:t.toLowerCase().includes(s))||((l=(c=o.vendor)==null?void 0:c.businessName)==null?void 0:l.toLowerCase().includes(s))||((T=(i=o.vendor)==null?void 0:i.businessAddress)==null?void 0:T.toLowerCase().includes(s))||((U=(Q=o.vendor)==null?void 0:Q.contactNumber)==null?void 0:U.includes(s))||o.orderDate&&new Date(o.orderDate).toLocaleDateString().includes(s)||o.dateOfReceived&&new Date(o.receiveDate).toLocaleDateString().includes(s)||((K=d(o.warehouseId))==null?void 0:K.toLowerCase().includes(s))||((H=o.details)==null?void 0:H.some(F=>{var $,B,q;return(($=F.description)==null?void 0:$.toLowerCase().includes(s))||((B=F.quantity)==null?void 0:B.toString().includes(s))||((q=F.unitPrice)==null?void 0:q.toString().includes(s))}))}catch(F){return console.error("Error filtering item:",F),!1}});D(m),W(1),m.length===0?w("No data found"):w(null)}catch(s){console.error("Error in search effect:",s),w("Error occurred while searching")}},[L,N]),a.useEffect(()=>{(async()=>{var m;try{const o=await de.get("/api/v1/warehouseLoc/locations");o.data.data&&n(o.data.data)}catch(o){w((m=o==null?void 0:o.response)==null?void 0:m.data.message)}})()},[]);const d=s=>{if(!h.length)return"Loading...";const m=h.find(o=>o._id===s);return m?m.warehouseName:"Unknown Warehouse"},b=s=>{C(s.target.value)};return S?e.jsx(z,{color:"primary",className:"mt-5 w-15 mx-auto justify-content-center"}):N.length===0?e.jsx(P,{color:"warning",className:"text-center mt-5 w-75 mx-auto",children:"No data available"}):k?e.jsxs(P,{color:"danger",className:"text-center mt-5 w-75 mx-auto",children:["Error: ",k.message]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"mt-3",children:e.jsxs(Z,{className:"w-50 mb-3",children:[e.jsx(ee,{type:"text",placeholder:"Search by PO Number, Vendor, or Products...",value:L,id:"searchItem",onChange:b}),e.jsx(se,{children:e.jsx(J,{icon:X})})]})}),S?e.jsx(z,{color:"primary",className:"mt-5 w-15 mx-auto justify-content-center"}):N.length===0?e.jsx(P,{color:"warning",className:"text-center mt-5 w-75 mx-auto",children:"No data available"}):e.jsxs(e.Fragment,{children:[y&&e.jsx(P,{color:"danger",className:"text-center mt-5 w-75 mx-auto",children:y}),e.jsx(xe,{className:"m-2",children:f.filter(s=>s.received).map(s=>e.jsxs(je,{children:[e.jsx(fe,{children:e.jsxs("div",{className:"d-flex justify-content-between w-100 align-items-center",children:[e.jsx("div",{children:e.jsxs("ul",{className:"list-unstyled",children:[e.jsxs("li",{children:["PO Number: ",e.jsx("strong",{children:s.poNumber})]}),e.jsxs("li",{children:["Warehuse Location:"," ",e.jsx("strong",{children:d(s.warehouse_id)})]})]})}),e.jsxs("div",{className:"text-medium-emphasis",children:["Order Date: ",new Date(s.orderDate).toLocaleDateString()]})]})}),e.jsxs(ge,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{children:"Vendor Information"}),e.jsxs("div",{className:"ms-3",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Name:"})," ",s.vendor.businessName]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Address:"})," ",s.vendor.businessAddress]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Contact:"})," ",s.vendor.contactNumber]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{children:"Shipping Details"}),e.jsxs("div",{className:"ms-3",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Carrier:"})," ",s.carrier]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Expected Delivery Date:"})," ",new Date(s.receiveDate).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{children:"Products"}),e.jsxs(te,{responsive:!0,small:!0,className:"mt-2",children:[e.jsx(re,{children:e.jsxs(M,{children:[e.jsx(p,{children:"Description"}),e.jsx(p,{children:"Quantity"}),e.jsx(p,{children:"Received Date"})]})}),e.jsx(ae,{children:s.details.map((m,o)=>e.jsxs(M,{children:[e.jsx(v,{children:m.description}),e.jsx(v,{children:m.quantity}),e.jsx(v,{children:s.receiveDate?new Date(s.receiveDate).toLocaleDateString():"N/A"})]},o))})]})]}),s.additionalNotes&&e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{children:"Additional Notes"}),e.jsx("div",{className:"ms-3",children:s.additionalNotes})]})]})]},s._id))}),f.length>0&&e.jsxs(_,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:["Showing ",E.length>0?r+1:0," to"," ",Math.min(A,E.length)," of ",E.length," received entries"]}),e.jsxs(ne,{className:"mt-3",children:[e.jsx(O,{disabled:g===1,onClick:()=>W(s=>Math.max(s-1,1)),children:"Previous"}),Array.from({length:j},(s,m)=>m+1).map(s=>e.jsx(O,{active:s===g,onClick:()=>W(s),children:s},s)),e.jsx(O,{disabled:g===j,onClick:()=>W(s=>Math.min(s+1,j)),children:"Next"})]})]})]})]})},Ce=({onAddItem:N})=>{const{showError:S,showSuccess:k}=me(),[u,I]=a.useState([]),[x,D]=a.useState(1),[y,w]=a.useState(null),[L,C]=a.useState(!0),[g,W]=a.useState(""),[R,h]=a.useState([]),[n,j]=a.useState([]),E=10;a.useEffect(()=>{(async()=>{try{const c=await V.get("https://log2_backend.chysev.cloud/api/v1/purchaseOrder");c.status===200&&I(c.data)}catch(c){console.error("Error fetching data:",c)}})()},[]);const A=async t=>{var c,l;try{if((await V.put(`https://log2_backend.chysev.cloud/api/v1/purchaseOrder/${t}`,{received:!0,receiveDate:new Date().toISOString()})).status===200){const T=await V.get("https://log2_backend.chysev.cloud/api/v1/purchaseOrder");I(T.data),k("Item received successfully")}}catch(i){console.error("Error updating purchase order:",i),S(((l=(c=i==null?void 0:i.response)==null?void 0:c.data)==null?void 0:l.message)||"Error updating purchase order")}};a.useEffect(()=>{(async()=>{var c,l;try{const i=await de.get("/api/v1/warehouseLoc/locations");i.data.data&&(j(i.data.data),k(i.data.message))}catch(i){w((c=i==null?void 0:i.response)==null?void 0:c.data.message),S(((l=i==null?void 0:i.response)==null?void 0:l.data.message)||"Error fetching warehouses")}})()},[]);const r=t=>{if(!n.length)return"Loading...";const c=n.find(l=>l._id===t);return c?c.warehouseName:"Unknown Warehouse"};if(a.useEffect(()=>{C(!1)},[]),a.useEffect(()=>{if(g===""){I(u);return}const t=g.toLowerCase().trim(),c=u.filter(l=>{var i,T,Q,U,K,H,F,$,B;try{return((i=l.poNumber)==null?void 0:i.toLowerCase().includes(t))||((Q=(T=l.vendor)==null?void 0:T.businessName)==null?void 0:Q.toLowerCase().includes(t))||((K=(U=l.vendor)==null?void 0:U.businessAddress)==null?void 0:K.toLowerCase().includes(t))||((F=(H=l.vendor)==null?void 0:H.contactNumber)==null?void 0:F.toLowerCase().includes(t))||(($=l.carrier)==null?void 0:$.toLowerCase().includes(t))||l.orderDate&&new Date(l.orderDate).toLocaleDateString().includes(t)||l.receiveDate&&new Date(l.receiveDate).toLocaleDateString().includes(t)||((B=l.details)==null?void 0:B.some(q=>{var ce;return(ce=q.description)==null?void 0:ce.toLowerCase().includes(t)}))}catch(q){return console.error("Error filtering data:",q),!1}});I(c),D(1),w(c.length===0?"No results found":null)},[g]),L)return e.jsx(z,{color:"primary",className:"mt-5 w-15 mx-auto justify-content-center"});const f=x*E,d=f-E,b=u.slice(d,f),s=Math.ceil(u.length/E),m=t=>{W(t.target.value)};return u.length>0&&u.every(t=>t.received===!0)?e.jsx(P,{color:"success",className:"text-center mt-3 w-75 mx-auto",children:"All items have been received."}):b.length===0?e.jsx(P,{color:"danger",className:"text-center mt-3 w-75 mx-auto",children:"No items to receive."}):y?e.jsx(P,{color:"danger",className:"text-center mt-3 w-75 mx-auto",children:y}):e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"mt-3",children:e.jsxs(Z,{className:"w-50 mb-3",children:[e.jsx(ee,{type:"text",placeholder:"Search by PO Number, Supplier, or Item Name",value:g,id:"searchInput",onChange:m}),e.jsx(se,{children:e.jsx(J,{icon:X})})]})}),e.jsxs(te,{hover:!0,responsive:!0,children:[e.jsx(re,{children:e.jsxs(M,{children:[e.jsx(p,{children:"PO Number"}),e.jsx(p,{children:"Order Date"}),e.jsx(p,{children:"Date to Receive"}),e.jsx(p,{children:"Carrier"}),e.jsx(p,{children:"Warehouse"}),e.jsx(p,{children:"Vendor"}),e.jsx(p,{children:"Products"}),e.jsx(p,{children:"Receive"}),e.jsx(p,{children:"Actions"})]})}),e.jsx(ae,{children:b.filter(t=>!t.received).map(t=>e.jsxs(M,{children:[e.jsx(v,{children:t.poNumber}),e.jsx(v,{children:new Date(t.orderDate).toLocaleDateString()}),e.jsx(v,{children:new Date(t.receiveDate).toLocaleDateString()}),e.jsx(v,{children:t.carrier}),e.jsx(v,{children:r(t.warehouse_id)}),e.jsxs(v,{children:[e.jsx("div",{children:t.vendor.businessName}),e.jsx("small",{className:"text-medium-emphasis",children:t.vendor.contactNumber})]}),e.jsx(v,{children:t.details.map(c=>e.jsxs("div",{children:[c.description," ( pcs: ",c.quantity," x"," ",c.unitPrice.toFixed(2)," )"]},c.productId))}),e.jsx(v,{children:t.received?"Yes":"No"}),e.jsx(v,{children:e.jsx(pe,{color:"primary",className:"mt-2",onClick:()=>A(t._id),children:"Complete"})})]},t._id))})]}),u.filter(t=>!t.received).length>0&&e.jsxs(_,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs(_,{children:["Showing ",d+1," to ",Math.min(f,u.length)," of"," ",u.length," entries"]}),e.jsxs(ne,{className:"mt-3",children:[e.jsx(O,{disabled:x===1,onClick:()=>D(t=>Math.max(t-1,1)),children:"Previous"}),[...Array(s).keys()].map(t=>e.jsx(O,{active:t+1===x,onClick:()=>D(t+1),children:t+1},t+1)),e.jsx(O,{disabled:x===s,onClick:()=>D(t=>Math.min(t+1,s)),children:"Next"})]})]}),y&&e.jsx(P,{color:"danger",className:"text-center mt-5 w-75 mx-auto justify-content-center",children:y})]})},be=({items:N,loading:S,error:k})=>{const[u,I]=a.useState([]),[x,D]=a.useState(""),[y,w]=a.useState(null),L=10,[C,g]=a.useState(1),W=r=>{switch(r){case"Stocked":return"success";case"Out of Stock":return"danger";default:return"secondary"}};a.useEffect(()=>{I(N)},[N]),a.useEffect(()=>{if(x==="")I(N),w(null);else{const r=N.filter(f=>{const d=f.itemName.toLowerCase().includes(x.toLowerCase()),b=f.locations.some(s=>{const m=s.warehouse;return m.warehouseName.toLowerCase().includes(x.toLowerCase())||m.address.toLowerCase().includes(x.toLowerCase())});return d||b});I(r),g(1),r.length===0?w("No results found"):w(null)}},[x,N]);const R=r=>{D(r.target.value)},h=r=>{if(!r||!Array.isArray(r))return[];const f=new Map;return r.forEach(d=>{if(!(d!=null&&d.warehouse))return;const b=d.warehouse._id||"deleted";if(!f.has(b))f.set(b,{warehouse:{...d.warehouse,deleted:d.warehouse.deleted||!d.warehouse._id},quantity:d.quantity||0});else{const s=f.get(b);s.quantity+=d.quantity||0,f.set(b,s)}}),Array.from(f.values())};if(S)return e.jsx(z,{color:"primary",className:"text-center mt-5 w-75 mx-auto justify-content-center"});if(k)return e.jsxs(P,{color:"danger",className:"text-center mt-5 w-75 mx-auto justify-content-center",children:["Error: ",k]});const n=C*L,j=n-L,E=u.slice(j,n),A=Math.ceil(u.length/L);return e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"m-3",children:e.jsxs(Z,{className:"w-50 mb-3",children:[e.jsx(ee,{type:"text",id:"search",value:x,onChange:R,placeholder:"Search by item name or warehouse..."}),e.jsx(se,{children:e.jsx(J,{icon:X})})]})}),e.jsxs("strong",{className:"m-3 align-self-start",children:["Total Items: ",E.length]}),y?e.jsx(P,{color:"warning",children:y}):e.jsxs(te,{hover:!0,responsive:!0,striped:!0,className:"text-center",children:[e.jsx(re,{children:e.jsxs(M,{children:[e.jsx(p,{scope:"col",children:"Item Name"}),e.jsx(p,{scope:"col",children:"Total Quantity"}),e.jsx(p,{scope:"col",children:"Warehouse Locations"}),e.jsx(p,{scope:"col",children:"Status"})]})}),e.jsx(ae,{children:E.map((r,f)=>e.jsxs(M,{children:[e.jsx(v,{children:r.itemName}),e.jsx(v,{children:e.jsx("strong",{children:r.quantity})}),e.jsx(v,{children:e.jsx(_,{className:"locations-list",children:h(r.locations).map((d,b)=>{const s=d.warehouse;return e.jsx(_,{className:"location-item",children:e.jsxs(_,{className:"location-details",children:[e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("span",{className:"warehouse-name",children:(s==null?void 0:s.warehouseName)||"Unknown Warehouse"}),e.jsx(oe,{color:s!=null&&s.deleted?"danger":"success",className:"ms-2",children:s!=null&&s.deleted?"Deleted":"Active"})]}),e.jsx("span",{className:"warehouse-address",children:(s==null?void 0:s.address)||"No address available"}),e.jsxs("span",{className:"quantity-badge",children:["Qty: ",d.quantity]})]})},(s==null?void 0:s._id)||`deleted-${b}`)})})}),e.jsx(v,{children:e.jsx(oe,{color:W(r.status||(r.quantity>0?"Stocked":"Out of Stock")),children:r.status||(r.quantity>0?"Stocked":"Out of Stock")})})]},r._id||f))})]}),u.length===0&&!y&&e.jsx(P,{color:"warning",className:"text-center mt-5 w-75 mx-auto",children:"No items found."}),e.jsxs(ne,{align:"center",children:[e.jsx(O,{disabled:C===1,onClick:()=>g(r=>Math.max(r-1,1)),children:"Previous"}),[...Array(A).keys()].map(r=>e.jsx(O,{active:r+1===C,onClick:()=>g(r+1),children:r+1},r+1)),e.jsx(O,{disabled:C===A,onClick:()=>g(r=>Math.min(r+1,A)),children:"Next"})]})]})},Se=`
  .locations-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .location-item {
    display: flex;
    flex-direction: column;
    padding: 8px;
    background-color: #f8f9fa;
    border-radius: 4px;
    width: fit-content;

  }

  .location-details {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 4px;
  }

  .warehouse-name {
    font-weight: 500;
    color: #495057;
  }

  .warehouse-address {
    color: #6c757d;
    font-size: 0.9em;
    font-style: italic;
  }

  .quantity-badge {
    background-color: #e9ecef;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 0.85em;
    color: #495057;
  }

`,he=document.createElement("style");he.innerText=Se;document.head.appendChild(he);const He=()=>{const[N,S]=a.useState([]),[k,u]=a.useState([]),[I,x]=a.useState(!1),[D,y]=a.useState(null),[w,L]=a.useState(0);a.useEffect(()=>{(async()=>{x(!0);try{const n=await V.get("https://log2_backend.chysev.cloud/api/v1/purchaseOrder");n.status===200&&S(n.data)}catch(n){y(n.message)}finally{x(!1)}})()},[w]);const C=()=>{L(h=>h+1)},g=h=>{S(n=>[...n,h]),u(n=>[...n,h]),C()},W=h=>{S(n=>n.filter(j=>j._id!==h)),u(n=>n.filter(j=>j._id!==h)),C()},R=h=>{S(n=>n.map(j=>j._id===h._id?h:j)),u(n=>n.map(j=>j._id===h._id?h:j)),C()};return e.jsx(e.Fragment,{children:e.jsxs(ve,{activeItemKey:"Warehouse Items Details",children:[e.jsxs(Ne,{variant:"tabs",children:[e.jsx(G,{itemKey:"Warehouse Items Details",children:"Warehouse Items Details"}),e.jsx(G,{itemKey:"For Receiving",children:"For Receiving"}),e.jsx(G,{itemKey:"Items",children:"Items"})]}),e.jsxs(we,{children:[e.jsx(Y,{className:"p-3",itemKey:"Warehouse Items Details",children:e.jsx(ye,{warehousing:N,loading:I,error:D,onDeleteItem:W,onUpdateItem:R,onRefresh:C})}),e.jsx(Y,{className:"p-3",itemKey:"For Receiving",children:e.jsxs(le,{children:[e.jsx(ie,{children:"Item Reiceving"}),e.jsx(Ce,{onAddItem:g})]})}),e.jsx(Y,{className:"p-3",itemKey:"Items",children:e.jsxs(le,{children:[e.jsx(ie,{children:"Items"}),e.jsx(be,{items:k,loading:I,error:D})]})})]})]})})};export{He as default};
