import{k as q,r as c,j as e,C as A,x as B}from"./index-DewLwpri.js";import{C as x}from"./index.esm-DGgU1JFB.js";import{C as E}from"./CContainer-B97CIy0o.js";import{C as T,a as U}from"./CRow-D7CXgryv.js";import{C as G}from"./CCard-CFLl5Ql0.js";import{C as M}from"./CCardBody-bDybmbb_.js";import{C as z,a as S}from"./CForm-BI8XSZr1.js";import{C as l,a as m}from"./CInputGroupText-BIW95Qg1.js";import{c as H}from"./cil-user-Ddrdy7PS.js";import{C as p}from"./CFormInput-Ca8VBleV.js";import{c as R}from"./cil-lock-locked-DmxpJbVL.js";import{C as W}from"./CFormSelect-DAtRDSPb.js";import{a as k}from"./CButton-OiCnr5Nw.js";import"./CCloseButton-BLvC_O-1.js";const oe=()=>{const j=q(),[s,f]=c.useState({username:"",email:"",password:"",repeatPassword:"",role:"",photo:null}),[C,u]=c.useState(null),[g,w]=c.useState(null),[o,h]=c.useState(!1),[v,F]=c.useState(null),i=d=>{const{id:r,value:t}=d.target;f(n=>({...n,[r]:t}))},P=d=>{const r=d.target.files[0];if(r){f(n=>({...n,photo:r}));const t=new FileReader;t.onloadend=()=>{F(t.result)},t.readAsDataURL(r)}},I=async d=>{var t,n,b,N,y;d.preventDefault(),h(!0),u(null);const r=new FormData;r.append("username",s.username),r.append("email",s.email),r.append("password",s.password),r.append("role",s.role),s.photo&&r.append("photo",s.photo);for(let a of r.entries())console.log(a[0]+": "+a[1]);try{if(s.password!==s.repeatPassword){u("Passwords do not match"),h(!1);return}const a=await B.post("/api/v1/user/register",s,{headers:{"Content-Type":"multipart/form-data"}});a.data&&a.data.success?(w("Registration successful"),a.data.token&&sessionStorage.setItem("accessToken",a.data.token),setTimeout(()=>{w(null),j("/dashboard")},2e3)):u(((t=a.data)==null?void 0:t.message)||"Registration failed")}catch(a){console.error("Full error details:",{message:a.message,response:(n=a.response)==null?void 0:n.data,status:(b=a.response)==null?void 0:b.status});const D=((y=(N=a.response)==null?void 0:N.data)==null?void 0:y.message)||a.message||"An error occurred during registration";u(D)}finally{h(!1)}},L=()=>{j("/dashboard")};return e.jsx("div",{className:"bg-body-tertiary min-vh-100 d-flex flex-row align-items-center",children:e.jsx(E,{children:e.jsx(T,{className:"justify-content-center",children:e.jsx(U,{md:9,lg:7,xl:6,children:e.jsx(G,{className:"mx-4",children:e.jsx(M,{className:"p-4",children:e.jsxs(z,{onSubmit:I,children:[e.jsx("h1",{children:"Register New User"}),C&&e.jsx(S,{color:"danger",className:"text-center w-75 mx-auto",children:C}),g&&e.jsx(S,{color:"success",className:"text-center w-75 mx-auto",children:g}),e.jsxs(l,{className:"mb-3",children:[e.jsx(m,{children:e.jsx(x,{icon:H})}),e.jsx(p,{placeholder:"Username",autoComplete:"off",id:"username",value:s.username,onChange:i,required:!0,disabled:o})]}),e.jsxs(l,{className:"mb-3",children:[e.jsx(m,{children:"@"}),e.jsx(p,{placeholder:"Email",autoComplete:"off",id:"email",value:s.email,onChange:i,required:!0,type:"email",disabled:o})]}),e.jsxs(l,{className:"mb-3",children:[e.jsx(m,{children:e.jsx(x,{icon:R})}),e.jsx(p,{type:"password",placeholder:"Password",autoComplete:"off",id:"password",value:s.password,onChange:i,required:!0,disabled:o})]}),e.jsxs(l,{className:"mb-4",children:[e.jsx(m,{children:e.jsx(x,{icon:R})}),e.jsx(p,{type:"password",placeholder:"Repeat password",autoComplete:"off",id:"repeatPassword",value:s.repeatPassword,onChange:i,required:!0,disabled:o})]}),e.jsxs(l,{className:"mb-3",children:[e.jsx(m,{children:"Role"}),e.jsxs(W,{id:"role",value:s.role,onChange:i,disabled:o,children:[e.jsx("option",{value:"",children:"Select Role"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"manager",children:"Manager"}),e.jsx("option",{value:"inspector",children:"Inspector"}),e.jsx("option",{value:"driver",children:"Driver"})]})]}),e.jsx(l,{className:"mb-3",children:e.jsx(p,{type:"file",accept:"image/*",onChange:P})}),v&&e.jsx("div",{className:"mb-3",children:e.jsx("img",{src:v,alt:"Preview",style:{maxWidth:"200px",maxHeight:"200px",objectFit:"cover"}})}),e.jsx(k,{color:"success",type:"submit",disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx(A,{size:"sm"})," Loading..."]}):"Create"}),e.jsx(k,{color:"secondary",className:"ms-2",onClick:L,disabled:o,children:"Back"})]})})})})})})})};export{oe as default};
