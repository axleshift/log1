import{r as t,j as e,C as k,x as A,i as z,z as $}from"./index-Dyx0DIrn.js";import{F,i as G,j as U,k as H,l as Q,m as J}from"./index-NM-69ELr.js";import{a as M}from"./CButton-CtKjPV20.js";import{C as B,a as q,b as Y,c as E,d as R}from"./CModalTitle-DJL1L4Gu.js";import{a as w,C as _}from"./CForm-irlHWoP0.js";import{C as p}from"./CFormInput-I2HVwpLx.js";import{C as D}from"./CFormSelect-CWJq5OYB.js";import{C as I}from"./CContainer-BtUNE6VJ.js";import{C as K}from"./CInputGroup-WaV9Ijsw.js";import{C as O}from"./CInputGroupText-vTj4mbjR.js";import{C as W,a as X,b as Z,c as ee}from"./CAccordionHeader-CVt0RQlF.js";import{C}from"./DefaultLayout-1ioHhC6-.js";import{C as ae}from"./CCard-yvBdmMdt.js";import{C as le}from"./CCardBody-CgPGZ8CB.js";import"./CCloseButton-CJAvPORm.js";import"./index.esm-Xnxbx9J7.js";import"./1-xAHH-UTp.js";import"./cil-user-Ddrdy7PS.js";const se=({onAddVehicle:l})=>{const[N,T]=t.useState(!1),[h,y]=t.useState(!1),[f,i]=t.useState(null),[g,c]=t.useState(null),[u,r]=t.useState(!1),s={idNum:Math.floor(Math.random()*1e6).toString(),brand:"",model:"",year:"",regisNumber:"",type:"",capacity:"",fuelType:"",currentMileage:"",status:"available"},[n,o]=t.useState(s),d=j=>{const{id:x,value:b}=j.target;o(v=>({...v,[x]:b}))},a=[{label:"Van",value:"van"},{label:"Pickup Truck",value:"pickup"},{label:"Box Truck",value:"box"},{label:"Straight Truck",value:"straight"},{label:"Semi-Trailer Trucks",value:"semi"},{label:"Refrigerated Trucks",value:"refrigerated"},{label:"Tanker Trucks",value:"tanker"},{label:"Flatbed Trucks",value:"flatbed"}],V=[{label:"Diesel",value:"Diesel"},{label:"Gasoline",value:"Gasoline"}],m=async j=>{j.currentTarget.checkValidity()===!1&&(j.preDefault(),j.stopPropagation()),T(!0),r(!0);try{const b=await A.post("/api/v1/vehicle",n);b.data.success&&(c("Vehicle added successfully"),l(b.data.data),setTimeout(()=>{c(null),o(s),r(!1),T(!1)},2e3))}catch(b){i(b.response.data.message),setTimeout(()=>{i(null)},2e3)}r(!1)},L=new Date().getFullYear(),S=1990;return e.jsx(e.Fragment,{children:u?e.jsx(k,{color:"primary",size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsxs(M,{color:"primary",variant:"outline",onClick:()=>y(!0),children:[e.jsx(F,{icon:G})," Add Vehicle"]}),e.jsxs(B,{visible:h,onClose:()=>y(!1),children:[e.jsx(q,{closeButton:!0,children:e.jsx(Y,{children:"Add Vehicle"})}),f&&e.jsx(w,{color:"danger",className:"m-3",children:f}),g&&e.jsx(w,{color:"success",className:"m-3",children:g}),e.jsx(E,{children:e.jsxs(_,{noValidate:!0,validated:N,children:[e.jsx(p,{className:"mb-3",floatingLabel:"ID Number",placeholder:"ID Number",type:"text",id:"idNum",label:"ID Number",value:n.idNum,disabled:!0}),e.jsx(p,{className:"mb-3",floatingLabel:"Brand",placeholder:"Brand",type:"text",id:"brand",label:"Brand",autoComplete:"off",required:!0,value:n.brand,onChange:d}),e.jsx(p,{className:"mb-3",floatingLabel:"Model",placeholder:"Model",type:"text",id:"model",label:"Model",autoComplete:"off",required:!0,value:n.model,onChange:d}),e.jsx(p,{type:"number",className:"mb-3",floatingLabel:"Year",placeholder:"Year",id:"year",value:n.year,required:!0,min:S,max:L,onChange:d,onBlur:j=>{const x=parseInt(j.target.value);x>=S&&x<=L&&!isNaN(x)||(alert(`Please enter a year between ${S} and ${L}`),o({...n,year:S}))}}),e.jsx(p,{className:"mb-3",floatingLabel:"Registration Number",placeholder:"Registration Number",type:"text",id:"regisNumber",label:"Registration Number",autoComplete:"off",required:!0,value:n.regisNumber,onChange:d}),e.jsx(D,{className:"mb-3",floatingLabel:"Vehicle Type",placeholder:"Vehicle Type",id:"type",value:n.type,required:!0,onChange:d,options:[{label:"Select Vehicle Type",value:""},...a]}),e.jsx(p,{className:"mb-2",type:"number",floatingLabel:"Capacity",placeholder:"Capacity",id:"capacity",label:"Capacity",autoComplete:"off",required:!0,min:"0",value:n.capacity,onChange:d}),e.jsx(D,{className:"mb-3",floatingLabel:"Fuel Type",placeholder:"Fuel Type",id:"fuelType",value:n.fuelType,required:!0,onChange:d,options:[{label:"Select Fuel Type",value:""},...V]}),e.jsx(p,{className:"mb-3",floatingLabel:"Current Mileage",placeholder:"Current Mileage",type:"number",id:"currentMileage",label:"Current Mileage",autoComplete:"off",required:!0,value:n.currentMileage,min:"0",max:"100000000000",onChange:d})]})}),e.jsxs(R,{children:[e.jsx(M,{color:"secondary",variant:"outline",disabled:u,onClick:()=>{y(!1),o(s),T(!1),i(null)},children:u?e.jsx(k,{color:"secondary",size:"sm"}):"Cancel"}),e.jsx(M,{color:"primary",variant:"outline",disabled:u,onClick:m,children:u?e.jsx(k,{color:"primary",size:"sm"}):"Save"})]})]})]})})},re=({vehicle:l,onDeleteVehicle:N})=>{const T=sessionStorage.getItem("accessToken"),y=z.create({baseURL:"http://localhost:5057",withCredentials:!0,headers:{"Content-Type":"application/json",...T&&{Authorization:`Bearer ${T}`}}}),[f,i]=t.useState(!1),[g,c]=t.useState(null),u=async()=>{i(!0);try{(await y.delete(`/api/v1/vehicle/${l._id}`)).status===200&&(alert("Vehicle deleted successfully"),i(!1),N(l._id),i(!1),c(null))}catch(r){c(r)}finally{i(!1)}};return g?e.jsxs(w,{color:"danger",className:"text-center mt-5 w-75 mx-auto",children:["Error: ",g.message]}):e.jsx(e.Fragment,{children:e.jsx(M,{color:"danger",variant:"outline",disabled:f,onClick:u,className:"me-2",children:f?e.jsx(k,{size:"sm"}):e.jsx(F,{icon:U})})})},te=({vehicle:l,onUpdateVehicle:N})=>{const[T,h]=t.useState(!1),[y,f]=t.useState(null),[i,g]=t.useState(null),[c,u]=t.useState(!1),[r,s]=t.useState(!1),n={idNum:l.idNum,brand:l.brand,model:l.model,year:l.year,regisNumber:l.regisNumber,type:l.type,capacity:l.capacity,fuelType:l.fuelType,currentMileage:l.currentMileage},[o,d]=t.useState(n),a=x=>{const{id:b,value:v}=x.target;d(P=>({...P,[b]:v}))},V=[{label:"Van",value:"van"},{label:"Pickup Truck",value:"pickup"},{label:"Box Truck",value:"box"},{label:"Straight Truck",value:"straight"},{label:"Semi-Trailer Trucks",value:"semi"},{label:"Refrigerated Trucks",value:"refrigerated"},{label:"Tanker Trucks",value:"tanker"},{label:"Flatbed Trucks",value:"flatbed"}],m=[{label:"Diesel",value:"Diesel"},{label:"Gasoline",value:"Gasoline"}],L=async x=>{u(!0),x.currentTarget.checkValidity()===!1&&x.stopPropagation(),s(!0);try{const v=await A.put(`/api/v1/vehicle/${l._id}`,o);v.data.success&&(f("Vehicle updated successfully"),N(v.data.data),setTimeout(()=>{f(null),u(!1),s(!1),h(!1)},2e3))}catch(v){g(v.response.data.message),setTimeout(()=>{g(null)},2e3)}finally{u(!1)}},S=new Date().getFullYear(),j=1990;return e.jsxs(e.Fragment,{children:[e.jsx(M,{color:"primary",variant:"outline",disabled:c,onClick:()=>h(!0),className:"me-2",children:c?e.jsx(k,{size:"sm"}):e.jsx(F,{icon:H})}),e.jsxs(B,{visible:T,onClose:()=>h(!1),children:[e.jsx(q,{closeButton:!0,children:e.jsx(Y,{children:"Update Vehicle"})}),i&&e.jsx(w,{color:"danger",className:"m-3",children:i}),y&&e.jsx(w,{color:"success",className:"m-3",children:y}),e.jsx(E,{children:e.jsxs(_,{noValidate:!0,validated:r,children:[e.jsx(p,{className:"mb-3",floatingLabel:"ID Number",placeholder:"ID Number",type:"text",id:"idNum",label:"ID Number",value:o.idNum,disabled:!0}),e.jsx(p,{className:"mb-3",floatingLabel:"Brand",placeholder:"Brand",type:"text",id:"brand",label:"Brand",required:!0,value:o.brand,onChange:a}),e.jsx(p,{className:"mb-3",floatingLabel:"Model",placeholder:"Model",type:"text",id:"model",label:"Model",required:!0,value:o.model,onChange:a}),e.jsx(p,{type:"number",className:"mb-3",floatingLabel:"Year",placeholder:"Year",id:"year",value:o.year,required:!0,min:j,max:S,onChange:a,onBlur:x=>{const b=parseInt(x.target.value);b>=j&&b<=S&&!isNaN(b)||(alert(`Please enter a year between ${j} and ${S}`),d({...o,year:j}))}}),e.jsx(p,{className:"mb-3",floatingLabel:"Registration Number",placeholder:"Registration Number",type:"text",id:"regisNumber",label:"Registration Number",required:!0,value:o.regisNumber,onChange:a}),e.jsx(D,{className:"mb-3",floatingLabel:"Vehicle Type",placeholder:"Vehicle Type",id:"type",value:o.type,required:!0,onChange:a,options:[{label:"Select Vehicle Type",value:""},...V]}),e.jsx(p,{className:"mb-2",type:"number",floatingLabel:"Capacity",placeholder:"Capacity",id:"capacity",label:"Capacity",required:!0,min:"0",value:o.capacity,onChange:a}),e.jsx(D,{className:"mb-3",floatingLabel:"Fuel Type",placeholder:"Fuel Type",id:"fuelType",label:"Fuel Type",value:o.fuelType,required:!0,onChange:a,options:[{label:"Select Fuel Type",value:""},...m]}),e.jsx(p,{className:"mb-3",floatingLabel:"Current Mileage",placeholder:"Current Mileage",type:"number",id:"currentMileage",label:"Current Mileage",required:!0,min:"0",max:"100000000000",value:o.currentMileage,onChange:a})]})}),e.jsxs(R,{children:[e.jsx(M,{color:"secondary",variant:"outline",disabled:c,onClick:()=>{h(!1),g(null),d(l),s(!1)},children:c?e.jsx(k,{size:"sm",color:"secondary"}):"Cancel"}),e.jsx(M,{color:"success",variant:"outline",disabled:c,onClick:L,children:c?e.jsx(k,{size:"sm",color:"success"}):"Save Changes"})]})]})]})},ne=({vehicle:l,error:N,loading:T,onDeleteVehicle:h,onUpdateVehicle:y})=>{const[f,i]=t.useState([]),g=$(),c=["manager","admin"],[u,r]=t.useState(null),[s,n]=t.useState("");t.useEffect(()=>{i(l)},[l]),t.useEffect(()=>{(()=>{if(s==="")i(l);else{const V=l.filter(m=>m.idNum.toString().includes(s)||m.brand.toLowerCase().includes(s.toLowerCase())||m.model.toLowerCase().includes(s.toLowerCase())||m.year.toString().includes(s)||m.type.toLowerCase().includes(s.toLowerCase())||m.regisNumber.toLowerCase().includes(s.toLowerCase())||m.capacity.toString().includes(s)||d.find(L=>L.value===m.status).label.toLowerCase().includes(s.toLowerCase()));i(V),V.length===0?r("No vehicles found"):r(null)}})()},[s,l]);const o=a=>{switch(a){case"available":return"green";case"in_use":return"red";case"maintenance":return"orange";case"inspection":return"yellow";default:return"black"}},d=[{value:"available",label:"Available"},{value:"in_use",label:"In Use"},{value:"maintenance",label:"Maintenance"},{value:"inactive",label:"Inactive"},{value:"inspection",label:"Inspection"}];return l.length===0?e.jsx(w,{color:"danger",className:"text-center justify-content-center",children:"No vehicles found"}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"mt-3",children:e.jsxs(K,{className:"w-50 mb-3",children:[e.jsx(p,{type:"text",placeholder:"Search vehicles",id:"search",value:s,onChange:a=>n(a.target.value),className:"w-50 me-2 "}),e.jsx(O,{children:e.jsx(F,{icon:Q})})]})}),e.jsx(W,{className:"m-2",children:f.map((a,V)=>e.jsxs(X,{children:[e.jsx(Z,{children:e.jsxs("p",{className:"w-100 m-1 ",children:["Registration Number:",e.jsx("strong",{className:"ms-2",children:a.regisNumber}),e.jsx(F,{icon:J,color:o(a.status),className:"m-2 float-end"}),e.jsx("small",{className:"m-2 float-end",children:d.find(m=>m.value===a.status).label})]})}),e.jsxs(ee,{children:[e.jsxs(C,{children:["ID: ",a.idNum]}),e.jsxs(C,{children:["Brand: ",a.brand]}),e.jsxs(C,{children:["Model: ",a.model]}),e.jsxs(C,{children:["Year: ",a.year]}),e.jsxs(C,{children:["Type: ",a.type]}),e.jsxs(C,{children:["Capacity: ",a.capacity]}),e.jsxs(C,{children:["Status: ",d.find(m=>m.value===a.status).label]}),e.jsxs(C,{children:["Driver:"," ",a.assignedDriver?`${a.assignedDriver.driverName} - ${a.assignedDriver.licenseNumber}`:"Not assigned"]}),e.jsxs(C,{children:["Fuel Type: ",a.fuelType]}),e.jsxs(C,{children:["Current Mileage: ",a.currentMileage]}),e.jsxs(I,{className:"d-flex justify-content-end mt-3",children:[e.jsx(te,{vehicle:a,onUpdateVehicle:y}),c.includes(g)&&e.jsx(re,{vehicle:a,onDeleteVehicle:h})]})]})]},a._id||V))}),u&&e.jsx(w,{color:"danger",className:"text-center justify-content-center",children:u})]})},Ve=()=>{const[l,N]=t.useState([]),[T,h]=t.useState(!0),[y,f]=t.useState(null),i=async()=>{h(!0);try{const r=await A.get("/api/v1/vehicle");r.status===200?(N(r.data.data),h(!1)):f(r.data.message)}catch(r){f(r.message)}finally{h(!1)}};t.useEffect(()=>{i()},[]);const g=r=>{N(s=>[...s,r])},c=r=>{N(s=>s.filter(n=>n._id!==r))},u=r=>{N(s=>s.map(n=>n._id===r._id?r:n),i())};return e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"text-center",children:"Vehicle Management"}),e.jsx(I,{className:"m-3",children:e.jsx(se,{onAddVehicle:g})}),e.jsxs(ae,{children:[e.jsx(C,{children:"Vehicle List"}),e.jsx(le,{className:"md-3",children:e.jsx(ne,{vehicle:l,error:y,onDeleteVehicle:c,onUpdateVehicle:u,loading:T})})]})]})};export{Ve as default};
