import{B as ee,r as n,j as e,k as Y,m as G,D as Ce,E as oe}from"./index-9q14rM7R.js";import{F as X,q as Se,g as De,e as ie,n as Ie,a as xe}from"./index-Dh_uSIGz.js";import{C as O}from"./CAlert-BY32Zm3C.js";import{a as U}from"./CButton-BT1rWau9.js";import{C as fe,a as ge,b as pe,c as ve,d as Ne}from"./CModalTitle-DFQUuEFe.js";import{C as be}from"./CForm-CCEBrrPn.js";import{C as we}from"./CFormSelect-BJGzYABc.js";import{C as Q}from"./CContainer-Bx_IidIf.js";import{C as J}from"./CInputGroup-VZBprtOO.js";import{C as F}from"./CFormInput-CiLBdQhH.js";import{C as le}from"./CInputGroupText-CtLay3vB.js";import{C as Le,a as Pe,b as Ee,c as Ae}from"./CAccordionHeader-DszraVUi.js";import{C as se,a as re,b as H,c as D,d as ae,e as I}from"./CTable-DAEx-CZU.js";import{C as de,a as V}from"./CPaginationItem-DpEMu8-b.js";import{C as Re}from"./CFormTextarea-BHFKWNEM.js";import{C as ce,a as ke}from"./DefaultLayout-Dd5iyPkL.js";import{C as We,a as qe,b as te,c as ne}from"./CTabList-DTKtNKCe.js";import{C as je}from"./CCard-B85_9HOU.js";import"./index.esm-Yn3Ds21R.js";import"./1-Gp7zrvLB.js";import"./cil-user-Ddrdy7PS.js";import"./getTransitionDurationFromElement-Cpu4p4hx.js";const Te=({warehousing:f,onDeleteItem:o})=>{const{showError:q,showSuccess:u}=ee(),[y,h]=n.useState(null),[L,P]=n.useState(!1),C=async()=>{P(!0);const g=await G.delete(`/api/v1/warehouse/delete/${f._id}`);g.data.success?(u(g.data.message),o(f._id),P(!1)):(P(!1),h(g.data.message),q(g.data.message))};return y?e.jsxs(O,{color:"danger",className:"text-center mt-5 w-75 mx-auto",children:["Error: ",y.message]}):e.jsx(e.Fragment,{children:e.jsx(U,{color:"danger",variant:"outline",onClick:C,className:"me-2",children:L?e.jsx(Y,{size:"sm"}):e.jsx(X,{icon:Se})})})},_e=({warehousing:f,onUpdateItem:o})=>{const{showSuccess:q,showErrors:u}=ee(),[y,h]=n.useState(null),[L,P]=n.useState(!1),[C,g]=n.useState(null),[A,x]=n.useState(!1),[R,T]=n.useState([]),[d,t]=n.useState({warehouse:f.warehouse||"",warehouseLocDetails:{warehouseName:f.warehouseName||"",address:f.address||""},byReceived:""});n.useEffect(()=>{(async()=>{try{const r=await G.get("/api/v1/warehouseLoc/locations");T(r.data.data)}catch(r){h(r.response.data.message),u(r.response.data.message)}})()},[]);const p=b=>{const r=b.target.value,j=R.find(m=>m._id===r);t(m=>({...m,warehouse:r,warehouseLocDetails:{warehouseName:j?j.warehouseName:"",address:j?j.address:""}}))},W=async b=>{b.preventDefault();const j=JSON.parse(sessionStorage.getItem("user")).email;if(!j){h("User email not found. Please log in again.");return}const m=R.find(s=>s._id===d.warehouse);if(!m){h("Warehouse not found.");return}d.warehouseLocDetails={warehouseName:m.warehouseName,address:m.address},P(!0);try{const s=await G.patch(`/api/v1/warehouse/update/${f._id}`,{...d,byReceived:j});if(s.data.success){const i=s.data.data,N=R.find(a=>a._id===i.warehouse);i.warehouse=N,q(s.data.message),o(s.data.data),setTimeout(()=>{g(null),x(!1)},2e3)}}catch(s){h(s.response.data.message),u(s.response.data.message),setTimeout(()=>{h(null)},2e3)}P(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(U,{color:"primary",variant:"outline",className:"me-2",onClick:()=>x(!0),children:L?e.jsx(Y,{size:"sm"}):e.jsx(X,{icon:De})}),e.jsxs(fe,{visible:A,onClose:()=>x(!1),children:[e.jsx(ge,{children:e.jsx(pe,{children:"Recieved Items"})}),y&&e.jsx(O,{color:"danger",children:y}),C&&e.jsx(O,{color:"success",children:C}),e.jsx(ve,{children:e.jsx(be,{children:e.jsxs(we,{id:"warehouse",floatingLabel:"Warehouse",className:"mb-3",value:d.warehouse,onChange:p,required:!0,children:[e.jsx("option",{value:"",children:"Select Warehouse"}),R.map(b=>e.jsxs("option",{value:b._id,children:[b.warehouseName," - ",b.address]},b._id))]})})}),e.jsxs(Ne,{children:[e.jsx(U,{color:"secondary",variant:"outline",onClick:()=>x(!1),children:"Close"}),e.jsx(U,{color:"primary",variant:"outline",onClick:W,children:"Update Item"})]})]})]})},Oe=({warehousing:f,loading:o,error:q,onDeleteItem:u,onUpdateItem:y})=>{const[h,L]=n.useState([]),[P,C]=n.useState(null),[g,A]=n.useState(""),x=Ce(),R=["manager","admin"],[T,d]=n.useState(1),[t]=n.useState(10),p=Math.ceil(h.length/t),W=h.filter(s=>s.received===!0),b=T*t,r=b-t,j=W.slice(r,b);n.useEffect(()=>{try{if(g===""){L(f),C(null);return}const s=g.toLowerCase().trim(),i=f.filter(N=>{var a,w,E,c,l,v,S,k,M,$,_,K,B,z;try{return((a=N.poNumber)==null?void 0:a.toLowerCase().includes(s))||((E=(w=N.warehouseLocDetails)==null?void 0:w.warehouseName)==null?void 0:E.toLowerCase().includes(s))||((l=(c=N.warehouseLocDetails)==null?void 0:c.address)==null?void 0:l.toLowerCase().includes(s))||((S=(v=N.vendor)==null?void 0:v.businessName)==null?void 0:S.toLowerCase().includes(s))||((M=(k=N.vendor)==null?void 0:k.businessAddress)==null?void 0:M.toLowerCase().includes(s))||((_=($=N.vendor)==null?void 0:$.contactNumber)==null?void 0:_.includes(s))||N.orderDate&&new Date(N.orderDate).toLocaleDateString().includes(s)||N.dateOfReceived&&new Date(N.receiveDate).toLocaleDateString().includes(s)||(((B=(K=N.byReceived)==null?void 0:K.toString().toLowerCase())==null?void 0:B.includes(s))??!1)||((z=N.details)==null?void 0:z.some(Z=>{var ue,he,me;return((ue=Z.description)==null?void 0:ue.toLowerCase().includes(s))||((he=Z.quantity)==null?void 0:he.toString().includes(s))||((me=Z.unitPrice)==null?void 0:me.toString().includes(s))}))}catch(Z){return console.error("Error filtering item:",Z),!1}});L(i),d(1),i.length===0?C("No data found"):C(null)}catch(s){console.error("Error in search effect:",s),C("Error occurred while searching")}},[g,f]);const m=s=>{A(s.target.value)};return o?e.jsx(Y,{color:"primary",className:"mt-5 w-15 mx-auto justify-content-center"}):f.length===0?e.jsx(O,{color:"warning",className:"text-center mt-5 w-75 mx-auto",children:"No data available"}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"mt-3",children:e.jsxs(J,{className:"w-50 mb-3",children:[e.jsx(F,{type:"text",placeholder:"Search by PO Number, Vendor, or Products...",value:g,id:"searchItem",onChange:m}),e.jsx(le,{children:e.jsx(X,{icon:ie})})]})}),o?e.jsx(Y,{color:"primary",className:"mt-5 w-15 mx-auto justify-content-center"}):f.length===0?e.jsx(O,{color:"warning",className:"text-center mt-5 w-75 mx-auto",children:"No data available"}):e.jsxs(e.Fragment,{children:[P&&e.jsx(O,{color:"danger",className:"text-center mt-5 w-75 mx-auto",children:P}),e.jsx(Le,{className:"m-2",children:j.filter(s=>s.received).map(s=>e.jsxs(Pe,{children:[e.jsx(Ee,{children:e.jsxs("div",{className:"d-flex justify-content-between w-100 align-items-center",children:[e.jsx("div",{children:e.jsxs("ul",{className:"list-unstyled",children:[e.jsxs("li",{children:["PO Number: ",e.jsx("strong",{children:s.poNumber})]}),e.jsxs("li",{children:["Warehuse Location: ",e.jsx("strong",{children:s.warehouse_id})]})]})}),e.jsxs("div",{className:"text-medium-emphasis",children:["Order Date: ",new Date(s.orderDate).toLocaleDateString()]})]})}),e.jsxs(Ae,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{children:"Vendor Information"}),e.jsxs("div",{className:"ms-3",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Name:"})," ",s.vendor.businessName]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Address:"})," ",s.vendor.businessAddress]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Contact:"})," ",s.vendor.contactNumber]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{children:"Shipping Details"}),e.jsxs("div",{className:"ms-3",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Carrier:"})," ",s.carrier]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Receive Date:"})," ",new Date(s.receiveDate).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{children:"Products"}),e.jsxs(se,{responsive:!0,small:!0,className:"mt-2",children:[e.jsx(re,{children:e.jsxs(H,{children:[e.jsx(D,{children:"Description"}),e.jsx(D,{children:"Quantity"}),e.jsx(D,{children:"Received By"}),e.jsx(D,{children:"Received Date"})]})}),e.jsx(ae,{children:s.details.map((i,N)=>e.jsxs(H,{children:[e.jsx(I,{children:i.description}),e.jsx(I,{children:i.quantity}),e.jsx(I,{children:s.byReceived}),e.jsx(I,{children:s.dateOfReceived?new Date(s.dateOfReceived).toLocaleDateString():"N/A"})]},N))})]})]}),s.additionalNotes&&e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{children:"Additional Notes"}),e.jsx("div",{className:"ms-3",children:s.additionalNotes})]}),e.jsxs(Q,{className:"d-flex justify-content-end mt-3",children:[e.jsx(_e,{warehousing:s,onUpdateItem:y}),R.includes(x)&&e.jsx(Te,{warehousing:s,onDeleteItem:u})]})]})]},s._id))}),j.length>0&&e.jsxs(Q,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:["Showing ",W.length>0?r+1:0," to"," ",Math.min(b,W.length)," of ",W.length," received entries"]}),e.jsxs(de,{className:"mt-3",children:[e.jsx(V,{disabled:T===1,onClick:()=>d(s=>Math.max(s-1,1)),children:"Previous"}),Array.from({length:p},(s,i)=>i+1).map(s=>e.jsx(V,{active:s===T,onClick:()=>d(s),children:s},s)),e.jsx(V,{disabled:T===p,onClick:()=>d(s=>Math.min(s+1,p)),children:"Next"})]})]})]})]})},Fe=({onAddItem:f,item:o={}})=>{var i,N,a,w,E;const{showSuccess:q,showError:u}=ee(),[y,h]=n.useState("Add Item"),[L,P]=n.useState(!1),[C,g]=n.useState(!1),[A,x]=n.useState(""),[R,T]=n.useState([]),d=new Date().toISOString().split("T")[0],[t,p]=n.useState({poNumber:o.poNumber||"",orderDate:o.orderDate||d,receiveDate:o.receiveDate||d,carrier:o.carrier||"",vendor:{businessName:((i=o==null?void 0:o.vendor)==null?void 0:i.businessName)||"",businessAddress:((N=o==null?void 0:o.vendor)==null?void 0:N.businessAddress)||"",contactNumber:((a=o==null?void 0:o.vendor)==null?void 0:a.contactNumber)||""},warehouse:o.warehouse||"",warehouseLocDetails:{warehouseName:((w=o==null?void 0:o.warehouseLocDetails)==null?void 0:w.warehouseName)||"",address:((E=o==null?void 0:o.warehouseLocDetails)==null?void 0:E.address)||""},details:o.details||[{productId:"",description:"",quantity:""}],procurementId:o.procurementId||"",rfqId:o.rfqId||null,vendorId:o.vendorId||"",additionalNotes:o.additionalNotes||"",byReceived:"",dateOfReceived:""}),W=c=>{const l=c.target.value,v=R.find(S=>S._id===l);p(S=>({...S,warehouse:l,warehouseLocDetails:{warehouseName:v?v.warehouseName:"",address:v?v.address:""}}))},b=(c,l,v)=>{p(S=>{const k=[...S.details];return k[c]={...k[c],[l]:v,...l==="quantity"||l==="unitPrice"?{subTotal:Number(l==="quantity"?v:k[c].quantity)*Number(l==="unitPrice"?v:k[c].unitPrice)}:{}},{...S,details:k}})},r=c=>{const{id:l,value:v}=c.target;if(l.includes(".")){const[S,k]=l.split(".");p(M=>({...M,[S]:{...M[S],[k]:v}}))}else p(S=>({...S,[l]:v}))},j=async c=>{try{return(await G.get(`/api/v1/warehouse/checkPoNumber/${c}`)).data.exists}catch(l){return console.error(l),!1}};n.useEffect(()=>{(async()=>{await j(o.poNumber)&&h("Already Added")})()},[o.poNumber]),n.useEffect(()=>{(async()=>{try{const l=await G.get("/api/v1/warehouseLoc/locations");T(l.data.data)}catch(l){x(l.response.data.message),u(l.response.data.message)}})()},[]);const m=()=>t.warehouse?!t.warehouseLocDetails.warehouseName||!t.warehouseLocDetails.address?(x("Warehouse location details are incomplete"),!1):!0:(x("Please select a warehouse"),!1),s=async c=>{var S,k,M,$;if(c.preventDefault(),!m())return;const v=JSON.parse(sessionStorage.getItem("user")).email;if(!v){x("User email not found. Please log in again.");return}if(!t.warehouse){x("Please select a warehouse");return}try{const _=R.find(z=>z._id===t.warehouse);if(!_){x("Selected warehouse not found");return}const K={...t,byReceived:v,dateOfReceived:new Date().toISOString().split("T")[0],warehouse:t.warehouse,warehouseLocDetails:{warehouseName:_.warehouseName,address:_.address}},B=await G.post("/api/v1/warehouse/addItem",K);B.data.success&&(f(B.data.data),g(!1),q("Item added successfully"),h("Already Added"))}catch(_){console.error("Error submitting form:",_),x(((k=(S=_.response)==null?void 0:S.data)==null?void 0:k.message)||"Error adding item"),u((($=(M=_.response)==null?void 0:M.data)==null?void 0:$.message)||"Error adding item")}};return e.jsxs(e.Fragment,{children:[e.jsx(U,{color:"primary",variant:"outline",onClick:()=>g(!0),disabled:y==="Already Added",children:y==="Already Added"?e.jsx("span",{className:"me-1",children:"Already Added"}):e.jsx(X,{icon:Ie})}),e.jsxs(fe,{visible:C,onClose:()=>g(!1),size:"lg",children:[e.jsx(ge,{children:e.jsx(pe,{children:"Add Receiving Item"})}),A&&e.jsx(O,{color:"danger",children:A}),L&&e.jsx(O,{color:"success",children:L}),e.jsx(ve,{children:e.jsxs(be,{children:[e.jsxs(J,{className:"mb-3",children:[e.jsx(F,{type:"text",id:"poNumber",floatingLabel:"PO Number",className:"mb-3",value:t.poNumber,onChange:r,required:!0,disabled:!0}),e.jsx(F,{type:"date",id:"orderDate",floatingLabel:"Order Date",className:"mb-3",value:t.orderDate.split("T")[0],onChange:r,required:!0,disabled:!0}),e.jsx(F,{type:"date",id:"receiveDate",floatingLabel:"Date to Receive",className:"mb-3",value:t.receiveDate.split("T")[0],onChange:r,required:!0,disabled:!0})]}),e.jsx(F,{type:"text",id:"vendor.businessName",floatingLabel:"Vendor Business Name",className:"mb-3",value:t.vendor.businessName,onChange:r,required:!0,disabled:!0}),e.jsx(J,{className:"mb-3",children:e.jsx(F,{type:"text",id:"vendor.businessAddress",floatingLabel:"Vendor Address",className:"mb-3",value:t.vendor.businessAddress,onChange:r,required:!0,disabled:!0})}),e.jsxs(J,{className:"mb-3",children:[e.jsx(F,{type:"text",id:"vendor.contactNumber",floatingLabel:"Vendor Contact Number",className:"mb-3",value:t.vendor.contactNumber,onChange:r,required:!0,disabled:!0}),e.jsx(F,{type:"text",id:"carrier",floatingLabel:"Carrier",className:"mb-3",value:t.carrier,onChange:r,required:!0,disabled:!0})]}),e.jsx(Re,{id:"additionalNotes",floatingLabel:"Additional Notes",className:"mb-3",value:t.additionalNotes,onChange:r,rows:3,disabled:!0}),e.jsxs("div",{className:"mb-3",children:[e.jsx(ce,{children:"Product Details"}),e.jsxs(se,{responsive:!0,children:[e.jsx(re,{children:e.jsxs(H,{children:[e.jsx(D,{children:"Description"}),e.jsx(D,{children:"Quantity"}),e.jsx(D,{children:"Unit Price "})]})}),e.jsx(ae,{children:t.details.map((c,l)=>e.jsxs(H,{children:[e.jsx(I,{children:e.jsx(F,{type:"text",id:"description",value:c.description,onChange:v=>b(l,"description",v.target.value),placeholder:"Product description",disabled:!0})}),e.jsx(I,{children:e.jsx(F,{type:"number",id:"quantity",value:c.quantity,onChange:v=>b(l,"quantity",v.target.value),placeholder:"Qty",disabled:!0})}),e.jsx(I,{children:e.jsx(U,{color:"danger",size:"sm",onClick:()=>removeProductRow(l),disabled:t.details.length===1,children:"Remove"})})]},l))})]})]}),e.jsxs(we,{id:"warehouse",floatingLabel:"Warehouse",className:"mb-3",value:t.warehouse,onChange:W,required:!0,children:[e.jsx("option",{value:"",children:"Select Warehouse"}),R.map(c=>e.jsxs("option",{value:c._id,children:[c.warehouseName," - ",c.address]},c._id))]})]})}),e.jsxs(Ne,{children:[e.jsx(U,{color:"secondary",onClick:()=>g(!1),children:"Close"}),e.jsx(U,{color:"primary",onClick:s,children:"Save"})]})]})]})},Me=({onAddItem:f})=>{const{showError:o,showSuccess:q}=ee(),[u,y]=n.useState([]),[h,L]=n.useState(1),[P,C]=n.useState(null),[g,A]=n.useState(!0),[x,R]=n.useState(""),[T,d]=n.useState([]),[t,p]=n.useState([]),W=10;n.useEffect(()=>{(async()=>{try{const w=await oe.get("https://log2_backend.chysev.cloud/api/v1/purchaseOrder");w.status===200&&y(w.data)}catch(w){console.error("Error fetching data:",w)}})()},[]);const b=a=>{oe.put(`https://log2_backend.chysev.cloud/api/v1/purchaseOrder/${a}`,{received:!0,receiveDate:new Date().toISOString()}).status===200&&fetchReicevingItems()};if(n.useEffect(()=>{(async()=>{var w,E;try{const c=await G.get("/api/v1/warehouseLoc/locations");c.data.data&&(p(c.data.data),q(c.data.message))}catch(c){C((w=c==null?void 0:c.response)==null?void 0:w.data.message),o(((E=c==null?void 0:c.response)==null?void 0:E.data.message)||"Error fetching warehouses")}})()},[]),n.useEffect(()=>{A(!1)},[]),n.useEffect(()=>{if(x===""){y(u);return}const a=x.toLowerCase().trim(),w=u.filter(E=>{var c,l,v,S,k,M,$,_,K;try{return((c=E.poNumber)==null?void 0:c.toLowerCase().includes(a))||((v=(l=E.vendor)==null?void 0:l.businessName)==null?void 0:v.toLowerCase().includes(a))||((k=(S=E.vendor)==null?void 0:S.businessAddress)==null?void 0:k.toLowerCase().includes(a))||(($=(M=E.vendor)==null?void 0:M.contactNumber)==null?void 0:$.toLowerCase().includes(a))||((_=E.carrier)==null?void 0:_.toLowerCase().includes(a))||E.orderDate&&new Date(E.orderDate).toLocaleDateString().includes(a)||E.receiveDate&&new Date(E.receiveDate).toLocaleDateString().includes(a)||((K=E.details)==null?void 0:K.some(B=>{var z;return(z=B.description)==null?void 0:z.toLowerCase().includes(a)}))}catch(B){return console.error("Error filtering data:",B),!1}});y(w),L(1),C(w.length===0?"No results found":null)},[x]),g)return e.jsx(Y,{color:"primary",className:"mt-5 w-15 mx-auto justify-content-center"});const r=h*W,j=r-W,m=u.slice(j,r),s=Math.ceil(u.length/W),i=a=>{R(a.target.value)};return u.length>0&&u.every(a=>a.received===!0)?e.jsx(O,{color:"success",className:"text-center mt-3 w-75 mx-auto",children:"All items have been received."}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"mt-3",children:e.jsxs(J,{className:"w-50 mb-3",children:[e.jsx(F,{type:"text",placeholder:"Search by PO Number, Supplier, or Item Name",value:x,id:"searchInput",onChange:i}),e.jsx(le,{children:e.jsx(X,{icon:ie})})]})}),e.jsxs(se,{hover:!0,responsive:!0,children:[e.jsx(re,{children:e.jsxs(H,{children:[e.jsx(D,{children:"PO Number"}),e.jsx(D,{children:"Order Date"}),e.jsx(D,{children:"Date to Receive"}),e.jsx(D,{children:"Carrier"}),e.jsx(D,{children:"Warehouse"}),e.jsx(D,{children:"Vendor"}),e.jsx(D,{children:"Products"}),e.jsx(D,{children:"Receive"}),e.jsx(D,{children:"Actions"})]})}),e.jsx(ae,{children:m.filter(a=>!a.received).map(a=>e.jsxs(H,{children:[e.jsx(I,{children:a.poNumber}),e.jsx(I,{children:new Date(a.orderDate).toLocaleDateString()}),e.jsx(I,{children:new Date(a.receiveDate).toLocaleDateString()}),e.jsx(I,{children:a.carrier}),e.jsx(I,{children:a.warehouse_id}),e.jsxs(I,{children:[e.jsx("div",{children:a.vendor.businessName}),e.jsx("small",{className:"text-medium-emphasis",children:a.vendor.contactNumber})]}),e.jsx(I,{children:a.details.map(w=>e.jsxs("div",{children:[w.description," ( pcs: ",w.quantity," x"," ",w.unitPrice.toFixed(2)," )"]},w.productId))}),e.jsx(I,{children:a.received?"Yes":"No"}),e.jsxs(I,{children:[e.jsx(Fe,{item:a,onAddItem:f,mockDataReiceving:u}),e.jsx(U,{color:"primary",className:"mt-2",onClick:()=>b(a._id),children:"Complete"})]})]},a._id))})]}),u.filter(a=>!a.received).length>0&&e.jsxs(Q,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs(Q,{children:["Showing ",j+1," to ",Math.min(r,u.length)," of"," ",u.length," entries"]}),e.jsxs(de,{className:"mt-3",children:[e.jsx(V,{disabled:h===1,onClick:()=>L(a=>Math.max(a-1,1)),children:"Previous"}),[...Array(s).keys()].map(a=>e.jsx(V,{active:a+1===h,onClick:()=>L(a+1),children:a+1},a+1)),e.jsx(V,{disabled:h===s,onClick:()=>L(a=>Math.min(a+1,s)),children:"Next"})]})]}),P&&e.jsx(O,{color:"danger",className:"text-center mt-5 w-75 mx-auto justify-content-center",children:P})]})},Qe=({items:f,loading:o,error:q})=>{const[u,y]=n.useState([]),[h,L]=n.useState(""),[P,C]=n.useState(null),g=10,[A,x]=n.useState(1),R=r=>{switch(r){case"Stocked":return"success";case"Out of Stock":return"danger";default:return"secondary"}};n.useEffect(()=>{y(f)},[f]),n.useEffect(()=>{if(h==="")y(f),C(null);else{const r=f.filter(j=>{const m=j.itemName.toLowerCase().includes(h.toLowerCase()),s=j.locations.some(i=>{const N=i.warehouse;return N.warehouseName.toLowerCase().includes(h.toLowerCase())||N.address.toLowerCase().includes(h.toLowerCase())});return m||s});y(r),x(1),r.length===0?C("No results found"):C(null)}},[h,f]);const T=r=>{L(r.target.value)},d=r=>{if(!r||!Array.isArray(r))return[];const j=new Map;return r.forEach(m=>{if(!(m!=null&&m.warehouse))return;const s=m.warehouse._id||"deleted";if(!j.has(s))j.set(s,{warehouse:{...m.warehouse,deleted:m.warehouse.deleted||!m.warehouse._id},quantity:m.quantity||0});else{const i=j.get(s);i.quantity+=m.quantity||0,j.set(s,i)}}),Array.from(j.values())};if(o)return e.jsx(Y,{color:"primary",className:"text-center mt-5 w-75 mx-auto justify-content-center"});if(q)return e.jsxs(O,{color:"danger",className:"text-center mt-5 w-75 mx-auto justify-content-center",children:["Error: ",q]});const t=A*g,p=t-g,W=u.slice(p,t),b=Math.ceil(u.length/g);return e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"m-3",children:e.jsxs(J,{className:"w-50 mb-3",children:[e.jsx(F,{type:"text",id:"search",value:h,onChange:T,placeholder:"Search by item name or warehouse..."}),e.jsx(le,{children:e.jsx(X,{icon:ie})})]})}),e.jsxs("strong",{className:"m-3 align-self-start",children:["Total Items: ",W.length]}),P?e.jsx(O,{color:"warning",children:P}):e.jsxs(se,{hover:!0,responsive:!0,striped:!0,className:"text-center",children:[e.jsx(re,{children:e.jsxs(H,{children:[e.jsx(D,{scope:"col",children:"Item Name"}),e.jsx(D,{scope:"col",children:"Total Quantity"}),e.jsx(D,{scope:"col",children:"Warehouse Locations"}),e.jsx(D,{scope:"col",children:"Status"})]})}),e.jsx(ae,{children:W.map((r,j)=>e.jsxs(H,{children:[e.jsx(I,{children:r.itemName}),e.jsx(I,{children:e.jsx("strong",{children:r.quantity})}),e.jsx(I,{children:e.jsx(Q,{className:"locations-list",children:d(r.locations).map((m,s)=>{const i=m.warehouse;return e.jsx(Q,{className:"location-item",children:e.jsxs(Q,{className:"location-details",children:[e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("span",{className:"warehouse-name",children:(i==null?void 0:i.warehouseName)||"Unknown Warehouse"}),e.jsx(xe,{color:i!=null&&i.deleted?"danger":"success",className:"ms-2",children:i!=null&&i.deleted?"Deleted":"Active"})]}),e.jsx("span",{className:"warehouse-address",children:(i==null?void 0:i.address)||"No address available"}),e.jsxs("span",{className:"quantity-badge",children:["Qty: ",m.quantity]})]})},(i==null?void 0:i._id)||`deleted-${s}`)})})}),e.jsx(I,{children:e.jsx(xe,{color:R(r.status||(r.quantity>0?"Stocked":"Out of Stock")),children:r.status||(r.quantity>0?"Stocked":"Out of Stock")})})]},r._id||j))})]}),u.length===0&&!P&&e.jsx(O,{color:"warning",className:"text-center mt-5 w-75 mx-auto",children:"No items found."}),e.jsxs(de,{align:"center",children:[e.jsx(V,{disabled:A===1,onClick:()=>x(r=>Math.max(r-1,1)),children:"Previous"}),[...Array(b).keys()].map(r=>e.jsx(V,{active:r+1===A,onClick:()=>x(r+1),children:r+1},r+1)),e.jsx(V,{disabled:A===b,onClick:()=>x(r=>Math.min(r+1,b)),children:"Next"})]})]})},Be=`
  .locations-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .location-item {
    display: flex;
    flex-direction: column;
    padding: 8px;
    background-color: #f8f9fa;
    border-radius: 4px;
    width: fit-content;

  }

  .location-details {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 4px;
  }

  .warehouse-name {
    font-weight: 500;
    color: #495057;
  }

  .warehouse-address {
    color: #6c757d;
    font-size: 0.9em;
    font-style: italic;
  }

  .quantity-badge {
    background-color: #e9ecef;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 0.85em;
    color: #495057;
  }

`,ye=document.createElement("style");ye.innerText=Be;document.head.appendChild(ye);const us=()=>{const[f,o]=n.useState([]),[q,u]=n.useState([]),[y,h]=n.useState(!1),[L,P]=n.useState(null),[C,g]=n.useState(0);n.useEffect(()=>{(async()=>{h(!0);try{const t=await oe.get("https://log2_backend.chysev.cloud/api/v1/purchaseOrder");console.log(t.data),t.status===200&&o(t.data)}catch(t){P(t.message)}finally{h(!1)}})()},[C]);const A=()=>{g(d=>d+1)},x=d=>{o(t=>[...t,d]),u(t=>[...t,d]),A()},R=d=>{o(t=>t.filter(p=>p._id!==d)),u(t=>t.filter(p=>p._id!==d)),A()},T=d=>{o(t=>t.map(p=>p._id===d._id?d:p)),u(t=>t.map(p=>p._id===d._id?d:p)),A()};return e.jsx(e.Fragment,{children:e.jsxs(We,{activeItemKey:"Warehouse Items Details",children:[e.jsxs(qe,{variant:"tabs",children:[e.jsx(te,{itemKey:"Warehouse Items Details",children:"Warehouse Items Details"}),e.jsx(te,{itemKey:"For Reiceve",children:"For Reiceve"}),e.jsx(te,{itemKey:"Items",children:"Items"})]}),e.jsxs(ke,{children:[e.jsx(ne,{className:"p-3",itemKey:"Warehouse Items Details",children:e.jsx(Oe,{warehousing:f,loading:y,error:L,onDeleteItem:R,onUpdateItem:T})}),e.jsx(ne,{className:"p-3",itemKey:"For Reiceve",children:e.jsxs(je,{children:[e.jsx(ce,{children:"Item Reiceving"}),e.jsx(Me,{onAddItem:x})]})}),e.jsx(ne,{className:"p-3",itemKey:"Items",children:e.jsxs(je,{children:[e.jsx(ce,{children:"Items"}),e.jsx(Qe,{items:q,loading:y,error:L})]})})]})]})})};export{us as default};
