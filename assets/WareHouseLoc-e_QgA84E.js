import{r as a,_ as pe,u as ge,a as k,R as E,C as xe,c as je,P as g,d as Ce,G as ve,l as Q,j as e,k as P,n as _,D as be}from"./index-oK4_cjtr.js";import{r as ye,F as z,u as Ne,l as Se,k as we}from"./index-BXjDqJpC.js";import{a as W}from"./CButton-BuIKmGst.js";import{C as re,a as oe,b as ne,c as ie}from"./CModalHeader-AU35Eh-T.js";import{C as ce}from"./CModalTitle-B_CKYWk0.js";import{C as I}from"./CAlert-BM2-mCId.js";import{C as le}from"./CForm-C88K1vIg.js";import{C as A}from"./CFormInput-CdVQ9r3w.js";import{C as G}from"./CContainer-BpfzISMU.js";import{C as Le}from"./CInputGroup-BzIC-QP3.js";import{C as Pe}from"./CInputGroupText-BceKQr5W.js";import{C as ke}from"./CCard-BrEz3-r-.js";import{e as se,u as Te,C as de}from"./DefaultLayout-DUQjdB1T.js";import{C as Ee}from"./CCardBody-BLfd61Yo.js";import{C as We,a as Ie,b as ae,c as D,d as Fe,e as O}from"./CTable-Z6T-8I6R.js";import{g as Me}from"./getTransitionDurationFromElement-Cpu4p4hx.js";import{C as Ae,a as J}from"./CPaginationItem-BZstXv7Q.js";import"./index.esm-DJhTDB-G.js";import"./1-CafIYk1U.js";import"./cil-user-Ddrdy7PS.js";var te=function(s){typeof s=="function"&&s()},Re=function(s){s.dispatchEvent(new Event("transitionend"))},He=function(s,d,y){if(y===void 0&&(y=!0),!y){te(s);return}var v=5,j=Me(d)+v,n=!1,h=function(o){var u=o.target;u===d&&(n=!0,d.removeEventListener("transitionend",h),te(s))};d.addEventListener("transitionend",h),setTimeout(function(){n||Re(d)},j)},Ve=function(s,d){switch(s){case"right":return se(d)?"left":"right";case"left":return se(d)?"right":"left";default:return s}},M=a.forwardRef(function(s,d){var y=s.children,v=s.animation,j=v===void 0?!0:v,n=s.className,h=s.container,o=s.content,u=s.delay,p=u===void 0?0:u,t=s.fallbackPlacements,i=t===void 0?["top","right","bottom","left"]:t,c=s.offset,N=c===void 0?[0,6]:c,b=s.onHide,S=s.onShow,w=s.placement,T=w===void 0?"top":w,L=s.popperConfig,m=s.trigger,x=m===void 0?["hover","focus"]:m,l=s.visible,r=pe(s,["children","animation","className","container","content","delay","fallbackPlacements","offset","onHide","onShow","placement","popperConfig","trigger","visible"]),C=a.useRef(null),f=a.useRef(null),U=ge(d,C),R="tooltip".concat(a.useId()),$=a.useState(!1),H=$[0],K=$[1],X=a.useState(l),F=X[0],Y=X[1],q=Te(),ue=q.initPopper,fe=q.destroyPopper,me=q.updatePopper,Z=typeof p=="number"?{show:p,hide:p}:p,ee={modifiers:[{name:"arrow",options:{element:".tooltip-arrow"}},{name:"flip",options:{fallbackPlacements:i}},{name:"offset",options:{offset:N}}],placement:Ve(T,f.current)},he=k(k({},ee),typeof L=="function"?L(ee):L);a.useEffect(function(){if(l){V();return}B()},[l]),a.useEffect(function(){if(H&&f.current&&C.current){ue(f.current,C.current,he),setTimeout(function(){Y(!0)},Z.show);return}!H&&f.current&&C.current&&fe()},[H]),a.useEffect(function(){!F&&f.current&&C.current&&He(function(){K(!1)},C.current)},[F]);var V=function(){K(!0),S&&S()},B=function(){setTimeout(function(){Y(!1),b&&b()},Z.hide)};return a.useEffect(function(){me()},[o]),E.createElement(E.Fragment,null,E.cloneElement(y,k(k(k(k(k({},F&&{"aria-describedby":R}),{ref:f}),(x==="click"||x.includes("click"))&&{onClick:function(){return F?B():V()}}),(x==="focus"||x.includes("focus"))&&{onFocus:function(){return V()},onBlur:function(){return B()}}),(x==="hover"||x.includes("hover"))&&{onMouseEnter:function(){return V()},onMouseLeave:function(){return B()}})),E.createElement(xe,{container:h,portal:!0},H&&E.createElement("div",k({className:je("tooltip","bs-tooltip-auto",{fade:j,show:F},n),id:R,ref:U,role:"tooltip"},r),E.createElement("div",{className:"tooltip-arrow"}),E.createElement("div",{className:"tooltip-inner"},o))))});M.propTypes={animation:g.bool,children:g.node,container:g.any,content:g.oneOfType([g.string,g.node]),delay:g.oneOfType([g.number,g.shape({show:g.number.isRequired,hide:g.number.isRequired})]),fallbackPlacements:ve,offset:g.any,onHide:g.func,onShow:g.func,placement:g.oneOf(["auto","top","right","bottom","left"]),popperConfig:g.oneOfType([g.func,g.object]),trigger:Ce,visible:g.bool};M.displayName="CTooltip";const Be=({onAddWarehouseLoc:s})=>{const{showSuccess:d,showError:y}=Q(),[v,j]=a.useState(!1),[n,h]=a.useState(!1),[o,u]=a.useState(!1),[p,t]=a.useState(null),[i,c]=a.useState(null),N={warehouseName:"",address:""},[b,S]=a.useState(N),w=m=>{const{id:x,value:l}=m.target;S(r=>({...r,[x]:l}))},T=async m=>{const l=m.currentTarget.checkValidity();if(l||(m.preventDefault(),m.stopPropagation()),j(l),l){const C=JSON.parse(sessionStorage.getItem("user")).email;if(!C){t("User email not found. Please log in again.");return}u(!0);try{const f=await _.post("api/v1/warehouseLoc/add",{...b,createdBy:C});f.data.success&&(d(f.data.message),s(f.data.data),setTimeout(()=>{u(!1),h(!1),t(null),S(N),j(!1)},2e3))}catch(f){t(f.response.data.message),y(f.response.data.message),setTimeout(()=>{t(null)},2e3)}u(!1)}},L=({icon:m})=>{const[x,l]=a.useState(!1);return e.jsx(z,{icon:m,bounce:x,onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1)})};return e.jsx(e.Fragment,{children:o?e.jsx(P,{color:"primary",size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsxs(W,{color:"primary",variant:"outline",disabled:o,onClick:()=>h(!0),children:[o?e.jsx(P,{color:"secondary",size:"sm"}):e.jsx(L,{icon:ye})," Add Warehouse Location"]}),e.jsxs(re,{visible:n,onClose:()=>h(!1),children:[e.jsx(oe,{closeButton:!0,children:e.jsx(ce,{children:"Add Warehouse Location"})}),p&&e.jsx(I,{color:"danger",className:"m-3",children:p}),i&&e.jsx(I,{color:"success",className:"m-3",children:i}),e.jsx(ne,{children:e.jsxs(le,{noValidate:!0,validated:v,children:[e.jsx(A,{type:"text",id:"warehouseName",className:"mb-3",placeholder:"Warehouse Name",floatingLabel:"Warehouse Name",onChange:w,value:b.warehouseName,autoComplete:"off",required:!0,feedbackInvalid:"Please enter a warehouse name",feedbackValid:"Looks good!"}),e.jsx(A,{type:"text",id:"address",className:"mb-3",placeholder:"Address",floatingLabel:"Address",onChange:w,value:b.address,autoComplete:"off",required:!0,feedbackInvalid:"Please enter an address",feedbackValid:"Looks good!"})]})}),e.jsxs(ie,{children:[e.jsx(W,{color:"secondary",variant:"outline",disabled:o,onClick:()=>{h(!1),S(N),h(!1),t(null),j(!1)},children:o?e.jsx(P,{color:"secondary",size:"sm"}):"Cancel"}),e.jsx(W,{color:"primary",variant:"outline",disabled:o,onClick:T,children:o?e.jsx(P,{color:"primary",size:"sm"}):"Add"})]})]})]})})},De=({warehouseLoc:s,onDeleteWarehouseLoc:d})=>{const{showSuccess:y,showError:v}=Q(),[j,n]=a.useState(!1),[h,o]=a.useState(null),u=async()=>{n(!0);try{const t=await _.patch(`api/v1/warehouseLoc/delete/${s._id}`);t.data.success&&(y(t.data.message),d(s._id),n(!1),o(null))}catch(t){o(t),v(t.message)}finally{n(!1)}};if(h)return e.jsxs(I,{color:"danger",className:"text-center mt-5 w-75 mx-auto",children:["Error: ",h.message]});const p=({icon:t})=>{const[i,c]=a.useState(!1);return e.jsx(z,{icon:t,bounce:i,onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1)})};return e.jsx(e.Fragment,{children:e.jsxs(W,{color:"danger",disabled:j,variant:"outline",onClick:u,className:"me-2",children:[j?e.jsx(P,{size:"sm"}):e.jsx(p,{icon:Ne})," Delete"]})})},Oe=({warehouseLoc:s,onUpdateWarehouseLoc:d})=>{const{showSuccess:y,showErrors:v}=Q(),[j,n]=a.useState(!1),[h,o]=a.useState(!1),[u,p]=a.useState(!1),[t,i]=a.useState(null),[c,N]=a.useState(null),[b,S]=a.useState({warehouseName:s.warehouseName,address:s.address}),w=m=>{const{id:x,value:l}=m.target;S(r=>({...r,[x]:l}))},T=async m=>{const l=m.currentTarget.checkValidity();l||(m.preventDefault(),m.stopPropagation()),o(l);const C=JSON.parse(sessionStorage.getItem("user")).email;if(!C){i("User email not found. Please log in again.");return}p(!0);try{const f=await _.put(`api/v1/warehouseLoc/update/${s._id}`,{...b,createdBy:C});f.data.success&&(y(f.data.message),d(f.data.data),setTimeout(()=>{N(null),n(!1),i(null),o(!1)},2e3))}catch(f){i(f.response.data.message),v(f.response.data.message),setTimeout(()=>{i(null)},2e3)}p(!1)},L=({icon:m})=>{const[x,l]=a.useState(!1);return e.jsx(z,{icon:m,bounce:x,onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1)})};return e.jsxs(e.Fragment,{children:[e.jsxs(W,{color:"primary",variant:"outline",disabled:u,onClick:()=>n(!0),className:"me-2",children:[u?e.jsx(P,{size:"sm"}):e.jsx(L,{icon:Se})," Update"]}),e.jsxs(re,{visible:j,onClose:()=>n(!1),children:[e.jsx(oe,{closeButton:!0,children:e.jsx(ce,{children:"Update Warehouse Location"})}),t&&e.jsx(I,{color:"danger",className:"m-3",children:t}),c&&e.jsx(I,{color:"success",className:"m-3",children:c}),e.jsx(ne,{children:e.jsxs(le,{noValidate:!0,validated:h,children:[e.jsx(A,{type:"text",id:"warehouseName",className:"mb-3",placeholder:"Warehouse Name",floatingLabel:"Warehouse Name",onChange:w,value:b.warehouseName,autoComplete:"off",required:!0,feedbackInvalid:"Please enter a warehouse name.",feedbackValid:"Looks good!"}),e.jsx(A,{type:"text",id:"address",className:"mb-3",placeholder:"Address",floatingLabel:"Address",onChange:w,value:b.address,autoComplete:"off",required:!0,feedbackInvalid:"Please enter an address.",feedbackValid:"Looks good!"})]})}),e.jsxs(ie,{children:[e.jsx(W,{color:"secondary",variant:"outline",disabled:u,onClick:()=>{n(!1),i(null),o(!1)},children:u?e.jsx(P,{size:"sm",color:"secondary"}):"Cancel"}),e.jsx(W,{color:"primary",variant:"outline",disabled:u,onClick:T,children:u?e.jsx(P,{size:"sm",color:"success"}):"Update"})]})]})]})},_e=({warehouseLoc:s,loading:d,error:y,onDeleteWarehouseLoc:v,onUpdateWarehouseLoc:j})=>{const[n,h]=a.useState(""),[o,u]=a.useState([]),[p,t]=a.useState(1),[i,c]=a.useState(null),N=10,b=be(),S=["manager","admin"],w="admin";if(a.useEffect(()=>{u(s)},[s]),a.useEffect(()=>{if(n==="")u(s);else{const r=s.filter(C=>{const f=C.warehouseName.toLowerCase().includes(n.toLowerCase()),U=C.address.toLowerCase().includes(n.toLowerCase()),R=S.includes(b)&&C.createdBy.toLowerCase().includes(n.toLowerCase());return f||U||R});u(r),t(1),r.length===0?c("No results found"):c(null)}},[n,s]),s.length===0)return e.jsx(I,{color:"danger",className:"text-center mt-5 w-75 mx-auto justify-content-center",children:"No Warehouse Location Found"});const T=r=>{h(r.target.value)},L=p*N,m=L-N,x=o.slice(m,L),l=Math.ceil(o.length/N);return d?e.jsx(P,{color:"primary",className:"text-center mt-5 w-75 mx-auto",children:"Loading Warehouse Location..."}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"m-3",children:e.jsxs(Le,{className:"w-50 mb-3",children:[e.jsx(A,{type:"text",id:"search",value:n,onChange:T,placeholder:"Search Warehouse Location..."}),e.jsx(Pe,{children:e.jsx(z,{icon:we})})]})}),e.jsxs(ke,{children:[e.jsx(de,{children:"Warehouse Location List"}),e.jsxs(Ee,{className:"md-3",children:[e.jsxs(We,{bordered:!0,hover:!0,responsive:!0,className:"mx-auto ",children:[e.jsx(Ie,{className:"text-center",children:e.jsxs(ae,{children:[e.jsx(D,{className:"fixed-width bg-secondary",children:"Warehouse Name"}),e.jsx(D,{className:"fixed-width bg-secondary",children:"Address"}),w.includes(b)&&e.jsx(D,{className:"fixed-width bg-secondary",children:"Created By"}),e.jsx(D,{className:"fixed-width bg-secondary",children:"Actions"})]})}),e.jsx(Fe,{className:"text-center",children:x.map(r=>e.jsxs(ae,{children:[e.jsx(O,{className:"fixed-width",children:e.jsx(M,{content:r.warehouseName,children:e.jsx("span",{children:r.warehouseName})})}),e.jsx(O,{className:"fixed-width",children:e.jsx(M,{content:r.address,children:e.jsx("span",{children:r.address})})}),w.includes(b)&&e.jsx(O,{className:"fixed-width",color:"danger",children:e.jsx(M,{content:r.createdBy,children:e.jsx("span",{children:r.createdBy})})}),e.jsxs(O,{className:"fixed-width",children:[e.jsx(Oe,{warehouseLoc:r,onUpdateWarehouseLoc:j}),S.includes(b)&&e.jsx(De,{warehouseLoc:r,onDeleteWarehouseLoc:v})]})]},r._id))})]}),o.length>0&&e.jsxs(G,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs(G,{children:["Showing ",m+1," to"," ",Math.min(L,o.length)," of"," ",o.length," entries"]}),e.jsxs(Ae,{className:"mt-3",children:[e.jsx(J,{disabled:p===1,onClick:()=>t(r=>Math.max(r-1,1)),children:"Previous"}),[...Array(l).keys()].map(r=>e.jsx(J,{active:r+1===p,onClick:()=>t(r+1),children:r+1},r+1)),e.jsx(J,{disabled:p===l,onClick:()=>t(r=>Math.min(r+1,l)),children:"Next"})]})]}),i&&e.jsx(I,{color:"danger",className:"text-center mt-5 w-75 mx-auto justify-content-center",children:i})]})]})]})};sessionStorage.getItem("accessToken");const ls=()=>{const[s,d]=a.useState([]),[y,v]=a.useState(!1),[j,n]=a.useState(null),h=async()=>{var t,i;v(!0);try{const c=await _.get("api/v1/warehouseLoc/locations");c.status===200?d(c.data.data):n(c.data.message)}catch(c){n(((i=(t=c.response)==null?void 0:t.data)==null?void 0:i.message)||c.message)}finally{v(!1)}};a.useEffect(()=>{h()},[]);const o=t=>{d(i=>[...i,t])},u=t=>{d(i=>i.filter(c=>c._id!==t))},p=t=>{d(i=>i.map(c=>c._id===t._id?t:c))};return e.jsxs(e.Fragment,{children:[e.jsx(de,{children:"Warehouse location"}),e.jsx(Be,{onAddWarehouseLoc:o}),e.jsx(_e,{warehouseLoc:s,loading:y,error:j,onDeleteWarehouseLoc:u,onUpdateWarehouseLoc:p})]})};export{ls as default};
