import{l as X,r as o,j as e,k as z,n as G,A as he}from"./index-Csb6LGYQ.js";import{s as ve,F as O,t as Se,m as pe,a as q,u as ge,v as De,w as Ee}from"./index-DR__Bmlu.js";import{a as A}from"./CButton-xYfsFmXD.js";import{C as ne,a as le,b as ie,c as oe}from"./CModalHeader-Ddas35qS.js";import{C as xe}from"./CModalTitle-BDh5wlQf.js";import{C as H}from"./CAlert-C3In0CUE.js";import{C as fe}from"./CForm-BxUbakQG.js";import{C as K}from"./CInputGroup-CffURYMu.js";import{C as V}from"./CFormInput-f2a8oeA-.js";import{C as W}from"./CFormSelect-C1r65ghA.js";import{C as B}from"./CContainer-B-zbMWDF.js";import{C as je}from"./CInputGroupText-DDMJ-5MD.js";import{C as be,a as ye,b as Ce,c as Ne}from"./CAccordionHeader-CR-17YZq.js";import{C as T,F as Te,a as Ve}from"./DefaultLayout-BselYkSR.js";import{C as _e,a as ee}from"./CPaginationItem-B4fcx8ha.js";import*as M from"xlsx";import{C as se}from"./index.esm-DK3JKpBW.js";import{a as de,C as ue}from"./CRow-UocUvAN0.js";import{C as Le}from"./CButtonGroup-DQQ4vhSO.js";import{C as Re}from"./1-B_HZyjvk.js";import{C as Z}from"./CCard-NorjZmAT.js";import{C as Ie}from"./CCardHeader-B11k8edq.js";import{C as J}from"./CCardBody-BJZZWNkB.js";import{C as ke,a as Me,b as me,c as U,d as Fe,e as Y}from"./CTable-C_kZkx49.js";import{C as Ae,a as Pe,b as ae,c as te}from"./CTabList-DzTH9zjP.js";import"./cil-user-Ddrdy7PS.js";import"./getTransitionDurationFromElement-Cpu4p4hx.js";var re=["512 512","<polygon fill='var(--ci-primary-color, currentColor)' points='272 434.744 272 209.176 240 209.176 240 434.744 188.118 382.862 165.49 405.489 256 496 346.51 405.489 323.882 382.862 272 434.744' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M400,161.176c0-79.4-64.6-144-144-144s-144,64.6-144,144a96,96,0,0,0,0,192h80v-32H112a64,64,0,0,1,0-128h32v-32a112,112,0,0,1,224,0v32h32a64,64,0,0,1,0,128H320v32h80a96,96,0,0,0,0-192Z' class='ci-primary'/>"];const $e=({onAddVehicle:c})=>{const{showSuccess:C,showError:N}=X(),[R,_]=o.useState(!1),[y,j]=o.useState(!1),[F,E]=o.useState(null),[S,w]=o.useState(null),[n,D]=o.useState(!1),p={idNum:Math.floor(Math.random()*1e6).toString(),brand:"",model:"",year:"",regisExprationDate:"",regisNumber:"",capacity:"",units:"",fuelType:"",currentMileage:"",status:"available"},[f,d]=o.useState(p),g=m=>{const{id:i,value:x}=m.target;d(b=>({...b,[i]:x}))},v=[{label:"Van",value:"van"},{label:"Pickup Truck",value:"pickup"},{label:"Box Truck",value:"box"},{label:"Straight Truck",value:"straight"},{label:"Semi-Trailer Trucks",value:"semi"},{label:"Refrigerated Trucks",value:"refrigerated"},{label:"Tanker Trucks",value:"tanker"},{label:"Flatbed Trucks",value:"flatbed"}],r=[{label:"Diesel",value:"Diesel"},{label:"Gasoline",value:"Gasoline"}],a=[{label:"kilograms",value:"kg"},{label:"Tons",value:"ton"}],h=async m=>{var x,b,I,$;m.currentTarget.checkValidity()===!1&&(m.preDefault(),m.stopPropagation()),_(!0),D(!0);try{const L=await G.post("api/v1/vehicle",f);L.data.success&&(C(L.data.message),c(L.data.data),setTimeout(()=>{d(p),D(!1),_(!1),j(!1)},2e3))}catch(L){N(((b=(x=L.response)==null?void 0:x.data)==null?void 0:b.message)||L.message),E((($=(I=L.response)==null?void 0:I.data)==null?void 0:$.message)||L.message),setTimeout(()=>{E(null)},2e3)}D(!1)},u=new Date().getFullYear(),t=1990,l=new Date().toISOString().split("T")[0],s=({icon:m})=>{const[i,x]=o.useState(!1);return e.jsx(O,{icon:m,bounce:i,onMouseEnter:()=>x(!0),onMouseLeave:()=>x(!1)})};return e.jsx(e.Fragment,{children:n?e.jsx(z,{color:"primary",size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsxs(A,{color:"primary",variant:"outline",onClick:()=>j(!0),children:[e.jsx(s,{icon:ve})," Add Vehicle"]}),e.jsxs(ne,{visible:y,onClose:()=>j(!1),size:"lg",children:[e.jsx(le,{closeButton:!0,children:e.jsx(xe,{children:"Add Vehicle"})}),F&&e.jsx(H,{color:"danger",className:"m-3",children:F}),S&&e.jsx(H,{color:"success",className:"m-3",children:S}),e.jsx(ie,{children:e.jsxs(fe,{noValidate:!0,validated:R,children:[e.jsxs(K,{children:[e.jsx(V,{className:"mb-3",floatingLabel:"ID Number",placeholder:"ID Number",type:"text",id:"idNum",label:"ID Number",value:f.idNum,disabled:!0}),e.jsx(V,{className:"mb-3",floatingLabel:"Brand",placeholder:"Brand",type:"text",id:"brand",label:"Brand",autoComplete:"off",required:!0,value:f.brand,onChange:g}),e.jsx(V,{className:"mb-3",floatingLabel:"Model",placeholder:"Model",type:"text",id:"model",label:"Model",autoComplete:"off",required:!0,value:f.model,onChange:g})]}),e.jsxs(K,{children:[e.jsx(V,{type:"number",className:"mb-3",floatingLabel:"Year",placeholder:"Year",id:"year",value:f.year,required:!0,min:t,max:u,onChange:g,onBlur:m=>{const i=parseInt(m.target.value);i>=t&&i<=u&&!isNaN(i)||(alert(`Please enter a year between ${t} and ${u}`),d({...f,year:t}))}}),e.jsx(V,{className:"mb-3",floatingLabel:"Registration Number",placeholder:"Registration Number",type:"text",id:"regisNumber",label:"Registration Number",autoComplete:"off",required:!0,value:f.regisNumber,onChange:g}),e.jsx(V,{className:"mb-3",floatingLabel:"Registration Expiration Date",placeholder:"Registration Expiration Date",type:"date",id:"regisExprationDate",label:"Registration Expiration Date",autoComplete:"off",required:!0,min:l,value:f.regisExprationDate,onChange:g})]}),e.jsxs(K,{children:[e.jsx(W,{className:"mb-3",floatingLabel:"Vehicle Type",placeholder:"Vehicle Type",id:"type",value:f.type,required:!0,onChange:g,options:[{label:"Select Vehicle Type",value:""},...v]}),e.jsx(W,{className:"mb-3",floatingLabel:"Vehicle Units",placeholder:"Vehicle Unit",id:"units",value:f.units,required:!0,onChange:g,options:[{label:"Select Vehicle Unit",value:""},...a]}),e.jsx(V,{className:"mb-2",type:"number",floatingLabel:"Capacity",placeholder:"Capacity",id:"capacity",label:"Capacity",autoComplete:"off",required:!0,min:"0",value:f.capacity,onChange:g}),e.jsx(W,{className:"mb-3",floatingLabel:"Fuel Type",placeholder:"Fuel Type",id:"fuelType",value:f.fuelType,required:!0,onChange:g,options:[{label:"Select Fuel Type",value:""},...r]})]}),e.jsx(V,{className:"mb-3",floatingLabel:"Current Mileage",placeholder:"Current Mileage",type:"number",id:"currentMileage",label:"Current Mileage",autoComplete:"off",required:!0,value:f.currentMileage,min:"0",max:"100000000000",onChange:g})]})}),e.jsxs(oe,{children:[e.jsx(A,{color:"secondary",variant:"outline",disabled:n,onClick:()=>{j(!1),d(p),_(!1),E(null)},children:n?e.jsx(z,{color:"secondary",size:"sm"}):"Cancel"}),e.jsx(A,{color:"primary",variant:"outline",disabled:n,onClick:h,children:n?e.jsx(z,{color:"primary",size:"sm"}):"Save"})]})]})]})})},Be=({vehicle:c,onUpdateVehicle:C})=>{const{showSuccess:N,showError:R}=X(),[_,y]=o.useState(!1),[j,F]=o.useState(null),[E,S]=o.useState(null),[w,n]=o.useState(!1),[D,p]=o.useState(!1),f={idNum:c.idNum,brand:c.brand,model:c.model,year:c.year,regisExprationDate:c.regisExprationDate,regisNumber:c.regisNumber,type:c.type,units:c.units,capacity:c.capacity,fuelType:c.fuelType,currentMileage:c.currentMileage},[d,g]=o.useState(f),v=i=>{const{id:x,value:b}=i.target;g(I=>({...I,[x]:b}))},r=[{label:"Van",value:"van"},{label:"Pickup Truck",value:"pickup"},{label:"Box Truck",value:"box"},{label:"Straight Truck",value:"straight"},{label:"Semi-Trailer Trucks",value:"semi"},{label:"Refrigerated Trucks",value:"refrigerated"},{label:"Tanker Trucks",value:"tanker"},{label:"Flatbed Trucks",value:"flatbed"}],a=[{label:"Diesel",value:"Diesel"},{label:"Gasoline",value:"Gasoline"}],h=[{label:"kilograms",value:"kg"},{label:"Tons",value:"ton"}],u=async i=>{var b,I,$,L;i.preventDefault(),n(!0),i.currentTarget.checkValidity()===!1&&(i.preDefault(),i.stopPropagation()),p(!0),n(!0);try{const k=new Date;k.setHours(0,0,0,0);const P=new Date(d.regisExprationDate);if(P.setHours(0,0,0,0),P<=k){S("Registration date must be in the future"),setIsLoading(!1);return}const Q=await G.put(`api/v1/vehicle/${c._id}`,d);Q.data.success&&(N(Q.data.message),C(Q.data.data),setTimeout(()=>{n(!1),p(!1),y(!1)},2e3))}catch(k){R(((I=(b=k.response)==null?void 0:b.data)==null?void 0:I.message)||k.message),S(((L=($=k.response)==null?void 0:$.data)==null?void 0:L.message)||k.message),setTimeout(()=>{S(null)},2e3)}finally{n(!1)}},t=new Date().getFullYear(),l=1990,s=new Date().toISOString().split("T")[0],m=({icon:i})=>{const[x,b]=o.useState(!1);return e.jsx(O,{icon:i,bounce:x,onMouseEnter:()=>b(!0),onMouseLeave:()=>b(!1)})};return e.jsxs(e.Fragment,{children:[e.jsxs(A,{color:"primary",variant:"outline",disabled:w,onClick:()=>y(!0),className:"me-2",children:[w?e.jsx(z,{size:"sm"}):e.jsx(m,{icon:Se})," Update"]}),e.jsxs(ne,{visible:_,onClose:()=>y(!1),size:"lg",children:[e.jsx(le,{closeButton:!0,children:e.jsx(xe,{children:"Update Vehicle"})}),E&&e.jsx(H,{color:"danger",className:"m-3",children:E}),j&&e.jsx(H,{color:"success",className:"m-3",children:j}),e.jsx(ie,{children:e.jsxs(fe,{noValidate:!0,validated:D,children:[e.jsxs(K,{children:[e.jsx(V,{className:"mb-3",floatingLabel:"ID Number",placeholder:"ID Number",type:"text",id:"idNum",label:"ID Number",value:d.idNum,disabled:!0}),e.jsx(V,{className:"mb-3",floatingLabel:"Brand",placeholder:"Brand",type:"text",id:"brand",label:"Brand",required:!0,value:d.brand,onChange:v}),e.jsx(V,{className:"mb-3",floatingLabel:"Model",placeholder:"Model",type:"text",id:"model",label:"Model",required:!0,value:d.model,onChange:v})]}),e.jsxs(K,{children:[e.jsx(V,{type:"number",className:"mb-3",floatingLabel:"Year",placeholder:"Year",id:"year",value:d.year,required:!0,min:l,max:t,onChange:v,onBlur:i=>{const x=parseInt(i.target.value);x>=l&&x<=t&&!isNaN(x)||(alert(`Please enter a year between ${l} and ${t}`),g({...d,year:l}))}}),e.jsx(V,{className:"mb-3",floatingLabel:"Registration Number",placeholder:"Registration Number",type:"text",id:"regisNumber",label:"Registration Number",required:!0,value:d.regisNumber,onChange:v}),e.jsx(V,{className:"mb-3",floatingLabel:"Registration Expiration Date",placeholder:"Registration Expiration Date",type:"date",id:"regisExprationDate",label:"Registration Expiration Date",autoComplete:"off",required:!0,min:s,value:d.regisExprationDate.split("T")[0],onChange:v})]}),e.jsxs(K,{children:[e.jsx(W,{className:"mb-3",floatingLabel:"Vehicle Type",placeholder:"Vehicle Type",id:"type",value:d.type,required:!0,onChange:v,options:[{label:"Select Vehicle Type",value:""},...r]}),e.jsx(W,{className:"mb-3",floatingLabel:"Vehicle Unit",placeholder:"Vehicle Unit",id:"units",value:d.units,required:!0,onChange:v,options:[{label:"Select Vehicle Unit",value:""},...h]}),e.jsx(V,{className:"mb-2",type:"number",floatingLabel:"Capacity",placeholder:"Capacity",id:"capacity",label:"Capacity",required:!0,min:"0",value:d.capacity,onChange:v}),e.jsx(W,{className:"mb-3",floatingLabel:"Fuel Type",placeholder:"Fuel Type",id:"fuelType",label:"Fuel Type",value:d.fuelType,required:!0,onChange:v,options:[{label:"Select Fuel Type",value:""},...a]})]}),e.jsx(V,{className:"mb-3",floatingLabel:"Current Mileage",placeholder:"Current Mileage",type:"number",id:"currentMileage",label:"Current Mileage",required:!0,min:"0",max:"100000000000",value:d.currentMileage,onChange:v})]})}),e.jsxs(oe,{children:[e.jsx(A,{color:"secondary",variant:"outline",disabled:w,onClick:()=>{y(!1),S(null),g(f),p(!1)},children:w?e.jsx(z,{size:"sm",color:"secondary"}):"Cancel"}),e.jsx(A,{color:"success",variant:"outline",disabled:w,onClick:u,children:w?e.jsx(z,{size:"sm",color:"success"}):"Save Changes"})]})]})]})},He=({vehicle:c,error:C,loading:N,onDeleteVehicle:R,onUpdateVehicle:_})=>{const[y,j]=o.useState([]),F=he(),E=["manager","admin","super admin"],[S,w]=o.useState(null),[n,D]=o.useState(""),[p,f]=o.useState(1),[d]=o.useState(10),g=p*d,v=g-d,r=y.slice(v,g),a=Math.ceil(y.length/d);o.useEffect(()=>{j(c)},[c]),o.useEffect(()=>{(()=>{if(f(1),n==="")j(c);else{const m=c.filter(i=>{var x,b,I,$,L,k,P,Q,ce;return((x=i.idNum)==null?void 0:x.toString().includes(n))||((b=i.brand)==null?void 0:b.toLowerCase().includes(n.toLowerCase()))||((I=i.model)==null?void 0:I.toLowerCase().includes(n.toLowerCase()))||(($=i.year)==null?void 0:$.toString().includes(n))||((L=i.regisExprationDate)==null?void 0:L.toLowerCase().includes(n.toLowerCase()))||((k=i.type)==null?void 0:k.toLowerCase().includes(n.toLowerCase()))||((P=i.regisNumber)==null?void 0:P.toLowerCase().includes(n.toLowerCase()))||((Q=i.capacity)==null?void 0:Q.toString().includes(n))||(((ce=u.find(we=>we.value===i.status))==null?void 0:ce.label)||"").toLowerCase().includes(n.toLowerCase())});j(m),m.length===0?w("No vehicles found"):w(null)}})()},[n,c]);const h=s=>{switch(s){case"available":return"green";case"in_use":return"red";case"maintenance":return"orange";case"inspection":return"yellow";case"forRegistration":return"grey";default:return"black"}},u=[{value:"available",label:"Available"},{value:"in_use",label:"In Use"},{value:"maintenance",label:"Maintenance"},{value:"inactive",label:"Inactive"},{value:"inspection",label:"Inspection"},{value:"forRegistration",label:"For Registration"}];if(c.length===0)return e.jsx(H,{color:"danger",className:"text-center justify-content-center",children:"No vehicles found"});const t=s=>{if(!s)return{text:"No expiration date",badge:"secondary"};const m=new Date;m.setHours(0,0,0,0);const i=new Date(s);i.setHours(0,0,0,0);const x=i.getTime()-m.getTime(),b=Math.ceil(x/(1e3*60*60*24));if(b<0){const I=Math.abs(b);return{text:`Expired ${I} ${I===1?"day":"days"} ago`,badge:"danger"}}return b===0?{text:"Expires Today",badge:"danger"}:b<=14?{text:`Expires in ${b} ${b===1?"day":"days"}`,badge:"warning"}:{text:"Registered",badge:"success"}},l=({icon:s})=>{const[m,i]=o.useState(!1);return e.jsx(O,{icon:s,bounce:m,onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1)})};return e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"mt-3",children:e.jsxs(K,{className:"w-50 mb-3",children:[e.jsx(V,{type:"text",placeholder:"Search vehicles",id:"search",value:n,onChange:s=>D(s.target.value),className:"w-50 me-2 "}),e.jsx(je,{children:e.jsx(O,{icon:pe})})]})}),e.jsx(be,{className:"m-2",children:r.map((s,m)=>e.jsxs(ye,{children:[e.jsxs(Ce,{className:"d-flex justify-content-between",children:[e.jsx(B,{children:e.jsxs("ul",{className:"list-unstyled",children:[e.jsxs("li",{children:["Registration Number: ",e.jsx("strong",{children:s.regisNumber})]}),e.jsxs("li",{children:["Driver:"," ",e.jsx("strong",{children:s.assignedDriver?`${s.assignedDriver.driverName} - ${s.assignedDriver.licenseNumber}`:"Not assigned"})]}),e.jsxs("li",{children:["Registration expiration Date:"," ",e.jsx("strong",{children:s.regisExprationDate?e.jsxs(e.Fragment,{children:[new Date(s.regisExprationDate).toLocaleDateString()," ",e.jsx(q,{color:t(s.regisExprationDate).badge,children:t(s.regisExprationDate).text})]}):"No expiration date"})]})]})}),e.jsxs(B,{className:"d-flex justify-content-end",children:[e.jsx(O,{icon:ge,color:h(s.status),className:"m-2 float-end"}),e.jsx("small",{className:"m-2 float-end",children:u.find(i=>i.value===s.status).label})]})]}),e.jsxs(Ne,{children:[e.jsxs(T,{children:["ID: ",s.idNum]}),e.jsxs(T,{children:["Brand: ",s.brand]}),e.jsxs(T,{children:["Model: ",s.model]}),e.jsxs(T,{children:["Year: ",s.year]}),e.jsxs(T,{children:["Type: ",s.type]}),e.jsxs(T,{children:["Capacity: ",s.units,": ",s.capacity]}),e.jsxs(T,{children:["Status: ",u.find(i=>i.value===s.status).label]}),e.jsxs(T,{children:["Driver:"," ",s.assignedDriver?`${s.assignedDriver.driverName} - ${s.assignedDriver.licenseNumber}`:"Not assigned"]}),e.jsxs(T,{children:["Fuel Type: ",s.fuelType]}),e.jsxs(T,{children:["Current Mileage: ",s.currentMileage]}),e.jsxs(B,{className:"d-flex justify-content-end mt-3",children:[e.jsx(Be,{vehicle:s,onUpdateVehicle:_}),E.includes(F)&&e.jsxs(A,{color:"danger",variant:"outline",onClick:()=>R(s._id),children:[e.jsx(l,{icon:De})," Delete"]})]})]})]},s._id||m))}),y.length>0&&e.jsxs(B,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs(B,{children:["Showing ",v+1," to ",Math.min(g,y.length)," ","of ",y.length," entries"]}),e.jsxs(_e,{className:"mt-3",children:[e.jsx(ee,{disabled:p===1,onClick:()=>f(s=>Math.max(s-1,1)),children:"Previous"}),Array.from({length:a},(s,m)=>m+1).map(s=>e.jsx(ee,{active:s===p,onClick:()=>f(s),children:s},s)),e.jsx(ee,{disabled:p===a,onClick:()=>f(s=>Math.min(s+1,a)),children:"Next"})]})]}),S&&e.jsx(H,{color:"danger",className:"text-center justify-content-center",children:S})]})},qe=()=>{const{showError:c}=X(),[C,N]=o.useState([]),[R,_]=o.useState([]),[y,j]=o.useState(!1),[F,E]=o.useState(null);o.useEffect(()=>{(async()=>{var a,h;try{j(!0);const u=await G.get("/api/v1/vehicle/");u.data.data&&N(u.data.data)}catch(u){console.error("Error fetching vehicle data:",u),E(((h=(a=u==null?void 0:u.response)==null?void 0:a.data)==null?void 0:h.message)||"Error fetching vehicle data")}finally{j(!1)}})()},[]);const S=async()=>{var r,a,h,u;j(!0);try{const t=await G.get("https://backend-log2.axleshift.com/api/v1/shipment");if(t.status===200){const l=t.data.shipments||[];_(l),E(null)}}catch(t){E(((a=(r=t==null?void 0:t.response)==null?void 0:r.data)==null?void 0:a.message)||"Error fetching data"),c(((u=(h=t==null?void 0:t.response)==null?void 0:h.data)==null?void 0:u.message)||"Error fetching data")}finally{j(!1)}};o.useEffect(()=>{S()},[]);const w=()=>!C.length||!R.length?[]:C.map(r=>{var h,u,t,l,s,m,i,x,b,I,$,L;const a=R.find(k=>{var P;return((P=k.vehicle)==null?void 0:P.plate_no)===r.regisNumber});if(a&&a.dispatch!=="Completed"){let k=null,P=null;return a.isInWarehouse?(k=(h=a.consignee)==null?void 0:h.consignee_company_address,P={companyName:(u=a.consignee)==null?void 0:u.consignee_company_name,contactName:(t=a.consignee)==null?void 0:t.consignee_contact_name,contactPhone:(l=a.consignee)==null?void 0:l.consignee_contact_phone_number,contactEmail:(s=a.consignee)==null?void 0:s.consignee_contact_email_address}):(k=(m=a.shipper)==null?void 0:m.shipper_company_address,P={companyName:(i=a.shipper)==null?void 0:i.shipper_company_name,contactName:(x=a.shipper)==null?void 0:x.shipper_contact_name,contactPhone:(b=a.shipper)==null?void 0:b.shipper_contact_phone_number,contactEmail:(I=a.shipper)==null?void 0:I.shipper_contact_email_address}),{...r,shipmentDetails:{tracking_id:a.tracking_id,dispatch_status:a.dispatch,shipping_type:($=a.shipping)==null?void 0:$.shipping_type,shipment_description:(L=a.shipment)==null?void 0:L.shipment_description,receive_date:a.receiveDate},deliveryAddress:k,recipientInfo:P}}return{...r,shipmentDetails:null,deliveryAddress:null,recipientInfo:null}}),n=r=>{switch(r){case"maintenance":return e.jsx(q,{color:"warning",children:"Maintenance"});case"forRegistration":return e.jsx(q,{color:"secondary",children:"For Registration"});case"available":return e.jsx(q,{color:"success",children:"Available"});case"in_use":return e.jsx(q,{color:"danger",children:"In Use"});default:return e.jsx(q,{color:"primary",children:"Unknown"})}},D=r=>{switch(r){case"Completed":return"success";case"Dispatching":return"info";case"Pending":return"warning";default:return"secondary"}},p=()=>w().map(a=>{var h,u,t,l,s,m,i,x,b;return{"Vehicle ID":a.idNum,"License Plate":a.regisNumber,Status:a.status,"Tracking ID":((h=a.shipmentDetails)==null?void 0:h.tracking_id)||"No Shipment","Recipient Company":((u=a.recipientInfo)==null?void 0:u.companyName)||"N/A","Contact Name":((t=a.recipientInfo)==null?void 0:t.contactName)||"N/A","Contact Phone":((l=a.recipientInfo)==null?void 0:l.contactPhone)||"N/A","Contact Email":((s=a.recipientInfo)==null?void 0:s.contactEmail)||"N/A","Delivery Address":a.deliveryAddress||"No address assigned","Dispatch Status":((m=a.shipmentDetails)==null?void 0:m.dispatch_status)||"No Status","Shipping Type":((i=a.shipmentDetails)==null?void 0:i.shipping_type)||"N/A","Shipment Description":((x=a.shipmentDetails)==null?void 0:x.shipment_description)||"N/A","Receive Date":((b=a.shipmentDetails)==null?void 0:b.receive_date)||"N/A"}}),f=()=>{try{j(!0);const r=p(),a=M.utils.json_to_sheet(r),h=M.utils.book_new();M.utils.book_append_sheet(h,a,"Vehicle Report"),M.writeFile(h,`vehicle-report-${new Date().toISOString().split("T")[0]}.csv`)}catch(r){console.error("Error exporting to CSV:",r),c("Error exporting to CSV")}finally{j(!1)}},d=()=>{try{j(!0);const r=p(),a=M.utils.json_to_sheet(r),h=[{wch:10},{wch:15},{wch:12},{wch:15},{wch:30},{wch:20},{wch:15},{wch:25},{wch:40},{wch:15},{wch:15},{wch:30},{wch:20}];a["!cols"]=h;const u={font:{bold:!0},fill:{fgColor:{rgb:"EEEEEE"}},alignment:{horizontal:"center"}},t=M.utils.decode_range(a["!ref"]);for(let s=t.s.c;s<=t.e.c;++s){const m=M.utils.encode_cell({r:0,c:s});a[m]&&(a[m].s=u)}const l=M.utils.book_new();M.utils.book_append_sheet(l,a,"Vehicle Report"),M.writeFile(l,`vehicle-report-${new Date().toISOString().split("T")[0]}.xlsx`)}catch(r){console.error("Error exporting to Excel:",r),c("Error exporting to Excel")}finally{j(!1)}},g=()=>{try{j(!0);const r=p(),a=M.utils.book_new(),h=M.utils.json_to_sheet(r),u=[["Fleet Overview"],["Total Vehicles",C.length],["Available",C.filter(l=>l.status==="available").length],["In Maintenance",C.filter(l=>l.status==="maintenance").length],["In Use",C.filter(l=>l.status==="in_use").length],["For Registration",C.filter(l=>l.status==="forRegistration").length],["Scheduled",w().filter(l=>l.shipmentDetails).length]],t=M.utils.aoa_to_sheet(u);M.utils.book_append_sheet(a,t,"Summary"),M.utils.book_append_sheet(a,h,"Vehicle Details"),["!cols","!rows"].forEach(l=>{h[l]=h[l]||[],t[l]=t[l]||[]}),t["!cols"]=[{wch:20},{wch:10}],h["!cols"]=[{wch:10},{wch:15},{wch:12},{wch:15},{wch:30},{wch:20},{wch:15},{wch:25},{wch:40},{wch:15},{wch:15},{wch:30},{wch:20}],M.writeFile(a,`vehicle-report-detailed-${new Date().toISOString().split("T")[0]}.xlsx`)}catch(r){console.error("Error exporting to Excel:",r),c("Error exporting to Excel")}finally{j(!1)}};if(y)return e.jsx("div",{children:"Loading..."});if(F)return e.jsxs("div",{children:["Error: ",F]});const v=w();return e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"mb-3",children:e.jsx(ue,{xs:12,className:"d-flex justify-content-end",children:e.jsxs(Le,{children:[e.jsxs(A,{color:"primary",onClick:d,disabled:y,className:"me-2",children:[e.jsx(se,{icon:re,className:"me-2"}),"Export to Excel"]}),e.jsxs(A,{color:"info",onClick:g,disabled:y,className:"me-2",children:[e.jsx(se,{icon:re,className:"me-2"}),"Detailed Excel"]}),e.jsxs(A,{color:"success",onClick:f,disabled:y,children:[e.jsx(se,{icon:re,className:"me-2"}),"Export to CSV"]})]})})}),e.jsxs("div",{className:"pdf-container",children:[e.jsxs("div",{className:"report-header",children:[e.jsx("div",{className:"company-logo",children:e.jsx(Re,{src:Te,height:100,fluid:!0,alt:"Freight Logo",className:"logo-image bg-primary"})}),e.jsxs("div",{className:"report-title",children:[e.jsx("h1",{children:"Vehicle Status Report"}),e.jsxs("div",{className:"report-metadata",children:[e.jsxs("p",{children:["Generated on:"," ",new Date().toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})]}),e.jsxs("p",{children:["Total Vehicles: ",C.length]})]})]})]}),e.jsx("div",{className:"summary-section",children:e.jsxs("div",{className:"summary-box",children:[e.jsx("h3",{children:"Fleet Overview"}),e.jsxs("div",{className:"summary-stats",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-label",children:"Available:"}),e.jsx("span",{className:"stat-value",children:C.filter(r=>r.status==="available").length})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-label",children:"In Maintenance:"}),e.jsx("span",{className:"stat-value",children:C.filter(r=>r.status==="maintenance").length})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-label",children:"In Use:"}),e.jsx("span",{className:"stat-value",children:C.filter(r=>r.status==="in_use").length})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-label",children:"For Registration:"}),e.jsx("span",{className:"stat-value",children:C.filter(r=>r.status==="forRegistration").length})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-label",children:"Scheduled:"}),e.jsx("span",{className:"stat-value",children:v.filter(r=>r.shipmentDetails).length})]})]})]})}),e.jsx(de,{children:e.jsx(ue,{xs:12,children:e.jsxs(Z,{className:"mb-4",children:[e.jsxs(Ie,{children:[e.jsx("strong",{children:"Vehicle Status Report"}),e.jsxs("div",{className:"small text-medium-emphasis",children:["Generated on: ",new Date().toLocaleDateString()]})]}),e.jsx(J,{children:e.jsxs(ke,{hover:!0,responsive:!0,className:"border",children:[e.jsx(Me,{children:e.jsxs(me,{children:[e.jsx(U,{scope:"col",children:"Vehicle ID"}),e.jsx(U,{scope:"col",children:"License Plate"}),e.jsx(U,{scope:"col",children:"Status"}),e.jsx(U,{scope:"col",children:"Tracking ID"}),e.jsx(U,{scope:"col",children:"Recipient Company"}),e.jsx(U,{scope:"col",children:"Contact Person"}),e.jsx(U,{scope:"col",children:"Delivery Address"}),e.jsx(U,{scope:"col",children:"Dispatch Status"})]})}),e.jsx(Fe,{children:v.map(r=>{var a,h,u,t;return e.jsxs(me,{children:[e.jsx(Y,{children:r.idNum}),e.jsx(Y,{children:r.regisNumber}),e.jsx(Y,{children:n(r.status)}),e.jsx(Y,{children:((a=r.shipmentDetails)==null?void 0:a.tracking_id)||e.jsx(q,{color:"warning",children:"No Shipment"})}),e.jsx(Y,{children:((h=r.recipientInfo)==null?void 0:h.companyName)||"N/A"}),e.jsx(Y,{children:r.recipientInfo?e.jsxs("div",{children:[e.jsx("div",{children:r.recipientInfo.contactName}),e.jsx("small",{className:"text-muted",children:r.recipientInfo.contactPhone})]}):"N/A"}),e.jsx(Y,{children:r.deliveryAddress||"No address assigned"}),e.jsx(Y,{children:e.jsx(q,{color:D((u=r.shipmentDetails)==null?void 0:u.dispatch_status),children:((t=r.shipmentDetails)==null?void 0:t.dispatch_status)||"No Status"})})]},r._id)})})]})})]})})})]})]})},Ue=({restoredVehicle:c,onRestoreVehicle:C})=>{const[N,R]=o.useState(!1),{showSuccess:_,showError:y}=X(),[j,F]=o.useState(null),E=async()=>{var S,w;R(!0);try{const n=await G.patch(`api/v1/vehicle/restore/${c}`);n.data.success&&(_(n.data.message),C(n.data.data))}catch(n){y(((w=(S=n.response)==null?void 0:S.data)==null?void 0:w.message)||"Error restoring vehicle"),console.error("Error restoring vehicle:",n)}finally{R(!1)}};return e.jsx(A,{color:"success",variant:"outline",onClick:E,disabled:N,className:"mx-1",children:N?e.jsx(z,{size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsx(O,{icon:Ee,className:"me-1"}),"Restore"]})})},Ye=({restoredVehicle:c,onRestoreVehicle:C})=>{const[N,R]=o.useState(""),[_,y]=o.useState([]),[j,F]=o.useState(null);o.useEffect(()=>{(()=>{if(N==="")y(c);else{const D=c.filter(p=>{var f,d,g,v,r,a,h,u,t;return((f=p.idNum)==null?void 0:f.toString().includes(N))||((d=p.brand)==null?void 0:d.toLowerCase().includes(N.toLowerCase()))||((g=p.model)==null?void 0:g.toLowerCase().includes(N.toLowerCase()))||((v=p.year)==null?void 0:v.toString().includes(N))||((r=p.regisExprationDate)==null?void 0:r.toLowerCase().includes(N.toLowerCase()))||((a=p.type)==null?void 0:a.toLowerCase().includes(N.toLowerCase()))||((h=p.regisNumber)==null?void 0:h.toLowerCase().includes(N.toLowerCase()))||((u=p.capacity)==null?void 0:u.toString().includes(N))||(((t=S.find(l=>l.value===p.status))==null?void 0:t.label)||"").toLowerCase().includes(N.toLowerCase())});y(D),D.length===0?F("No vehicles found"):F(null)}})()},[N,c]);const E=n=>{switch(n){case"available":return"green";case"in_use":return"red";case"maintenance":return"orange";case"inspection":return"yellow";case"forRegistration":return"grey";default:return"black"}},S=[{value:"available",label:"Available"},{value:"in_use",label:"In Use"},{value:"maintenance",label:"Maintenance"},{value:"inactive",label:"Inactive"},{value:"inspection",label:"Inspection"},{value:"forRegistration",label:"For Registration"}];if(_.length===0)return e.jsx(H,{color:"danger",className:"text-center justify-content-center",children:"No vehicles found to restore"});const w=n=>{if(!n)return{text:"No expiration date",badge:"secondary"};const D=new Date;D.setHours(0,0,0,0);const p=new Date(n);p.setHours(0,0,0,0);const f=p.getTime()-D.getTime(),d=Math.ceil(f/(1e3*60*60*24));if(d<0){const g=Math.abs(d);return{text:`Expired ${g} ${g===1?"day":"days"} ago`,badge:"danger"}}return d===0?{text:"Expires Today",badge:"danger"}:d<=14?{text:`Expires in ${d} ${d===1?"day":"days"}`,badge:"warning"}:{text:"Registered",badge:"success"}};return e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"mt-3",children:e.jsxs(K,{className:"w-50 mb-3",children:[e.jsx(V,{type:"text",placeholder:"Search vehicles",id:"searchRestoredVehicles",value:N,onChange:n=>R(n.target.value),className:"w-50 me-2 "}),e.jsx(je,{children:e.jsx(O,{icon:pe})})]})}),j&&e.jsx(H,{color:"danger",children:j}),e.jsx(be,{children:_.map(n=>e.jsxs(ye,{children:[e.jsxs(Ce,{className:"d-flex justify-content-between",children:[e.jsx(B,{children:e.jsxs("ul",{children:[e.jsxs("li",{children:["Registration Number: ",e.jsx("strong",{children:n.regisNumber})]}),e.jsxs("li",{children:["Registration expiration Date:"," ",e.jsx("strong",{children:n.regisExprationDate?e.jsxs(e.Fragment,{children:[new Date(n.regisExprationDate).toISOString().split("T")[0]," ",e.jsx(q,{color:w(n.regisExprationDate).badge,children:w(n.regisExprationDate).text})]}):"No expiration date"})]})]})}),e.jsxs(B,{className:"d-flex justify-content-end",children:[e.jsx(O,{icon:ge,color:E(n.status),className:"m-2 float-end"}),e.jsx("small",{className:"m-2 float-end",children:S.find(D=>D.value===n.status).label})]})]}),e.jsxs(Ne,{children:[e.jsxs(T,{children:["Year: ",n.year]}),e.jsxs(T,{children:["Type: ",n.type]}),e.jsxs(T,{children:["Capacity: ",n.capacity]}),e.jsxs(T,{children:["Status: ",n.status]}),e.jsx(B,{className:"d-flex justify-content-end mt-3",children:e.jsx(Ue,{restoredVehicle:n._id,onRestoreVehicle:C})})]})]},n._id))})]})},fs=()=>{const c=he(),C=["super admin","admin","manager","fleet manager"],{showSuccess:N,showError:R}=X(),[_,y]=o.useState([]),[j,F]=o.useState(!0),[E,S]=o.useState(null),[w,n]=o.useState(null),[D,p]=o.useState(!1),[f,d]=o.useState([]);o.useEffect(()=>{g()},[]),o.useEffect(()=>{const t=()=>{const s=new Date;s.setHours(0,0,0,0),y(m=>m.map(i=>{const x=new Date(i.regisExprationDate);return x.setHours(0,0,0,0),x<=s&&i.status!=="forRegistration"?{...i,status:"forRegistration"}:i}))};t();const l=setInterval(t,24*60*60*1e3);return()=>clearInterval(l)},[]);const g=async()=>{var t,l;F(!0);try{const[s,m]=await Promise.all([G.get("api/v1/vehicle"),G.get("api/v1/vehicle/restored")]);y(s.data.data),d(m.data.data)}catch(s){R(((l=(t=s.response)==null?void 0:t.data)==null?void 0:l.message)||"Error fetching data"),S(s.message)}finally{F(!1)}},v=t=>{n(t),p(!0)},r=async()=>{var t,l;try{await G.patch(`api/v1/vehicle/${w}`),y(s=>s.filter(m=>m._id!==w)),N("Vehicle deleted successfully"),p(!1),g()}catch(s){R(((l=(t=s.response)==null?void 0:t.data)==null?void 0:l.message)||"Error deleting vehicle")}},a=t=>{y(l=>[...l,t])},h=t=>{d(l=>l.map(s=>s._id===t._id?t:s)),g()},u=t=>{y(l=>l.map(s=>s._id===t._id?t:s),g())};return j?e.jsx("div",{className:"text-center",children:e.jsx(z,{color:"primary"})}):e.jsx(e.Fragment,{children:c&&C.includes(c)?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"text-center",children:"Vehicle Management"}),e.jsx(B,{className:"m-3",children:e.jsx($e,{onAddVehicle:a})}),e.jsxs(Ae,{activeItemKey:"Vehicle List",children:[e.jsxs(Pe,{variant:"tabs",children:[e.jsx(ae,{itemKey:"Vehicle List",children:"Vehicle List"}),e.jsx(ae,{itemKey:"Restore Vehicles",children:"Restore Vehicles"}),e.jsx(ae,{itemKey:"Vehicle Report",children:"Vehicle Report"})]}),e.jsxs(Ve,{children:[e.jsx(te,{itemKey:"Vehicle List",children:e.jsxs(Z,{children:[e.jsx(T,{children:"Vehicle List"}),e.jsx(J,{className:"md-3",children:e.jsx(He,{vehicle:_,error:E,onDeleteVehicle:v,onUpdateVehicle:u,loading:j})})]})}),e.jsx(te,{itemKey:"Restore Vehicles",children:c&&C.includes(c)&&c!=="fleet manager"?e.jsxs(Z,{children:[e.jsx(T,{children:"Restore Vehicles"}),e.jsx(J,{className:"md-3",children:e.jsx(Ye,{restoredVehicle:f,onRestoreVehicle:h})})]}):e.jsx(H,{color:"danger",className:"text-center justify-content-center m-5",children:"You are not authorized to view this tab"})}),e.jsx(te,{itemKey:"Vehicle Report",children:e.jsxs(Z,{children:[e.jsx(T,{children:"Vehicle Report"}),e.jsx(J,{className:"md-3",children:e.jsx(qe,{vehicle:_})})]})})]})]}),e.jsxs(ne,{visible:D,onClose:()=>p(!1),alignment:"center",children:[e.jsx(le,{children:"Confirm Delete"}),e.jsx(ie,{children:"Are you sure you want to delete this vehicle?"}),e.jsxs(oe,{children:[e.jsx(A,{color:"danger",variant:"outline",onClick:r,children:"Delete"}),e.jsx(A,{color:"secondary",variant:"outline",onClick:()=>p(!1),children:"Cancel"})]})]})]}):e.jsx(H,{color:"danger",className:"text-center justify-content-center m-5",children:"You do not have permission to access this page."})})};export{fs as default};
