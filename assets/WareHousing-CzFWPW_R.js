import{r as a,D as ue,j as e,k as z,m as de,B as me,F as V}from"./index-ZMwIOqj8.js";import{F as J,e as X,a as oe}from"./index-Cwo3Cd4M.js";import{C as F}from"./CAlert-BoqKpfKm.js";import{C as W}from"./CContainer-rE-MVcFl.js";import{C as Z}from"./CInputGroup-DjsFo21O.js";import{C as ee}from"./CFormInput-CS9tLG47.js";import{C as se}from"./CInputGroupText-BafuM7E4.js";import{C as xe,a as je,b as fe,c as ge}from"./CAccordionHeader-vebNYPZG.js";import{C as te,a as re,b as M,c as p,d as ae,e as v}from"./CTable-RMjK0ck_.js";import{C as ne,a as A}from"./CPaginationItem-16Z88ppK.js";import{a as pe}from"./CButton-BuY-uvdP.js";import{C as ve,a as ye,b as G,c as Y}from"./CTabList-CAE-_X4D.js";import{a as Ne,C as ie}from"./DefaultLayout-DofOZavo.js";import{C as le}from"./CCard-5TVShjg-.js";import"./getTransitionDurationFromElement-Cpu4p4hx.js";import"./index.esm-DhgnSAmI.js";import"./1-B4eYyJlF.js";import"./cil-user-Ddrdy7PS.js";const we=({warehousing:y,loading:C,error:_,onDeleteItem:u,onUpdateItem:b})=>{const[x,S]=a.useState([]),[L,N]=a.useState(null),[I,w]=a.useState("");ue();const[g,P]=a.useState(1),[O]=a.useState(10),[h,n]=a.useState([]),j=Math.ceil(x.length/O),E=x.filter(s=>s.received===!0),k=g*O,r=k-O,f=E.slice(r,k);a.useEffect(()=>{try{if(I===""){S(y),N(null);return}const s=I.toLowerCase().trim(),m=y.filter(o=>{var t,c,l,i,T,Q,U,K,B;try{return((t=o.poNumber)==null?void 0:t.toLowerCase().includes(s))||((l=(c=o.vendor)==null?void 0:c.businessName)==null?void 0:l.toLowerCase().includes(s))||((T=(i=o.vendor)==null?void 0:i.businessAddress)==null?void 0:T.toLowerCase().includes(s))||((U=(Q=o.vendor)==null?void 0:Q.contactNumber)==null?void 0:U.includes(s))||o.orderDate&&new Date(o.orderDate).toLocaleDateString().includes(s)||o.dateOfReceived&&new Date(o.receiveDate).toLocaleDateString().includes(s)||((K=d(o.warehouseId))==null?void 0:K.toLowerCase().includes(s))||((B=o.details)==null?void 0:B.some(R=>{var H,$,q;return((H=R.description)==null?void 0:H.toLowerCase().includes(s))||(($=R.quantity)==null?void 0:$.toString().includes(s))||((q=R.unitPrice)==null?void 0:q.toString().includes(s))}))}catch(R){return console.error("Error filtering item:",R),!1}});S(m),P(1),m.length===0?N("No data found"):N(null)}catch(s){console.error("Error in search effect:",s),N("Error occurred while searching")}},[I,y]),a.useEffect(()=>{(async()=>{var m;try{const o=await de.get("/api/v1/warehouseLoc/locations");o.data.data&&n(o.data.data)}catch(o){N((m=o==null?void 0:o.response)==null?void 0:m.data.message)}})()},[]);const d=s=>{if(!h.length)return"Loading...";const m=h.find(o=>o._id===s);return m?m.warehouseName:"Unknown Warehouse"},D=s=>{w(s.target.value)};return C?e.jsx(z,{color:"primary",className:"mt-5 w-15 mx-auto justify-content-center"}):y.length===0?e.jsx(F,{color:"warning",className:"text-center mt-5 w-75 mx-auto",children:"No data available"}):e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"mt-3",children:e.jsxs(Z,{className:"w-50 mb-3",children:[e.jsx(ee,{type:"text",placeholder:"Search by PO Number, Vendor, or Products...",value:I,id:"searchItem",onChange:D}),e.jsx(se,{children:e.jsx(J,{icon:X})})]})}),C?e.jsx(z,{color:"primary",className:"mt-5 w-15 mx-auto justify-content-center"}):y.length===0?e.jsx(F,{color:"warning",className:"text-center mt-5 w-75 mx-auto",children:"No data available"}):e.jsxs(e.Fragment,{children:[L&&e.jsx(F,{color:"danger",className:"text-center mt-5 w-75 mx-auto",children:L}),e.jsx(xe,{className:"m-2",children:f.filter(s=>s.received).map(s=>e.jsxs(je,{children:[e.jsx(fe,{children:e.jsxs("div",{className:"d-flex justify-content-between w-100 align-items-center",children:[e.jsx("div",{children:e.jsxs("ul",{className:"list-unstyled",children:[e.jsxs("li",{children:["PO Number: ",e.jsx("strong",{children:s.poNumber})]}),e.jsxs("li",{children:["Warehuse Location:"," ",e.jsx("strong",{children:d(s.warehouse_id)})]})]})}),e.jsxs("div",{className:"text-medium-emphasis",children:["Order Date: ",new Date(s.orderDate).toLocaleDateString()]})]})}),e.jsxs(ge,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{children:"Vendor Information"}),e.jsxs("div",{className:"ms-3",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Name:"})," ",s.vendor.businessName]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Address:"})," ",s.vendor.businessAddress]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Contact:"})," ",s.vendor.contactNumber]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{children:"Shipping Details"}),e.jsxs("div",{className:"ms-3",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Carrier:"})," ",s.carrier]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Expected Delivery Date:"})," ",new Date(s.receiveDate).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{children:"Products"}),e.jsxs(te,{responsive:!0,small:!0,className:"mt-2",children:[e.jsx(re,{children:e.jsxs(M,{children:[e.jsx(p,{children:"Description"}),e.jsx(p,{children:"Quantity"}),e.jsx(p,{children:"Received Date"})]})}),e.jsx(ae,{children:s.details.map((m,o)=>e.jsxs(M,{children:[e.jsx(v,{children:m.description}),e.jsx(v,{children:m.quantity}),e.jsx(v,{children:s.receiveDate?new Date(s.receiveDate).toLocaleDateString():"N/A"})]},o))})]})]}),s.additionalNotes&&e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{children:"Additional Notes"}),e.jsx("div",{className:"ms-3",children:s.additionalNotes})]})]})]},s._id))}),f.length>0&&e.jsxs(W,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:["Showing ",E.length>0?r+1:0," to"," ",Math.min(k,E.length)," of ",E.length," received entries"]}),e.jsxs(ne,{className:"mt-3",children:[e.jsx(A,{disabled:g===1,onClick:()=>P(s=>Math.max(s-1,1)),children:"Previous"}),Array.from({length:j},(s,m)=>m+1).map(s=>e.jsx(A,{active:s===g,onClick:()=>P(s),children:s},s)),e.jsx(A,{disabled:g===j,onClick:()=>P(s=>Math.min(s+1,j)),children:"Next"})]})]})]})]})},Ce=({onAddItem:y})=>{const{showError:C,showSuccess:_}=me(),[u,b]=a.useState([]),[x,S]=a.useState(1),[L,N]=a.useState(null),[I,w]=a.useState(!0),[g,P]=a.useState(""),[O,h]=a.useState([]),[n,j]=a.useState([]),E=10;a.useEffect(()=>{(async()=>{try{const c=await V.get("https://log2_backend.chysev.cloud/api/v1/purchaseOrder");c.status===200&&b(c.data)}catch(c){console.error("Error fetching data:",c)}})()},[]);const k=async t=>{var c,l;try{if((await V.put(`https://log2_backend.chysev.cloud/api/v1/purchaseOrder/${t}`,{received:!0,receiveDate:new Date().toISOString()})).status===200){const T=await V.get("https://log2_backend.chysev.cloud/api/v1/purchaseOrder");b(T.data),_("Item received successfully")}}catch(i){console.error("Error updating purchase order:",i),C(((l=(c=i==null?void 0:i.response)==null?void 0:c.data)==null?void 0:l.message)||"Error updating purchase order")}};a.useEffect(()=>{(async()=>{var c,l;try{const i=await de.get("/api/v1/warehouseLoc/locations");i.data.data&&(j(i.data.data),_(i.data.message))}catch(i){N((c=i==null?void 0:i.response)==null?void 0:c.data.message),C(((l=i==null?void 0:i.response)==null?void 0:l.data.message)||"Error fetching warehouses")}})()},[]);const r=t=>{if(!n.length)return"Loading...";const c=n.find(l=>l._id===t);return c?c.warehouseName:"Unknown Warehouse"};if(a.useEffect(()=>{w(!1)},[]),a.useEffect(()=>{if(g===""){b(u);return}const t=g.toLowerCase().trim(),c=u.filter(l=>{var i,T,Q,U,K,B,R,H,$;try{return((i=l.poNumber)==null?void 0:i.toLowerCase().includes(t))||((Q=(T=l.vendor)==null?void 0:T.businessName)==null?void 0:Q.toLowerCase().includes(t))||((K=(U=l.vendor)==null?void 0:U.businessAddress)==null?void 0:K.toLowerCase().includes(t))||((R=(B=l.vendor)==null?void 0:B.contactNumber)==null?void 0:R.toLowerCase().includes(t))||((H=l.carrier)==null?void 0:H.toLowerCase().includes(t))||l.orderDate&&new Date(l.orderDate).toLocaleDateString().includes(t)||l.receiveDate&&new Date(l.receiveDate).toLocaleDateString().includes(t)||(($=l.details)==null?void 0:$.some(q=>{var ce;return(ce=q.description)==null?void 0:ce.toLowerCase().includes(t)}))}catch(q){return console.error("Error filtering data:",q),!1}});b(c),S(1),N(c.length===0?"No results found":null)},[g]),I)return e.jsx(z,{color:"primary",className:"mt-5 w-15 mx-auto justify-content-center"});const f=x*E,d=f-E,D=u.slice(d,f),s=Math.ceil(u.length/E),m=t=>{P(t.target.value)};return u.length>0&&u.every(t=>t.received===!0)?e.jsx(F,{color:"success",className:"text-center mt-3 w-75 mx-auto",children:"All items have been received."}):e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"mt-3",children:e.jsxs(Z,{className:"w-50 mb-3",children:[e.jsx(ee,{type:"text",placeholder:"Search by PO Number, Supplier, or Item Name",value:g,id:"searchInput",onChange:m}),e.jsx(se,{children:e.jsx(J,{icon:X})})]})}),e.jsxs(te,{hover:!0,responsive:!0,children:[e.jsx(re,{children:e.jsxs(M,{children:[e.jsx(p,{children:"PO Number"}),e.jsx(p,{children:"Order Date"}),e.jsx(p,{children:"Date to Receive"}),e.jsx(p,{children:"Carrier"}),e.jsx(p,{children:"Warehouse"}),e.jsx(p,{children:"Vendor"}),e.jsx(p,{children:"Products"}),e.jsx(p,{children:"Receive"}),e.jsx(p,{children:"Actions"})]})}),e.jsx(ae,{children:D.filter(t=>!t.received).map(t=>e.jsxs(M,{children:[e.jsx(v,{children:t.poNumber}),e.jsx(v,{children:new Date(t.orderDate).toLocaleDateString()}),e.jsx(v,{children:new Date(t.receiveDate).toLocaleDateString()}),e.jsx(v,{children:t.carrier}),e.jsx(v,{children:r(t.warehouse_id)}),e.jsxs(v,{children:[e.jsx("div",{children:t.vendor.businessName}),e.jsx("small",{className:"text-medium-emphasis",children:t.vendor.contactNumber})]}),e.jsx(v,{children:t.details.map(c=>e.jsxs("div",{children:[c.description," ( pcs: ",c.quantity," x"," ",c.unitPrice.toFixed(2)," )"]},c.productId))}),e.jsx(v,{children:t.received?"Yes":"No"}),e.jsx(v,{children:e.jsx(pe,{color:"primary",className:"mt-2",onClick:()=>k(t._id),children:"Complete"})})]},t._id))})]}),u.filter(t=>!t.received).length>0&&e.jsxs(W,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs(W,{children:["Showing ",d+1," to ",Math.min(f,u.length)," of"," ",u.length," entries"]}),e.jsxs(ne,{className:"mt-3",children:[e.jsx(A,{disabled:x===1,onClick:()=>S(t=>Math.max(t-1,1)),children:"Previous"}),[...Array(s).keys()].map(t=>e.jsx(A,{active:t+1===x,onClick:()=>S(t+1),children:t+1},t+1)),e.jsx(A,{disabled:x===s,onClick:()=>S(t=>Math.min(t+1,s)),children:"Next"})]})]}),L&&e.jsx(F,{color:"danger",className:"text-center mt-5 w-75 mx-auto justify-content-center",children:L})]})},be=({items:y,loading:C,error:_})=>{const[u,b]=a.useState([]),[x,S]=a.useState(""),[L,N]=a.useState(null),I=10,[w,g]=a.useState(1),P=r=>{switch(r){case"Stocked":return"success";case"Out of Stock":return"danger";default:return"secondary"}};a.useEffect(()=>{b(y)},[y]),a.useEffect(()=>{if(x==="")b(y),N(null);else{const r=y.filter(f=>{const d=f.itemName.toLowerCase().includes(x.toLowerCase()),D=f.locations.some(s=>{const m=s.warehouse;return m.warehouseName.toLowerCase().includes(x.toLowerCase())||m.address.toLowerCase().includes(x.toLowerCase())});return d||D});b(r),g(1),r.length===0?N("No results found"):N(null)}},[x,y]);const O=r=>{S(r.target.value)},h=r=>{if(!r||!Array.isArray(r))return[];const f=new Map;return r.forEach(d=>{if(!(d!=null&&d.warehouse))return;const D=d.warehouse._id||"deleted";if(!f.has(D))f.set(D,{warehouse:{...d.warehouse,deleted:d.warehouse.deleted||!d.warehouse._id},quantity:d.quantity||0});else{const s=f.get(D);s.quantity+=d.quantity||0,f.set(D,s)}}),Array.from(f.values())};if(C)return e.jsx(z,{color:"primary",className:"text-center mt-5 w-75 mx-auto justify-content-center"});if(_)return e.jsxs(F,{color:"danger",className:"text-center mt-5 w-75 mx-auto justify-content-center",children:["Error: ",_]});const n=w*I,j=n-I,E=u.slice(j,n),k=Math.ceil(u.length/I);return e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"m-3",children:e.jsxs(Z,{className:"w-50 mb-3",children:[e.jsx(ee,{type:"text",id:"search",value:x,onChange:O,placeholder:"Search by item name or warehouse..."}),e.jsx(se,{children:e.jsx(J,{icon:X})})]})}),e.jsxs("strong",{className:"m-3 align-self-start",children:["Total Items: ",E.length]}),L?e.jsx(F,{color:"warning",children:L}):e.jsxs(te,{hover:!0,responsive:!0,striped:!0,className:"text-center",children:[e.jsx(re,{children:e.jsxs(M,{children:[e.jsx(p,{scope:"col",children:"Item Name"}),e.jsx(p,{scope:"col",children:"Total Quantity"}),e.jsx(p,{scope:"col",children:"Warehouse Locations"}),e.jsx(p,{scope:"col",children:"Status"})]})}),e.jsx(ae,{children:E.map((r,f)=>e.jsxs(M,{children:[e.jsx(v,{children:r.itemName}),e.jsx(v,{children:e.jsx("strong",{children:r.quantity})}),e.jsx(v,{children:e.jsx(W,{className:"locations-list",children:h(r.locations).map((d,D)=>{const s=d.warehouse;return e.jsx(W,{className:"location-item",children:e.jsxs(W,{className:"location-details",children:[e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("span",{className:"warehouse-name",children:(s==null?void 0:s.warehouseName)||"Unknown Warehouse"}),e.jsx(oe,{color:s!=null&&s.deleted?"danger":"success",className:"ms-2",children:s!=null&&s.deleted?"Deleted":"Active"})]}),e.jsx("span",{className:"warehouse-address",children:(s==null?void 0:s.address)||"No address available"}),e.jsxs("span",{className:"quantity-badge",children:["Qty: ",d.quantity]})]})},(s==null?void 0:s._id)||`deleted-${D}`)})})}),e.jsx(v,{children:e.jsx(oe,{color:P(r.status||(r.quantity>0?"Stocked":"Out of Stock")),children:r.status||(r.quantity>0?"Stocked":"Out of Stock")})})]},r._id||f))})]}),u.length===0&&!L&&e.jsx(F,{color:"warning",className:"text-center mt-5 w-75 mx-auto",children:"No items found."}),e.jsxs(ne,{align:"center",children:[e.jsx(A,{disabled:w===1,onClick:()=>g(r=>Math.max(r-1,1)),children:"Previous"}),[...Array(k).keys()].map(r=>e.jsx(A,{active:r+1===w,onClick:()=>g(r+1),children:r+1},r+1)),e.jsx(A,{disabled:w===k,onClick:()=>g(r=>Math.min(r+1,k)),children:"Next"})]})]})},Se=`
  .locations-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .location-item {
    display: flex;
    flex-direction: column;
    padding: 8px;
    background-color: #f8f9fa;
    border-radius: 4px;
    width: fit-content;

  }

  .location-details {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 4px;
  }

  .warehouse-name {
    font-weight: 500;
    color: #495057;
  }

  .warehouse-address {
    color: #6c757d;
    font-size: 0.9em;
    font-style: italic;
  }

  .quantity-badge {
    background-color: #e9ecef;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 0.85em;
    color: #495057;
  }

`,he=document.createElement("style");he.innerText=Se;document.head.appendChild(he);const Be=()=>{const[y,C]=a.useState([]),[_,u]=a.useState([]),[b,x]=a.useState(!1),[S,L]=a.useState(null),[N,I]=a.useState(0);a.useEffect(()=>{(async()=>{x(!0);try{const n=await V.get("https://log2_backend.chysev.cloud/api/v1/purchaseOrder");console.log(n.data),n.status===200&&C(n.data)}catch(n){L(n.message)}finally{x(!1)}})()},[N]);const w=()=>{I(h=>h+1)},g=h=>{C(n=>[...n,h]),u(n=>[...n,h]),w()},P=h=>{C(n=>n.filter(j=>j._id!==h)),u(n=>n.filter(j=>j._id!==h)),w()},O=h=>{C(n=>n.map(j=>j._id===h._id?h:j)),u(n=>n.map(j=>j._id===h._id?h:j)),w()};return e.jsx(e.Fragment,{children:e.jsxs(ve,{activeItemKey:"Warehouse Items Details",children:[e.jsxs(ye,{variant:"tabs",children:[e.jsx(G,{itemKey:"Warehouse Items Details",children:"Warehouse Items Details"}),e.jsx(G,{itemKey:"For Reiceve",children:"For Reiceve"}),e.jsx(G,{itemKey:"Items",children:"Items"})]}),e.jsxs(Ne,{children:[e.jsx(Y,{className:"p-3",itemKey:"Warehouse Items Details",children:e.jsx(we,{warehousing:y,loading:b,error:S,onDeleteItem:P,onUpdateItem:O,onRefresh:w})}),e.jsx(Y,{className:"p-3",itemKey:"For Reiceve",children:e.jsxs(le,{children:[e.jsx(ie,{children:"Item Reiceving"}),e.jsx(Ce,{onAddItem:g})]})}),e.jsx(Y,{className:"p-3",itemKey:"Items",children:e.jsxs(le,{children:[e.jsx(ie,{children:"Items"}),e.jsx(be,{items:_,loading:b,error:S})]})})]})]})})};export{Be as default};
