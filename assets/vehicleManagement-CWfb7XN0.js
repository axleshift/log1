import{r as c,j as e,C as L}from"./index-BGH5WKgn.js";import{a as k}from"./index-DW_MHI2K.js";import{F as M,f as Y,a as _,b as E,c as z,d as G,C as x}from"./DefaultLayout-D-YVYAE7.js";import{a as S}from"./CButton-Bwssm7-p.js";import{C as R,a as A,b as U,c as q,d as B}from"./CModalTitle-D48pPIQc.js";import{C as w}from"./CAlert-8_0YzkvJ.js";import{C as P}from"./CForm-BZRjToy7.js";import{C as d}from"./CFormInput-BE5aKP1g.js";import{C as I}from"./CFormSelect-DfnBAduD.js";import{C as D}from"./index.esm-CQ0Ql4Ln.js";import{C as $,a as H}from"./CInputGroupText-DTBNZhpZ.js";import{C as Q,a as J,b as O,c as K}from"./CAccordionHeader-ByNUPfl8.js";import{C as W}from"./CCard--Vw0nMq9.js";import{C as X}from"./CCardBody-DbRd0EZb.js";import"./CCloseButton-C08nsniV.js";import"./cil-user-Ddrdy7PS.js";const Z=({onAddVehicle:r})=>{const V=k.create({baseURL:"http://localhost:5057",withCredentials:!0}),[C,b]=c.useState(!1),[u,p]=c.useState(!1),[g,h]=c.useState(null),[m,n]=c.useState(null),[t,f]=c.useState(!1),T={idNum:Math.floor(Math.random()*1e6).toString(),brand:"",model:"",year:"",regisNumber:"",type:"",capacity:"",fuelType:"",currentMileage:"",status:"available"},[o,l]=c.useState(T),a=[{label:"Van",value:"van"},{label:"Pickup Truck",value:"pickup"},{label:"Box Truck",value:"box"},{label:"Straight Truck",value:"straight"},{label:"Semi-Trailer Trucks",value:"semi"},{label:"Refrigerated Trucks",value:"refrigerated"},{label:"Tanker Trucks",value:"tanker"},{label:"Flatbed Trucks",value:"flatbed"}],v=[{label:"Diesel",value:"diesel"},{label:"Gasoline",value:"gasoline"}],y=async i=>{i.currentTarget.checkValidity()===!1&&(i.preDefault(),i.stopPropagation()),b(!0),f(!0);try{const j=await V.post("/api/v1/vehicle",o);j.data.success&&(n("Vehicle added successfully"),r(j.data.data),setTimeout(()=>{n(null),l(T),f(!1),b(!1)},2e3))}catch(j){h(j.response.data.message),setTimeout(()=>{h(null)},2e3)}f(!1)};return e.jsx(e.Fragment,{children:t?e.jsx(L,{color:"primary",size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsxs(S,{color:"primary",variant:"outline",onClick:()=>p(!0),children:[e.jsx(M,{icon:Y})," Add Vehicle"]}),e.jsxs(R,{visible:u,onClose:()=>p(!1),children:[e.jsx(A,{closeButton:!0,children:e.jsx(U,{children:"Add Vehicle"})}),g&&e.jsx(w,{color:"danger",className:"m-3",children:g}),m&&e.jsx(w,{color:"success",className:"m-3",children:m}),e.jsx(q,{children:e.jsxs(P,{noValidate:!0,validated:C,children:[e.jsx(d,{className:"mb-3",floatingLabel:"ID Number",placeholder:"ID Number",type:"text",id:"idNum",label:"ID Number",value:o.idNum,disabled:!0}),e.jsx(d,{className:"mb-3",floatingLabel:"Brand",placeholder:"Brand",type:"text",id:"brand",label:"Brand",autoComplete:"off",required:!0,value:o.brand,onChange:i=>l({...o,brand:i.target.value})}),e.jsx(d,{className:"mb-3",floatingLabel:"Model",placeholder:"Model",type:"text",id:"model",label:"Model",autoComplete:"off",required:!0,value:o.model,onChange:i=>l({...o,model:i.target.value})}),e.jsx(d,{type:"number",className:"mb-3",floatingLabel:"Year",placeholder:"Year",id:"year",autoComplete:"off",value:o.year,required:!0,min:"1990",max:new Date().getFullYear(),onChange:i=>{const s=i.target.value;l({...o,year:s})},onBlur:i=>{const s=parseInt(i.target.value);(s<1990||s>new Date().getFullYear()||isNaN(s))&&(alert("Please enter a year between 1990 and "+new Date().getFullYear()),l({...o,year:1990}))}}),e.jsx(d,{className:"mb-3",floatingLabel:"Registration Number",placeholder:"Registration Number",type:"text",id:"regisNumber",label:"Registration Number",autoComplete:"off",required:!0,value:o.regisNumber,onChange:i=>l({...o,regisNumber:i.target.value})}),e.jsx(I,{className:"mb-3",floatingLabel:"Vehicle Type",placeholder:"Vehicle Type",id:"type",value:o.type,required:!0,onChange:i=>l({...o,type:i.target.value}),options:[{label:"Select Vehicle Type",value:""},...a]}),e.jsx(d,{className:"mb-2",type:"number",floatingLabel:"Capacity",placeholder:"Capacity",id:"capacity",label:"Capacity",autoComplete:"off",required:!0,min:"0",value:o.capacity,onChange:i=>l({...o,capacity:i.target.value})}),e.jsx(I,{className:"mb-3",floatingLabel:"Fuel Type",placeholder:"Fuel Type",id:"fuelType",value:o.fuelType,required:!0,onChange:i=>l({...o,fuelType:i.target.value}),options:[{label:"Select Fuel Type",value:""},...v]}),e.jsx(d,{className:"mb-3",floatingLabel:"Current Mileage",placeholder:"Current Mileage",type:"number",id:"mileage",label:"Current Mileage",autoComplete:"off",required:!0,value:o.currentMileage,min:"0",onChange:i=>l({...o,currentMileage:i.target.value})})]})}),e.jsxs(B,{children:[e.jsx(S,{color:"secondary",variant:"outline",disabled:t,onClick:()=>{p(!1),l(T),b(!1),h(null)},children:t?e.jsx(L,{color:"secondary",size:"sm"}):"Cancel"}),e.jsx(S,{color:"primary",variant:"outline",disabled:t,onClick:y,children:t?e.jsx(L,{color:"primary",size:"sm"}):"Save"})]})]})]})})},ee=({vehicle:r,onDeleteVehicle:N})=>{const C=k.create({baseURL:"http://localhost:5057"}),[b,u]=c.useState(!1),[p,g]=c.useState(null),h=async()=>{u(!0);try{(await C.delete(`/api/v1/vehicle/${r._id}`)).status===200&&(alert("Vehicle deleted successfully"),u(!1),N(r._id),u(!1),g(null))}catch(m){g(m)}finally{u(!1)}};return e.jsx(e.Fragment,{children:e.jsx(S,{color:"danger",variant:"outline",disabled:b,onClick:h,children:b?e.jsx(L,{size:"sm"}):e.jsx(M,{icon:_})})})},ae=({vehicle:r,onUpdateVehicle:N})=>{const C=k.create({baseURL:"http://localhost:5057",withCredentials:!0}),[b,u]=c.useState(!1),[p,g]=c.useState(null),[h,m]=c.useState(null),[n,t]=c.useState(!1),[f,T]=c.useState(!1),o={idNum:r.idNum,brand:r.brand,model:r.model,year:r.year,regisNumber:r.regisNumber,type:r.type,capacity:r.capacity,fuelType:r.fuelType,currentMileage:r.currentMileage},[l,a]=c.useState(o),v=[{label:"Van",value:"van"},{label:"Pickup Truck",value:"pickup"},{label:"Box Truck",value:"box"},{label:"Straight Truck",value:"straight"},{label:"Semi-Trailer Trucks",value:"semi"},{label:"Refrigerated Trucks",value:"refrigerated"},{label:"Tanker Trucks",value:"tanker"},{label:"Flatbed Trucks",value:"flatbed"}],y=[{label:"Diesel",value:"diesel"},{label:"Gasoline",value:"gasoline"}],i=async s=>{t(!0),s.currentTarget.checkValidity()===!1&&s.stopPropagation(),T(!0);try{const F=await C.put(`/api/v1/vehicle/${r._id}`,l);F.data.success&&(g("Vehicle updated successfully"),N(F.data.data),setTimeout(()=>{a(o),g(null),t(!1),T(!1),u(!1)},2e3))}catch(F){m(F.response.data.message),setTimeout(()=>{m(null)},2e3)}finally{t(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(S,{color:"primary",variant:"outline",disabled:n,onClick:()=>u(!0),className:"me-2",children:n?e.jsx(L,{size:"sm"}):e.jsx(M,{icon:E})}),e.jsxs(R,{visible:b,onClose:()=>u(!1),children:[e.jsx(A,{closeButton:!0,children:e.jsx(U,{children:"Update Vehicle"})}),h&&e.jsx(w,{color:"danger",className:"m-3",children:h}),p&&e.jsx(w,{color:"success",className:"m-3",children:p}),e.jsx(q,{children:e.jsxs(P,{noValidate:!0,validated:f,children:[e.jsx(d,{className:"mb-3",floatingLabel:"ID Number",placeholder:"ID Number",type:"text",id:"idNum",label:"ID Number",value:l.idNum,disabled:!0}),e.jsx(d,{className:"mb-3",floatingLabel:"Brand",placeholder:"Brand",type:"text",id:"brand",label:"Brand",required:!0,value:l.brand,onChange:s=>a({...l,brand:s.target.value})}),e.jsx(d,{className:"mb-3",floatingLabel:"Model",placeholder:"Model",type:"text",id:"model",label:"Model",required:!0,value:l.model,onChange:s=>a({...l,model:s.target.value})}),e.jsx(d,{type:"number",className:"mb-3",floatingLabel:"Year",placeholder:"Year",id:"year",value:l.year,required:!0,min:"1990",max:new Date().getFullYear(),onChange:s=>{const j=s.target.value;a({...l,year:j})},onBlur:s=>{const j=parseInt(s.target.value);(j<1990||j>new Date().getFullYear()||isNaN(j))&&(alert("Please enter a year between 1990 and "+new Date().getFullYear()),a({...l,year:1990}))}}),e.jsx(d,{className:"mb-3",floatingLabel:"Registration Number",placeholder:"Registration Number",type:"text",id:"regisNumber",label:"Registration Number",required:!0,value:l.regisNumber,onChange:s=>a({...l,regisNumber:s.target.value})}),e.jsx(I,{className:"mb-3",floatingLabel:"Vehicle Type",placeholder:"Vehicle Type",id:"type",value:l.type,required:!0,onChange:s=>a({...l,type:s.target.value}),options:[{label:"Select Vehicle Type",value:""},...v]}),e.jsx(d,{className:"mb-2",type:"number",floatingLabel:"Capacity",placeholder:"Capacity",id:"capacity",label:"Capacity",required:!0,min:"0",value:l.capacity,onChange:s=>a({...l,capacity:s.target.value})}),e.jsx(I,{className:"mb-3",floatingLabel:"Fuel Type",placeholder:"Fuel Type",id:"fuelType",label:"Fuel Type",value:l.fuelType,required:!0,onChange:s=>a({...l,fuelType:s.target.value}),options:[{label:"Select Fuel Type",value:""},...y]}),e.jsx(d,{className:"mb-3",floatingLabel:"Current Mileage",placeholder:"Current Mileage",type:"number",id:"mileage",label:"Current Mileage",required:!0,min:"0",value:l.currentMileage,onChange:s=>a({...l,currentMileage:s.target.value})})]})}),e.jsxs(B,{children:[e.jsx(S,{color:"secondary",variant:"outline",disabled:n,onClick:()=>{u(!1),m(null),a(r),T(!1)},children:n?e.jsx(L,{size:"sm",color:"secondary"}):"Cancel"}),e.jsx(S,{color:"success",variant:"outline",disabled:n,onClick:i,children:n?e.jsx(L,{size:"sm",color:"success"}):"Save Changes"})]})]})]})},le=({vehicle:r,loading:N,error:V,onDeleteVehicle:C,onUpdateVehicle:b})=>{const[u,p]=c.useState([]),g=JSON.parse(sessionStorage.getItem("user")),h=["manager","admin"],[m,n]=c.useState(null),[t,f]=c.useState("");k.create({baseURL:"http://localhost:5057",withCredentials:!0}),c.useEffect(()=>{p(r)},[r]),c.useEffect(()=>{(()=>{if(t==="")p(r);else{const v=r.filter(y=>y.idNum.toString().includes(t)||y.brand.toLowerCase().includes(t.toLowerCase())||y.model.toLowerCase().includes(t.toLowerCase())||y.year.toString().includes(t)||y.type.toLowerCase().includes(t.toLowerCase())||y.regisNumber.toLowerCase().includes(t.toLowerCase())||y.capacity.toString().includes(t)||l.find(i=>i.value===y.status).label.toLowerCase().includes(t.toLowerCase()));p(v),v.length===0?n("No vehicles found"):n(null)}})()},[t,r]);const o=a=>{switch(a){case"available":return"green";case"in_use":return"red";case"maintenance":return"orange";case"inspection":return"yellow";default:return"black"}},l=[{value:"available",label:"Available"},{value:"in_use",label:"In Use"},{value:"maintenance",label:"Maintenance"},{value:"inactive",label:"Inactive"},{value:"inspection",label:"Inspection"}];return r.length===0?e.jsx(w,{color:"danger",className:"text-center justify-content-center",children:"No vehicles found"}):e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"mt-3",children:e.jsxs($,{className:"w-50 mb-3",children:[e.jsx(d,{type:"text",placeholder:"Search vehicles",id:"search",value:t,onChange:a=>f(a.target.value),className:"w-50 me-2 "}),e.jsx(H,{children:e.jsx(M,{icon:z})})]})}),e.jsx(Q,{className:"m-2",children:u.map(a=>e.jsxs(J,{children:[e.jsx(O,{children:e.jsxs("p",{className:"w-100 m-1 ",children:["Registration Number:",e.jsx("strong",{className:"ms-2",children:a.regisNumber}),e.jsx(M,{icon:G,color:o(a.status),className:"m-2 float-end"}),e.jsx("small",{className:"m-2 float-end",children:l.find(v=>v.value===a.status).label})]})}),e.jsxs(K,{children:[e.jsxs(x,{children:["ID: ",a.idNum]}),e.jsxs(x,{children:["Brand: ",a.brand]}),e.jsxs(x,{children:["Model: ",a.model]}),e.jsxs(x,{children:["Year: ",a.year]}),e.jsxs(x,{children:["Type: ",a.type]}),e.jsxs(x,{children:["Capacity: ",a.capacity]}),e.jsxs(x,{children:["Status: ",l.find(v=>v.value===a.status).label]}),e.jsxs(x,{children:["Driver:"," ",a.assignedDriver?`${a.assignedDriver.driverName} - ${a.assignedDriver.licenseNumber}`:"Not assigned"]}),e.jsxs(x,{children:["Fuel Type: ",a.fuelType]}),e.jsxs(x,{children:["Current Mileage: ",a.currentMileage]}),e.jsxs(D,{className:"d-flex justify-content-end mt-3",children:[e.jsx(ae,{vehicle:a,onUpdateVehicle:b}),h.includes(g.data.user.role)&&e.jsx(ee,{vehicle:a,onDeleteVehicle:C})]})]})]},a._id))}),m&&e.jsx(w,{color:"danger",className:"text-center justify-content-center",children:m})]})},te="http://localhost:5057",se=k.create({baseURL:te}),je=()=>{const[r,N]=c.useState([]),[V,C]=c.useState(!0),[b,u]=c.useState(null),p=async()=>{C(!0);try{const n=await se.get("/api/v1/vehicle");n.status===200?(N(n.data.data),C(!1)):u(n.data.message)}catch(n){u(n.message)}finally{C(!1)}};c.useEffect(()=>{p()});const g=n=>{N(t=>[...t,n])},h=n=>{N(t=>t.filter(f=>f.id!==n))},m=n=>{N(t=>t.map(f=>f.id===n.id?n:f))};return e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"text-center",children:"Vehicle Management"}),e.jsx(D,{className:"m-3",children:e.jsx(Z,{onAddVehicle:g})}),e.jsxs(W,{children:[e.jsx(x,{children:"Vehicle List"}),e.jsx(X,{className:"md-3",children:e.jsx(le,{vehicle:r,error:b,onDeleteVehicle:h,onUpdateVehicle:m,loading:V})})]})]})};export{je as default};
