import{l as ge,r as o,j as e,k as ce,n as K,A as Se}from"./index-D6mlluMj.js";import{s as Te,F as z,k as we,I as Ee,f as Me,J as Re,b as Qe,a as _e,K as $e,d as Ae,L as Oe,l as De,y as ze,v as qe}from"./index-c-DuCOGy.js";import{a as _}from"./CButton-BikbuiKU.js";import{C as me,a as ue,b as pe,c as he}from"./CModalHeader-F8HQcIQD.js";import{C as Le}from"./CModalTitle-B0kw4xSC.js";import{C as de}from"./CAlert-DyOx87OV.js";import{C as Pe}from"./CForm-Cak7Qu-d.js";import{C as T}from"./CInputGroup-B1punbFT.js";import{C as h,a as ke}from"./CFormInput-Bv1zYdGP.js";import{C as fe}from"./CFormSelect-cKRnp-Rs.js";import{C as Ne}from"./1-uMqa3qbm.js";import{C as Fe}from"./CFormTextarea-DUvZts1B.js";import{C as je}from"./CContainer-BeypE0T3.js";import{C as ee}from"./CCard-Dsu2SNrA.js";import{C as te}from"./CCardBody-BqwsaOfU.js";import{a as ve,C as W}from"./CRow-BvK8Yfnc.js";import{C as Ge}from"./CInputGroupText-i2rWi08d.js";import{C as Ue,a as Be,b as He,c as Je}from"./CAccordionHeader-jcBNNrEk.js";import{C as We,a as be}from"./CPaginationItem-BF8XDZjU.js";import{C as Ke}from"./DefaultLayout-Y1MpLCC1.js";import"./index.esm-BlirLcHy.js";import"./cil-user-Ddrdy7PS.js";const Xe=({onAddFuelog:d})=>{var k,J;const{showSuccess:X,showError:D}=ge(),[q,F]=o.useState(!1),[G,ae]=o.useState(null),[U,B]=o.useState(!1),[Y,j]=o.useState(!1),[ie,oe]=o.useState(!1),[se,I]=o.useState(null),[Z,le]=o.useState([]),[w,E]=o.useState([]),$=new Date().toISOString().split("T")[0],M={vehicleId:"",driverId:"",vehicleDetails:{brand:"",model:"",regisNumber:"",fuelType:""},driverDetails:{driverName:""},date:"",receiptNumber:"",fuelQuantity:"",fuelType:"",costPerLiter:"",totalCost:"",currentMileage:"",receiptImage:"",route:{start:"",end:"",distance:""},notes:"",litersPer100km:"",kmPerLiter:"",mpg:""},[l,r]=o.useState(M);o.useEffect(()=>{(async()=>{try{F(!0);const[p,i]=await Promise.all([K.get("api/v1/driver"),K.get("api/v1/vehicle/in-use")]);le(p.data.data),E(i.data.data)}catch{D("Error fetching initial data")}finally{F(!1)}})()},[]);const f=c=>{const{id:p,value:i}=c.target;if(p.includes("route.")){const a=p.split(".")[1];r(t=>{const s={...t,route:{...t.route,[a]:i}};if(s.route.distance&&s.fuelQuantity){const n=parseFloat(s.route.distance),m=parseFloat(s.fuelQuantity);if(n>0&&m>0){const L=m/n*100;s.litersPer100km=L.toFixed(2);const A=n/m;s.kmPerLiter=A.toFixed(2);const R=m*.264172,re=n*.621371/R;s.mpg=re.toFixed(2)}}return s})}else if(p==="vehicleId"){const a=w.find(s=>s._id===i),t=Z.find(s=>s._id===(a==null?void 0:a.assignedDriver));r(s=>({...s,vehicleId:i,driverId:(a==null?void 0:a.assignedDriver)||"",vehicleDetails:{brand:(a==null?void 0:a.brand)||"",model:(a==null?void 0:a.model)||"",regisNumber:(a==null?void 0:a.regisNumber)||"",fuelType:(a==null?void 0:a.fuelType)||""},driverDetails:{driverName:(t==null?void 0:t.driverName)||""},currentMileage:(a==null?void 0:a.currentMileage)||"",fuelType:(a==null?void 0:a.fuelType)||""}))}else r(p==="fuelQuantity"||p==="costPerLiter"?a=>{const t={...a,[p]:i},s=parseFloat(p==="fuelQuantity"?i:a.fuelQuantity),n=parseFloat(p==="costPerLiter"?i:a.costPerLiter);if(!isNaN(s)&&!isNaN(n)&&(t.totalCost=(s*n).toFixed(2)),p==="fuelQuantity"&&t.route.distance){const m=parseFloat(t.route.distance),L=parseFloat(i);if(m>0&&L>0){const A=L/m*100;t.litersPer100km=A.toFixed(2);const R=m/L;t.kmPerLiter=R.toFixed(2);const O=L*.264172,ne=m*.621371/O;t.mpg=ne.toFixed(2)}}return t}:a=>({...a,[p]:i}))},V=c=>{const p=c.target.files[0];if(p){if(!p.type.match("image.*")){D("Please upload an image file"),c.target.value="";return}const i=5*1024*1024;if(p.size>i){D("File size should be less than 5MB"),c.target.value="";return}r(t=>({...t,receiptImage:p}));const a=new FileReader;a.onloadend=()=>{I(a.result)},a.readAsDataURL(p)}},H=async c=>{if(c.preventDefault(),c.stopPropagation(),c.currentTarget.checkValidity()===!1){oe(!0);return}F(!0);try{const i=new FormData;if(i.append("vehicleId",l.vehicleId),i.append("driverId",l.driverId),i.append("vehicleDetails[brand]",l.vehicleDetails.brand),i.append("vehicleDetails[model]",l.vehicleDetails.model),i.append("vehicleDetails[regisNumber]",l.vehicleDetails.regisNumber),i.append("vehicleDetails[fuelType]",l.vehicleDetails.fuelType),i.append("driverDetails[driverName]",l.driverDetails.driverName),i.append("date",l.date),i.append("receiptNumber",l.receiptNumber),i.append("fuelQuantity",l.fuelQuantity),i.append("fuelType",l.fuelType),i.append("costPerLiter",l.costPerLiter),i.append("totalCost",l.totalCost),i.append("currentMileage",l.currentMileage),i.append("notes",l.notes),i.append("litersPer100km",l.litersPer100km),i.append("kmPerLiter",l.kmPerLiter),i.append("mpg",l.mpg),i.append("route[start]",l.route.start),i.append("route[end]",l.route.end),i.append("route[distance]",l.route.distance),l.receiptImage){if(l.receiptImage.size>5242880){D("File size should be less than 5MB");return}i.append("receiptImage",l.receiptImage)}console.log("receiptImage",l.receiptImage);const a=await K.post("api/v1/fuelLogs/fuel-logs",i);console.log("response",a),a.data.success&&(d(a.data.data),X(a.data.message),B(a.data.message),setTimeout(()=>{B(!1),r(M),I(null),j(!1)},2e3))}catch(i){D(i.response.data.message),ae(i.response.data.message),setTimeout(()=>{ae(null)},5e3)}finally{F(!1)}},x=({icon:c})=>{const[p,i]=o.useState(!1);return e.jsx(z,{icon:c,bounce:p,onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1)})};return e.jsxs(e.Fragment,{children:[e.jsxs(_,{color:"primary",variant:"outline",disabled:q,onClick:()=>j(!0),children:[q?e.jsx(ce,{color:"primary",size:"sm"}):e.jsx(x,{icon:Te}),"Add Fuel Log"]}),e.jsxs(me,{visible:Y,onClose:()=>j(!1),size:"lg",children:[e.jsx(ue,{children:e.jsx(Le,{children:"Add Fuel Log"})}),G&&e.jsx(de,{color:"danger",className:"m-3",children:G}),U&&e.jsx(de,{color:"success",className:"m-3",children:U}),e.jsx(pe,{children:e.jsxs(Pe,{noValidate:!0,validated:ie,children:[e.jsxs(T,{children:[e.jsx(h,{type:"date",className:"mb-3",floatingLabel:"date",label:"Receipt Number",id:"date",max:$,value:l.date,onChange:f,required:!0}),e.jsxs(fe,{className:"mb-3",floatingLabel:"Vehicle",label:"Vehicle",id:"vehicleId",value:l.vehicleId,onChange:f,required:!0,children:[e.jsx("option",{value:"",children:"Select Vehicle"}),w==null?void 0:w.map(c=>e.jsx("option",{value:c._id,children:`${c.brand} / ${c.model} / ${c.regisNumber}`},c._id))]})]}),e.jsxs(T,{children:[" ",e.jsx(h,{className:"mb-3",floatingLabel:"Driver",label:"Driver",id:"driverId",value:((k=Z.find(c=>c._id===l.driverId))==null?void 0:k.driverName)||"",onChange:f,disabled:!0}),e.jsxs(fe,{className:"mb-3",floatingLabel:"Fuel Type",label:"Fuel Type",id:"fuelType",required:!0,value:((J=w.find(c=>c._id===l.vehicleId))==null?void 0:J.fuelType)||"",onChange:f,disabled:!0,children:[e.jsx("option",{value:"",children:"Select Fuel Type"}),e.jsx("option",{value:"Gasoline",children:"Gasoline"}),e.jsx("option",{value:"Diesel",children:"Diesel"})]})]}),e.jsxs(T,{children:[e.jsx(h,{className:"mb-3",type:"text",floatingLabel:"Official Reciept",placeholder:"Official Reciept",id:"receiptNumber",value:l.receiptNumber,onChange:f,required:!0,autoComplete:"off"}),e.jsx(h,{className:"mb-3",type:"number",floatingLabel:"Fuel Quantity",placeholder:"Fuel Quantity",id:"fuelQuantity",value:l.fuelQuantity,onChange:f,required:!0,autoComplete:"off",min:"0",step:"0.01",feedbackInvalid:"Please enter a valid fuel quantity"}),e.jsx(h,{className:"mb-3",type:"number",floatingLabel:"Cost Per Liter",placeholder:"Cost Per Liter",id:"costPerLiter",value:l.costPerLiter,onChange:f,autoComplete:"off",feedbackInvalid:"Please enter a valid cost per liter"}),e.jsx(h,{className:"mb-3",type:"number",floatingLabel:"Total Cost",placeholder:"Total Cost",id:"totalCost",value:l.totalCost,onChange:f,autoComplete:"off",min:"0",step:"0.01",disabled:!0,feedbackInvalid:"Please enter a valid total cost"})]}),e.jsxs(T,{children:[e.jsx(h,{className:"mb-3",type:"number",floatingLabel:"Odometer Reading",placeholder:"Odometer Reading",id:"currentMileage",value:l.currentMileage,onChange:f,autoComplete:"off",feedbackInvalid:"Please enter a valid odometer reading"}),e.jsx(h,{className:"mb-3",type:"text",floatingLabel:"Start Location",placeholder:"Start Location",id:"route.start",value:l.route.start,onChange:f,autoComplete:"off",feedbackInvalid:"Please enter a valid start location"}),e.jsx(h,{className:"mb-3",type:"text",floatingLabel:"End Location",placeholder:"End Location",id:"route.end",value:l.route.end,onChange:f,autoComplete:"off",feedbackInvalid:"Please enter a valid end location"}),e.jsx(h,{className:"mb-3",type:"number",floatingLabel:"Distance/kilometers",placeholder:"Distance",id:"route.distance",value:l.route.distance,onChange:f,autoComplete:"off",feedbackInvalid:"Please enter a valid distance"})]}),e.jsxs(T,{className:"mb-3",children:[e.jsx(h,{type:"text",floatingLabel:"L/100km",placeholder:"Liters per 100km",id:"litersPer100km",value:l.litersPer100km,disabled:!0}),e.jsx(h,{type:"text",floatingLabel:"km/L",placeholder:"Kilometers per Liter",id:"kmPerLiter",value:l.kmPerLiter,disabled:!0}),e.jsx(h,{type:"text",floatingLabel:"MPG",placeholder:"Miles per Gallon",id:"mpg",value:l.mpg,disabled:!0})]}),e.jsx(ke,{htmlFor:"receipt",children:"Picture Of Receipts"}),e.jsx(T,{className:"mb-3",children:e.jsx(h,{type:"file",id:"receipt",accept:"image/*",required:!0,feedbackInvalid:"Please upload a receipt image",onChange:V})}),se&&e.jsx("div",{className:"mb-3",children:e.jsx(Ne,{src:se,rounded:!0,align:"center",alt:"Receipts",width:200,height:200})}),e.jsx(Fe,{className:"mb-3",type:"text",floatingLabel:"Notes",placeholder:"Notes",rows:3,id:"notes",value:l.notes,autoCapitalize:"on",autoComplete:"off",onChange:f,feedbackInvalid:"Please enter a valid notes"})]})}),e.jsxs(he,{children:[e.jsx(_,{color:"secondary",onClick:()=>j(!1),children:"Close"}),e.jsx(_,{color:"primary",onClick:H,disabled:q,children:q?e.jsx(ce,{color:"primary",size:"sm"}):"Add"})]})]})]})},Ye=({fuelLogs:d,vehicles:X,drivers:D,loading:q,error:F,onDeleteFuelLog:G,onUpdateFuelLog:ae,onViewReceipt:U})=>{const[B,Y]=o.useState(""),[j,ie]=o.useState("date"),[oe,se]=o.useState("desc"),[I,Z]=o.useState(""),[le,w]=o.useState(null),[E,$]=o.useState(1),[M]=o.useState(10),[l,r]=o.useState(null),f=Se(),V=["manager","admin","super admin"],H=(t,s)=>{if(typeof t=="object"&&(t!=null&&t.brand)&&(t!=null&&t.model)&&(t!=null&&t.regisNumber))return`${t.brand} ${t.model} (${t.regisNumber})`;if(!t&&(s!=null&&s.vehicleDetails))return`${s.vehicleDetails.brand} ${s.vehicleDetails.model} (${s.vehicleDetails.regisNumber}) [Deleted]`;const n=X.find(m=>m._id===t);if(n)return`${n.brand} ${n.model} (${n.regisNumber})`;if(n.deleted===!0)return`${n.brand} ${n.model} (${n.regisNumber}) [Deleted]`},x=(t,s)=>{var m;if(typeof t=="object"&&(t!=null&&t.driverName))return t.driverName;if(!t&&((m=s==null?void 0:s.driverDetails)!=null&&m.driverName))return`${s.driverDetails.driverName} [Deleted]`;const n=D.find(L=>L._id===t);if(n!=null&&n.driverName)return n.driverName},k=d.filter(t=>{var R,O,re,ne;if(!t)return!1;const s=H(t.vehicleId,t).toLowerCase(),n=x(t.driverId,t).toLowerCase(),m=B.toLowerCase(),L=(((R=t.receiptNumber)==null?void 0:R.toLowerCase())||"").includes(m)||s.includes(m)||n.includes(m)||(t.date?new Date(t.date).toLocaleDateString().includes(m):!1)||(((O=t.fuelQuantity)==null?void 0:O.toString())||"").includes(m)||(((re=t.totalCost)==null?void 0:re.toString())||"").includes(m),A=I?(typeof t.vehicleId=="object"?(ne=t.vehicleId)==null?void 0:ne._id:t.vehicleId)===I:!0;return L&&A}).sort((t,s)=>{let n,m;switch(j){case"vehicle":n=H(t.vehicleId,t),m=H(s.vehicleId,s);break;case"driver":n=x(t.driverId,t),m=x(s.driverId,s);break;case"date":n=new Date(t.date||"").getTime(),m=new Date(s.date||"").getTime();break;case"fuelQuantity":case"costPerLiter":case"totalCost":n=parseFloat(t[j]||0),m=parseFloat(s[j]||0);break;default:n=t[j]||"",m=s[j]||""}return!n&&!m?0:n?m?oe==="asc"?n>m?1:-1:n<m?1:-1:-1:1}),J=E*M,c=J-M,p=k.slice(c,J),i=Math.ceil(k.length/M);if(o.useEffect(()=>{$(1)},[B,I]),o.useEffect(()=>{k.length===0?r("No matching records found"):r(null)},[k]),q)return e.jsx(ce,{});if(F)return e.jsx(de,{color:"danger",children:F});const a=({icon:t})=>{const[s,n]=o.useState(!1);return e.jsx(z,{icon:t,bounce:s,onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1)})};return e.jsxs(je,{fluid:!0,className:"p-0",children:[e.jsx(ee,{className:"mb-4 shadow-sm border-0",children:e.jsx(te,{children:e.jsxs(ve,{className:"align-items-center",children:[e.jsx(W,{xs:12,md:6,children:e.jsxs(T,{children:[e.jsx(h,{placeholder:"Search fuel logs...",value:B,onChange:t=>Y(t.target.value),className:"border-end-0"}),e.jsx(Ge,{className:"bg-transparent",children:e.jsx(z,{icon:we})})]})}),e.jsx(W,{xs:12,md:6,className:"mt-3 mt-md-0 text-end",children:e.jsxs("span",{className:"text-muted",children:["Total Records: ",k.length]})})]})})}),e.jsx(Ue,{children:p.map(t=>{var s,n,m,L,A,R,O;return e.jsxs(Be,{children:[e.jsx(He,{onClick:()=>w(le===t._id?null:t._id),children:e.jsxs("div",{className:"d-flex justify-content-sm-between w-100",children:[e.jsxs("ul",{className:"list-unstyled",children:[e.jsxs("li",{className:"ps-3",children:[e.jsx("strong",{children:"Receipt Number:"})," ",t.receiptNumber]}),e.jsxs("li",{className:"ps-3",children:[e.jsx(z,{icon:Ee})," ",new Date(t.date).toLocaleDateString()]})]}),e.jsxs("div",{className:"float-end p-3",children:[e.jsx(z,{icon:Me})," ",e.jsxs("strong",{children:[t.vehicleDetails.regisNumber," ",`(${t.vehicleDetails.model})`]})]})]})}),e.jsx(Je,{children:e.jsxs(ve,{className:"g-4",children:[e.jsx(W,{xs:12,md:4,children:e.jsx(ee,{className:"h-100 border-0 shadow-sm",children:e.jsxs(te,{children:[e.jsxs("h6",{className:"mb-3",children:[e.jsx(z,{icon:Re,className:"text-primary me-2"}),"Vehicle Details"]}),e.jsxs("div",{className:"ms-4",children:[e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Registration:"})," ",((s=t.vehicleId)==null?void 0:s.regisNumber)||((n=t.vehicleDetails)==null?void 0:n.regisNumber)]}),e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Model:"})," ",((m=t.vehicleId)==null?void 0:m.model)||((L=t.vehicleDetails)==null?void 0:L.model)]}),e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:"Brand:"})," ",((A=t.vehicleId)==null?void 0:A.brand)||((R=t.vehicleDetails)==null?void 0:R.brand)]})]})]})})}),e.jsx(W,{xs:12,md:4,children:e.jsx(ee,{className:"h-100 border-0 shadow-sm",children:e.jsxs(te,{children:[e.jsxs("h6",{className:"mb-3",children:[e.jsx(z,{icon:Qe,className:"text-primary me-2"}),"Driver Details"]}),e.jsx("div",{className:"ms-4",children:e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:"Name:"})," ",t.driverId?t.driverId.driverName:e.jsxs("span",{children:[t.driverDetails.driverName," ",e.jsx(_e,{color:"danger",className:"ms-2",children:"Deleted"})]})]})})]})})}),e.jsx(W,{xs:12,md:4,children:e.jsx(ee,{className:"h-100 border-0 shadow-sm",children:e.jsxs(te,{children:[e.jsxs("h6",{className:"mb-3",children:[e.jsx(z,{icon:$e,className:"text-primary me-2"}),"Route Start To End"]}),e.jsxs("div",{className:"ms-4",children:[e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Start Location:"})," ",t.route.start]}),e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:"End Location:"})," ",t.route.end]})]})]})})}),e.jsx(W,{xs:12,md:4,children:e.jsx(ee,{className:"h-100 border-0 shadow-sm",children:e.jsxs(te,{children:[e.jsxs("h6",{className:"mb-3",children:[e.jsx(z,{icon:Ae,className:"text-primary me-2"}),"Fuel Details"]}),e.jsxs("div",{className:"ms-4",children:[e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Quantity:"})," ",t.fuelQuantity," L"]}),e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Cost/L:"})," ",t.costPerLiter]}),e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:"Total:"})," ",t.totalCost]})]})]})})}),e.jsx(W,{xs:12,md:4,children:e.jsx(ee,{className:"h-100 border-0 shadow-sm",children:e.jsxs(te,{children:[e.jsxs("h6",{className:"mb-3",children:[e.jsx(z,{icon:Oe,className:"text-primary me-2"}),"Efficiency Metrics"]}),e.jsxs("div",{className:"ms-4",children:[e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"L/100km:"})," ",t.litersPer100km]}),e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"km/L:"})," ",t.kmPerLiter]}),e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:"MPG:"})," ",t.mpg]})]})]})})}),e.jsx(W,{xs:12,md:4,children:e.jsx(ee,{className:"h-100 border-0 shadow-sm",children:e.jsxs(te,{children:[e.jsxs("h6",{className:"mb-3",children:[e.jsx(z,{icon:De,className:"text-primary me-2"}),"Actions"]}),e.jsxs("div",{className:"d-grid gap-2",children:[e.jsxs(_,{color:"primary",variant:"outline",onClick:()=>U(t),children:[e.jsx(a,{icon:ze,className:"me-2"}),"View Receipt"]}),((O=t.vehicleId)==null?void 0:O.deleted)!==!0&&e.jsxs(_,{color:"info",variant:"outline",onClick:()=>ae(t),children:[e.jsx(a,{icon:De,className:"me-2"}),"Edit"]}),V.includes(f)&&e.jsxs(_,{color:"danger",variant:"outline",onClick:()=>G(t._id),children:[e.jsx(a,{icon:qe,className:"me-2"}),"Delete"]})]})]})})})]})})]},t._id)})}),k.length>0&&e.jsx(ee,{className:"mt-4 border-0 shadow-sm",children:e.jsx(te,{children:e.jsxs(ve,{className:"align-items-center",children:[e.jsx(W,{xs:12,md:6,className:"mb-3 mb-md-0",children:e.jsxs("span",{className:"text-muted",children:["Showing ",c+1," to"," ",Math.min(J,k.length)," of"," ",k.length," entries"]})}),e.jsx(W,{xs:12,md:6,children:e.jsxs(We,{className:"justify-content-end m-0",children:[e.jsx(be,{disabled:E===1,onClick:()=>$(t=>Math.max(t-1,1)),children:"Previous"}),Array.from({length:i},(t,s)=>s+1).map(t=>e.jsx(be,{active:t===E,onClick:()=>$(t),children:t},t)),e.jsx(be,{disabled:E===i,onClick:()=>$(t=>Math.min(t+1,i)),children:"Next"})]})})]})})}),l&&e.jsx(de,{color:"info",className:"text-center mt-4",children:l})]})},Ze=({fuelLog:d,visible:X,onClose:D,onUpdate:q,vehicles:F,drivers:G})=>{var p,i,a,t,s,n,m,L,A,R,O,re,ne;const{showSuccess:ae,showError:U}=ge(),B="https://backend-log1.axleshift.com/",[Y,j]=o.useState(!1),[ie,oe]=o.useState(null),[se,I]=o.useState(null),[Z,le]=o.useState(null),[w,E]=o.useState([]),[$,M]=o.useState([]),l=new Date().toISOString().split("T")[0],[r,f]=o.useState({date:new Date(d.date).toISOString().split("T")[0],receiptNumber:d.receiptNumber,vehicleId:((p=d.vehicleId)==null?void 0:p._id)||d.vehicleId,driverId:((i=d.driverId)==null?void 0:i._id)||d.driverId,vehicleDetails:{brand:((a=d.vehicleId)==null?void 0:a.brand)||((t=d.vehicleDetails)==null?void 0:t.brand)||"",model:((s=d.vehicleId)==null?void 0:s.model)||((n=d.vehicleDetails)==null?void 0:n.model)||"",regisNumber:((m=d.vehicleId)==null?void 0:m.regisNumber)||((L=d.vehicleDetails)==null?void 0:L.regisNumber)||"",fuelType:((A=d.vehicleId)==null?void 0:A.fuelType)||((R=d.vehicleDetails)==null?void 0:R.fuelType)||""},driverDetails:{driverName:((O=d.driverId)==null?void 0:O.driverName)||((re=d.driverDetails)==null?void 0:re.driverName)||""},fuelQuantity:d.fuelQuantity,costPerLiter:d.costPerLiter,totalCost:d.totalCost,currentMileage:d.currentMileage||"",fuelType:d.fuelType||"",route:{start:d.route.start,end:d.route.end,distance:d.route.distance},litersPer100km:d.litersPer100km,kmPerLiter:d.kmPerLiter,mpg:d.mpg,notes:d.notes||""}),[V,H]=o.useState(!1);o.useEffect(()=>{d!=null&&d.receiptImage&&I(`${B}uploads/receipts/${d.receiptImage}`)},[d]),o.useEffect(()=>{(async()=>{try{j(!0);const[g,N]=await Promise.all([K.get("/api/v1/driver"),K.get("/api/v1/vehicle/in-use")]);M(g.data.data),E(N.data.data)}catch{U("Error fetching initial data")}finally{j(!1)}})()},[]);const x=b=>{const{id:g,value:N}=b.target;if(g.includes("route.")){const u=g.split(".")[1];f(C=>{const v={...C,route:{...C.route,[u]:N}};if(v.route.distance&&v.fuelQuantity){const y=parseFloat(v.route.distance),S=parseFloat(v.fuelQuantity);if(y>0&&S>0){const P=S/y*100;v.litersPer100km=P.toFixed(2);const Q=y/S;v.kmPerLiter=Q.toFixed(2);const xe=S*.264172,ye=y*.621371/xe;v.mpg=ye.toFixed(2)}}return v})}else if(g==="vehicleId"){const u=w.find(v=>v._id===N),C=G.find(v=>v._id===(u==null?void 0:u.assignedDriver));f(v=>({...v,vehicleId:N,driverId:(u==null?void 0:u.assignedDriver)||"",vehicleDetails:{brand:(u==null?void 0:u.brand)||"",model:(u==null?void 0:u.model)||"",regisNumber:(u==null?void 0:u.regisNumber)||"",fuelType:(u==null?void 0:u.fuelType)||""},driverDetails:{driverName:(C==null?void 0:C.driverName)||""},currentMileage:(u==null?void 0:u.currentMileage)||"",fuelType:(u==null?void 0:u.fuelType)||""}))}else f(g==="fuelQuantity"||g==="costPerLiter"?u=>{const C={...u,[g]:N},v=parseFloat(g==="fuelQuantity"?N:u.fuelQuantity),y=parseFloat(g==="costPerLiter"?N:u.costPerLiter);if(!isNaN(v)&&!isNaN(y)&&(C.totalCost=(v*y).toFixed(2)),g==="fuelQuantity"&&C.route.distance){const S=parseFloat(C.route.distance),P=parseFloat(N);if(S>0&&P>0){const Q=P/S*100;C.litersPer100km=Q.toFixed(2);const xe=S/P;C.kmPerLiter=xe.toFixed(2);const Ce=P*.264172,Ie=S*.621371/Ce;C.mpg=Ie.toFixed(2)}}return C}:u=>({...u,[g]:N}))},k=b=>{const g=b.target.files[0];if(g){f(u=>({...u,receiptImage:g}));const N=new FileReader;N.onloadend=()=>{I(N.result)},N.readAsDataURL(g)}},J=async b=>{var N,u,C,v;if(b.preventDefault(),!b.currentTarget.checkValidity()){b.stopPropagation(),H(!0);return}j(!0);try{const y=new FormData;Object.keys(r).forEach(P=>{P==="route"?Object.keys(r.route).forEach(Q=>{y.append(`route[${Q}]`,r.route[Q])}):P==="vehicleDetails"?Object.keys(r.vehicleDetails).forEach(Q=>{y.append(`vehicleDetails[${Q}]`,r.vehicleDetails[Q])}):P==="driverDetails"?Object.keys(r.driverDetails).forEach(Q=>{y.append(`driverDetails[${Q}]`,r.driverDetails[Q])}):(P==="receiptImage"&&r[P],y.append(P,r[P]))});const S=await K.put(`/api/v1/fuelLogs/fuel-logs/${d._id}`,y);S.data.success&&(ae(S.data.message),q({...S.data.data,vehicleId:{_id:r.vehicleId,brand:r.vehicleDetails.brand,model:r.vehicleDetails.model,regisNumber:r.vehicleDetails.regisNumber},driverId:{_id:r.driverId,driverName:r.driverDetails.driverName}}),D())}catch(y){U(((u=(N=y.response)==null?void 0:N.data)==null?void 0:u.message)||"Error updating fuel log"),le(((v=(C=y.response)==null?void 0:C.data)==null?void 0:v.message)||"Error updating fuel log")}finally{j(!1)}},c=F.some(b=>b._id===r.vehicleId&&b.deleted);return e.jsxs(me,{visible:X,onClose:D,size:"lg",backdrop:"static",children:[e.jsx(ue,{children:e.jsx(Le,{children:"Add Fuel Log"})}),Z&&e.jsx(de,{color:"danger",className:"m-3",children:Z}),ie&&e.jsx(de,{color:"success",className:"m-3",children:ie}),e.jsx(pe,{children:e.jsxs(Pe,{noValidate:!0,validated:V,children:[e.jsxs(T,{children:[" ",e.jsx(h,{type:"date",className:"mb-3",floatingLabel:"date",label:"Receipt Number",id:"date",max:l,value:r.date,onChange:x,required:!0,disabled:c}),e.jsxs(fe,{className:"mb-3",floatingLabel:"Vehicle",label:"Vehicle",id:"vehicleId",value:r.vehicleId||"",onChange:x,required:!0,disabled:!0,children:[w.map(b=>e.jsxs("option",{value:b._id,children:[b.brand," / ",b.model," / ",b.regisNumber]},b._id)),e.jsxs("option",{value:"",children:[" ",`${r.vehicleDetails.brand} / ${r.vehicleDetails.model} / ${r.vehicleDetails.regisNumber} [DELETED]`]})]})]}),e.jsxs(T,{children:[e.jsx(h,{className:"mb-3",type:"text",floatingLabel:"Driver Name",placeholder:"Driver Name",id:"driverName",value:((ne=G.find(b=>b._id===r.driverId))==null?void 0:ne.driverName)||`${r.driverDetails.driverName} [DELETED]`,onChange:x,disabled:!0}),e.jsxs(fe,{className:"mb-3",floatingLabel:"Fuel Type",label:"Fuel Type",id:"fuelType",required:!0,value:r.fuelType||"",onChange:x,disabled:!0,children:[e.jsx("option",{value:"",children:"Select Fuel Type"}),e.jsx("option",{value:"Gasoline",children:"Gasoline"}),e.jsx("option",{value:"Diesel",children:"Diesel"})]})]}),e.jsxs(T,{children:[e.jsx(h,{className:"mb-3",type:"text",floatingLabel:"Official Reciept",placeholder:"Official Reciept",id:"receiptNumber",value:r.receiptNumber,onChange:x,required:!0,autoComplete:"off",disabled:c}),e.jsx(h,{className:"mb-3",type:"number",floatingLabel:"Fuel Quantity",placeholder:"Fuel Quantity",id:"fuelQuantity",value:r.fuelQuantity,onChange:x,required:!0,autoComplete:"off",min:"0",step:"0.01",feedbackInvalid:"Please enter a valid fuel quantity",disabled:c}),e.jsx(h,{className:"mb-3",type:"number",floatingLabel:"Cost Per Liter",placeholder:"Cost Per Liter",id:"costPerLiter",value:r.costPerLiter,onChange:x,autoComplete:"off",feedbackInvalid:"Please enter a valid cost per liter",disabled:c}),e.jsx(h,{className:"mb-3",type:"number",floatingLabel:"Total Cost",placeholder:"Total Cost",id:"totalCost",value:r.totalCost,onChange:x,autoComplete:"off",min:"0",step:"0.01",disabled:!0,feedbackInvalid:"Please enter a valid total cost"})]}),e.jsxs(T,{children:[e.jsx(h,{className:"mb-3",type:"number",floatingLabel:"Odometer Reading",placeholder:"Odometer Reading",id:"currentMileage",value:r.currentMileage,onChange:x,autoComplete:"off",feedbackInvalid:"Please enter a valid odometer reading",disabled:c}),e.jsx(h,{className:"mb-3",type:"text",floatingLabel:"Start Location",placeholder:"Start Location",id:"route.start",value:r.route.start,onChange:x,autoComplete:"off",feedbackInvalid:"Please enter a valid start location",disabled:c}),e.jsx(h,{className:"mb-3",type:"text",floatingLabel:"End Location",placeholder:"End Location",id:"route.end",value:r.route.end,onChange:x,autoComplete:"off",feedbackInvalid:"Please enter a valid end location",disabled:c}),e.jsx(h,{className:"mb-3",type:"number",floatingLabel:"Distance/kilometers",placeholder:"Distance",id:"route.distance",value:r.route.distance,onChange:x,autoComplete:"off",min:"0",step:"0.01",feedbackInvalid:"Please enter a valid distance",disabled:c})]}),e.jsxs(T,{className:"mb-3",children:[e.jsx(h,{type:"text",floatingLabel:"L/100km",placeholder:"Liters per 100km",id:"litersPer100km",value:r.litersPer100km,disabled:!0}),e.jsx(h,{type:"text",floatingLabel:"km/L",placeholder:"Kilometers per Liter",id:"kmPerLiter",value:r.kmPerLiter,disabled:!0}),e.jsx(h,{type:"text",floatingLabel:"MPG",placeholder:"Miles per Gallon",id:"mpg",value:r.mpg,disabled:!0})]}),e.jsx(ke,{htmlFor:"receipt",children:"Picture Of Receipts"}),e.jsx(T,{className:"mb-3",children:e.jsx(h,{type:"file",id:"receipt",accept:"image/*",onChange:k,disabled:c})}),se&&e.jsx("div",{className:"mb-3",children:e.jsx(Ne,{src:se,rounded:!0,align:"center",alt:"Receipts",width:200,height:200})}),e.jsx(Fe,{className:"mb-3",type:"text",floatingLabel:"Notes",placeholder:"Notes",rows:3,id:"notes",value:r.notes,autoCapitalize:"on",autoComplete:"off",onChange:x,feedbackInvalid:"Please enter a valid notes",disabled:c})]})}),e.jsxs(he,{children:[e.jsx(_,{color:"secondary",onClick:D,children:"Close"}),e.jsx(_,{color:"primary",onClick:J,disabled:Y||c,children:Y?e.jsx(ce,{color:"primary",size:"sm"}):"Add"})]})]})},Nt=()=>{const d="https://backend-log1.axleshift.com/",{showSuccess:X,showError:D}=ge(),[q,F]=o.useState([]),[G,ae]=o.useState([]),[U,B]=o.useState([]),[Y,j]=o.useState(!1),[ie,oe]=o.useState(null),[se,I]=o.useState(!1),[Z,le]=o.useState(null),[w,E]=o.useState(!1),[$,M]=o.useState(null),[l,r]=o.useState(!1),[f,V]=o.useState(null),H=async()=>{var a,t;j(!0);try{const[s,n,m]=await Promise.all([K.get("api/v1/fuelLogs/fuel-logs"),K.get("api/v1/vehicle/in-use"),K.get("api/v1/driver")]);F(s.data.data),ae(n.data.data),B(m.data.data),X("Data fetched successfully")}catch(s){D(((t=(a=s.response)==null?void 0:a.data)==null?void 0:t.message)||"Error fetching data"),oe(s.message)}finally{j(!1)}},x=a=>{le(a),I(!0)},k=async()=>{var a,t;try{await K.delete(`api/v1/fuelLogs/fuel-logs/${Z}`),F(s=>s.filter(n=>n._id!==Z)),X("Fuel log deleted successfully"),I(!1)}catch(s){D(((t=(a=s.response)==null?void 0:a.data)==null?void 0:t.message)||"Error deleting fuel log")}},J=a=>{V(a),r(!0)},c=a=>{F(t=>t.map(s=>s._id===a._id?a:s)),r(!1),V(null)},p=a=>{if(a.receiptImage){const t=`${d}uploads/receipts/${a.receiptImage}`;M(t),E(!0),X("Receipt image loaded successfully")}else D("No receipt image available")};if(o.useEffect(()=>{H()},[]),Y)return e.jsx(ce,{color:"primary",size:"sm",children:"Loading..."});const i=a=>{F(t=>[...t,a]),H()};return e.jsx(e.Fragment,{children:e.jsxs(je,{children:[e.jsx(Ke,{children:"Fuel Management"}),e.jsx(ee,{children:e.jsxs(te,{children:[e.jsx(je,{className:"mb-3",children:e.jsx(Xe,{onAddFuelog:i})}),e.jsx(Ye,{fuelLogs:q,vehicles:G,drivers:U,loading:Y,error:ie,onDeleteFuelLog:x,onUpdateFuelLog:J,onViewReceipt:p})]})}),l&&e.jsx(Ze,{fuelLog:f,visible:l,onClose:()=>{r(!1),V(null)},onUpdate:c,vehicles:G,drivers:U}),e.jsxs(me,{visible:se,onClose:()=>I(!1),alignment:"center",children:[e.jsx(ue,{closeButton:!0,children:"Confirm Delete"}),e.jsx(pe,{children:"Are you sure you want to delete this fuel log? This action cannot be undone."}),e.jsxs(he,{children:[e.jsx(_,{color:"secondary",variant:"outline",onClick:()=>I(!1),children:"Cancel"}),e.jsx(_,{color:"danger",variant:"outline",onClick:k,children:"Delete"})]})]}),e.jsxs(me,{visible:w,onClose:()=>{E(!1),M(null)},size:"lg",alignment:"center",children:[e.jsx(ue,{closeButton:!0,children:"Receipt Image"}),e.jsx(pe,{className:"text-center",children:$&&e.jsx(Ne,{src:$,alt:"Receipt",style:{maxWidth:"100%",maxHeight:"70vh",objectFit:"contain"},onError:a=>{D("Error loading image"),a.target.src="placeholder-image-url.jpg"}})}),e.jsxs(he,{children:[e.jsx(_,{color:"secondary",variant:"outline",onClick:()=>{E(!1),M(null)},children:"Close"}),e.jsx("a",{href:$,target:"_blank",rel:"noopener noreferrer",children:e.jsx(_,{color:"primary",variant:"outline",children:"Open in New Tab"})})]})]})]})})};export{Nt as default};
