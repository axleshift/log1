import{B as be,r as o,j as e,k as oe,A as H,D as Te}from"./index-BElC7Iah.js";import{F as le,h as we,e as Ee,n as ye,o as Ne,a as De,p as Re,g as Me,i as Qe}from"./index-C1mT4LDC.js";import{a as M}from"./CButton-DzbbCv2e.js";import{C as ce,a as ue,b as Le,c as me,d as pe}from"./CModalTitle-42RmhkTZ.js";import{a as ne,C as ke}from"./CForm-DG9u0lFa.js";import{C as R,a as $e}from"./CInputGroupText-B9OyZYiS.js";import{C as p,a as Fe}from"./CFormInput-BkwhWuY3.js";import{C as fe}from"./CFormSelect-DEs4ck2h.js";import{C as xe}from"./1-DTyOmbo5.js";import{C as Se}from"./CFormTextarea-PMWki7Tb.js";import{C as se}from"./CContainer-htpbj9Ya.js";import{C as _e,a as Oe,b as Pe,c as Z,d as Ae,e as K}from"./CTable-bOZpDnwa.js";import{b as qe,c as Ue,d as Ge,C as ze}from"./DefaultLayout-BgzkAF5b.js";import{C as Be,a as ve}from"./CPaginationItem-DRFy3HOm.js";import{C as He}from"./CCard-CdfwD7Ih.js";import{C as We}from"./CCardBody-O4cU2JiN.js";import"./index.esm-BuUAuGL-.js";import"./cil-user-Ddrdy7PS.js";const Je=({onAddFuelog:d})=>{var f,O;const{showSuccess:W,showError:w}=be(),[q,F]=o.useState(!1),[U,V]=o.useState(null),[G,z]=o.useState(!1),[re,b]=o.useState(!1),[J,k]=o.useState(!1),[B,Q]=o.useState(null),[ee,S]=o.useState([]),[P,X]=o.useState([]),ie=new Date().toISOString().split("T")[0],$={vehicleId:"",driverId:"",vehicleDetails:{brand:"",model:"",regisNumber:"",fuelType:""},driverDetails:{driverName:""},date:"",receiptNumber:"",fuelQuantity:"",fuelType:"",costPerLiter:"",totalCost:"",currentMileage:"",receiptImage:null,route:{start:"",end:"",distance:""},notes:"",litersPer100km:"",kmPerLiter:"",mpg:""},[i,s]=o.useState($);o.useEffect(()=>{(async()=>{try{F(!0);const[u,r]=await Promise.all([H.get("/api/v1/driver"),H.get("/api/v1/vehicle/in-use")]);S(u.data.data),X(r.data.data)}catch{w("Error fetching initial data")}finally{F(!1)}})()},[]);const m=v=>{const{id:u,value:r}=v.target;if(u.includes("route.")){const t=u.split(".")[1];s(n=>{const l={...n,route:{...n.route,[t]:r}};if(l.route.distance&&l.fuelQuantity){const a=parseFloat(l.route.distance),h=parseFloat(l.fuelQuantity);if(a>0&&h>0){const x=h/a*100;l.litersPer100km=x.toFixed(2);const I=a/h;l.kmPerLiter=I.toFixed(2);const A=h*.264172,ae=a*.621371/A;l.mpg=ae.toFixed(2)}}return l})}else if(u==="vehicleId"){const t=P.find(l=>l._id===r),n=ee.find(l=>l._id===(t==null?void 0:t.assignedDriver));s(l=>({...l,vehicleId:r,driverId:(t==null?void 0:t.assignedDriver)||"",vehicleDetails:{brand:(t==null?void 0:t.brand)||"",model:(t==null?void 0:t.model)||"",regisNumber:(t==null?void 0:t.regisNumber)||"",fuelType:(t==null?void 0:t.fuelType)||""},driverDetails:{driverName:(n==null?void 0:n.driverName)||""},currentMileage:(t==null?void 0:t.currentMileage)||"",fuelType:(t==null?void 0:t.fuelType)||""}))}else s(u==="fuelQuantity"||u==="costPerLiter"?t=>{const n={...t,[u]:r},l=parseFloat(u==="fuelQuantity"?r:t.fuelQuantity),a=parseFloat(u==="costPerLiter"?r:t.costPerLiter);if(!isNaN(l)&&!isNaN(a)&&(n.totalCost=(l*a).toFixed(2)),u==="fuelQuantity"&&n.route.distance){const h=parseFloat(n.route.distance),x=parseFloat(r);if(h>0&&x>0){const I=x/h*100;n.litersPer100km=I.toFixed(2);const A=h/x;n.kmPerLiter=A.toFixed(2);const te=x*.264172,de=h*.621371/te;n.mpg=de.toFixed(2)}}return n}:t=>({...t,[u]:r}))},_=v=>{const u=v.target.files[0];if(u){s(t=>({...t,receiptImage:u}));const r=new FileReader;r.onloadend=()=>{Q(r.result)},r.readAsDataURL(u)}},Y=async v=>{if(v.preventDefault(),v.stopPropagation(),v.currentTarget.checkValidity()===!1){k(!0);return}F(!0);try{const r=new FormData;r.append("vehicleId",i.vehicleId),r.append("driverId",i.driverId),r.append("vehicleDetails[brand]",i.vehicleDetails.brand),r.append("vehicleDetails[model]",i.vehicleDetails.model),r.append("vehicleDetails[regisNumber]",i.vehicleDetails.regisNumber),r.append("vehicleDetails[fuelType]",i.vehicleDetails.fuelType),r.append("driverDetails[driverName]",i.driverDetails.driverName),r.append("date",i.date),r.append("receiptNumber",i.receiptNumber),r.append("fuelQuantity",i.fuelQuantity),r.append("fuelType",i.fuelType),r.append("costPerLiter",i.costPerLiter),r.append("totalCost",i.totalCost),r.append("currentMileage",i.currentMileage),r.append("notes",i.notes),r.append("litersPer100km",i.litersPer100km),r.append("kmPerLiter",i.kmPerLiter),r.append("mpg",i.mpg),r.append("route[start]",i.route.start),r.append("route[end]",i.route.end),r.append("route[distance]",i.route.distance),i.receiptImage&&r.append("receiptImage",i.receiptImage);const t=await H.post("/api/v1/fuelLogs/fuel-logs",r);t.data.success&&(d(t.data.data),W(t.data.message),z(t.data.message),setTimeout(()=>{z(!1),s($),Q(null),b(!1)},2e3))}catch(r){w(r.response.data.message),V(r.response.data.message),setTimeout(()=>{V(null)},5e3)}finally{F(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs(M,{color:"primary",variant:"outline",disabled:q,onClick:()=>b(!0),children:[q?e.jsx(oe,{color:"primary",size:"sm"}):e.jsx(le,{icon:we}),"Add Fuel Log"]}),e.jsxs(ce,{visible:re,onClose:()=>b(!1),size:"lg",children:[e.jsx(ue,{children:e.jsx(Le,{children:"Add Fuel Log"})}),U&&e.jsx(ne,{color:"danger",className:"m-3",children:U}),G&&e.jsx(ne,{color:"success",className:"m-3",children:G}),e.jsx(me,{children:e.jsxs(ke,{noValidate:!0,validated:J,children:[e.jsxs(R,{children:[e.jsx(p,{type:"date",className:"mb-3",floatingLabel:"date",label:"Receipt Number",id:"date",max:ie,value:i.date,onChange:m,required:!0}),e.jsxs(fe,{className:"mb-3",floatingLabel:"Vehicle",label:"Vehicle",id:"vehicleId",value:i.vehicleId,onChange:m,required:!0,children:[e.jsx("option",{value:"",children:"Select Vehicle"}),P==null?void 0:P.map(v=>e.jsx("option",{value:v._id,children:`${v.brand} / ${v.model} / ${v.regisNumber}`},v._id))]}),e.jsx(p,{className:"mb-3",floatingLabel:"Driver",label:"Driver",id:"driverId",value:((f=ee.find(v=>v._id===i.driverId))==null?void 0:f.driverName)||"",onChange:m,disabled:!0}),e.jsxs(fe,{className:"mb-3",floatingLabel:"Fuel Type",label:"Fuel Type",id:"fuelType",required:!0,value:((O=P.find(v=>v._id===i.vehicleId))==null?void 0:O.fuelType)||"",onChange:m,disabled:!0,children:[e.jsx("option",{value:"",children:"Select Fuel Type"}),e.jsx("option",{value:"Gasoline",children:"Gasoline"}),e.jsx("option",{value:"Diesel",children:"Diesel"})]})]}),e.jsxs(R,{children:[e.jsx(p,{className:"mb-3",type:"text",floatingLabel:"Official Reciept",placeholder:"Official Reciept",id:"receiptNumber",value:i.receiptNumber,onChange:m,required:!0,autoComplete:"off"}),e.jsx(p,{className:"mb-3",type:"number",floatingLabel:"Fuel Quantity",placeholder:"Fuel Quantity",id:"fuelQuantity",value:i.fuelQuantity,onChange:m,required:!0,autoComplete:"off",min:"0",step:"0.01",feedbackInvalid:"Please enter a valid fuel quantity"}),e.jsx(p,{className:"mb-3",type:"number",floatingLabel:"Cost Per Liter",placeholder:"Cost Per Liter",id:"costPerLiter",value:i.costPerLiter,onChange:m,autoComplete:"off",feedbackInvalid:"Please enter a valid cost per liter"}),e.jsx(p,{className:"mb-3",type:"number",floatingLabel:"Total Cost",placeholder:"Total Cost",id:"totalCost",value:i.totalCost,onChange:m,autoComplete:"off",min:"0",step:"0.01",disabled:!0,feedbackInvalid:"Please enter a valid total cost"})]}),e.jsxs(R,{children:[e.jsx(p,{className:"mb-3",type:"number",floatingLabel:"Odometer Reading",placeholder:"Odometer Reading",id:"currentMileage",value:i.currentMileage,onChange:m,autoComplete:"off",feedbackInvalid:"Please enter a valid odometer reading"}),e.jsx(p,{className:"mb-3",type:"text",floatingLabel:"Start Location",placeholder:"Start Location",id:"route.start",value:i.route.start,onChange:m,autoComplete:"off",feedbackInvalid:"Please enter a valid start location"}),e.jsx(p,{className:"mb-3",type:"text",floatingLabel:"End Location",placeholder:"End Location",id:"route.end",value:i.route.end,onChange:m,autoComplete:"off",feedbackInvalid:"Please enter a valid end location"}),e.jsx(p,{className:"mb-3",type:"number",floatingLabel:"Distance/kilometers",placeholder:"Distance",id:"route.distance",value:i.route.distance,onChange:m,autoComplete:"off",feedbackInvalid:"Please enter a valid distance"})]}),e.jsxs(R,{className:"mb-3",children:[e.jsx(p,{type:"text",floatingLabel:"L/100km",placeholder:"Liters per 100km",id:"litersPer100km",value:i.litersPer100km,disabled:!0}),e.jsx(p,{type:"text",floatingLabel:"km/L",placeholder:"Kilometers per Liter",id:"kmPerLiter",value:i.kmPerLiter,disabled:!0}),e.jsx(p,{type:"text",floatingLabel:"MPG",placeholder:"Miles per Gallon",id:"mpg",value:i.mpg,disabled:!0})]}),e.jsx(Fe,{htmlFor:"receipt",children:"Picture Of Receipts"}),e.jsx(R,{className:"mb-3",children:e.jsx(p,{type:"file",id:"receipt",accept:"images/*",onChange:_})}),B&&e.jsx("div",{className:"mb-3",children:e.jsx(xe,{src:B,rounded:!0,align:"center",alt:"Receipts",width:200,height:200})}),e.jsx(Se,{className:"mb-3",type:"text",floatingLabel:"Notes",placeholder:"Notes",rows:3,id:"notes",value:i.notes,autoCapitalize:"on",autoComplete:"off",onChange:m,feedbackInvalid:"Please enter a valid notes"})]})}),e.jsxs(pe,{children:[e.jsx(M,{color:"secondary",onClick:()=>b(!1),children:"Close"}),e.jsx(M,{color:"primary",onClick:Y,disabled:q,children:q?e.jsx(oe,{color:"primary",size:"sm"}):"Add"})]})]})]})},Xe=({fuelLogs:d,vehicles:W,drivers:w,loading:q,error:F,onDeleteFuelLog:U,onUpdateFuelLog:V,onViewReceipt:G})=>{const[z,re]=o.useState(""),[b,J]=o.useState("date"),[k,B]=o.useState("desc"),[Q,ee]=o.useState(""),[S,P]=o.useState(1),[X]=o.useState(10),[ie,$]=o.useState(null),i=Te(),s=["manager","admin"],m=t=>{b===t?B(k==="asc"?"desc":"asc"):(J(t),B("asc"))},_=(t,n)=>{if(typeof t=="object"&&(t!=null&&t.brand)&&(t!=null&&t.model)&&(t!=null&&t.regisNumber))return`${t.brand} ${t.model} (${t.regisNumber})`;if(!t&&(n!=null&&n.vehicleDetails))return`${n.vehicleDetails.brand} ${n.vehicleDetails.model} (${n.vehicleDetails.regisNumber}) [Deleted]`;const l=W.find(a=>a._id===t);if(l)return`${l.brand} ${l.model} (${l.regisNumber})`},Y=(t,n)=>{var a;if(typeof t=="object"&&(t!=null&&t.driverName))return t.driverName;if(!t&&((a=n==null?void 0:n.driverDetails)!=null&&a.driverName))return`${n.driverDetails.driverName} [Deleted]`;const l=w.find(h=>h._id===t);if(l!=null&&l.driverName)return l.driverName},f=d.filter(t=>{var I,A,te,ae;if(!t)return!1;const n=_(t.vehicleId,t).toLowerCase(),l=Y(t.driverId,t).toLowerCase(),a=z.toLowerCase(),h=(((I=t.receiptNumber)==null?void 0:I.toLowerCase())||"").includes(a)||n.includes(a)||l.includes(a)||(t.date?new Date(t.date).toLocaleDateString().includes(a):!1)||(((A=t.fuelQuantity)==null?void 0:A.toString())||"").includes(a)||(((te=t.totalCost)==null?void 0:te.toString())||"").includes(a),x=Q?(typeof t.vehicleId=="object"?(ae=t.vehicleId)==null?void 0:ae._id:t.vehicleId)===Q:!0;return h&&x}).sort((t,n)=>{let l,a;switch(b){case"vehicle":l=_(t.vehicleId,t),a=_(n.vehicleId,n);break;case"driver":l=Y(t.driverId,t),a=Y(n.driverId,n);break;case"date":l=new Date(t.date||"").getTime(),a=new Date(n.date||"").getTime();break;case"fuelQuantity":case"costPerLiter":case"totalCost":l=parseFloat(t[b]||0),a=parseFloat(n[b]||0);break;default:l=t[b]||"",a=n[b]||""}return!l&&!a?0:l?a?k==="asc"?l>a?1:-1:l<a?1:-1:-1:1}),O=S*X,v=O-X,u=f.slice(v,O),r=Math.ceil(f.length/X);return o.useEffect(()=>{P(1)},[z,Q]),o.useEffect(()=>{f.length===0?$("No matching records found"):$(null)},[f]),q?e.jsx(oe,{}):F?e.jsx(ne,{color:"danger",children:F}):e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"col-6 mt-3 mb-3",children:e.jsxs(R,{children:[e.jsx(p,{placeholder:"Search by receipt #, vehicle, driver, date...",value:z,onChange:t=>re(t.target.value),id:"search"}),e.jsx($e,{children:e.jsx(le,{icon:Ee})})]})}),e.jsxs(_e,{hover:!0,responsive:!0,className:"text-center",children:[e.jsx(Oe,{children:e.jsxs(Pe,{children:[e.jsxs(Z,{onClick:()=>m("date"),style:{cursor:"pointer"},children:["Date"," ",b==="date"&&e.jsx(le,{icon:k==="asc"?ye:Ne})]}),e.jsxs(Z,{onClick:()=>m("receiptNumber"),style:{cursor:"pointer"},children:["Receipt #"," ",b==="receiptNumber"&&e.jsx(le,{icon:k==="asc"?ye:Ne})]}),e.jsxs(Z,{onClick:()=>m("vehicle"),style:{cursor:"pointer"},children:["Vehicle ",b==="vehicle"&&(k==="asc"?"↑":"↓")]}),e.jsxs(Z,{onClick:()=>m("driver"),style:{cursor:"pointer"},children:["Driver ",b==="driver"&&(k==="asc"?"↑":"↓")]}),e.jsxs(Z,{onClick:()=>m("fuelQuantity"),style:{cursor:"pointer"},children:["Quantity (L) ",b==="fuelQuantity"&&(k==="asc"?"↑":"↓")]}),e.jsxs(Z,{onClick:()=>m("costPerLiter"),style:{cursor:"pointer"},children:["Cost/L ",b==="costPerLiter"&&(k==="asc"?"↑":"↓")]}),e.jsxs(Z,{onClick:()=>m("totalCost"),style:{cursor:"pointer"},children:["Total Cost ",b==="totalCost"&&(k==="asc"?"↑":"↓")]}),e.jsx(Z,{children:"Fuel Efficiency"}),e.jsx(Z,{children:"Actions"})]})}),e.jsx(Ae,{className:"align-middle",children:u.map(t=>e.jsxs(Pe,{children:[e.jsx(K,{children:new Date(t.date).toLocaleDateString()}),e.jsx(K,{children:t.receiptNumber}),e.jsx(K,{children:t.vehicleId?`${t.vehicleId.brand} ${t.vehicleId.model} (${t.vehicleId.regisNumber})`:e.jsxs(e.Fragment,{children:[`${t.vehicleDetails.brand} ${t.vehicleDetails.model} (${t.vehicleDetails.regisNumber}) `,e.jsx(De,{color:"danger",className:"ms-2",children:"Deleted"})]})}),e.jsx(K,{children:t.driverId?t.driverId.driverName:e.jsxs(e.Fragment,{children:[t.driverDetails.driverName," ",e.jsx(De,{color:"danger",className:"ms-2",children:"Deleted"})]})}),e.jsx(K,{children:t.fuelQuantity}),e.jsx(K,{children:t.costPerLiter}),e.jsx(K,{children:t.totalCost}),e.jsxs(K,{children:[e.jsxs(se,{children:[t.litersPer100km," L/100km"]}),e.jsxs(se,{children:[t.kmPerLiter," km/L"]}),e.jsxs(se,{children:[t.mpg," MPG"]})]}),e.jsx(K,{children:e.jsxs(qe,{variant:"input-group",children:[e.jsx(Ue,{color:"secondary",variant:"outline",children:"Actions"}),e.jsxs(Ge,{children:[e.jsxs(M,{color:"primary",variant:"ghost",className:"m-2",onClick:()=>G(t),children:[e.jsx(le,{icon:Re})," View Receipt"]}),e.jsxs(M,{color:"info",variant:"ghost",className:"m-2",onClick:()=>V(t),children:[e.jsx(le,{icon:Me})," Edit"]}),s.includes(i)&&e.jsxs(M,{color:"danger",variant:"ghost",className:"m-2",onClick:()=>U(t._id),children:[e.jsx(le,{icon:Qe})," Delete"]})]})]})})]},t._id))})]}),f.length>0&&e.jsxs(se,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs(se,{children:["Showing ",v+1," to"," ",Math.min(O,f.length)," of"," ",f.length," entries"]}),e.jsxs(Be,{className:"mt-3",children:[e.jsx(ve,{disabled:S===1,onClick:()=>P(t=>Math.max(t-1,1)),children:"Previous"}),Array.from({length:r},(t,n)=>n+1).map(t=>e.jsx(ve,{active:t===S,onClick:()=>P(t),children:t},t)),e.jsx(ve,{disabled:S===r,onClick:()=>P(t=>Math.min(t+1,r)),children:"Next"})]})]}),ie&&e.jsx(ne,{color:"info",className:"text-center",children:ie})]})},Ye=({fuelLog:d,visible:W,onClose:w,onUpdate:q,vehicles:F,drivers:U})=>{var r,t,n,l,a,h,x,I,A,te,ae,de,ge;const{showSuccess:V,showError:G}=be(),z="http://localhost:5057",[re,b]=o.useState(!1),[J,k]=o.useState(null),[B,Q]=o.useState(null),[ee,S]=o.useState(null),[P,X]=o.useState([]),[ie,$]=o.useState([]),i=new Date().toISOString().split("T")[0],[s,m]=o.useState({date:new Date(d.date).toISOString().split("T")[0],receiptNumber:d.receiptNumber,vehicleId:((r=d.vehicleId)==null?void 0:r._id)||d.vehicleId,driverId:((t=d.driverId)==null?void 0:t._id)||d.driverId,vehicleDetails:{brand:((n=d.vehicleId)==null?void 0:n.brand)||((l=d.vehicleDetails)==null?void 0:l.brand)||"",model:((a=d.vehicleId)==null?void 0:a.model)||((h=d.vehicleDetails)==null?void 0:h.model)||"",regisNumber:((x=d.vehicleId)==null?void 0:x.regisNumber)||((I=d.vehicleDetails)==null?void 0:I.regisNumber)||"",fuelType:((A=d.vehicleId)==null?void 0:A.fuelType)||((te=d.vehicleDetails)==null?void 0:te.fuelType)||""},driverDetails:{driverName:((ae=d.driverId)==null?void 0:ae.driverName)||((de=d.driverDetails)==null?void 0:de.driverName)||""},fuelQuantity:d.fuelQuantity,costPerLiter:d.costPerLiter,totalCost:d.totalCost,currentMileage:d.currentMileage||"",fuelType:d.fuelType||"",route:{start:d.route.start,end:d.route.end,distance:d.route.distance},litersPer100km:d.litersPer100km,kmPerLiter:d.kmPerLiter,mpg:d.mpg,notes:d.notes||""}),[_,Y]=o.useState(!1);o.useEffect(()=>{d!=null&&d.receiptImage&&Q(`${z}/uploads/receipts/${d.receiptImage}`)},[d]),o.useEffect(()=>{(async()=>{try{b(!0);const[C,y]=await Promise.all([H.get("/api/v1/driver"),H.get("/api/v1/vehicle/in-use")]);$(C.data.data),X(y.data.data)}catch{G("Error fetching initial data")}finally{b(!1)}})()},[]);const f=j=>{const{id:C,value:y}=j.target;if(C.includes("route.")){const c=C.split(".")[1];m(N=>{const g={...N,route:{...N.route,[c]:y}};if(g.route.distance&&g.fuelQuantity){const D=parseFloat(g.route.distance),T=parseFloat(g.fuelQuantity);if(D>0&&T>0){const L=T/D*100;g.litersPer100km=L.toFixed(2);const E=D/T;g.kmPerLiter=E.toFixed(2);const he=T*.264172,Ce=D*.621371/he;g.mpg=Ce.toFixed(2)}}return g})}else if(C==="vehicleId"){const c=P.find(g=>g._id===y),N=U.find(g=>g._id===(c==null?void 0:c.assignedDriver));m(g=>({...g,vehicleId:y,driverId:(c==null?void 0:c.assignedDriver)||"",vehicleDetails:{brand:(c==null?void 0:c.brand)||"",model:(c==null?void 0:c.model)||"",regisNumber:(c==null?void 0:c.regisNumber)||"",fuelType:(c==null?void 0:c.fuelType)||""},driverDetails:{driverName:(N==null?void 0:N.driverName)||""},currentMileage:(c==null?void 0:c.currentMileage)||"",fuelType:(c==null?void 0:c.fuelType)||""}))}else m(C==="fuelQuantity"||C==="costPerLiter"?c=>{const N={...c,[C]:y},g=parseFloat(C==="fuelQuantity"?y:c.fuelQuantity),D=parseFloat(C==="costPerLiter"?y:c.costPerLiter);if(!isNaN(g)&&!isNaN(D)&&(N.totalCost=(g*D).toFixed(2)),C==="fuelQuantity"&&N.route.distance){const T=parseFloat(N.route.distance),L=parseFloat(y);if(T>0&&L>0){const E=L/T*100;N.litersPer100km=E.toFixed(2);const he=T/L;N.kmPerLiter=he.toFixed(2);const je=L*.264172,Ie=T*.621371/je;N.mpg=Ie.toFixed(2)}}return N}:c=>({...c,[C]:y}))},O=j=>{const C=j.target.files[0];if(C){m(c=>({...c,receiptImage:C}));const y=new FileReader;y.onloadend=()=>{Q(y.result)},y.readAsDataURL(C)}},v=async j=>{var y,c,N,g;if(j.preventDefault(),!j.currentTarget.checkValidity()){j.stopPropagation(),Y(!0);return}b(!0);try{const D=new FormData;Object.keys(s).forEach(L=>{L==="route"?Object.keys(s.route).forEach(E=>{D.append(`route[${E}]`,s.route[E])}):L==="vehicleDetails"?Object.keys(s.vehicleDetails).forEach(E=>{D.append(`vehicleDetails[${E}]`,s.vehicleDetails[E])}):L==="driverDetails"?Object.keys(s.driverDetails).forEach(E=>{D.append(`driverDetails[${E}]`,s.driverDetails[E])}):(L==="receiptImage"&&s[L],D.append(L,s[L]))});const T=await H.put(`/api/v1/fuelLogs/fuel-logs/${d._id}`,D);T.data.success&&(V(T.data.message),q({...T.data.data,vehicleId:{_id:s.vehicleId,brand:s.vehicleDetails.brand,model:s.vehicleDetails.model,regisNumber:s.vehicleDetails.regisNumber},driverId:{_id:s.driverId,driverName:s.driverDetails.driverName}}),w())}catch(D){G(((c=(y=D.response)==null?void 0:y.data)==null?void 0:c.message)||"Error updating fuel log"),S(((g=(N=D.response)==null?void 0:N.data)==null?void 0:g.message)||"Error updating fuel log")}finally{b(!1)}},u=!F.some(j=>j._id===s.vehicleId);return e.jsxs(ce,{visible:W,onClose:w,size:"lg",backdrop:"static",children:[e.jsx(ue,{children:e.jsx(Le,{children:"Add Fuel Log"})}),ee&&e.jsx(ne,{color:"danger",className:"m-3",children:ee}),J&&e.jsx(ne,{color:"success",className:"m-3",children:J}),e.jsx(me,{children:e.jsxs(ke,{noValidate:!0,validated:_,children:[e.jsxs(R,{children:[" ",e.jsx(p,{type:"date",className:"mb-3",floatingLabel:"date",label:"Receipt Number",id:"date",max:i,value:s.date,onChange:f,required:!0,disabled:u}),e.jsxs(fe,{className:"mb-3",floatingLabel:"Vehicle",label:"Vehicle",id:"vehicleId",value:s.vehicleId||"",onChange:f,required:!0,disabled:!0,children:[P.map(j=>e.jsxs("option",{value:j._id,children:[j.brand," / ",j.model," / ",j.regisNumber]},j._id)),e.jsxs("option",{value:"",children:[" ",`${s.vehicleDetails.brand} / ${s.vehicleDetails.model} / ${s.vehicleDetails.regisNumber} [DELETED]`]})]})]}),e.jsxs(R,{children:[e.jsx(p,{className:"mb-3",type:"text",floatingLabel:"Driver Name",placeholder:"Driver Name",id:"driverName",value:((ge=U.find(j=>j._id===s.driverId))==null?void 0:ge.driverName)||`${s.driverDetails.driverName} [DELETED]`,onChange:f,disabled:!0}),e.jsxs(fe,{className:"mb-3",floatingLabel:"Fuel Type",label:"Fuel Type",id:"fuelType",required:!0,value:s.fuelType||"",onChange:f,disabled:!0,children:[e.jsx("option",{value:"",children:"Select Fuel Type"}),e.jsx("option",{value:"Gasoline",children:"Gasoline"}),e.jsx("option",{value:"Diesel",children:"Diesel"})]})]}),e.jsxs(R,{children:[e.jsx(p,{className:"mb-3",type:"text",floatingLabel:"Official Reciept",placeholder:"Official Reciept",id:"receiptNumber",value:s.receiptNumber,onChange:f,required:!0,autoComplete:"off",disabled:u}),e.jsx(p,{className:"mb-3",type:"number",floatingLabel:"Fuel Quantity",placeholder:"Fuel Quantity",id:"fuelQuantity",value:s.fuelQuantity,onChange:f,required:!0,autoComplete:"off",min:"0",step:"0.01",feedbackInvalid:"Please enter a valid fuel quantity",disabled:u}),e.jsx(p,{className:"mb-3",type:"number",floatingLabel:"Cost Per Liter",placeholder:"Cost Per Liter",id:"costPerLiter",value:s.costPerLiter,onChange:f,autoComplete:"off",feedbackInvalid:"Please enter a valid cost per liter",disabled:u}),e.jsx(p,{className:"mb-3",type:"number",floatingLabel:"Total Cost",placeholder:"Total Cost",id:"totalCost",value:s.totalCost,onChange:f,autoComplete:"off",min:"0",step:"0.01",disabled:!0,feedbackInvalid:"Please enter a valid total cost"})]}),e.jsxs(R,{children:[e.jsx(p,{className:"mb-3",type:"number",floatingLabel:"Odometer Reading",placeholder:"Odometer Reading",id:"currentMileage",value:s.currentMileage,onChange:f,autoComplete:"off",feedbackInvalid:"Please enter a valid odometer reading",disabled:u}),e.jsx(p,{className:"mb-3",type:"text",floatingLabel:"Start Location",placeholder:"Start Location",id:"route.start",value:s.route.start,onChange:f,autoComplete:"off",feedbackInvalid:"Please enter a valid start location",disabled:u}),e.jsx(p,{className:"mb-3",type:"text",floatingLabel:"End Location",placeholder:"End Location",id:"route.end",value:s.route.end,onChange:f,autoComplete:"off",feedbackInvalid:"Please enter a valid end location",disabled:u}),e.jsx(p,{className:"mb-3",type:"number",floatingLabel:"Distance/kilometers",placeholder:"Distance",id:"route.distance",value:s.route.distance,onChange:f,autoComplete:"off",min:"0",step:"0.01",feedbackInvalid:"Please enter a valid distance",disabled:u})]}),e.jsxs(R,{className:"mb-3",children:[e.jsx(p,{type:"text",floatingLabel:"L/100km",placeholder:"Liters per 100km",id:"litersPer100km",value:s.litersPer100km,disabled:!0}),e.jsx(p,{type:"text",floatingLabel:"km/L",placeholder:"Kilometers per Liter",id:"kmPerLiter",value:s.kmPerLiter,disabled:!0}),e.jsx(p,{type:"text",floatingLabel:"MPG",placeholder:"Miles per Gallon",id:"mpg",value:s.mpg,disabled:!0})]}),e.jsx(Fe,{htmlFor:"receipt",children:"Picture Of Receipts"}),e.jsx(R,{className:"mb-3",children:e.jsx(p,{type:"file",id:"receipt",accept:"images/*",onChange:O,disabled:u})}),B&&e.jsx("div",{className:"mb-3",children:e.jsx(xe,{src:B,rounded:!0,align:"center",alt:"Receipts",width:200,height:200})}),e.jsx(Se,{className:"mb-3",type:"text",floatingLabel:"Notes",placeholder:"Notes",rows:3,id:"notes",value:s.notes,autoCapitalize:"on",autoComplete:"off",onChange:f,feedbackInvalid:"Please enter a valid notes",disabled:u})]})}),e.jsxs(pe,{children:[e.jsx(M,{color:"secondary",onClick:w,children:"Close"}),e.jsx(M,{color:"primary",onClick:v,disabled:re||u,children:re?e.jsx(oe,{color:"primary",size:"sm"}):"Add"})]})]})},ht=()=>{const d="http://localhost:5057",{showSuccess:W,showError:w}=be(),[q,F]=o.useState([]),[U,V]=o.useState([]),[G,z]=o.useState([]),[re,b]=o.useState(null),[J,k]=o.useState(!1),[B,Q]=o.useState(null),[ee,S]=o.useState(!1),[P,X]=o.useState(null),[ie,$]=o.useState(!1),[i,s]=o.useState(null),[m,_]=o.useState(!1),[Y,f]=o.useState(null),O=async()=>{var a,h;k(!0);try{const[x,I,A]=await Promise.all([H.get("/api/v1/fuelLogs/fuel-logs"),H.get("/api/v1/vehicle/in-use"),H.get("/api/v1/driver")]);F(x.data.data),V(I.data.data),z(A.data.data),W("Data fetched successfully")}catch(x){w(((h=(a=x.response)==null?void 0:a.data)==null?void 0:h.message)||"Error fetching data"),Q(x.message)}finally{k(!1)}},v=a=>{X(a),S(!0)},u=async()=>{var a,h;try{await H.delete(`/api/v1/fuelLogs/fuel-logs/${P}`),F(x=>x.filter(I=>I._id!==P)),W("Fuel log deleted successfully"),S(!1)}catch(x){w(((h=(a=x.response)==null?void 0:a.data)==null?void 0:h.message)||"Error deleting fuel log")}},r=a=>{f(a),_(!0)},t=a=>{F(h=>h.map(x=>x._id===a._id?a:x)),_(!1),f(null)},n=a=>{if(a.receiptImage){const h=`${d}/uploads/receipts/${a.receiptImage}`;s(h),$(!0),W("Receipt image loaded successfully")}else w("No receipt image available")};if(o.useEffect(()=>{O()},[]),J)return e.jsx(oe,{color:"primary",size:"sm",children:"Loading..."});const l=a=>{F(h=>[...h,a]),O()};return e.jsx(e.Fragment,{children:e.jsxs(se,{children:[e.jsx(ze,{children:"Fuel Management"}),e.jsx(He,{children:e.jsxs(We,{children:[e.jsx(se,{className:"mb-3",children:e.jsx(Je,{onAddFuelog:l})}),e.jsx(Xe,{fuelLogs:q,vehicles:U,drivers:G,loading:J,error:B,onDeleteFuelLog:v,onUpdateFuelLog:r,onViewReceipt:n})]})}),m&&e.jsx(Ye,{fuelLog:Y,visible:m,onClose:()=>{_(!1),f(null)},onUpdate:t,vehicles:U,drivers:G}),e.jsxs(ce,{visible:ee,onClose:()=>S(!1),alignment:"center",children:[e.jsx(ue,{closeButton:!0,children:"Confirm Delete"}),e.jsx(me,{children:"Are you sure you want to delete this fuel log? This action cannot be undone."}),e.jsxs(pe,{children:[e.jsx(M,{color:"secondary",variant:"outline",onClick:()=>S(!1),children:"Cancel"}),e.jsx(M,{color:"danger",variant:"outline",onClick:u,children:"Delete"})]})]}),e.jsxs(ce,{visible:ie,onClose:()=>{$(!1),s(null)},size:"lg",alignment:"center",children:[e.jsx(ue,{closeButton:!0,children:"Receipt Image"}),e.jsx(me,{className:"text-center",children:i&&e.jsx(xe,{src:i,alt:"Receipt",style:{maxWidth:"100%",maxHeight:"70vh",objectFit:"contain"},onError:a=>{toast.error("Error loading image"),a.target.src="placeholder-image-url.jpg"}})}),e.jsxs(pe,{children:[e.jsx(M,{color:"secondary",variant:"outline",onClick:()=>{$(!1),s(null)},children:"Close"}),e.jsx(M,{color:"primary",variant:"outline",onClick:()=>window.open(i,"_blank"),children:"Open in New Tab"})]})]})]})})};export{ht as default};
