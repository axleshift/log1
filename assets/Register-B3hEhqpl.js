import{i as B,w as q,r as d,j as e,C as D}from"./index-nNgQDi3y.js";import{C as x}from"./index.esm-BuKqvEan.js";import{C as E}from"./CContainer-XXKGP3D5.js";import{C as z,a as G}from"./CRow-JFXe5p0a.js";import{C as M}from"./CCard-C11t10-G.js";import{C as _}from"./CCardBody-D9zCfA2H.js";import{C as H}from"./CForm-C8WwGFvM.js";import{C as R}from"./CAlert-Da4UQtJl.js";import{C as i,a as m}from"./CInputGroupText-I3x9P6oS.js";import{c as J}from"./cil-user-Ddrdy7PS.js";import{C as p}from"./CFormInput-C49UErcb.js";import{c as I}from"./cil-lock-locked-DmxpJbVL.js";import{C as O}from"./CFormSelect-CJsiCtlq.js";import{C as P}from"./CButton-B31Ato4o.js";import"./CCloseButton-U_0zd53e.js";import"./CLink-B-ouRo4I.js";const ce=()=>{const C=B(),j=sessionStorage.getItem("accessToken");JSON.parse(sessionStorage.getItem("user"));const k=q.create({baseURL:"http://localhost:5057",withCredentials:!0,headers:{"Content-Type":"application/json",...j&&{Authorization:`Bearer ${j}`}}}),[s,f]=d.useState({username:"",email:"",password:"",repeatPassword:"",role:"",photo:null}),[g,u]=d.useState(null),[w,b]=d.useState(null),[o,h]=d.useState(!1),[v,F]=d.useState(null),l=c=>{const{id:r,value:t}=c.target;f(n=>({...n,[r]:t}))},L=c=>{const r=c.target.files[0];if(r){f(n=>({...n,photo:r}));const t=new FileReader;t.onloadend=()=>{F(t.result)},t.readAsDataURL(r)}},U=async c=>{var t,n,N,y,S;c.preventDefault(),h(!0),u(null);const r=new FormData;r.append("username",s.username),r.append("email",s.email),r.append("password",s.password),r.append("role",s.role),s.photo&&r.append("photo",s.photo);for(let a of r.entries())console.log(a[0]+": "+a[1]);try{if(s.password!==s.repeatPassword){u("Passwords do not match"),h(!1);return}const a=await k.post("/api/v1/user/register",s,{headers:{"Content-Type":"multipart/form-data"}});a.data&&a.data.success?(b("Registration successful"),a.data.token&&sessionStorage.setItem("accessToken",a.data.token),setTimeout(()=>{b(null),C("/dashboard")},2e3)):u(((t=a.data)==null?void 0:t.message)||"Registration failed")}catch(a){console.error("Full error details:",{message:a.message,response:(n=a.response)==null?void 0:n.data,status:(N=a.response)==null?void 0:N.status});const T=((S=(y=a.response)==null?void 0:y.data)==null?void 0:S.message)||a.message||"An error occurred during registration";u(T)}finally{h(!1)}},A=()=>{C("/dashboard")};return e.jsx("div",{className:"bg-body-tertiary min-vh-100 d-flex flex-row align-items-center",children:e.jsx(E,{children:e.jsx(z,{className:"justify-content-center",children:e.jsx(G,{md:9,lg:7,xl:6,children:e.jsx(M,{className:"mx-4",children:e.jsx(_,{className:"p-4",children:e.jsxs(H,{onSubmit:U,children:[e.jsx("h1",{children:"Register New User"}),g&&e.jsx(R,{color:"danger",className:"text-center w-75 mx-auto",children:g}),w&&e.jsx(R,{color:"success",className:"text-center w-75 mx-auto",children:w}),e.jsxs(i,{className:"mb-3",children:[e.jsx(m,{children:e.jsx(x,{icon:J})}),e.jsx(p,{placeholder:"Username",autoComplete:"off",id:"username",value:s.username,onChange:l,required:!0,disabled:o})]}),e.jsxs(i,{className:"mb-3",children:[e.jsx(m,{children:"@"}),e.jsx(p,{placeholder:"Email",autoComplete:"off",id:"email",value:s.email,onChange:l,required:!0,type:"email",disabled:o})]}),e.jsxs(i,{className:"mb-3",children:[e.jsx(m,{children:e.jsx(x,{icon:I})}),e.jsx(p,{type:"password",placeholder:"Password",autoComplete:"off",id:"password",value:s.password,onChange:l,required:!0,disabled:o})]}),e.jsxs(i,{className:"mb-4",children:[e.jsx(m,{children:e.jsx(x,{icon:I})}),e.jsx(p,{type:"password",placeholder:"Repeat password",autoComplete:"off",id:"repeatPassword",value:s.repeatPassword,onChange:l,required:!0,disabled:o})]}),e.jsxs(i,{className:"mb-3",children:[e.jsx(m,{children:"Role"}),e.jsxs(O,{id:"role",value:s.role,onChange:l,disabled:o,children:[e.jsx("option",{value:"",children:"Select Role"}),e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"manager",children:"Manager"}),e.jsx("option",{value:"inspector",children:"Inspector"})]})]}),e.jsx(i,{className:"mb-3",children:e.jsx(p,{type:"file",accept:"image/*",onChange:L})}),v&&e.jsx("div",{className:"mb-3",children:e.jsx("img",{src:v,alt:"Preview",style:{maxWidth:"200px",maxHeight:"200px",objectFit:"cover"}})}),e.jsx(P,{color:"success",type:"submit",disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx(D,{size:"sm"})," Loading..."]}):"Create"}),e.jsx(P,{color:"secondary",className:"ms-2",onClick:A,disabled:o,children:"Back"})]})})})})})})})};export{ce as default};
