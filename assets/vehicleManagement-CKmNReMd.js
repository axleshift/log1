import{l as U,r as n,j as e,k as B,n as _,A as re}from"./index-BTSAY1jP.js";import{s as he,F as $,t as fe,m as ne,a as le,u as ie,v as be,w as je}from"./index-Dn9UYZt8.js";import{a as Y}from"./CButton-DR-vKXAR.js";import{C as O,a as Q,b as J,c as W}from"./CModalHeader-CilGuV6x.js";import{C as oe}from"./CModalTitle-BJWUHLpp.js";import{C as q}from"./CAlert-D-e74jgy.js";import{C as ce}from"./CForm-DQbMisVi.js";import{C as P}from"./CInputGroup-CQKjyylt.js";import{C as y}from"./CFormInput-PBNeC-mo.js";import{C as G}from"./CFormSelect-Bfwswoto.js";import{C as I}from"./CContainer-DEEd9IWu.js";import{C as de}from"./CInputGroupText-BsTVzfJV.js";import{C as ue,a as me,b as ge,c as xe}from"./CAccordionHeader-D0Ivzz_g.js";import{C as S,a as ye}from"./DefaultLayout-C2YjAy5i.js";import{C as Ce,a as K}from"./CPaginationItem-DER1Jz8K.js";import{C as Ne,a as ve,b as ee,c as ae}from"./CTabList-BEJu789-.js";import{C as se}from"./CCard-nIY_lqVA.js";import{C as te}from"./CCardBody-on8ISP2K.js";import"./index.esm-Dl38YfVk.js";import"./1-0rsEpf3b.js";import"./cil-user-Ddrdy7PS.js";import"./getTransitionDurationFromElement-Cpu4p4hx.js";const Se=({onAddVehicle:i})=>{const{showSuccess:R,showError:g}=U(),[L,D]=n.useState(!1),[m,b]=n.useState(!1),[E,w]=n.useState(null),[j,h]=n.useState(null),[s,C]=n.useState(!1),c={idNum:Math.floor(Math.random()*1e6).toString(),brand:"",model:"",year:"",regisExprationDate:"",regisNumber:"",capacity:"",fuelType:"",currentMileage:"",status:"available"},[u,l]=n.useState(c),d=a=>{const{id:r,value:t}=a.target;l(p=>({...p,[r]:t}))},f=[{label:"Van",value:"van"},{label:"Pickup Truck",value:"pickup"},{label:"Box Truck",value:"box"},{label:"Straight Truck",value:"straight"},{label:"Semi-Trailer Trucks",value:"semi"},{label:"Refrigerated Trucks",value:"refrigerated"},{label:"Tanker Trucks",value:"tanker"},{label:"Flatbed Trucks",value:"flatbed"}],F=[{label:"Diesel",value:"Diesel"},{label:"Gasoline",value:"Gasoline"}],V=async a=>{var t,p,v,k;a.currentTarget.checkValidity()===!1&&(a.preDefault(),a.stopPropagation()),D(!0),C(!0);try{const T=await _.post("api/v1/vehicle",u);T.data.success&&(R(T.data.message),i(T.data.data),setTimeout(()=>{l(c),C(!1),D(!1),b(!1)},2e3))}catch(T){g(((p=(t=T.response)==null?void 0:t.data)==null?void 0:p.message)||T.message),w(((k=(v=T.response)==null?void 0:v.data)==null?void 0:k.message)||T.message),setTimeout(()=>{w(null)},2e3)}C(!1)},M=new Date().getFullYear(),N=1990,o=new Date().toISOString().split("T")[0],x=({icon:a})=>{const[r,t]=n.useState(!1);return e.jsx($,{icon:a,bounce:r,onMouseEnter:()=>t(!0),onMouseLeave:()=>t(!1)})};return e.jsx(e.Fragment,{children:s?e.jsx(B,{color:"primary",size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsxs(Y,{color:"primary",variant:"outline",onClick:()=>b(!0),children:[e.jsx(x,{icon:he})," Add Vehicle"]}),e.jsxs(O,{visible:m,onClose:()=>b(!1),size:"lg",children:[e.jsx(Q,{closeButton:!0,children:e.jsx(oe,{children:"Add Vehicle"})}),E&&e.jsx(q,{color:"danger",className:"m-3",children:E}),j&&e.jsx(q,{color:"success",className:"m-3",children:j}),e.jsx(J,{children:e.jsxs(ce,{noValidate:!0,validated:L,children:[e.jsxs(P,{children:[e.jsx(y,{className:"mb-3",floatingLabel:"ID Number",placeholder:"ID Number",type:"text",id:"idNum",label:"ID Number",value:u.idNum,disabled:!0}),e.jsx(y,{className:"mb-3",floatingLabel:"Brand",placeholder:"Brand",type:"text",id:"brand",label:"Brand",autoComplete:"off",required:!0,value:u.brand,onChange:d}),e.jsx(y,{className:"mb-3",floatingLabel:"Model",placeholder:"Model",type:"text",id:"model",label:"Model",autoComplete:"off",required:!0,value:u.model,onChange:d})]}),e.jsxs(P,{children:[e.jsx(y,{type:"number",className:"mb-3",floatingLabel:"Year",placeholder:"Year",id:"year",value:u.year,required:!0,min:N,max:M,onChange:d,onBlur:a=>{const r=parseInt(a.target.value);r>=N&&r<=M&&!isNaN(r)||(alert(`Please enter a year between ${N} and ${M}`),l({...u,year:N}))}}),e.jsx(y,{className:"mb-3",floatingLabel:"Registration Number",placeholder:"Registration Number",type:"text",id:"regisNumber",label:"Registration Number",autoComplete:"off",required:!0,value:u.regisNumber,onChange:d}),e.jsx(y,{className:"mb-3",floatingLabel:"Registration Expiration Date",placeholder:"Registration Expiration Date",type:"date",id:"regisExprationDate",label:"Registration Expiration Date",autoComplete:"off",required:!0,min:o,value:u.regisExprationDate,onChange:d})]}),e.jsxs(P,{children:[e.jsx(G,{className:"mb-3",floatingLabel:"Vehicle Type",placeholder:"Vehicle Type",id:"type",value:u.type,required:!0,onChange:d,options:[{label:"Select Vehicle Type",value:""},...f]}),e.jsx(y,{className:"mb-2",type:"number",floatingLabel:"Capacity",placeholder:"Capacity",id:"capacity",label:"Capacity",autoComplete:"off",required:!0,min:"0",value:u.capacity,onChange:d}),e.jsx(G,{className:"mb-3",floatingLabel:"Fuel Type",placeholder:"Fuel Type",id:"fuelType",value:u.fuelType,required:!0,onChange:d,options:[{label:"Select Fuel Type",value:""},...F]})]}),e.jsx(y,{className:"mb-3",floatingLabel:"Current Mileage",placeholder:"Current Mileage",type:"number",id:"currentMileage",label:"Current Mileage",autoComplete:"off",required:!0,value:u.currentMileage,min:"0",max:"100000000000",onChange:d})]})}),e.jsxs(W,{children:[e.jsx(Y,{color:"secondary",variant:"outline",disabled:s,onClick:()=>{b(!1),l(c),D(!1),w(null)},children:s?e.jsx(B,{color:"secondary",size:"sm"}):"Cancel"}),e.jsx(Y,{color:"primary",variant:"outline",disabled:s,onClick:V,children:s?e.jsx(B,{color:"primary",size:"sm"}):"Save"})]})]})]})})},De=({vehicle:i,onUpdateVehicle:R})=>{const{showSuccess:g,showError:L}=U(),[D,m]=n.useState(!1),[b,E]=n.useState(null),[w,j]=n.useState(null),[h,s]=n.useState(!1),[C,c]=n.useState(!1),u={idNum:i.idNum,brand:i.brand,model:i.model,year:i.year,regisExprationDate:i.regisExprationDate,regisNumber:i.regisNumber,type:i.type,capacity:i.capacity,fuelType:i.fuelType,currentMileage:i.currentMileage},[l,d]=n.useState(u),f=r=>{const{id:t,value:p}=r.target;d(v=>({...v,[t]:p}))},F=[{label:"Van",value:"van"},{label:"Pickup Truck",value:"pickup"},{label:"Box Truck",value:"box"},{label:"Straight Truck",value:"straight"},{label:"Semi-Trailer Trucks",value:"semi"},{label:"Refrigerated Trucks",value:"refrigerated"},{label:"Tanker Trucks",value:"tanker"},{label:"Flatbed Trucks",value:"flatbed"}],V=[{label:"Diesel",value:"Diesel"},{label:"Gasoline",value:"Gasoline"}],M=async r=>{var p,v,k,T;r.preventDefault(),s(!0),r.currentTarget.checkValidity()===!1&&(r.preDefault(),r.stopPropagation()),c(!0),s(!0);try{const A=new Date;A.setHours(0,0,0,0);const z=new Date(l.regisExprationDate);if(z.setHours(0,0,0,0),z<=A){j("Registration date must be in the future"),setIsLoading(!1);return}const H=await _.put(`api/v1/vehicle/${i._id}`,l);H.data.success&&(g(H.data.message),R(H.data.data),setTimeout(()=>{s(!1),c(!1),m(!1)},2e3))}catch(A){L(((v=(p=A.response)==null?void 0:p.data)==null?void 0:v.message)||A.message),j(((T=(k=A.response)==null?void 0:k.data)==null?void 0:T.message)||A.message),setTimeout(()=>{j(null)},2e3)}finally{s(!1)}},N=new Date().getFullYear(),o=1990,x=new Date().toISOString().split("T")[0],a=({icon:r})=>{const[t,p]=n.useState(!1);return e.jsx($,{icon:r,bounce:t,onMouseEnter:()=>p(!0),onMouseLeave:()=>p(!1)})};return e.jsxs(e.Fragment,{children:[e.jsxs(Y,{color:"primary",variant:"outline",disabled:h,onClick:()=>m(!0),className:"me-2",children:[h?e.jsx(B,{size:"sm"}):e.jsx(a,{icon:fe})," Update"]}),e.jsxs(O,{visible:D,onClose:()=>m(!1),size:"lg",children:[e.jsx(Q,{closeButton:!0,children:e.jsx(oe,{children:"Update Vehicle"})}),w&&e.jsx(q,{color:"danger",className:"m-3",children:w}),b&&e.jsx(q,{color:"success",className:"m-3",children:b}),e.jsx(J,{children:e.jsxs(ce,{noValidate:!0,validated:C,children:[e.jsxs(P,{children:[e.jsx(y,{className:"mb-3",floatingLabel:"ID Number",placeholder:"ID Number",type:"text",id:"idNum",label:"ID Number",value:l.idNum,disabled:!0}),e.jsx(y,{className:"mb-3",floatingLabel:"Brand",placeholder:"Brand",type:"text",id:"brand",label:"Brand",required:!0,value:l.brand,onChange:f}),e.jsx(y,{className:"mb-3",floatingLabel:"Model",placeholder:"Model",type:"text",id:"model",label:"Model",required:!0,value:l.model,onChange:f})]}),e.jsxs(P,{children:[e.jsx(y,{type:"number",className:"mb-3",floatingLabel:"Year",placeholder:"Year",id:"year",value:l.year,required:!0,min:o,max:N,onChange:f,onBlur:r=>{const t=parseInt(r.target.value);t>=o&&t<=N&&!isNaN(t)||(alert(`Please enter a year between ${o} and ${N}`),d({...l,year:o}))}}),e.jsx(y,{className:"mb-3",floatingLabel:"Registration Number",placeholder:"Registration Number",type:"text",id:"regisNumber",label:"Registration Number",required:!0,value:l.regisNumber,onChange:f}),e.jsx(y,{className:"mb-3",floatingLabel:"Registration Expiration Date",placeholder:"Registration Expiration Date",type:"date",id:"regisExprationDate",label:"Registration Expiration Date",autoComplete:"off",required:!0,min:x,value:l.regisExprationDate.split("T")[0],onChange:f})]}),e.jsxs(P,{children:[e.jsx(G,{className:"mb-3",floatingLabel:"Vehicle Type",placeholder:"Vehicle Type",id:"type",value:l.type,required:!0,onChange:f,options:[{label:"Select Vehicle Type",value:""},...F]}),e.jsx(y,{className:"mb-2",type:"number",floatingLabel:"Capacity",placeholder:"Capacity",id:"capacity",label:"Capacity",required:!0,min:"0",value:l.capacity,onChange:f}),e.jsx(G,{className:"mb-3",floatingLabel:"Fuel Type",placeholder:"Fuel Type",id:"fuelType",label:"Fuel Type",value:l.fuelType,required:!0,onChange:f,options:[{label:"Select Fuel Type",value:""},...V]})]}),e.jsx(y,{className:"mb-3",floatingLabel:"Current Mileage",placeholder:"Current Mileage",type:"number",id:"currentMileage",label:"Current Mileage",required:!0,min:"0",max:"100000000000",value:l.currentMileage,onChange:f})]})}),e.jsxs(W,{children:[e.jsx(Y,{color:"secondary",variant:"outline",disabled:h,onClick:()=>{m(!1),j(null),d(u),c(!1)},children:h?e.jsx(B,{size:"sm",color:"secondary"}):"Cancel"}),e.jsx(Y,{color:"success",variant:"outline",disabled:h,onClick:M,children:h?e.jsx(B,{size:"sm",color:"success"}):"Save Changes"})]})]})]})},we=({vehicle:i,error:R,loading:g,onDeleteVehicle:L,onUpdateVehicle:D})=>{const[m,b]=n.useState([]),E=re(),w=["manager","admin","super admin"],[j,h]=n.useState(null),[s,C]=n.useState(""),[c,u]=n.useState(1),[l]=n.useState(10),d=c*l,f=d-l,F=m.slice(f,d),V=Math.ceil(m.length/l);n.useEffect(()=>{b(i)},[i]),n.useEffect(()=>{(()=>{if(u(1),s==="")b(i);else{const r=i.filter(t=>{var p,v,k,T,A,z,H,X,Z;return((p=t.idNum)==null?void 0:p.toString().includes(s))||((v=t.brand)==null?void 0:v.toLowerCase().includes(s.toLowerCase()))||((k=t.model)==null?void 0:k.toLowerCase().includes(s.toLowerCase()))||((T=t.year)==null?void 0:T.toString().includes(s))||((A=t.regisExprationDate)==null?void 0:A.toLowerCase().includes(s.toLowerCase()))||((z=t.type)==null?void 0:z.toLowerCase().includes(s.toLowerCase()))||((H=t.regisNumber)==null?void 0:H.toLowerCase().includes(s.toLowerCase()))||((X=t.capacity)==null?void 0:X.toString().includes(s))||(((Z=N.find(pe=>pe.value===t.status))==null?void 0:Z.label)||"").toLowerCase().includes(s.toLowerCase())});b(r),r.length===0?h("No vehicles found"):h(null)}})()},[s,i]);const M=a=>{switch(a){case"available":return"green";case"in_use":return"red";case"maintenance":return"orange";case"inspection":return"yellow";case"forRegistration":return"grey";default:return"black"}},N=[{value:"available",label:"Available"},{value:"in_use",label:"In Use"},{value:"maintenance",label:"Maintenance"},{value:"inactive",label:"Inactive"},{value:"inspection",label:"Inspection"},{value:"forRegistration",label:"For Registration"}];if(i.length===0)return e.jsx(q,{color:"danger",className:"text-center justify-content-center",children:"No vehicles found"});const o=a=>{if(!a)return{text:"No expiration date",badge:"secondary"};const r=new Date;r.setHours(0,0,0,0);const t=new Date(a);t.setHours(0,0,0,0);const p=t.getTime()-r.getTime(),v=Math.ceil(p/(1e3*60*60*24));if(v<0){const k=Math.abs(v);return{text:`Expired ${k} ${k===1?"day":"days"} ago`,badge:"danger"}}return v===0?{text:"Expires Today",badge:"danger"}:v<=14?{text:`Expires in ${v} ${v===1?"day":"days"}`,badge:"warning"}:{text:"Registered",badge:"success"}},x=({icon:a})=>{const[r,t]=n.useState(!1);return e.jsx($,{icon:a,bounce:r,onMouseEnter:()=>t(!0),onMouseLeave:()=>t(!1)})};return e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"mt-3",children:e.jsxs(P,{className:"w-50 mb-3",children:[e.jsx(y,{type:"text",placeholder:"Search vehicles",id:"search",value:s,onChange:a=>C(a.target.value),className:"w-50 me-2 "}),e.jsx(de,{children:e.jsx($,{icon:ne})})]})}),e.jsx(ue,{className:"m-2",children:F.map((a,r)=>e.jsxs(me,{children:[e.jsxs(ge,{className:"d-flex justify-content-between",children:[e.jsx(I,{children:e.jsxs("ul",{className:"list-unstyled",children:[e.jsxs("li",{children:["Registration Number: ",e.jsx("strong",{children:a.regisNumber})]}),e.jsxs("li",{children:["Driver:"," ",e.jsx("strong",{children:a.assignedDriver?`${a.assignedDriver.driverName} - ${a.assignedDriver.licenseNumber}`:"Not assigned"})]}),e.jsxs("li",{children:["Registration expiration Date:"," ",e.jsx("strong",{children:a.regisExprationDate?e.jsxs(e.Fragment,{children:[new Date(a.regisExprationDate).toLocaleDateString()," ",e.jsx(le,{color:o(a.regisExprationDate).badge,children:o(a.regisExprationDate).text})]}):"No expiration date"})]})]})}),e.jsxs(I,{className:"d-flex justify-content-end",children:[e.jsx($,{icon:ie,color:M(a.status),className:"m-2 float-end"}),e.jsx("small",{className:"m-2 float-end",children:N.find(t=>t.value===a.status).label})]})]}),e.jsxs(xe,{children:[e.jsxs(S,{children:["ID: ",a.idNum]}),e.jsxs(S,{children:["Brand: ",a.brand]}),e.jsxs(S,{children:["Model: ",a.model]}),e.jsxs(S,{children:["Year: ",a.year]}),e.jsxs(S,{children:["Type: ",a.type]}),e.jsxs(S,{children:["Capacity: ",a.capacity]}),e.jsxs(S,{children:["Status: ",N.find(t=>t.value===a.status).label]}),e.jsxs(S,{children:["Driver:"," ",a.assignedDriver?`${a.assignedDriver.driverName} - ${a.assignedDriver.licenseNumber}`:"Not assigned"]}),e.jsxs(S,{children:["Fuel Type: ",a.fuelType]}),e.jsxs(S,{children:["Current Mileage: ",a.currentMileage]}),e.jsxs(I,{className:"d-flex justify-content-end mt-3",children:[e.jsx(De,{vehicle:a,onUpdateVehicle:D}),w.includes(E)&&e.jsxs(Y,{color:"danger",variant:"outline",onClick:()=>L(a._id),children:[e.jsx(x,{icon:be})," Delete"]})]})]})]},a._id||r))}),m.length>0&&e.jsxs(I,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs(I,{children:["Showing ",f+1," to ",Math.min(d,m.length)," ","of ",m.length," entries"]}),e.jsxs(Ce,{className:"mt-3",children:[e.jsx(K,{disabled:c===1,onClick:()=>u(a=>Math.max(a-1,1)),children:"Previous"}),Array.from({length:V},(a,r)=>r+1).map(a=>e.jsx(K,{active:a===c,onClick:()=>u(a),children:a},a)),e.jsx(K,{disabled:c===V,onClick:()=>u(a=>Math.min(a+1,V)),children:"Next"})]})]}),j&&e.jsx(q,{color:"danger",className:"text-center justify-content-center",children:j})]})},Te=({restoredVehicle:i,onRestoreVehicle:R})=>{const[g,L]=n.useState(!1),{showSuccess:D,showError:m}=U(),[b,E]=n.useState(null),w=async()=>{var j,h;L(!0);try{const s=await _.patch(`api/v1/vehicle/restore/${i}`);s.data.success&&(D(s.data.message),R(s.data.data))}catch(s){m(((h=(j=s.response)==null?void 0:j.data)==null?void 0:h.message)||"Error restoring vehicle"),console.error("Error restoring vehicle:",s)}finally{L(!1)}};return e.jsx(Y,{color:"success",variant:"outline",onClick:w,disabled:g,className:"mx-1",children:g?e.jsx(B,{size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsx($,{icon:je,className:"me-1"}),"Restore"]})})},Le=({restoredVehicle:i,onRestoreVehicle:R})=>{const[g,L]=n.useState(""),[D,m]=n.useState([]),[b,E]=n.useState(null);n.useEffect(()=>{(()=>{if(g==="")m(i);else{const C=i.filter(c=>{var u,l,d,f,F,V,M,N,o;return((u=c.idNum)==null?void 0:u.toString().includes(g))||((l=c.brand)==null?void 0:l.toLowerCase().includes(g.toLowerCase()))||((d=c.model)==null?void 0:d.toLowerCase().includes(g.toLowerCase()))||((f=c.year)==null?void 0:f.toString().includes(g))||((F=c.regisExprationDate)==null?void 0:F.toLowerCase().includes(g.toLowerCase()))||((V=c.type)==null?void 0:V.toLowerCase().includes(g.toLowerCase()))||((M=c.regisNumber)==null?void 0:M.toLowerCase().includes(g.toLowerCase()))||((N=c.capacity)==null?void 0:N.toString().includes(g))||(((o=j.find(x=>x.value===c.status))==null?void 0:o.label)||"").toLowerCase().includes(g.toLowerCase())});m(C),C.length===0?E("No vehicles found"):E(null)}})()},[g,i]);const w=s=>{switch(s){case"available":return"green";case"in_use":return"red";case"maintenance":return"orange";case"inspection":return"yellow";case"forRegistration":return"grey";default:return"black"}},j=[{value:"available",label:"Available"},{value:"in_use",label:"In Use"},{value:"maintenance",label:"Maintenance"},{value:"inactive",label:"Inactive"},{value:"inspection",label:"Inspection"},{value:"forRegistration",label:"For Registration"}];if(D.length===0)return e.jsx(q,{color:"danger",className:"text-center justify-content-center",children:"No vehicles found to restore"});const h=s=>{if(!s)return{text:"No expiration date",badge:"secondary"};const C=new Date;C.setHours(0,0,0,0);const c=new Date(s);c.setHours(0,0,0,0);const u=c.getTime()-C.getTime(),l=Math.ceil(u/(1e3*60*60*24));if(l<0){const d=Math.abs(l);return{text:`Expired ${d} ${d===1?"day":"days"} ago`,badge:"danger"}}return l===0?{text:"Expires Today",badge:"danger"}:l<=14?{text:`Expires in ${l} ${l===1?"day":"days"}`,badge:"warning"}:{text:"Registered",badge:"success"}};return e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"mt-3",children:e.jsxs(P,{className:"w-50 mb-3",children:[e.jsx(y,{type:"text",placeholder:"Search vehicles",id:"searchRestoredVehicles",value:g,onChange:s=>L(s.target.value),className:"w-50 me-2 "}),e.jsx(de,{children:e.jsx($,{icon:ne})})]})}),b&&e.jsx(q,{color:"danger",children:b}),e.jsx(ue,{children:D.map(s=>e.jsxs(me,{children:[e.jsxs(ge,{className:"d-flex justify-content-between",children:[e.jsx(I,{children:e.jsxs("ul",{children:[e.jsxs("li",{children:["Registration Number: ",e.jsx("strong",{children:s.regisNumber})]}),e.jsxs("li",{children:["Registration expiration Date:"," ",e.jsx("strong",{children:s.regisExprationDate?e.jsxs(e.Fragment,{children:[new Date(s.regisExprationDate).toISOString().split("T")[0]," ",e.jsx(le,{color:h(s.regisExprationDate).badge,children:h(s.regisExprationDate).text})]}):"No expiration date"})]})]})}),e.jsxs(I,{className:"d-flex justify-content-end",children:[e.jsx($,{icon:ie,color:w(s.status),className:"m-2 float-end"}),e.jsx("small",{className:"m-2 float-end",children:j.find(C=>C.value===s.status).label})]})]}),e.jsxs(xe,{children:[e.jsxs(S,{children:["Year: ",s.year]}),e.jsxs(S,{children:["Type: ",s.type]}),e.jsxs(S,{children:["Capacity: ",s.capacity]}),e.jsxs(S,{children:["Status: ",s.status]}),e.jsx(I,{className:"d-flex justify-content-end mt-3",children:e.jsx(Te,{restoredVehicle:s._id,onRestoreVehicle:R})})]})]},s._id))})]})},We=()=>{const i=re(),R=["super admin","admin","manager","fleet manager"],{showSuccess:g,showError:L}=U(),[D,m]=n.useState([]),[b,E]=n.useState(!0),[w,j]=n.useState(null),[h,s]=n.useState(null),[C,c]=n.useState(!1),[u,l]=n.useState([]);n.useEffect(()=>{d()},[]),n.useEffect(()=>{const o=()=>{const a=new Date;a.setHours(0,0,0,0),m(r=>r.map(t=>{const p=new Date(t.regisExprationDate);return p.setHours(0,0,0,0),p<=a&&t.status!=="forRegistration"?{...t,status:"forRegistration"}:t}))};o();const x=setInterval(o,24*60*60*1e3);return()=>clearInterval(x)},[]);const d=async()=>{var o,x;E(!0);try{const[a,r]=await Promise.all([_.get("api/v1/vehicle"),_.get("api/v1/vehicle/restored")]);m(a.data.data),l(r.data.data)}catch(a){L(((x=(o=a.response)==null?void 0:o.data)==null?void 0:x.message)||"Error fetching data"),j(a.message)}finally{E(!1)}},f=o=>{s(o),c(!0)},F=async()=>{var o,x;try{await _.patch(`api/v1/vehicle/${h}`),m(a=>a.filter(r=>r._id!==h)),g("Vehicle deleted successfully"),c(!1),d()}catch(a){L(((x=(o=a.response)==null?void 0:o.data)==null?void 0:x.message)||"Error deleting vehicle")}},V=o=>{m(x=>[...x,o])},M=o=>{l(x=>x.map(a=>a._id===o._id?o:a)),d()},N=o=>{m(x=>x.map(a=>a._id===o._id?o:a),d())};return b?e.jsx("div",{className:"text-center",children:e.jsx(B,{color:"primary"})}):e.jsx(e.Fragment,{children:i&&R.includes(i)?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"text-center",children:"Vehicle Management"}),e.jsx(I,{className:"m-3",children:e.jsx(Se,{onAddVehicle:V})}),e.jsxs(Ne,{activeItemKey:"Vehicle List",children:[e.jsxs(ve,{variant:"tabs",children:[e.jsx(ee,{itemKey:"Vehicle List",children:"Vehicle List"}),e.jsx(ee,{itemKey:"Restore Vehicles",children:"Restore Vehicles"})]}),e.jsxs(ye,{children:[e.jsx(ae,{itemKey:"Vehicle List",children:e.jsxs(se,{children:[e.jsx(S,{children:"Vehicle List"}),e.jsx(te,{className:"md-3",children:e.jsx(we,{vehicle:D,error:w,onDeleteVehicle:f,onUpdateVehicle:N,loading:b})})]})}),e.jsx(ae,{itemKey:"Restore Vehicles",children:i&&R.includes(i)&&i!=="fleet manager"?e.jsxs(se,{children:[e.jsx(S,{children:"Restore Vehicles"}),e.jsx(te,{className:"md-3",children:e.jsx(Le,{restoredVehicle:u,onRestoreVehicle:M})})]}):e.jsx(q,{color:"danger",className:"text-center justify-content-center m-5",children:"You are not authorized to view this tab"})})]})]}),e.jsxs(O,{visible:C,onClose:()=>c(!1),alignment:"center",children:[e.jsx(Q,{children:"Confirm Delete"}),e.jsx(J,{children:"Are you sure you want to delete this vehicle?"}),e.jsxs(W,{children:[e.jsx(Y,{color:"danger",variant:"outline",onClick:F,children:"Delete"}),e.jsx(Y,{color:"secondary",variant:"outline",onClick:()=>c(!1),children:"Cancel"})]})]})]}):e.jsx(q,{color:"danger",className:"text-center justify-content-center m-5",children:"You do not have permission to access this page."})})};export{We as default};
