import{w as I,r as l,j as e,C as S}from"./index-nNgQDi3y.js";import{F as w,d as B,g as G,e as H,h as Q,i as J}from"./index-DA9UjPMh.js";import{C as L}from"./CButton-B31Ato4o.js";import{C as z,a as U,b as M,c as $,d as O}from"./CModalTitle-DC27g7Q8.js";import{C as V}from"./CAlert-Da4UQtJl.js";import{C as R}from"./CForm-C8WwGFvM.js";import{C as g}from"./CFormInput-C49UErcb.js";import{C as k}from"./CFormSelect-CJsiCtlq.js";import{C as T}from"./CContainer-XXKGP3D5.js";import{C as K,a as W}from"./CInputGroupText-I3x9P6oS.js";import{C as X,a as Y,b as Z,c as ee}from"./CAccordionHeader-N1vMBNDk.js";import{C as y}from"./DefaultLayout-C_MU3311.js";import{C as se}from"./CCard-C11t10-G.js";import{C as ae}from"./CCardBody-D9zCfA2H.js";import"./CLink-B-ouRo4I.js";import"./CCloseButton-U_0zd53e.js";import"./index.esm-BuKqvEan.js";import"./cil-user-Ddrdy7PS.js";const te=({onAddDriver:o})=>{const f=sessionStorage.getItem("accessToken"),h=I.create({baseURL:"http://localhost:5057",withCredentials:!0,headers:{"Content-Type":"application/json",...f&&{Authorization:`Bearer ${f}`}}}),[m,p]=l.useState(!1),[x,N]=l.useState(null),[j,n]=l.useState(null),[i,c]=l.useState(!1),[r,A]=l.useState([]),[D,s]=l.useState(!1),b={idNum:Math.floor(Math.random()*1e6).toString(),driverName:"",email:"",phone:"",address:"",licenseNumber:"",status:"available",assignedVehicle:""},[d,v]=l.useState(b),a=async()=>{try{const t=await h.get("/api/v1/vehicle/available");A(t.data.data)}catch(t){console.error("Error fetching vehicles:",t)}};l.useEffect(()=>{a()},[]);const E=async t=>{t.currentTarget.checkValidity()===!1&&(t.preDefault(),t.stopPropagation()),s(!0),{...d},p(!0);try{const _=await h.post("/api/v1/driver",d);_.status===201&&(N("Driver added successfully"),o(_.data.data),setTimeout(()=>{v(b),s(!1),c(!1),p(!1)},2e3))}catch(_){n(_.response.data.message)}finally{p(!1)}};return e.jsx(e.Fragment,{children:m?e.jsx(S,{color:"primary",size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsxs(L,{color:"primary",disabled:m,variant:"outline",onClick:()=>c(!0),children:[m?e.jsx(S,{color:"primary",size:"sm"}):e.jsx(w,{icon:B})," ","Add Driver"]}),e.jsxs(z,{visible:i,onClose:()=>c(!1),children:[e.jsx(U,{children:e.jsx(M,{children:"Add Driver"})}),j&&e.jsx(V,{color:"danger",className:"m-3",children:j}),x&&e.jsx(V,{color:"success",className:"m-3",children:x}),e.jsx($,{children:e.jsxs(R,{noValidate:!0,validated:D,children:[e.jsx(g,{className:"mb-3",floatingLabel:"ID Number",placeholder:"ID Number",type:"text",id:"idNum",label:"ID Number",value:d.idNum,disabled:!0}),e.jsx(g,{className:"mb-3",floatingLabel:"Name",placeholder:"Name",type:"text",id:"Name",label:"Name",autoComplete:"off",required:!0,value:d.driverName,onChange:t=>v({...d,driverName:t.target.value})}),e.jsx(g,{className:"mb-3",floatingLabel:"email",placeholder:"Model",type:"email",id:"email",label:"Email",autoComplete:"off",required:!0,value:d.email,onChange:t=>v({...d,email:t.target.value})}),e.jsx(g,{type:"phone",className:"mb-3",floatingLabel:"phone",placeholder:"phone",id:"phone",label:"Phone",title:"Please enter a valid phone number",autoComplete:"off",value:d.phone,required:!0,onChange:t=>v({...d,phone:t.target.value})}),e.jsx(g,{className:"mb-3",floatingLabel:"Address",placeholder:"Address",type:"text",id:"address",label:"Address",autoComplete:"off",required:!0,value:d.address,onChange:t=>v({...d,address:t.target.value})}),e.jsx(g,{className:"mb-3",floatingLabel:"License Number",placeholder:"License Number",type:"text",id:"licenseNumber",label:"License Number",autoComplete:"off",required:!0,value:d.licenseNumber,onChange:t=>v({...d,licenseNumber:t.target.value})}),e.jsxs(k,{className:"mb-3",floatingLabel:"Vehicle",label:"Vehicle",id:"vehicle",required:!0,value:d.assignedVehicle,onChange:t=>v({...d,assignedVehicle:t.target.value}),children:[e.jsx("option",{value:null,children:"Select Vehicle"}),r.map(t=>e.jsxs("option",{value:t._id,children:[t.brand," /",t.model," /",t.regisNumber]},t._id))]})]})}),e.jsxs(O,{children:[e.jsx(L,{color:"secondary",variant:"outline",disabled:m,onClick:()=>{c(!1),v(b),n(null),s(!1)},children:m?e.jsx(S,{color:"secondary",size:"sm"}):"Cancel"}),e.jsx(L,{color:"primary",variant:"outline",onClick:E,disabled:m,children:m?e.jsx(S,{color:"primary",size:"sm"}):"Add Driver"})]})]})]})})},P=sessionStorage.getItem("accessToken"),le="http://localhost:5057",F=I.create({baseURL:le,withCredentials:!0,headers:{"Content-Type":"application/json",...P&&{Authorization:`Bearer ${P}`}}}),re=({driver:o,onUpdateDriver:f})=>{const[C,h]=l.useState(!1),[m,p]=l.useState(null),[x,N]=l.useState([]),[j,n]=l.useState(!1),[i,c]=l.useState(null),[r,A]=l.useState(!1),D={idNum:o.idNum,driverName:o.driverName,email:o.email,phone:o.phone,address:o.address,licenseNumber:o.licenseNumber,status:o.status,assignedVehicle:o.assignedVehicle},[s,u]=l.useState(D),b=async()=>{try{const a=await F.get("/api/v1/vehicle/available");N(a.data.data)}catch(a){console.error("Error fetching vehicles:",a)}};l.useEffect(()=>{b()},[]);const d=async a=>{a.preventDefault(),a.currentTarget.checkValidity()===!1&&a.stopPropagation(),n(!0),A(!0),{...s};try{const t=await F.put(`/api/v1/driver/${o._id}`,s);t.status===200&&(p("Driver updated successfully"),f(t.data.data),setTimeout(()=>{p(null),h(!1),u(D)},2e3))}catch(t){c(t.response.data.message),setTimeout(()=>{c(null)},2e3)}finally{A(!1)}},v=[{value:"available",label:"Available"},{value:"on_duty",label:"On Duty"},{value:"off_duty",label:"Off Duty"}];return e.jsxs(e.Fragment,{children:[e.jsx(L,{color:"primary",variant:"outline",disabled:r,onClick:()=>h(!0),className:"me-2",children:r?e.jsx(S,{size:"sm"}):e.jsx(w,{icon:G})}),e.jsxs(z,{visible:C,onClose:()=>h(!1),children:[e.jsx(U,{children:e.jsx(M,{children:"Update Driver"})}),i&&e.jsx(V,{color:"danger",className:"m-3",children:i}),m&&e.jsx(V,{color:"success",className:"m-3",children:m}),e.jsx($,{children:e.jsx(R,{noValidate:!0,validated:j,children:e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"mb-3",floatingLabel:"ID Number",placeholder:"ID Number",type:"text",id:"idNum",label:"ID Number",value:s.idNum,disabled:!0}),e.jsx(g,{className:"mb-3",floatingLabel:"Name",placeholder:"Name",type:"text",id:"Name",label:"Name",autoComplete:"off",required:!0,value:s.driverName,onChange:a=>u({...s,driverName:a.target.value})}),e.jsx(g,{className:"mb-3",floatingLabel:"email",placeholder:"Model",type:"email",id:"email",label:"Email",autoComplete:"off",required:!0,value:s.email,onChange:a=>u({...s,email:a.target.value})}),e.jsx(g,{type:"phone",className:"mb-3",floatingLabel:"phone",placeholder:"phone",id:"phone",label:"Phone",title:"Please enter a valid phone number",autoComplete:"off",value:s.phone,required:!0,onChange:a=>u({...s,phone:a.target.value})}),e.jsx(g,{className:"mb-3",floatingLabel:"Address",placeholder:"Address",type:"text",id:"address",label:"Address",autoComplete:"off",required:!0,value:s.address,onChange:a=>u({...s,address:a.target.value})}),e.jsx(g,{className:"mb-3",floatingLabel:"License Number",placeholder:"License Number",type:"text",id:"licenseNumber",label:"License Number",autoComplete:"off",required:!0,value:s.licenseNumber,onChange:a=>u({...s,licenseNumber:a.target.value})}),e.jsx(k,{className:"mb-3",floatingLabel:"Status",placeholder:"Status",id:"status",label:"Status",autoComplete:"off",required:!0,value:s.status,onChange:a=>u({...s,status:a.target.value}),children:v.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))}),s.status==="available"||s.status==="on_duty"&&e.jsx(k,{className:"mb-3",floatingLabel:"Vehicle",label:"Vehicle",id:"vehicle",value:s.assignedVehicle,onChange:a=>u({...s,assignedVehicle:a.target.value}),children:x.map(a=>e.jsxs("option",{value:a._id,children:[a.brand," / ",a.model," / ",a.regisNumber]},a._id))})]})})}),e.jsxs(O,{children:[e.jsx(L,{color:"secondary",variant:"outline",disabled:r,onClick:()=>{h(!1),c(null),n(!1)},children:r?e.jsx(S,{color:"secondary",size:"sm"}):"Close"}),e.jsx(L,{color:"success",variant:"outline",disabled:r,onClick:d,children:r?e.jsx(S,{color:"success",size:"sm"}):"Save Changes"})]})]})]})},oe=({driver:o,onDeleteDriver:f})=>{const C=sessionStorage.getItem("accessToken"),m=I.create({baseURL:"http://localhost:5057",withCredentials:!0,headers:{"Content-Type":"application/json",...C&&{Authorization:`Bearer ${C}`}}}),[p,x]=l.useState(!1),[N,j]=l.useState(null),n=async()=>{x(!0);try{(await m.delete(`/api/v1/driver/${o._id}`)).status===200&&(alert("Driver deleted successfully"),f(o._id),x(!1),j(null))}catch(i){j(i)}finally{x(!1)}};return e.jsx(e.Fragment,{children:e.jsx(L,{color:"danger",variant:"outline",onClick:n,className:"me-2",disabled:p,children:p?e.jsx(S,{size:"sm"}):e.jsx(w,{icon:H})})})},ne=({driver:o,loading:f,onDeleteDriver:C,onUpdateDriver:h})=>{I.create({baseURL:"http://localhost:5057",withCredentials:!0});const p=JSON.parse(sessionStorage.getItem("user")),x=["manager","admin"],[N,j]=l.useState(null),[n,i]=l.useState(""),[c,r]=l.useState([]);l.useEffect(()=>{(async()=>{if(n==="")r(o);else{const u=o.filter(b=>b.driverName.toLowerCase().includes(n.toLowerCase())||b.idNum.toString().includes(n)||b.email.toLowerCase().includes(n.toLowerCase())||b.phone.toString().includes(n)||b.address.toLowerCase().includes(n.toLowerCase())||b.licenseNumber.toString().includes(n)||D.find(d=>d.value===b.status).label.toLowerCase().includes(n.toLowerCase()));r(u),u.length===0?j("No results found"):j(null)}})()},[n,o]);const A=s=>{switch(s){case"available":return"green";case"on_duty":return"red";case"off_duty":return"orange";default:return"black"}},D=[{label:"Available",value:"available"},{label:"On Duty",value:"on_duty"},{label:"Off Duty",value:"off_duty"}];return o.length===0?e.jsx(V,{color:"danger",className:"justfy-content-center",children:"No drivers found"}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"mt-3",children:e.jsxs(K,{className:"w-50 mb-3 ",children:[e.jsx(g,{type:"text",placeholder:"Search Drivers...",id:"search",value:n,onChange:s=>i(s.target.value),className:"w-50 me-2 "}),e.jsx(W,{children:e.jsx(w,{icon:Q})})]})}),e.jsx(X,{className:"m-2",children:c.map(s=>e.jsxs(Y,{children:[e.jsx(Z,{children:e.jsxs("p",{className:"w-100 m-1",children:["Driver Name: ",e.jsxs("strong",{children:[" ",s.driverName," "]}),e.jsx(w,{icon:J,color:A(s.status),className:"m-2 float-end"}),e.jsxs("small",{className:"m-2 float-end",children:[" ",D.find(u=>u.value===s.status).label]})]})}),e.jsxs(ee,{children:[e.jsxs(y,{children:["ID: ",s.idNum]}),e.jsxs(y,{children:["Email: ",s.email]}),e.jsxs(y,{children:["Phone: ",s.phone]}),e.jsxs(y,{children:["Address: ",s.address]}),e.jsxs(y,{children:["License Number: ",s.licenseNumber]}),e.jsxs(y,{children:["Vehicle:"," ",s.assignedVehicle?`${s.assignedVehicle.regisNumber} - ${s.assignedVehicle.brand} ${s.assignedVehicle.model}`:"No vehicle assigned"]}),e.jsxs(y,{children:["Status: ",D.find(u=>u.value===s.status).label]}),e.jsxs(T,{className:"d-flex justify-content-end mt-3",children:[f?e.jsx(S,{color:"primary",size:"sm"}):e.jsx(re,{driver:s,onUpdateDriver:h}),x.includes(p.role)&&e.jsx(oe,{driver:s,onDeleteDriver:C})]})]})]},s._id))}),N&&e.jsx(V,{color:"danger",className:"text-center justify-content-center",children:N})]})},q=sessionStorage.getItem("accessToken"),ie="http://localhost:5057",ce=I.create({baseURL:ie,withCredentials:!0,headers:{"Content-Type":"application/json",...q&&{Authorization:`Bearer ${q}`}}}),we=()=>{const[o,f]=l.useState([]),[C,h]=l.useState(!1),[m,p]=l.useState(null),x=async()=>{var i,c;h(!0);try{const r=await ce.get("/api/v1/driver");r.status===200?(f(r.data.data),h(!1)):p(r.data.message)}catch(r){p(((c=(i=r.response)==null?void 0:i.data)==null?void 0:c.message)||r.message)}finally{h(!1)}};l.useEffect(()=>{x()},[]);const N=i=>{f(c=>[...c,i])},j=i=>{f(c=>c.filter(r=>r._id!==i))},n=i=>{f(c=>c.map(r=>r._id===i._id?i:r))};return e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"text-center",children:"Driver Management"}),e.jsx(T,{className:"m-3",children:e.jsx(te,{onAddDriver:N})}),e.jsxs(se,{children:[e.jsx(y,{children:"Drivers list"}),e.jsx(ae,{className:"md-3",children:e.jsx(ne,{driver:o,loading:C,error:m,onDeleteDriver:j,onUpdateDriver:n})})]})]})};export{we as default};
