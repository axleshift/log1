import{r as a,_ as pe,u as ge,a as k,R as E,C as xe,c as je,P as f,d as Ce,G as ve,l as Q,j as e,k as W,n as _,A as be}from"./index-D6mlluMj.js";import{F as q,s as ye,v as Ne,l as we,k as Se}from"./index-c-DuCOGy.js";import{a as T}from"./CButton-BikbuiKU.js";import{C as re,a as ne,b as oe,c as ie}from"./CModalHeader-F8HQcIQD.js";import{C as ce}from"./CModalTitle-B0kw4xSC.js";import{C as A}from"./CAlert-DyOx87OV.js";import{C as le}from"./CForm-Cak7Qu-d.js";import{C as M}from"./CFormInput-Bv1zYdGP.js";import{C as G}from"./CContainer-BeypE0T3.js";import{C as Le}from"./CInputGroup-B1punbFT.js";import{C as Pe}from"./CInputGroupText-i2rWi08d.js";import{C as ke}from"./CCard-Dsu2SNrA.js";import{e as se,u as Ee,C as de}from"./DefaultLayout-Y1MpLCC1.js";import{C as Te}from"./CCardBody-BqwsaOfU.js";import{C as We,a as Ae,b as ae,c as V,d as Ie,e as O}from"./CTable-BuBiqzem.js";import{g as Fe}from"./getTransitionDurationFromElement-Cpu4p4hx.js";import{C as Me,a as J}from"./CPaginationItem-BF8XDZjU.js";import"./index.esm-BlirLcHy.js";import"./1-uMqa3qbm.js";import"./cil-user-Ddrdy7PS.js";var te=function(s){typeof s=="function"&&s()},Re=function(s){s.dispatchEvent(new Event("transitionend"))},Be=function(s,c,b){if(b===void 0&&(b=!0),!b){te(s);return}var C=5,p=Fe(c)+C,o=!1,g=function(l){var d=l.target;d===c&&(o=!0,c.removeEventListener("transitionend",g),te(s))};c.addEventListener("transitionend",g),setTimeout(function(){o||Re(c)},p)},He=function(s,c){switch(s){case"right":return se(c)?"left":"right";case"left":return se(c)?"right":"left";default:return s}},F=a.forwardRef(function(s,c){var b=s.children,C=s.animation,p=C===void 0?!0:C,o=s.className,g=s.container,l=s.content,d=s.delay,u=d===void 0?0:d,r=s.fallbackPlacements,i=r===void 0?["top","right","bottom","left"]:r,n=s.offset,S=n===void 0?[0,6]:n,y=s.onHide,L=s.onShow,N=s.placement,P=N===void 0?"top":N,w=s.popperConfig,m=s.trigger,j=m===void 0?["hover","focus"]:m,h=s.visible,t=pe(s,["children","animation","className","container","content","delay","fallbackPlacements","offset","onHide","onShow","placement","popperConfig","trigger","visible"]),x=a.useRef(null),v=a.useRef(null),U=ge(c,x),R="tooltip".concat(a.useId()),$=a.useState(!1),B=$[0],K=$[1],X=a.useState(h),I=X[0],Y=X[1],z=Ee(),ue=z.initPopper,fe=z.destroyPopper,me=z.updatePopper,Z=typeof u=="number"?{show:u,hide:u}:u,ee={modifiers:[{name:"arrow",options:{element:".tooltip-arrow"}},{name:"flip",options:{fallbackPlacements:i}},{name:"offset",options:{offset:S}}],placement:He(P,v.current)},he=k(k({},ee),typeof w=="function"?w(ee):w);a.useEffect(function(){if(h){H();return}D()},[h]),a.useEffect(function(){if(B&&v.current&&x.current){ue(v.current,x.current,he),setTimeout(function(){Y(!0)},Z.show);return}!B&&v.current&&x.current&&fe()},[B]),a.useEffect(function(){!I&&v.current&&x.current&&Be(function(){K(!1)},x.current)},[I]);var H=function(){K(!0),L&&L()},D=function(){setTimeout(function(){Y(!1),y&&y()},Z.hide)};return a.useEffect(function(){me()},[l]),E.createElement(E.Fragment,null,E.cloneElement(b,k(k(k(k(k({},I&&{"aria-describedby":R}),{ref:v}),(j==="click"||j.includes("click"))&&{onClick:function(){return I?D():H()}}),(j==="focus"||j.includes("focus"))&&{onFocus:function(){return H()},onBlur:function(){return D()}}),(j==="hover"||j.includes("hover"))&&{onMouseEnter:function(){return H()},onMouseLeave:function(){return D()}})),E.createElement(xe,{container:g,portal:!0},B&&E.createElement("div",k({className:je("tooltip","bs-tooltip-auto",{fade:p,show:I},o),id:R,ref:U,role:"tooltip"},t),E.createElement("div",{className:"tooltip-arrow"}),E.createElement("div",{className:"tooltip-inner"},l))))});F.propTypes={animation:f.bool,children:f.node,container:f.any,content:f.oneOfType([f.string,f.node]),delay:f.oneOfType([f.number,f.shape({show:f.number.isRequired,hide:f.number.isRequired})]),fallbackPlacements:ve,offset:f.any,onHide:f.func,onShow:f.func,placement:f.oneOf(["auto","top","right","bottom","left"]),popperConfig:f.oneOfType([f.func,f.object]),trigger:Ce,visible:f.bool};F.displayName="CTooltip";const De=({onAddWarehouseLoc:s})=>{const{showSuccess:c,showError:b}=Q(),[C,p]=a.useState(!1),[o,g]=a.useState(!1),[l,d]=a.useState(!1),[u,r]=a.useState(null),i={warehouseName:"",address:"",capacity:{totalSpace:0,availableSpace:0,unit:"sqft"}},[n,S]=a.useState(i),y=N=>{const{id:P,value:w}=N.target;S(m=>({...m,[P]:w}))},L=async N=>{var w,m,j,h;if(N.preventDefault(),!N.currentTarget.checkValidity()){N.stopPropagation(),g(!0);return}d(!0);try{const t=JSON.parse(sessionStorage.getItem("user")),x=await _.post("api/v1/warehouseLoc/add",{...n,createdBy:t.email});x.data.success&&(c(x.data.message),s(x.data.data),p(!1),S(i),g(!1))}catch(t){r(((m=(w=t.response)==null?void 0:w.data)==null?void 0:m.message)||"An error occurred"),b(((h=(j=t.response)==null?void 0:j.data)==null?void 0:h.message)||"An error occurred")}finally{d(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs(T,{color:"primary",onClick:()=>p(!0),children:[e.jsx(q,{icon:ye})," Add Warehouse"]}),e.jsxs(re,{visible:C,onClose:()=>p(!1),"aria-labelledby":"AddWarehouseModal",children:[e.jsx(ne,{closeButton:!0,children:e.jsx(ce,{children:"Add New Warehouse"})}),e.jsxs(oe,{children:[u&&e.jsx(A,{color:"danger",children:u}),e.jsxs(le,{noValidate:!0,validated:o,children:[e.jsx(M,{type:"text",id:"warehouseName",className:"mb-3",placeholder:"Warehouse Name",floatingLabel:"Warehouse Name",onChange:y,value:n.warehouseName,required:!0,feedbackInvalid:"Please enter a warehouse name"}),e.jsx(M,{type:"text",id:"address",className:"mb-3",placeholder:"Address",floatingLabel:"Address",onChange:y,value:n.address,required:!0,feedbackInvalid:"Please enter an address"})]})]}),e.jsxs(ie,{children:[e.jsx(T,{color:"secondary",onClick:()=>{p(!1),S(i),r(null),g(!1)},children:"Cancel"}),e.jsx(T,{color:"primary",onClick:L,disabled:l,children:l?e.jsx(W,{size:"sm"}):"Save"})]})]})]})},Ve=({warehouseLoc:s,onDeleteWarehouseLoc:c})=>{const{showSuccess:b,showError:C}=Q(),[p,o]=a.useState(!1),[g,l]=a.useState(null),d=async()=>{o(!0);try{const r=await _.patch(`api/v1/warehouseLoc/delete/${s._id}`);r.data.success&&(b(r.data.message),c(s._id),o(!1),l(null))}catch(r){l(r),C(r.message)}finally{o(!1)}};if(g)return e.jsxs(A,{color:"danger",className:"text-center mt-5 w-75 mx-auto",children:["Error: ",g.message]});const u=({icon:r})=>{const[i,n]=a.useState(!1);return e.jsx(q,{icon:r,bounce:i,onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1)})};return e.jsx(e.Fragment,{children:e.jsxs(T,{color:"danger",disabled:p,variant:"outline",onClick:d,className:"me-2",children:[p?e.jsx(W,{size:"sm"}):e.jsx(u,{icon:Ne})," Delete"]})})},Oe=({warehouseLoc:s,onUpdateWarehouseLoc:c})=>{const{showSuccess:b,showErrors:C}=Q(),[p,o]=a.useState(!1),[g,l]=a.useState(!1),[d,u]=a.useState(!1),[r,i]=a.useState(null),[n,S]=a.useState(null),[y,L]=a.useState({warehouseName:s.warehouseName,address:s.address}),N=m=>{const{id:j,value:h}=m.target;L(t=>({...t,[j]:h}))},P=async m=>{const h=m.currentTarget.checkValidity();h||(m.preventDefault(),m.stopPropagation()),l(h);const x=JSON.parse(sessionStorage.getItem("user")).email;if(!x){i("User email not found. Please log in again.");return}u(!0);try{const v=await _.put(`api/v1/warehouseLoc/update/${s._id}`,{...y,createdBy:x});v.data.success&&(b(v.data.message),c(v.data.data),setTimeout(()=>{S(null),o(!1),i(null),l(!1)},2e3))}catch(v){i(v.response.data.message),C(v.response.data.message),setTimeout(()=>{i(null)},2e3)}u(!1)},w=({icon:m})=>{const[j,h]=a.useState(!1);return e.jsx(q,{icon:m,bounce:j,onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1)})};return e.jsxs(e.Fragment,{children:[e.jsxs(T,{color:"primary",variant:"outline",disabled:d,onClick:()=>o(!0),className:"me-2",children:[d?e.jsx(W,{size:"sm"}):e.jsx(w,{icon:we})," Update"]}),e.jsxs(re,{visible:p,onClose:()=>o(!1),children:[e.jsx(ne,{closeButton:!0,children:e.jsx(ce,{children:"Update Warehouse Location"})}),r&&e.jsx(A,{color:"danger",className:"m-3",children:r}),n&&e.jsx(A,{color:"success",className:"m-3",children:n}),e.jsx(oe,{children:e.jsxs(le,{noValidate:!0,validated:g,children:[e.jsx(M,{type:"text",id:"warehouseName",className:"mb-3",placeholder:"Warehouse Name",floatingLabel:"Warehouse Name",onChange:N,value:y.warehouseName,autoComplete:"off",required:!0,feedbackInvalid:"Please enter a warehouse name.",feedbackValid:"Looks good!"}),e.jsx(M,{type:"text",id:"address",className:"mb-3",placeholder:"Address",floatingLabel:"Address",onChange:N,value:y.address,autoComplete:"off",required:!0,feedbackInvalid:"Please enter an address.",feedbackValid:"Looks good!"})]})}),e.jsxs(ie,{children:[e.jsx(T,{color:"secondary",variant:"outline",disabled:d,onClick:()=>{o(!1),i(null),l(!1)},children:d?e.jsx(W,{size:"sm",color:"secondary"}):"Cancel"}),e.jsx(T,{color:"primary",variant:"outline",disabled:d,onClick:P,children:d?e.jsx(W,{size:"sm",color:"success"}):"Update"})]})]})]})},_e=({warehouseLoc:s,loading:c,error:b,onDeleteWarehouseLoc:C,onUpdateWarehouseLoc:p})=>{const[o,g]=a.useState(""),[l,d]=a.useState([]),[u,r]=a.useState(1),[i,n]=a.useState(null),S=10,y=be(),L=["manager","admin"],N="admin";if(a.useEffect(()=>{d(s)},[s]),a.useEffect(()=>{if(o==="")d(s);else{const t=s.filter(x=>{const v=x.warehouseName.toLowerCase().includes(o.toLowerCase()),U=x.address.toLowerCase().includes(o.toLowerCase()),R=L.includes(y)&&x.createdBy.toLowerCase().includes(o.toLowerCase());return v||U||R});d(t),r(1),t.length===0?n("No results found"):n(null)}},[o,s]),s.length===0)return e.jsx(A,{color:"danger",className:"text-center mt-5 w-75 mx-auto justify-content-center",children:"No Warehouse Location Found"});const P=t=>{g(t.target.value)},w=u*S,m=w-S,j=l.slice(m,w),h=Math.ceil(l.length/S);return c?e.jsx(W,{color:"primary",className:"text-center mt-5 w-75 mx-auto",children:"Loading Warehouse Location..."}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"m-3",children:e.jsxs(Le,{className:"w-50 mb-3",children:[e.jsx(M,{type:"text",id:"search",value:o,onChange:P,placeholder:"Search Warehouse Location..."}),e.jsx(Pe,{children:e.jsx(q,{icon:Se})})]})}),e.jsxs(ke,{children:[e.jsx(de,{children:"Warehouse Location List"}),e.jsxs(Te,{className:"md-3",children:[e.jsxs(We,{bordered:!0,hover:!0,responsive:!0,className:"mx-auto ",children:[e.jsx(Ae,{className:"text-center",children:e.jsxs(ae,{children:[e.jsx(V,{className:"fixed-width bg-secondary",children:"Warehouse Name"}),e.jsx(V,{className:"fixed-width bg-secondary",children:"Address"}),N.includes(y)&&e.jsx(V,{className:"fixed-width bg-secondary",children:"Created By"}),e.jsx(V,{className:"fixed-width bg-secondary",children:"Actions"})]})}),e.jsx(Ie,{className:"text-center",children:j.map(t=>e.jsxs(ae,{children:[e.jsx(O,{className:"fixed-width",children:e.jsx(F,{content:t.warehouseName,children:e.jsx("span",{children:t.warehouseName})})}),e.jsx(O,{className:"fixed-width",children:e.jsx(F,{content:t.address,children:e.jsx("span",{children:t.address})})}),N.includes(y)&&e.jsx(O,{className:"fixed-width",color:"danger",children:e.jsx(F,{content:t.createdBy,children:e.jsx("span",{children:t.createdBy})})}),e.jsxs(O,{className:"fixed-width",children:[e.jsx(Oe,{warehouseLoc:t,onUpdateWarehouseLoc:p}),L.includes(y)&&e.jsx(Ve,{warehouseLoc:t,onDeleteWarehouseLoc:C})]})]},t._id))})]}),l.length>0&&e.jsxs(G,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs(G,{children:["Showing ",m+1," to"," ",Math.min(w,l.length)," of"," ",l.length," entries"]}),e.jsxs(Me,{className:"mt-3",children:[e.jsx(J,{disabled:u===1,onClick:()=>r(t=>Math.max(t-1,1)),children:"Previous"}),[...Array(h).keys()].map(t=>e.jsx(J,{active:t+1===u,onClick:()=>r(t+1),children:t+1},t+1)),e.jsx(J,{disabled:u===h,onClick:()=>r(t=>Math.min(t+1,h)),children:"Next"})]})]}),i&&e.jsx(A,{color:"danger",className:"text-center mt-5 w-75 mx-auto justify-content-center",children:i})]})]})]})};sessionStorage.getItem("accessToken");const ls=()=>{const[s,c]=a.useState([]),[b,C]=a.useState(!1),[p,o]=a.useState(null),g=async()=>{var r,i;C(!0);try{const n=await _.get("api/v1/warehouseLoc/locations");n.status===200?c(n.data.data):o(n.data.message)}catch(n){o(((i=(r=n.response)==null?void 0:r.data)==null?void 0:i.message)||n.message)}finally{C(!1)}};a.useEffect(()=>{g()},[]);const l=r=>{c(i=>[...i,r])},d=r=>{c(i=>i.filter(n=>n._id!==r))},u=r=>{c(i=>i.map(n=>n._id===r._id?r:n))};return e.jsxs(e.Fragment,{children:[e.jsx(de,{children:"Warehouse location"}),e.jsx(De,{onAddWarehouseLoc:l}),e.jsx(_e,{warehouseLoc:s,loading:b,error:p,onDeleteWarehouseLoc:d,onUpdateWarehouseLoc:u})]})};export{ls as default};
