import{r as o,_ as ne,R as le,a as ie,c as ce,P as D,j as e,k as Y,n as $,A as de,m as me}from"./index-DP-6o1Ky.js";import{F as G,j as ue,k as he,a as pe,l as fe}from"./index-g5O3o-Ix.js";import{C as xe,a as K}from"./1-7zT8qG6k.js";import{C as je,a as Ce,b as ve,c as ge}from"./CModalHeader-BFzET1ml.js";import{C as we}from"./CModalTitle-CArKBMbn.js";import{C as M}from"./CAlert-B_Y39mMu.js";import{C as be}from"./CForm-WlX56MzA.js";import{C as P,a as ye}from"./CFormInput-D80Xx8QS.js";import{C as Se}from"./CFormSelect-D7JeoHHi.js";import{a as C}from"./CButton-fBjdpGOu.js";import"./index.esm-vCMPmUNq.js";import{C as L}from"./CContainer-Bm_J4ctF.js";import{C as Ne}from"./CInputGroup-Bbkatvq2.js";import{C as Pe}from"./CInputGroupText-BX58af7r.js";import{C as Ae}from"./CCard-Cfs72Y-Z.js";import{C as Ee}from"./CCardHeader-DhQwLTjq.js";import{C as Ue}from"./CCardBody-CJWP-GlI.js";import{C as ke,a as Le,b as X,c as b,d as Fe,e as y}from"./CTable-H3ASDLst.js";import{C as Te,a as O}from"./CPaginationItem-9GWkHQgm.js";var q=o.forwardRef(function(t,S){var m,A=t.children,a=t.className,c=t.size,f=t.vertical,u=ne(t,["children","className","size","vertical"]);return le.createElement("div",ie({className:ce(f?"btn-group-vertical":"btn-group",(m={},m["btn-group-".concat(c)]=c,m),a)},u,{ref:S}),A)});q.propTypes={children:D.node,className:D.string,size:D.oneOf(["sm","lg"]),vertical:D.bool};q.displayName="CButtonGroup";const Ie=({user:t,visible:S,onClose:m,onUpdate:A})=>{const[a,c]=o.useState({username:"",email:"",password:"",confirmPassword:"",role:"",photo:""}),[f,u]=o.useState(!1),[E,x]=o.useState(null),[v,N]=o.useState(null),[g,U]=o.useState(null),k="https://backend-log1.axleshift.com/";sessionStorage.getItem("accessToken"),o.useEffect(()=>{if(t)if(c({username:t.username||"",email:t.email||"",password:"",confirmPassword:"",role:t.role||"",photo:null}),t.photo){const l=t.photo.startsWith("http")?t.photo:`${k}uploads/profiles/${t.photo}`;U(l)}else U(null)},[t,k]);const d=async l=>{var i,h;l.preventDefault(),u(!0),x(null);try{if((a.password||a.confirmPassword)&&a.password!==a.confirmPassword)throw new Error("Passwords do not match");if(!t||!t._id){console.error("No user ID available");return}const n=new FormData;n.append("username",a.username),n.append("email",a.email),n.append("role",a.role),a.password&&n.append("password",a.password),a.photo&&n.append("photo",a.photo);const _=await $.put(`api/v1/user/update-user/${t._id}`,n);_.data.success&&(N("User updated successfully"),A(_.data.data),setTimeout(()=>{m()},2e3))}catch(n){console.error("Error updating user:",n),x(((h=(i=n.response)==null?void 0:i.data)==null?void 0:h.message)||n.message||"Failed to update user")}finally{u(!1)}},j=l=>{const{id:i,value:h}=l.target;c(n=>({...n,[i]:h}))},F=l=>{const i=l.target.files[0];if(i){c(n=>({...n,photo:i}));const h=new FileReader;h.onloadend=()=>{U(h.result)},h.readAsDataURL(i)}};return e.jsxs(je,{visible:S,onClose:m,children:[e.jsx(Ce,{children:e.jsxs(we,{children:["Edit User: ",t==null?void 0:t.username]})}),e.jsxs(ve,{children:[E&&e.jsx(M,{color:"danger",children:E}),v&&e.jsx(M,{color:"success",children:v}),e.jsxs(be,{onSubmit:d,children:[e.jsx(P,{id:"username",value:a.username,onChange:j,className:"mb-3",placeholder:"Enter username",autoComplete:"off",floatingLabel:"Username",required:!0}),e.jsx(P,{type:"email",id:"email",value:a.email,onChange:j,className:"mb-3",placeholder:"Enter email",autoComplete:"off",floatingLabel:"Email",required:!0}),e.jsx(ye,{htmlFor:"password",children:"New Password (leave blank to keep current)"}),e.jsx(P,{type:"password",id:"password",value:a.password,onChange:j,className:"mb-3",autoComplete:"off",placeholder:"New Password",floatingLabel:"New Password"}),e.jsx(P,{type:"password",id:"confirmPassword",value:a.confirmPassword,onChange:j,className:"mb-3",autoComplete:"off",placeholder:"Confirm Password",floatingLabel:"Confirm Password"}),e.jsxs(Se,{id:"role",label:"Role",value:a.role,onChange:j,className:"mb-3",required:!0,children:[e.jsx("option",{value:"",children:"Select Role"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"manager",children:"Manager"}),e.jsx("option",{value:"chief mechanic",children:"Chief mechanic"}),e.jsx("option",{value:"fleet manager",children:"Fleet Manager"}),e.jsx("option",{value:"scheduler",children:"Scheduler"}),e.jsx("option",{value:"warehouse manager",children:"Warehouse Manager"}),e.jsx("option",{value:"receiving clerk",children:"Receiving Clerk"})]}),e.jsx(P,{type:"file",id:"photo",label:"Profile Photo",onChange:F,accept:"image/*",className:"mb-3"}),g&&e.jsx("div",{className:"mb-3",children:e.jsx(xe,{src:g||K,alt:"Preview",align:"center",rounded:!0,width:200,height:200,crossOrigin:"anonymous",onError:l=>{l.target.onerror=null,l.target.src=K}})})]})]}),e.jsxs(ge,{children:[e.jsx(C,{color:"secondary",onClick:m,children:"Cancel"}),e.jsx(C,{color:"primary",onClick:d,disabled:f,children:f?e.jsx(Y,{size:"sm"}):"Save Changes"})]})]})},ss=({onUpdateUser:t})=>{const S=de(),m="super admin",A=me(),[a,c]=o.useState([]),[f,u]=o.useState(!0),[E,x]=o.useState([]),[v,N]=o.useState(1),[g,U]=o.useState(""),[k,d]=o.useState(null),[j,F]=o.useState(null),[l,i]=o.useState(!1),[h,n]=o.useState(!1),[_,Re]=o.useState(null),[Q,V]=o.useState(null),[T,B]=o.useState("all"),z=10,Z=s=>{switch(T){case"active":return s.filter(r=>r.isActive);case"inactive":return s.filter(r=>!r.isActive);default:return s}},ee=async()=>{u(!0);try{const r=(await $.get("api/v1/user/all-user")).data.data;c(r),x(r)}catch(s){console.error("Error fetching users:",s),d("Error fetching users")}finally{u(!1)}};o.useEffect(()=>{ee()},[]),o.useEffect(()=>{if(g==="")x(a);else{const s=a.filter(r=>{const p=g.toLowerCase(),w=r.isActive?"active":"inactive",I=r.isActive?"deactivate":"activate";return r.username.toLowerCase().includes(p)||r.email.toLowerCase().includes(p)||r.role.toLowerCase().includes(p)||w.includes(p)||I.includes(p)||r.createdAt.toLowerCase().includes(p)});x(s),N(1),s.length===0?d("No matching users found"):d(null)}},[g,a]);const se=async s=>{var r,p;u(!0);try{const w=await $.post(`api/v1/user/in-active-user/${s}`);if(w.data.success){const I=a.map(R=>R._id===s?{...R,isActive:!R.isActive}:R);c(I),x(I),F(w.data.message)}else d(w.data.message);setTimeout(()=>{F(null),d(null)},3e3)}catch(w){d(((p=(r=w.response)==null?void 0:r.data)==null?void 0:p.message)||"Failed to update user status"),setTimeout(()=>d(null),3e3)}finally{u(!1)}},ae=s=>{V(s),i(!0)},te=s=>{c(a.map(r=>r._id===s._id?s:r)),x(E.map(r=>r._id===s._id?s:r))};if(f)return e.jsx(Y,{className:"m-5 d-flex justify-content-center"});const W=Z(E),J=v*z,re=J-z,oe=W.slice(re,J),H=Math.ceil(W.length/z);return e.jsx(e.Fragment,{children:e.jsxs(L,{className:" justify-content-center align-items-center",children:[e.jsx(L,{className:"m-3 d-flex justify-content-center align-items-center",children:e.jsx("h1",{children:"Accounts"})}),e.jsx(L,{className:"m-3 d-flex justify-content-between",children:e.jsx(C,{color:"primary",className:"m-3 ",disabled:f,onClick:()=>A("/dashboard"),children:f?"Loading...":e.jsx(G,{icon:ue})})}),e.jsxs(L,{className:"m-3",children:[k&&e.jsx(M,{color:"danger",className:"mb-3",children:k}),j&&e.jsx(M,{color:"success",className:"mb-3",children:j}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs(Ne,{className:"w-50",children:[e.jsx(P,{type:"text",value:g,id:"search",onChange:s=>U(s.target.value),placeholder:"Search users..."}),e.jsx(Pe,{children:e.jsx(G,{icon:he})})]}),e.jsxs(q,{children:[e.jsx(C,{color:T==="all"?"primary":"secondary",onClick:()=>B("all"),children:"All"}),e.jsx(C,{color:T==="active"?"primary":"secondary",onClick:()=>B("active"),children:"Active"}),e.jsx(C,{color:T==="inactive"?"primary":"secondary",onClick:()=>B("inactive"),children:"Inactive"})]})]}),e.jsx("div",{className:"text-muted small mb-3",children:"Search by: username, email, role, status (active/inactive), or action (activate/deactivate)"}),e.jsxs(Ae,{children:[e.jsx(Ee,{children:e.jsx("h4",{children:"User List"})}),e.jsxs(Ue,{children:[e.jsxs(ke,{hover:!0,responsive:!0,className:"text-center",children:[e.jsx(Le,{children:e.jsxs(X,{children:[e.jsx(b,{children:"Username"}),e.jsx(b,{children:"Email"}),e.jsx(b,{children:"Role"}),e.jsx(b,{children:"Created Date"}),e.jsx(b,{children:"Status"}),e.jsx(b,{children:"Date of Login"}),e.jsx(b,{children:"Actions"})]})}),e.jsx(Fe,{children:oe.filter(s=>s.role!=="super admin").map(s=>e.jsxs(X,{children:[e.jsx(y,{children:s.username}),e.jsx(y,{children:s.email}),e.jsx(y,{children:s.role}),e.jsx(y,{children:s.createdAt.slice(0,10)}),e.jsx(y,{children:e.jsx(pe,{color:s.isActive?"success":"danger",children:s.isActive?"Active":"Deactivated"})}),e.jsx(y,{children:s.lastLoginTime||"-"}),e.jsx(y,{children:e.jsxs(L,{className:" d-flex justify-content-center align-items-center",children:[e.jsx(C,{variant:"outline",className:"me-2",color:s.isActive?"danger":"success",onClick:()=>se(s._id),children:s.isActive?"Deactivate":"Activate"}),S&&m.includes(S)&&e.jsx(C,{variant:"outline",className:"me-2",color:"primary",onClick:()=>ae(s),children:e.jsx(G,{icon:fe})})]})})]},s._id))})]}),Q&&e.jsx(Ie,{user:Q,visible:l,onClose:()=>{i(!1),V(null)},onUpdate:te}),e.jsxs(Te,{align:"center",children:[e.jsx(O,{disabled:v===1,onClick:()=>N(s=>Math.max(s-1,1)),children:"Previous"}),[...Array(H).keys()].map(s=>e.jsx(O,{active:s+1===v,onClick:()=>N(s+1),children:s+1},s+1)),e.jsx(O,{disabled:v===H,onClick:()=>N(s=>Math.min(s+1,H)),children:"Next"})]})]})]})]})]})})};export{ss as default};
