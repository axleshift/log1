import{l as ge,r as d,j as e,k as ce,n as W,A as Le}from"./index-BysJX1-u.js";import{s as we,F as z,k as Te,I as Ee,f as Me,J as Re,b as Qe,a as _e,K as $e,d as Ae,L as Oe,l as De,y as ze,v as qe}from"./index-CI_JwGfQ.js";import{a as Q}from"./CButton-C3bHcCoV.js";import{C as me,a as ue,b as pe,c as he}from"./CModalHeader-CX1bORT4.js";import{C as Pe}from"./CModalTitle-Drdh8PNC.js";import{C as de}from"./CAlert-Bgng-jkS.js";import{C as ke}from"./CForm-CJi66Oos.js";import{C as T}from"./CInputGroup-D49f4pre.js";import{C as h,a as Fe}from"./CFormInput-ts0iH0sw.js";import{C as fe}from"./CFormSelect-CthG47Ih.js";import{C as Ne}from"./1-boF8-dMt.js";import{C as Ie}from"./CFormTextarea-Bz7AMU6M.js";import{C as je}from"./CContainer-BlIykTTw.js";import{C as ee}from"./CCard-CCozfsBg.js";import{C as te}from"./CCardBody-FPbhVj7T.js";import{a as ve,C as J}from"./CRow-DqxtVYEC.js";import{C as Ge}from"./CInputGroupText-FiWgTsEN.js";import{C as Ue,a as Be,b as He,c as Je}from"./CAccordionHeader-CydZ0NL6.js";import{C as We,a as be}from"./CPaginationItem-sYtEvroH.js";import{C as Ye}from"./DefaultLayout-BKqZMzIQ.js";import"./index.esm-CbB94FCC.js";import"./cil-user-Ddrdy7PS.js";const Ke=({onAddFuelog:c})=>{var L,H;const{showSuccess:ae,showError:F}=ge(),[_,k]=d.useState(!1),[Y,$]=d.useState(null),[q,G]=d.useState(!1),[K,N]=d.useState(!1),[se,ne]=d.useState(!1),[re,A]=d.useState(null),[ie,U]=d.useState([]),[I,B]=d.useState([]),X=new Date().toISOString().split("T")[0],E={vehicleId:"",driverId:"",vehicleDetails:{brand:"",model:"",regisNumber:"",fuelType:""},driverDetails:{driverName:""},date:"",receiptNumber:"",fuelQuantity:"",fuelType:"",costPerLiter:"",totalCost:"",currentMileage:"",receiptImage:"",route:{start:"",end:"",distance:""},notes:"",litersPer100km:"",kmPerLiter:"",mpg:""},[n,r]=d.useState(E);d.useEffect(()=>{(async()=>{try{k(!0);const[p,i]=await Promise.all([W.get("api/v1/driver"),W.get("api/v1/vehicle/in-use")]);U(p.data.data),B(i.data.data)}catch{F("Error fetching initial data")}finally{k(!1)}})()},[]);const f=m=>{const{id:p,value:i}=m.target;if(p.includes("route.")){const l=p.split(".")[1];r(t=>{const a={...t,route:{...t.route,[l]:i}};if(a.route.distance&&a.fuelQuantity){const s=parseFloat(a.route.distance),o=parseFloat(a.fuelQuantity);if(s>0&&o>0){const v=o/s*100;a.litersPer100km=v.toFixed(2);const S=s/o;a.kmPerLiter=S.toFixed(2);const M=o*.264172,le=s*.621371/M;a.mpg=le.toFixed(2)}}return a})}else if(p==="vehicleId"){const l=I.find(a=>a._id===i),t=ie.find(a=>a._id===(l==null?void 0:l.assignedDriver));r(a=>({...a,vehicleId:i,driverId:(l==null?void 0:l.assignedDriver)||"",vehicleDetails:{brand:(l==null?void 0:l.brand)||"",model:(l==null?void 0:l.model)||"",regisNumber:(l==null?void 0:l.regisNumber)||"",fuelType:(l==null?void 0:l.fuelType)||""},driverDetails:{driverName:(t==null?void 0:t.driverName)||""},currentMileage:(l==null?void 0:l.currentMileage)||"",fuelType:(l==null?void 0:l.fuelType)||""}))}else r(p==="fuelQuantity"||p==="costPerLiter"?l=>{const t={...l,[p]:i},a=parseFloat(p==="fuelQuantity"?i:l.fuelQuantity),s=parseFloat(p==="costPerLiter"?i:l.costPerLiter);if(!isNaN(a)&&!isNaN(s)&&(t.totalCost=(a*s).toFixed(2)),p==="fuelQuantity"&&t.route.distance){const o=parseFloat(t.route.distance),v=parseFloat(i);if(o>0&&v>0){const S=v/o*100;t.litersPer100km=S.toFixed(2);const M=o/v;t.kmPerLiter=M.toFixed(2);const O=v*.264172,oe=o*.621371/O;t.mpg=oe.toFixed(2)}}return t}:l=>({...l,[p]:i}))},Z=m=>{const p=m.target.files[0];if(p){if(!p.type.match("image.*")){F("Please upload an image file"),m.target.value="";return}const i=5*1024*1024;if(p.size>i){F("File size should be less than 5MB"),m.target.value="";return}r(t=>({...t,receiptImage:p}));const l=new FileReader;l.onloadend=()=>{A(l.result)},l.readAsDataURL(p)}},V=async m=>{if(m.preventDefault(),m.stopPropagation(),m.currentTarget.checkValidity()===!1){ne(!0);return}k(!0);try{const i=new FormData;if(i.append("vehicleId",n.vehicleId),i.append("driverId",n.driverId),i.append("vehicleDetails[brand]",n.vehicleDetails.brand),i.append("vehicleDetails[model]",n.vehicleDetails.model),i.append("vehicleDetails[regisNumber]",n.vehicleDetails.regisNumber),i.append("vehicleDetails[fuelType]",n.vehicleDetails.fuelType),i.append("driverDetails[driverName]",n.driverDetails.driverName),i.append("date",n.date),i.append("receiptNumber",n.receiptNumber),i.append("fuelQuantity",n.fuelQuantity),i.append("fuelType",n.fuelType),i.append("costPerLiter",n.costPerLiter),i.append("totalCost",n.totalCost),i.append("currentMileage",n.currentMileage),i.append("notes",n.notes),i.append("litersPer100km",n.litersPer100km),i.append("kmPerLiter",n.kmPerLiter),i.append("mpg",n.mpg),i.append("route[start]",n.route.start),i.append("route[end]",n.route.end),i.append("route[distance]",n.route.distance),n.receiptImage){if(n.receiptImage.size>5242880){F("File size should be less than 5MB");return}i.append("receiptImage",n.receiptImage)}console.log("receiptImage",n.receiptImage);const l=await W.post("api/v1/fuelLogs/fuel-logs",i);console.log("response",l),l.data.success&&(c(l.data.data),ae(l.data.message),G(l.data.message),setTimeout(()=>{G(!1),r(E),A(null),N(!1)},2e3))}catch(i){F(i.response.data.message),$(i.response.data.message),setTimeout(()=>{$(null)},5e3)}finally{k(!1)}},x=({icon:m})=>{const[p,i]=d.useState(!1);return e.jsx(z,{icon:m,bounce:p,onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1)})};return e.jsxs(e.Fragment,{children:[e.jsxs(Q,{color:"primary",variant:"outline",disabled:_,onClick:()=>N(!0),children:[_?e.jsx(ce,{color:"primary",size:"sm"}):e.jsx(x,{icon:we}),"Add Fuel Log"]}),e.jsxs(me,{visible:K,onClose:()=>N(!1),size:"lg",children:[e.jsx(ue,{children:e.jsx(Pe,{children:"Add Fuel Log"})}),Y&&e.jsx(de,{color:"danger",className:"m-3",children:Y}),q&&e.jsx(de,{color:"success",className:"m-3",children:q}),e.jsx(pe,{children:e.jsxs(ke,{noValidate:!0,validated:se,children:[e.jsxs(T,{children:[e.jsx(h,{type:"date",className:"mb-3",floatingLabel:"date",label:"Receipt Number",id:"date",max:X,value:n.date,onChange:f,required:!0}),e.jsxs(fe,{className:"mb-3",floatingLabel:"Vehicle",label:"Vehicle",id:"vehicleId",value:n.vehicleId,onChange:f,required:!0,children:[e.jsx("option",{value:"",children:"Select Vehicle"}),I==null?void 0:I.map(m=>e.jsx("option",{value:m._id,children:`${m.brand} / ${m.model} / ${m.regisNumber}`},m._id))]})]}),e.jsxs(T,{children:[" ",e.jsx(h,{className:"mb-3",floatingLabel:"Driver",label:"Driver",id:"driverId",value:((L=ie.find(m=>m._id===n.driverId))==null?void 0:L.driverName)||"",onChange:f,disabled:!0}),e.jsxs(fe,{className:"mb-3",floatingLabel:"Fuel Type",label:"Fuel Type",id:"fuelType",required:!0,value:((H=I.find(m=>m._id===n.vehicleId))==null?void 0:H.fuelType)||"",onChange:f,disabled:!0,children:[e.jsx("option",{value:"",children:"Select Fuel Type"}),e.jsx("option",{value:"Gasoline",children:"Gasoline"}),e.jsx("option",{value:"Diesel",children:"Diesel"})]})]}),e.jsxs(T,{children:[e.jsx(h,{className:"mb-3",type:"text",floatingLabel:"Official Reciept",placeholder:"Official Reciept",id:"receiptNumber",value:n.receiptNumber,onChange:f,required:!0,autoComplete:"off"}),e.jsx(h,{className:"mb-3",type:"number",floatingLabel:"Fuel Quantity",placeholder:"Fuel Quantity",id:"fuelQuantity",value:n.fuelQuantity,onChange:f,required:!0,autoComplete:"off",min:"0",step:"0.01",feedbackInvalid:"Please enter a valid fuel quantity"}),e.jsx(h,{className:"mb-3",type:"number",floatingLabel:"Cost Per Liter",placeholder:"Cost Per Liter",id:"costPerLiter",value:n.costPerLiter,onChange:f,autoComplete:"off",feedbackInvalid:"Please enter a valid cost per liter"}),e.jsx(h,{className:"mb-3",type:"number",floatingLabel:"Total Cost",placeholder:"Total Cost",id:"totalCost",value:n.totalCost,onChange:f,autoComplete:"off",min:"0",step:"0.01",disabled:!0,feedbackInvalid:"Please enter a valid total cost"})]}),e.jsxs(T,{children:[e.jsx(h,{className:"mb-3",type:"number",floatingLabel:"Odometer Reading",placeholder:"Odometer Reading",id:"currentMileage",value:n.currentMileage,onChange:f,autoComplete:"off",feedbackInvalid:"Please enter a valid odometer reading"}),e.jsx(h,{className:"mb-3",type:"text",floatingLabel:"Start Location",placeholder:"Start Location",id:"route.start",value:n.route.start,onChange:f,autoComplete:"off",feedbackInvalid:"Please enter a valid start location"}),e.jsx(h,{className:"mb-3",type:"text",floatingLabel:"End Location",placeholder:"End Location",id:"route.end",value:n.route.end,onChange:f,autoComplete:"off",feedbackInvalid:"Please enter a valid end location"}),e.jsx(h,{className:"mb-3",type:"number",floatingLabel:"Distance/kilometers",placeholder:"Distance",id:"route.distance",value:n.route.distance,onChange:f,autoComplete:"off",feedbackInvalid:"Please enter a valid distance"})]}),e.jsxs(T,{className:"mb-3",children:[e.jsx(h,{type:"text",floatingLabel:"L/100km",placeholder:"Liters per 100km",id:"litersPer100km",value:n.litersPer100km,disabled:!0}),e.jsx(h,{type:"text",floatingLabel:"km/L",placeholder:"Kilometers per Liter",id:"kmPerLiter",value:n.kmPerLiter,disabled:!0}),e.jsx(h,{type:"text",floatingLabel:"MPG",placeholder:"Miles per Gallon",id:"mpg",value:n.mpg,disabled:!0})]}),e.jsx(Fe,{htmlFor:"receipt",children:"Picture Of Receipts"}),e.jsx(T,{className:"mb-3",children:e.jsx(h,{type:"file",id:"receipt",accept:"image/*",required:!0,feedbackInvalid:"Please upload a receipt image",onChange:Z})}),re&&e.jsx("div",{className:"mb-3",children:e.jsx(Ne,{src:re,rounded:!0,align:"center",alt:"Receipts",width:200,height:200})}),e.jsx(Ie,{className:"mb-3",type:"text",floatingLabel:"Notes",placeholder:"Notes",rows:3,id:"notes",value:n.notes,autoCapitalize:"on",autoComplete:"off",onChange:f,feedbackInvalid:"Please enter a valid notes"})]})}),e.jsxs(he,{children:[e.jsx(Q,{color:"secondary",onClick:()=>N(!1),children:"Close"}),e.jsx(Q,{color:"primary",onClick:V,disabled:_,children:_?e.jsx(ce,{color:"primary",size:"sm"}):"Add"})]})]})]})},Xe=({fuelLogs:c,vehicles:ae,drivers:F,loading:_,error:k,onDeleteFuelLog:Y,onUpdateFuelLog:$,onViewReceipt:q})=>{const[G,K]=d.useState(""),[N,se]=d.useState("date"),[ne,re]=d.useState("desc"),[A,ie]=d.useState(""),[U,I]=d.useState(null),[B,X]=d.useState(1),[E]=d.useState(10),[n,r]=d.useState(null),f=Le(),Z=["manager","admin","super admin","fleet manager"],V=(t,a)=>{if(typeof t=="object"&&(t!=null&&t.brand)&&(t!=null&&t.model)&&(t!=null&&t.regisNumber))return`${t.brand} ${t.model} (${t.regisNumber})`;if(!t&&(a!=null&&a.vehicleDetails))return`${a.vehicleDetails.brand} ${a.vehicleDetails.model} (${a.vehicleDetails.regisNumber}) [Deleted]`;const s=ae.find(o=>o._id===t);if(s)return`${s.brand} ${s.model} (${s.regisNumber})`;if(s.deleted===!0)return`${s.brand} ${s.model} (${s.regisNumber}) [Deleted]`},x=(t,a)=>{var o;if(typeof t=="object"&&(t!=null&&t.driverName))return t.driverName;if(!t&&((o=a==null?void 0:a.driverDetails)!=null&&o.driverName))return`${a.driverDetails.driverName} [Deleted]`;const s=F.find(v=>v._id===t);if(s!=null&&s.driverName)return s.driverName},L=c.filter(t=>{var M,O,le,oe;if(!t)return!1;const a=V(t.vehicleId,t).toLowerCase(),s=x(t.driverId,t).toLowerCase(),o=G.toLowerCase(),v=(((M=t.receiptNumber)==null?void 0:M.toLowerCase())||"").includes(o)||a.includes(o)||s.includes(o)||(t.date?new Date(t.date).toLocaleDateString().includes(o):!1)||(((O=t.fuelQuantity)==null?void 0:O.toString())||"").includes(o)||(((le=t.totalCost)==null?void 0:le.toString())||"").includes(o),S=A?(typeof t.vehicleId=="object"?(oe=t.vehicleId)==null?void 0:oe._id:t.vehicleId)===A:!0;return v&&S}).sort((t,a)=>{let s,o;switch(N){case"vehicle":s=V(t.vehicleId,t),o=V(a.vehicleId,a);break;case"driver":s=x(t.driverId,t),o=x(a.driverId,a);break;case"date":s=new Date(t.date||"").getTime(),o=new Date(a.date||"").getTime();break;case"fuelQuantity":case"costPerLiter":case"totalCost":s=parseFloat(t[N]||0),o=parseFloat(a[N]||0);break;default:s=t[N]||"",o=a[N]||""}return!s&&!o?0:s?o?ne==="asc"?s>o?1:-1:s<o?1:-1:-1:1}),H=B*E,m=H-E,p=L.slice(m,H),i=Math.ceil(L.length/E);if(d.useEffect(()=>{X(1)},[G,A]),d.useEffect(()=>{L.length===0?r("No matching records found"):r(null)},[L]),_)return e.jsx(ce,{});if(k)return e.jsx(de,{color:"danger",children:k});const l=({icon:t})=>{const[a,s]=d.useState(!1);return e.jsx(z,{icon:t,bounce:a,onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1)})};return e.jsxs(je,{fluid:!0,className:"p-0",children:[e.jsx(ee,{className:"mb-4 shadow-sm border-0",children:e.jsx(te,{children:e.jsxs(ve,{className:"align-items-center",children:[e.jsx(J,{xs:12,md:6,children:e.jsxs(T,{children:[e.jsx(h,{placeholder:"Search fuel logs...",value:G,onChange:t=>K(t.target.value),className:"border-end-0"}),e.jsx(Ge,{className:"bg-transparent",children:e.jsx(z,{icon:Te})})]})}),e.jsx(J,{xs:12,md:6,className:"mt-3 mt-md-0 text-end",children:e.jsxs("span",{className:"text-muted",children:["Total Records: ",L.length]})})]})})}),e.jsx(Ue,{children:p.map(t=>{var a,s,o,v,S,M,O;return e.jsxs(Be,{children:[e.jsx(He,{onClick:()=>I(U===t._id?null:t._id),children:e.jsxs("div",{className:"d-flex justify-content-sm-between w-100",children:[e.jsxs("ul",{className:"list-unstyled",children:[e.jsxs("li",{className:"ps-3",children:[e.jsx("strong",{children:"Receipt Number:"})," ",t.receiptNumber]}),e.jsxs("li",{className:"ps-3",children:[e.jsx(z,{icon:Ee})," ",new Date(t.date).toLocaleDateString()]})]}),e.jsxs("div",{className:"float-end p-3",children:[e.jsx(z,{icon:Me})," ",e.jsxs("strong",{children:[t.vehicleDetails.regisNumber," ",`(${t.vehicleDetails.model})`]})]})]})}),e.jsx(Je,{children:e.jsxs(ve,{className:"g-4",children:[e.jsx(J,{xs:12,md:4,children:e.jsx(ee,{className:"h-100 border-0 shadow-sm",children:e.jsxs(te,{children:[e.jsxs("h6",{className:"mb-3",children:[e.jsx(z,{icon:Re,className:"text-primary me-2"}),"Vehicle Details"]}),e.jsxs("div",{className:"ms-4",children:[e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Registration:"})," ",((a=t.vehicleId)==null?void 0:a.regisNumber)||((s=t.vehicleDetails)==null?void 0:s.regisNumber)]}),e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Model:"})," ",((o=t.vehicleId)==null?void 0:o.model)||((v=t.vehicleDetails)==null?void 0:v.model)]}),e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:"Brand:"})," ",((S=t.vehicleId)==null?void 0:S.brand)||((M=t.vehicleDetails)==null?void 0:M.brand)]})]})]})})}),e.jsx(J,{xs:12,md:4,children:e.jsx(ee,{className:"h-100 border-0 shadow-sm",children:e.jsxs(te,{children:[e.jsxs("h6",{className:"mb-3",children:[e.jsx(z,{icon:Qe,className:"text-primary me-2"}),"Driver Details"]}),e.jsx("div",{className:"ms-4",children:e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:"Name:"})," ",t.driverId?t.driverId.driverName:e.jsxs("span",{children:[t.driverDetails.driverName," ",e.jsx(_e,{color:"danger",className:"ms-2",children:"Deleted"})]})]})})]})})}),e.jsx(J,{xs:12,md:4,children:e.jsx(ee,{className:"h-100 border-0 shadow-sm",children:e.jsxs(te,{children:[e.jsxs("h6",{className:"mb-3",children:[e.jsx(z,{icon:$e,className:"text-primary me-2"}),"Route Start To End"]}),e.jsxs("div",{className:"ms-4",children:[e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Start Location:"})," ",t.route.start]}),e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:"End Location:"})," ",t.route.end]})]})]})})}),e.jsx(J,{xs:12,md:4,children:e.jsx(ee,{className:"h-100 border-0 shadow-sm",children:e.jsxs(te,{children:[e.jsxs("h6",{className:"mb-3",children:[e.jsx(z,{icon:Ae,className:"text-primary me-2"}),"Fuel Details"]}),e.jsxs("div",{className:"ms-4",children:[e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Quantity:"})," ",t.fuelQuantity," L"]}),e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Cost/L:"})," ",t.costPerLiter]}),e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:"Total:"})," ",t.totalCost]})]})]})})}),e.jsx(J,{xs:12,md:4,children:e.jsx(ee,{className:"h-100 border-0 shadow-sm",children:e.jsxs(te,{children:[e.jsxs("h6",{className:"mb-3",children:[e.jsx(z,{icon:Oe,className:"text-primary me-2"}),"Efficiency Metrics"]}),e.jsxs("div",{className:"ms-4",children:[e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"L/100km:"})," ",t.litersPer100km]}),e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"km/L:"})," ",t.kmPerLiter]}),e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:"MPG:"})," ",t.mpg]})]})]})})}),e.jsx(J,{xs:12,md:4,children:e.jsx(ee,{className:"h-100 border-0 shadow-sm",children:e.jsxs(te,{children:[e.jsxs("h6",{className:"mb-3",children:[e.jsx(z,{icon:De,className:"text-primary me-2"}),"Actions"]}),e.jsxs("div",{className:"d-grid gap-2",children:[e.jsxs(Q,{color:"primary",variant:"outline",onClick:()=>q(t),children:[e.jsx(l,{icon:ze,className:"me-2"}),"View Receipt"]}),((O=t.vehicleId)==null?void 0:O.deleted)!==!0&&e.jsxs(Q,{color:"info",variant:"outline",onClick:()=>$(t),children:[e.jsx(l,{icon:De,className:"me-2"}),"Edit"]}),Z.includes(f)&&e.jsxs(Q,{color:"danger",variant:"outline",onClick:()=>Y(t._id),children:[e.jsx(l,{icon:qe,className:"me-2"}),"Delete"]})]})]})})})]})})]},t._id)})}),L.length>0&&e.jsx(ee,{className:"mt-4 border-0 shadow-sm",children:e.jsx(te,{children:e.jsxs(ve,{className:"align-items-center",children:[e.jsx(J,{xs:12,md:6,className:"mb-3 mb-md-0",children:e.jsxs("span",{className:"text-muted",children:["Showing ",m+1," to"," ",Math.min(H,L.length)," of"," ",L.length," entries"]})}),e.jsx(J,{xs:12,md:6,children:e.jsxs(We,{className:"justify-content-end m-0",children:[e.jsx(be,{disabled:B===1,onClick:()=>X(t=>Math.max(t-1,1)),children:"Previous"}),Array.from({length:i},(t,a)=>a+1).map(t=>e.jsx(be,{active:t===B,onClick:()=>X(t),children:t},t)),e.jsx(be,{disabled:B===i,onClick:()=>X(t=>Math.min(t+1,i)),children:"Next"})]})})]})})}),n&&e.jsx(de,{color:"info",className:"text-center mt-4",children:n})]})},Ze=({fuelLog:c,visible:ae,onClose:F,onUpdate:_,vehicles:k,drivers:Y})=>{var p,i,l,t,a,s,o,v,S,M,O,le,oe;const{showSuccess:$,showError:q}=ge(),G="https://backend-log1.axleshift.com/",[K,N]=d.useState(!1),[se,ne]=d.useState(null),[re,A]=d.useState(null),[ie,U]=d.useState(null),[I,B]=d.useState([]),[X,E]=d.useState([]),n=new Date().toISOString().split("T")[0],[r,f]=d.useState({date:new Date(c.date).toISOString().split("T")[0],receiptNumber:c.receiptNumber,vehicleId:((p=c.vehicleId)==null?void 0:p._id)||c.vehicleId,driverId:((i=c.driverId)==null?void 0:i._id)||c.driverId,vehicleDetails:{brand:((l=c.vehicleId)==null?void 0:l.brand)||((t=c.vehicleDetails)==null?void 0:t.brand)||"",model:((a=c.vehicleId)==null?void 0:a.model)||((s=c.vehicleDetails)==null?void 0:s.model)||"",regisNumber:((o=c.vehicleId)==null?void 0:o.regisNumber)||((v=c.vehicleDetails)==null?void 0:v.regisNumber)||"",fuelType:((S=c.vehicleId)==null?void 0:S.fuelType)||((M=c.vehicleDetails)==null?void 0:M.fuelType)||""},driverDetails:{driverName:((O=c.driverId)==null?void 0:O.driverName)||((le=c.driverDetails)==null?void 0:le.driverName)||""},fuelQuantity:c.fuelQuantity,costPerLiter:c.costPerLiter,totalCost:c.totalCost,currentMileage:c.currentMileage||"",fuelType:c.fuelType||"",route:{start:c.route.start,end:c.route.end,distance:c.route.distance},litersPer100km:c.litersPer100km,kmPerLiter:c.kmPerLiter,mpg:c.mpg,notes:c.notes||""}),[Z,V]=d.useState(!1);d.useEffect(()=>{c!=null&&c.receiptImage&&A(`${G}uploads/receipts/${c.receiptImage}`)},[c]),d.useEffect(()=>{(async()=>{try{N(!0);const[g,C]=await Promise.all([W.get("/api/v1/driver"),W.get("/api/v1/vehicle/in-use")]);E(g.data.data),B(C.data.data)}catch{q("Error fetching initial data")}finally{N(!1)}})()},[]);const x=j=>{const{id:g,value:C}=j.target;if(g.includes("route.")){const u=g.split(".")[1];f(y=>{const b={...y,route:{...y.route,[u]:C}};if(b.route.distance&&b.fuelQuantity){const D=parseFloat(b.route.distance),w=parseFloat(b.fuelQuantity);if(D>0&&w>0){const P=w/D*100;b.litersPer100km=P.toFixed(2);const R=D/w;b.kmPerLiter=R.toFixed(2);const xe=w*.264172,ye=D*.621371/xe;b.mpg=ye.toFixed(2)}}return b})}else if(g==="vehicleId"){const u=I.find(b=>b._id===C),y=Y.find(b=>b._id===(u==null?void 0:u.assignedDriver));f(b=>({...b,vehicleId:C,driverId:(u==null?void 0:u.assignedDriver)||"",vehicleDetails:{brand:(u==null?void 0:u.brand)||"",model:(u==null?void 0:u.model)||"",regisNumber:(u==null?void 0:u.regisNumber)||"",fuelType:(u==null?void 0:u.fuelType)||""},driverDetails:{driverName:(y==null?void 0:y.driverName)||""},currentMileage:(u==null?void 0:u.currentMileage)||"",fuelType:(u==null?void 0:u.fuelType)||""}))}else f(g==="fuelQuantity"||g==="costPerLiter"?u=>{const y={...u,[g]:C},b=parseFloat(g==="fuelQuantity"?C:u.fuelQuantity),D=parseFloat(g==="costPerLiter"?C:u.costPerLiter);if(!isNaN(b)&&!isNaN(D)&&(y.totalCost=(b*D).toFixed(2)),g==="fuelQuantity"&&y.route.distance){const w=parseFloat(y.route.distance),P=parseFloat(C);if(w>0&&P>0){const R=P/w*100;y.litersPer100km=R.toFixed(2);const xe=w/P;y.kmPerLiter=xe.toFixed(2);const Ce=P*.264172,Se=w*.621371/Ce;y.mpg=Se.toFixed(2)}}return y}:u=>({...u,[g]:C}))},L=j=>{const g=j.target.files[0];if(g){f(u=>({...u,receiptImage:g}));const C=new FileReader;C.onloadend=()=>{A(C.result)},C.readAsDataURL(g)}},H=async j=>{var C,u,y,b;if(j.preventDefault(),!j.currentTarget.checkValidity()){j.stopPropagation(),V(!0);return}N(!0);try{const D=new FormData;Object.keys(r).forEach(P=>{P==="route"?Object.keys(r.route).forEach(R=>{D.append(`route[${R}]`,r.route[R])}):P==="vehicleDetails"?Object.keys(r.vehicleDetails).forEach(R=>{D.append(`vehicleDetails[${R}]`,r.vehicleDetails[R])}):P==="driverDetails"?Object.keys(r.driverDetails).forEach(R=>{D.append(`driverDetails[${R}]`,r.driverDetails[R])}):(P==="receiptImage"&&r[P],D.append(P,r[P]))});const w=await W.put(`/api/v1/fuelLogs/fuel-logs/${c._id}`,D);w.data.success&&($(w.data.message),_({...w.data.data,vehicleId:{_id:r.vehicleId,brand:r.vehicleDetails.brand,model:r.vehicleDetails.model,regisNumber:r.vehicleDetails.regisNumber},driverId:{_id:r.driverId,driverName:r.driverDetails.driverName}}),F())}catch(D){q(((u=(C=D.response)==null?void 0:C.data)==null?void 0:u.message)||"Error updating fuel log"),U(((b=(y=D.response)==null?void 0:y.data)==null?void 0:b.message)||"Error updating fuel log")}finally{N(!1)}},m=k.some(j=>j._id===r.vehicleId&&j.deleted);return e.jsxs(me,{visible:ae,onClose:F,size:"lg",backdrop:"static",children:[e.jsx(ue,{children:e.jsx(Pe,{children:"Add Fuel Log"})}),ie&&e.jsx(de,{color:"danger",className:"m-3",children:ie}),se&&e.jsx(de,{color:"success",className:"m-3",children:se}),e.jsx(pe,{children:e.jsxs(ke,{noValidate:!0,validated:Z,children:[e.jsxs(T,{children:[" ",e.jsx(h,{type:"date",className:"mb-3",floatingLabel:"date",label:"Receipt Number",id:"date",max:n,value:r.date,onChange:x,required:!0,disabled:m}),e.jsxs(fe,{className:"mb-3",floatingLabel:"Vehicle",label:"Vehicle",id:"vehicleId",value:r.vehicleId||"",onChange:x,required:!0,disabled:!0,children:[I.map(j=>e.jsxs("option",{value:j._id,children:[j.brand," / ",j.model," / ",j.regisNumber]},j._id)),e.jsxs("option",{value:"",children:[" ",`${r.vehicleDetails.brand} / ${r.vehicleDetails.model} / ${r.vehicleDetails.regisNumber} [DELETED]`]})]})]}),e.jsxs(T,{children:[e.jsx(h,{className:"mb-3",type:"text",floatingLabel:"Driver Name",placeholder:"Driver Name",id:"driverName",value:((oe=Y.find(j=>j._id===r.driverId))==null?void 0:oe.driverName)||`${r.driverDetails.driverName} [DELETED]`,onChange:x,disabled:!0}),e.jsxs(fe,{className:"mb-3",floatingLabel:"Fuel Type",label:"Fuel Type",id:"fuelType",required:!0,value:r.fuelType||"",onChange:x,disabled:!0,children:[e.jsx("option",{value:"",children:"Select Fuel Type"}),e.jsx("option",{value:"Gasoline",children:"Gasoline"}),e.jsx("option",{value:"Diesel",children:"Diesel"})]})]}),e.jsxs(T,{children:[e.jsx(h,{className:"mb-3",type:"text",floatingLabel:"Official Reciept",placeholder:"Official Reciept",id:"receiptNumber",value:r.receiptNumber,onChange:x,required:!0,autoComplete:"off",disabled:m}),e.jsx(h,{className:"mb-3",type:"number",floatingLabel:"Fuel Quantity",placeholder:"Fuel Quantity",id:"fuelQuantity",value:r.fuelQuantity,onChange:x,required:!0,autoComplete:"off",min:"0",step:"0.01",feedbackInvalid:"Please enter a valid fuel quantity",disabled:m}),e.jsx(h,{className:"mb-3",type:"number",floatingLabel:"Cost Per Liter",placeholder:"Cost Per Liter",id:"costPerLiter",value:r.costPerLiter,onChange:x,autoComplete:"off",feedbackInvalid:"Please enter a valid cost per liter",disabled:m}),e.jsx(h,{className:"mb-3",type:"number",floatingLabel:"Total Cost",placeholder:"Total Cost",id:"totalCost",value:r.totalCost,onChange:x,autoComplete:"off",min:"0",step:"0.01",disabled:!0,feedbackInvalid:"Please enter a valid total cost"})]}),e.jsxs(T,{children:[e.jsx(h,{className:"mb-3",type:"number",floatingLabel:"Odometer Reading",placeholder:"Odometer Reading",id:"currentMileage",value:r.currentMileage,onChange:x,autoComplete:"off",feedbackInvalid:"Please enter a valid odometer reading",disabled:m}),e.jsx(h,{className:"mb-3",type:"text",floatingLabel:"Start Location",placeholder:"Start Location",id:"route.start",value:r.route.start,onChange:x,autoComplete:"off",feedbackInvalid:"Please enter a valid start location",disabled:m}),e.jsx(h,{className:"mb-3",type:"text",floatingLabel:"End Location",placeholder:"End Location",id:"route.end",value:r.route.end,onChange:x,autoComplete:"off",feedbackInvalid:"Please enter a valid end location",disabled:m}),e.jsx(h,{className:"mb-3",type:"number",floatingLabel:"Distance/kilometers",placeholder:"Distance",id:"route.distance",value:r.route.distance,onChange:x,autoComplete:"off",min:"0",step:"0.01",feedbackInvalid:"Please enter a valid distance",disabled:m})]}),e.jsxs(T,{className:"mb-3",children:[e.jsx(h,{type:"text",floatingLabel:"L/100km",placeholder:"Liters per 100km",id:"litersPer100km",value:r.litersPer100km,disabled:!0}),e.jsx(h,{type:"text",floatingLabel:"km/L",placeholder:"Kilometers per Liter",id:"kmPerLiter",value:r.kmPerLiter,disabled:!0}),e.jsx(h,{type:"text",floatingLabel:"MPG",placeholder:"Miles per Gallon",id:"mpg",value:r.mpg,disabled:!0})]}),e.jsx(Fe,{htmlFor:"receipt",children:"Picture Of Receipts"}),e.jsx(T,{className:"mb-3",children:e.jsx(h,{type:"file",id:"receipt",accept:"image/*",onChange:L,disabled:m})}),re&&e.jsx("div",{className:"mb-3",children:e.jsx(Ne,{src:re,rounded:!0,align:"center",alt:"Receipts",width:200,height:200})}),e.jsx(Ie,{className:"mb-3",type:"text",floatingLabel:"Notes",placeholder:"Notes",rows:3,id:"notes",value:r.notes,autoCapitalize:"on",autoComplete:"off",onChange:x,feedbackInvalid:"Please enter a valid notes",disabled:m})]})}),e.jsxs(he,{children:[e.jsx(Q,{color:"secondary",onClick:F,children:"Close"}),e.jsx(Q,{color:"primary",onClick:H,disabled:K||m,children:K?e.jsx(ce,{color:"primary",size:"sm"}):"Add"})]})]})},Nt=()=>{const c=["admin","manager","super admin","fleet manager"],ae=Le(),F="https://backend-log1.axleshift.com/",{showSuccess:_,showError:k}=ge(),[Y,$]=d.useState([]),[q,G]=d.useState([]),[K,N]=d.useState([]),[se,ne]=d.useState(!1),[re,A]=d.useState(null),[ie,U]=d.useState(!1),[I,B]=d.useState(null),[X,E]=d.useState(!1),[n,r]=d.useState(null),[f,Z]=d.useState(!1),[V,x]=d.useState(null),L=async()=>{var a,s;ne(!0);try{const[o,v,S]=await Promise.all([W.get("api/v1/fuelLogs/fuel-logs"),W.get("api/v1/vehicle/in-use"),W.get("api/v1/driver")]);$(o.data.data),G(v.data.data),N(S.data.data)}catch(o){k(((s=(a=o.response)==null?void 0:a.data)==null?void 0:s.message)||"Error fetching data"),A(o.message)}finally{ne(!1)}},H=a=>{B(a),U(!0)},m=async()=>{var a,s;try{await W.delete(`api/v1/fuelLogs/fuel-logs/${I}`),$(o=>o.filter(v=>v._id!==I)),_("Fuel log deleted successfully"),U(!1)}catch(o){k(((s=(a=o.response)==null?void 0:a.data)==null?void 0:s.message)||"Error deleting fuel log")}},p=a=>{x(a),Z(!0)},i=a=>{$(s=>s.map(o=>o._id===a._id?a:o)),Z(!1),x(null)},l=a=>{if(a.receiptImage){const s=`${F}uploads/receipts/${a.receiptImage}`;r(s),E(!0),_("Receipt image loaded successfully")}else k("No receipt image available")};if(d.useEffect(()=>{L()},[]),se)return e.jsx(ce,{color:"primary",size:"sm",children:"Loading..."});const t=a=>{$(s=>[...s,a]),L()};return e.jsx(e.Fragment,{children:ae&&c.includes(ae)?e.jsxs(je,{children:[e.jsx(Ye,{children:"Fuel Management"}),e.jsx(ee,{children:e.jsxs(te,{children:[e.jsx(je,{className:"mb-3",children:e.jsx(Ke,{onAddFuelog:t})}),e.jsx(Xe,{fuelLogs:Y,vehicles:q,drivers:K,loading:se,error:re,onDeleteFuelLog:H,onUpdateFuelLog:p,onViewReceipt:l})]})}),f&&e.jsx(Ze,{fuelLog:V,visible:f,onClose:()=>{Z(!1),x(null)},onUpdate:i,vehicles:q,drivers:K}),e.jsxs(me,{visible:ie,onClose:()=>U(!1),alignment:"center",children:[e.jsx(ue,{closeButton:!0,children:"Confirm Delete"}),e.jsx(pe,{children:"Are you sure you want to delete this fuel log? This action cannot be undone."}),e.jsxs(he,{children:[e.jsx(Q,{color:"secondary",variant:"outline",onClick:()=>U(!1),children:"Cancel"}),e.jsx(Q,{color:"danger",variant:"outline",onClick:m,children:"Delete"})]})]}),e.jsxs(me,{visible:X,onClose:()=>{E(!1),r(null)},size:"lg",alignment:"center",children:[e.jsx(ue,{closeButton:!0,children:"Receipt Image"}),e.jsx(pe,{className:"text-center",children:n&&e.jsx(Ne,{src:n,alt:"Receipt",style:{maxWidth:"100%",maxHeight:"70vh",objectFit:"contain"},onError:a=>{k("Error loading image"),a.target.src="placeholder-image-url.jpg"}})}),e.jsxs(he,{children:[e.jsx(Q,{color:"secondary",variant:"outline",onClick:()=>{E(!1),r(null)},children:"Close"}),e.jsx("a",{href:n,target:"_blank",rel:"noopener noreferrer",children:e.jsx(Q,{color:"primary",variant:"outline",children:"Open in New Tab"})})]})]})]}):e.jsx(de,{color:"danger",className:"text-center w-100 mx-auto mt-5 justify-content-center",children:"You are not authorized to access this page."})})};export{Nt as default};
