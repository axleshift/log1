import{l as be,r as o,j as e,k as ce,n as K,D as Ie}from"./index-oK4_cjtr.js";import{r as Se,F as q,k as we,H as Te,f as Ee,I as Me,b as Re,a as Qe,J as $e,d as _e,K as Oe,l as ye,x as Ae,u as qe}from"./index-BXjDqJpC.js";import{a as Q}from"./CButton-BuIKmGst.js";import{C as de,a as me,b as ue,c as pe}from"./CModalHeader-AU35Eh-T.js";import{C as De}from"./CModalTitle-B_CKYWk0.js";import{C as oe}from"./CAlert-BM2-mCId.js";import{C as Le}from"./CForm-C88K1vIg.js";import{C as w}from"./CInputGroup-BzIC-QP3.js";import{C as u,a as Pe}from"./CFormInput-CdVQ9r3w.js";import{C as he}from"./CFormSelect-Dsn7-KPi.js";import{C as ge}from"./1-CafIYk1U.js";import{C as ke}from"./CFormTextarea-DtbG9U4O.js";import{C as je}from"./CContainer-BpfzISMU.js";import{C as ee}from"./CCard-BrEz3-r-.js";import{C as te}from"./CCardBody-BLfd61Yo.js";import{a as xe,C as W}from"./CRow-_VkGmz3j.js";import{C as Ue}from"./CInputGroupText-BceKQr5W.js";import{C as Ge,a as ze,b as He,c as Be}from"./CAccordionHeader-B37jRm7V.js";import{C as Je,a as ve}from"./CPaginationItem-BZstXv7Q.js";import{C as We}from"./DefaultLayout-DUQjdB1T.js";import"./index.esm-DJhTDB-G.js";import"./cil-user-Ddrdy7PS.js";const Ke=({onAddFuelog:c})=>{var L,J;const{showSuccess:X,showError:F}=be(),[U,I]=o.useState(!1),[G,ae]=o.useState(null),[z,H]=o.useState(!1),[Y,j]=o.useState(!1),[ie,ne]=o.useState(!1),[se,k]=o.useState(null),[Z,le]=o.useState([]),[$,T]=o.useState([]),_=new Date().toISOString().split("T")[0],E={vehicleId:"",driverId:"",vehicleDetails:{brand:"",model:"",regisNumber:"",fuelType:""},driverDetails:{driverName:""},date:"",receiptNumber:"",fuelQuantity:"",fuelType:"",costPerLiter:"",totalCost:"",currentMileage:"",receiptImage:null,route:{start:"",end:"",distance:""},notes:"",litersPer100km:"",kmPerLiter:"",mpg:""},[l,i]=o.useState(E);o.useEffect(()=>{(async()=>{try{I(!0);const[h,r]=await Promise.all([K.get("api/v1/driver"),K.get("api/v1/vehicle/in-use")]);le(h.data.data),T(r.data.data)}catch{F("Error fetching initial data")}finally{I(!1)}})()},[]);const f=p=>{const{id:h,value:r}=p.target;if(h.includes("route.")){const a=h.split(".")[1];i(t=>{const s={...t,route:{...t.route,[a]:r}};if(s.route.distance&&s.fuelQuantity){const n=parseFloat(s.route.distance),d=parseFloat(s.fuelQuantity);if(n>0&&d>0){const y=d/n*100;s.litersPer100km=y.toFixed(2);const O=n/d;s.kmPerLiter=O.toFixed(2);const M=d*.264172,re=n*.621371/M;s.mpg=re.toFixed(2)}}return s})}else if(h==="vehicleId"){const a=$.find(s=>s._id===r),t=Z.find(s=>s._id===(a==null?void 0:a.assignedDriver));i(s=>({...s,vehicleId:r,driverId:(a==null?void 0:a.assignedDriver)||"",vehicleDetails:{brand:(a==null?void 0:a.brand)||"",model:(a==null?void 0:a.model)||"",regisNumber:(a==null?void 0:a.regisNumber)||"",fuelType:(a==null?void 0:a.fuelType)||""},driverDetails:{driverName:(t==null?void 0:t.driverName)||""},currentMileage:(a==null?void 0:a.currentMileage)||"",fuelType:(a==null?void 0:a.fuelType)||""}))}else i(h==="fuelQuantity"||h==="costPerLiter"?a=>{const t={...a,[h]:r},s=parseFloat(h==="fuelQuantity"?r:a.fuelQuantity),n=parseFloat(h==="costPerLiter"?r:a.costPerLiter);if(!isNaN(s)&&!isNaN(n)&&(t.totalCost=(s*n).toFixed(2)),h==="fuelQuantity"&&t.route.distance){const d=parseFloat(t.route.distance),y=parseFloat(r);if(d>0&&y>0){const O=y/d*100;t.litersPer100km=O.toFixed(2);const M=d/y;t.kmPerLiter=M.toFixed(2);const A=y*.264172,P=d*.621371/A;t.mpg=P.toFixed(2)}}return t}:a=>({...a,[h]:r}))},V=p=>{const h=p.target.files[0];if(h){i(a=>({...a,receiptImage:h}));const r=new FileReader;r.onloadend=()=>{k(r.result)},r.readAsDataURL(h)}},B=async p=>{if(p.preventDefault(),p.stopPropagation(),p.currentTarget.checkValidity()===!1){ne(!0);return}I(!0);try{const r=new FormData;r.append("vehicleId",l.vehicleId),r.append("driverId",l.driverId),r.append("vehicleDetails[brand]",l.vehicleDetails.brand),r.append("vehicleDetails[model]",l.vehicleDetails.model),r.append("vehicleDetails[regisNumber]",l.vehicleDetails.regisNumber),r.append("vehicleDetails[fuelType]",l.vehicleDetails.fuelType),r.append("driverDetails[driverName]",l.driverDetails.driverName),r.append("date",l.date),r.append("receiptNumber",l.receiptNumber),r.append("fuelQuantity",l.fuelQuantity),r.append("fuelType",l.fuelType),r.append("costPerLiter",l.costPerLiter),r.append("totalCost",l.totalCost),r.append("currentMileage",l.currentMileage),r.append("notes",l.notes),r.append("litersPer100km",l.litersPer100km),r.append("kmPerLiter",l.kmPerLiter),r.append("mpg",l.mpg),r.append("route[start]",l.route.start),r.append("route[end]",l.route.end),r.append("route[distance]",l.route.distance),l.receiptImage&&r.append("receiptImage",l.receiptImage);const a=await K.post("api/v1/fuelLogs/fuel-logs",r);a.data.success&&(c(a.data.data),X(a.data.message),H(a.data.message),setTimeout(()=>{H(!1),i(E),k(null),j(!1)},2e3))}catch(r){F(r.response.data.message),ae(r.response.data.message),setTimeout(()=>{ae(null)},5e3)}finally{I(!1)}},x=({icon:p})=>{const[h,r]=o.useState(!1);return e.jsx(q,{icon:p,bounce:h,onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1)})};return e.jsxs(e.Fragment,{children:[e.jsxs(Q,{color:"primary",variant:"outline",disabled:U,onClick:()=>j(!0),children:[U?e.jsx(ce,{color:"primary",size:"sm"}):e.jsx(x,{icon:Se}),"Add Fuel Log"]}),e.jsxs(de,{visible:Y,onClose:()=>j(!1),size:"lg",children:[e.jsx(me,{children:e.jsx(De,{children:"Add Fuel Log"})}),G&&e.jsx(oe,{color:"danger",className:"m-3",children:G}),z&&e.jsx(oe,{color:"success",className:"m-3",children:z}),e.jsx(ue,{children:e.jsxs(Le,{noValidate:!0,validated:ie,children:[e.jsxs(w,{children:[e.jsx(u,{type:"date",className:"mb-3",floatingLabel:"date",label:"Receipt Number",id:"date",max:_,value:l.date,onChange:f,required:!0}),e.jsxs(he,{className:"mb-3",floatingLabel:"Vehicle",label:"Vehicle",id:"vehicleId",value:l.vehicleId,onChange:f,required:!0,children:[e.jsx("option",{value:"",children:"Select Vehicle"}),$==null?void 0:$.map(p=>e.jsx("option",{value:p._id,children:`${p.brand} / ${p.model} / ${p.regisNumber}`},p._id))]})]}),e.jsxs(w,{children:[" ",e.jsx(u,{className:"mb-3",floatingLabel:"Driver",label:"Driver",id:"driverId",value:((L=Z.find(p=>p._id===l.driverId))==null?void 0:L.driverName)||"",onChange:f,disabled:!0}),e.jsxs(he,{className:"mb-3",floatingLabel:"Fuel Type",label:"Fuel Type",id:"fuelType",required:!0,value:((J=$.find(p=>p._id===l.vehicleId))==null?void 0:J.fuelType)||"",onChange:f,disabled:!0,children:[e.jsx("option",{value:"",children:"Select Fuel Type"}),e.jsx("option",{value:"Gasoline",children:"Gasoline"}),e.jsx("option",{value:"Diesel",children:"Diesel"})]})]}),e.jsxs(w,{children:[e.jsx(u,{className:"mb-3",type:"text",floatingLabel:"Official Reciept",placeholder:"Official Reciept",id:"receiptNumber",value:l.receiptNumber,onChange:f,required:!0,autoComplete:"off"}),e.jsx(u,{className:"mb-3",type:"number",floatingLabel:"Fuel Quantity",placeholder:"Fuel Quantity",id:"fuelQuantity",value:l.fuelQuantity,onChange:f,required:!0,autoComplete:"off",min:"0",step:"0.01",feedbackInvalid:"Please enter a valid fuel quantity"}),e.jsx(u,{className:"mb-3",type:"number",floatingLabel:"Cost Per Liter",placeholder:"Cost Per Liter",id:"costPerLiter",value:l.costPerLiter,onChange:f,autoComplete:"off",feedbackInvalid:"Please enter a valid cost per liter"}),e.jsx(u,{className:"mb-3",type:"number",floatingLabel:"Total Cost",placeholder:"Total Cost",id:"totalCost",value:l.totalCost,onChange:f,autoComplete:"off",min:"0",step:"0.01",disabled:!0,feedbackInvalid:"Please enter a valid total cost"})]}),e.jsxs(w,{children:[e.jsx(u,{className:"mb-3",type:"number",floatingLabel:"Odometer Reading",placeholder:"Odometer Reading",id:"currentMileage",value:l.currentMileage,onChange:f,autoComplete:"off",feedbackInvalid:"Please enter a valid odometer reading"}),e.jsx(u,{className:"mb-3",type:"text",floatingLabel:"Start Location",placeholder:"Start Location",id:"route.start",value:l.route.start,onChange:f,autoComplete:"off",feedbackInvalid:"Please enter a valid start location"}),e.jsx(u,{className:"mb-3",type:"text",floatingLabel:"End Location",placeholder:"End Location",id:"route.end",value:l.route.end,onChange:f,autoComplete:"off",feedbackInvalid:"Please enter a valid end location"}),e.jsx(u,{className:"mb-3",type:"number",floatingLabel:"Distance/kilometers",placeholder:"Distance",id:"route.distance",value:l.route.distance,onChange:f,autoComplete:"off",feedbackInvalid:"Please enter a valid distance"})]}),e.jsxs(w,{className:"mb-3",children:[e.jsx(u,{type:"text",floatingLabel:"L/100km",placeholder:"Liters per 100km",id:"litersPer100km",value:l.litersPer100km,disabled:!0}),e.jsx(u,{type:"text",floatingLabel:"km/L",placeholder:"Kilometers per Liter",id:"kmPerLiter",value:l.kmPerLiter,disabled:!0}),e.jsx(u,{type:"text",floatingLabel:"MPG",placeholder:"Miles per Gallon",id:"mpg",value:l.mpg,disabled:!0})]}),e.jsx(Pe,{htmlFor:"receipt",children:"Picture Of Receipts"}),e.jsx(w,{className:"mb-3",children:e.jsx(u,{type:"file",id:"receipt",accept:"images/*",onChange:V})}),se&&e.jsx("div",{className:"mb-3",children:e.jsx(ge,{src:se,rounded:!0,align:"center",alt:"Receipts",width:200,height:200})}),e.jsx(ke,{className:"mb-3",type:"text",floatingLabel:"Notes",placeholder:"Notes",rows:3,id:"notes",value:l.notes,autoCapitalize:"on",autoComplete:"off",onChange:f,feedbackInvalid:"Please enter a valid notes"})]})}),e.jsxs(pe,{children:[e.jsx(Q,{color:"secondary",onClick:()=>j(!1),children:"Close"}),e.jsx(Q,{color:"primary",onClick:B,disabled:U,children:U?e.jsx(ce,{color:"primary",size:"sm"}):"Add"})]})]})]})},Xe=({fuelLogs:c,vehicles:X,drivers:F,loading:U,error:I,onDeleteFuelLog:G,onUpdateFuelLog:ae,onViewReceipt:z})=>{const[H,Y]=o.useState(""),[j,ie]=o.useState("date"),[ne,se]=o.useState("desc"),[k,Z]=o.useState(""),[le,$]=o.useState(null),[T,_]=o.useState(1),[E]=o.useState(10),[l,i]=o.useState(null),f=Ie(),V=["manager","admin"],B=(t,s)=>{if(typeof t=="object"&&(t!=null&&t.brand)&&(t!=null&&t.model)&&(t!=null&&t.regisNumber))return`${t.brand} ${t.model} (${t.regisNumber})`;if(!t&&(s!=null&&s.vehicleDetails))return`${s.vehicleDetails.brand} ${s.vehicleDetails.model} (${s.vehicleDetails.regisNumber}) [Deleted]`;const n=X.find(d=>d._id===t);if(n)return`${n.brand} ${n.model} (${n.regisNumber})`;if(n.deleted===!0)return`${n.brand} ${n.model} (${n.regisNumber}) [Deleted]`},x=(t,s)=>{var d;if(typeof t=="object"&&(t!=null&&t.driverName))return t.driverName;if(!t&&((d=s==null?void 0:s.driverDetails)!=null&&d.driverName))return`${s.driverDetails.driverName} [Deleted]`;const n=F.find(y=>y._id===t);if(n!=null&&n.driverName)return n.driverName},L=c.filter(t=>{var M,A,re,P;if(!t)return!1;const s=B(t.vehicleId,t).toLowerCase(),n=x(t.driverId,t).toLowerCase(),d=H.toLowerCase(),y=(((M=t.receiptNumber)==null?void 0:M.toLowerCase())||"").includes(d)||s.includes(d)||n.includes(d)||(t.date?new Date(t.date).toLocaleDateString().includes(d):!1)||(((A=t.fuelQuantity)==null?void 0:A.toString())||"").includes(d)||(((re=t.totalCost)==null?void 0:re.toString())||"").includes(d),O=k?(typeof t.vehicleId=="object"?(P=t.vehicleId)==null?void 0:P._id:t.vehicleId)===k:!0;return y&&O}).sort((t,s)=>{let n,d;switch(j){case"vehicle":n=B(t.vehicleId,t),d=B(s.vehicleId,s);break;case"driver":n=x(t.driverId,t),d=x(s.driverId,s);break;case"date":n=new Date(t.date||"").getTime(),d=new Date(s.date||"").getTime();break;case"fuelQuantity":case"costPerLiter":case"totalCost":n=parseFloat(t[j]||0),d=parseFloat(s[j]||0);break;default:n=t[j]||"",d=s[j]||""}return!n&&!d?0:n?d?ne==="asc"?n>d?1:-1:n<d?1:-1:-1:1}),J=T*E,p=J-E,h=L.slice(p,J),r=Math.ceil(L.length/E);if(o.useEffect(()=>{_(1)},[H,k]),o.useEffect(()=>{L.length===0?i("No matching records found"):i(null)},[L]),U)return e.jsx(ce,{});if(I)return e.jsx(oe,{color:"danger",children:I});const a=({icon:t})=>{const[s,n]=o.useState(!1);return e.jsx(q,{icon:t,bounce:s,onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1)})};return e.jsxs(je,{fluid:!0,className:"p-0",children:[e.jsx(ee,{className:"mb-4 shadow-sm border-0",children:e.jsx(te,{children:e.jsxs(xe,{className:"align-items-center",children:[e.jsx(W,{xs:12,md:6,children:e.jsxs(w,{children:[e.jsx(u,{placeholder:"Search fuel logs...",value:H,onChange:t=>Y(t.target.value),className:"border-end-0"}),e.jsx(Ue,{className:"bg-transparent",children:e.jsx(q,{icon:we})})]})}),e.jsx(W,{xs:12,md:6,className:"mt-3 mt-md-0 text-end",children:e.jsxs("span",{className:"text-muted",children:["Total Records: ",L.length]})})]})})}),e.jsx(Ge,{children:h.map(t=>{var s,n,d,y,O,M,A;return e.jsxs(ze,{children:[e.jsx(He,{onClick:()=>$(le===t._id?null:t._id),children:e.jsxs("div",{className:"d-flex justify-content-sm-between w-100",children:[e.jsxs("ul",{className:"list-unstyled",children:[e.jsxs("li",{className:"ps-3",children:[e.jsx("strong",{children:"Receipt Number:"})," ",t.receiptNumber]}),e.jsxs("li",{className:"ps-3",children:[e.jsx(q,{icon:Te})," ",new Date(t.date).toLocaleDateString()]})]}),e.jsxs("div",{className:"float-end p-3",children:[e.jsx(q,{icon:Ee})," ",e.jsxs("strong",{children:[t.vehicleDetails.regisNumber," ",`(${t.vehicleDetails.model})`]})]})]})}),e.jsx(Be,{children:e.jsxs(xe,{className:"g-4",children:[e.jsx(W,{xs:12,md:4,children:e.jsx(ee,{className:"h-100 border-0 shadow-sm",children:e.jsxs(te,{children:[e.jsxs("h6",{className:"mb-3",children:[e.jsx(q,{icon:Me,className:"text-primary me-2"}),"Vehicle Details"]}),e.jsxs("div",{className:"ms-4",children:[e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Registration:"})," ",((s=t.vehicleId)==null?void 0:s.regisNumber)||((n=t.vehicleDetails)==null?void 0:n.regisNumber)]}),e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Model:"})," ",((d=t.vehicleId)==null?void 0:d.model)||((y=t.vehicleDetails)==null?void 0:y.model)]}),e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:"Brand:"})," ",((O=t.vehicleId)==null?void 0:O.brand)||((M=t.vehicleDetails)==null?void 0:M.brand)]})]})]})})}),e.jsx(W,{xs:12,md:4,children:e.jsx(ee,{className:"h-100 border-0 shadow-sm",children:e.jsxs(te,{children:[e.jsxs("h6",{className:"mb-3",children:[e.jsx(q,{icon:Re,className:"text-primary me-2"}),"Driver Details"]}),e.jsx("div",{className:"ms-4",children:e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:"Name:"})," ",t.driverId?t.driverId.driverName:e.jsxs("span",{children:[t.driverDetails.driverName," ",e.jsx(Qe,{color:"danger",className:"ms-2",children:"Deleted"})]})]})})]})})}),e.jsx(W,{xs:12,md:4,children:e.jsx(ee,{className:"h-100 border-0 shadow-sm",children:e.jsxs(te,{children:[e.jsxs("h6",{className:"mb-3",children:[e.jsx(q,{icon:$e,className:"text-primary me-2"}),"Route Start To End"]}),e.jsxs("div",{className:"ms-4",children:[e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Start Location:"})," ",t.route.start]}),e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:"End Location:"})," ",t.route.end]})]})]})})}),e.jsx(W,{xs:12,md:4,children:e.jsx(ee,{className:"h-100 border-0 shadow-sm",children:e.jsxs(te,{children:[e.jsxs("h6",{className:"mb-3",children:[e.jsx(q,{icon:_e,className:"text-primary me-2"}),"Fuel Details"]}),e.jsxs("div",{className:"ms-4",children:[e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Quantity:"})," ",t.fuelQuantity," L"]}),e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Cost/L:"})," ",t.costPerLiter]}),e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:"Total:"})," ",t.totalCost]})]})]})})}),e.jsx(W,{xs:12,md:4,children:e.jsx(ee,{className:"h-100 border-0 shadow-sm",children:e.jsxs(te,{children:[e.jsxs("h6",{className:"mb-3",children:[e.jsx(q,{icon:Oe,className:"text-primary me-2"}),"Efficiency Metrics"]}),e.jsxs("div",{className:"ms-4",children:[e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"L/100km:"})," ",t.litersPer100km]}),e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"km/L:"})," ",t.kmPerLiter]}),e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:"MPG:"})," ",t.mpg]})]})]})})}),e.jsx(W,{xs:12,md:4,children:e.jsx(ee,{className:"h-100 border-0 shadow-sm",children:e.jsxs(te,{children:[e.jsxs("h6",{className:"mb-3",children:[e.jsx(q,{icon:ye,className:"text-primary me-2"}),"Actions"]}),e.jsxs("div",{className:"d-grid gap-2",children:[e.jsxs(Q,{color:"primary",variant:"outline",onClick:()=>z(t),children:[e.jsx(a,{icon:Ae,className:"me-2"}),"View Receipt"]}),((A=t.vehicleId)==null?void 0:A.deleted)!==!0&&e.jsxs(Q,{color:"info",variant:"outline",onClick:()=>ae(t),children:[e.jsx(a,{icon:ye,className:"me-2"}),"Edit"]}),V.includes(f)&&e.jsxs(Q,{color:"danger",variant:"outline",onClick:()=>G(t._id),children:[e.jsx(a,{icon:qe,className:"me-2"}),"Delete"]})]})]})})})]})})]},t._id)})}),L.length>0&&e.jsx(ee,{className:"mt-4 border-0 shadow-sm",children:e.jsx(te,{children:e.jsxs(xe,{className:"align-items-center",children:[e.jsx(W,{xs:12,md:6,className:"mb-3 mb-md-0",children:e.jsxs("span",{className:"text-muted",children:["Showing ",p+1," to"," ",Math.min(J,L.length)," of"," ",L.length," entries"]})}),e.jsx(W,{xs:12,md:6,children:e.jsxs(Je,{className:"justify-content-end m-0",children:[e.jsx(ve,{disabled:T===1,onClick:()=>_(t=>Math.max(t-1,1)),children:"Previous"}),Array.from({length:r},(t,s)=>s+1).map(t=>e.jsx(ve,{active:t===T,onClick:()=>_(t),children:t},t)),e.jsx(ve,{disabled:T===r,onClick:()=>_(t=>Math.min(t+1,r)),children:"Next"})]})})]})})}),l&&e.jsx(oe,{color:"info",className:"text-center mt-4",children:l})]})},Ye=({fuelLog:c,visible:X,onClose:F,onUpdate:U,vehicles:I,drivers:G})=>{var p,h,r,a,t,s,n,d,y,O,M,A,re;const{showSuccess:ae,showError:z}=be(),H="http://localhost:5057/",[Y,j]=o.useState(!1),[ie,ne]=o.useState(null),[se,k]=o.useState(null),[Z,le]=o.useState(null),[$,T]=o.useState([]),[_,E]=o.useState([]),l=new Date().toISOString().split("T")[0],[i,f]=o.useState({date:new Date(c.date).toISOString().split("T")[0],receiptNumber:c.receiptNumber,vehicleId:((p=c.vehicleId)==null?void 0:p._id)||c.vehicleId,driverId:((h=c.driverId)==null?void 0:h._id)||c.driverId,vehicleDetails:{brand:((r=c.vehicleId)==null?void 0:r.brand)||((a=c.vehicleDetails)==null?void 0:a.brand)||"",model:((t=c.vehicleId)==null?void 0:t.model)||((s=c.vehicleDetails)==null?void 0:s.model)||"",regisNumber:((n=c.vehicleId)==null?void 0:n.regisNumber)||((d=c.vehicleDetails)==null?void 0:d.regisNumber)||"",fuelType:((y=c.vehicleId)==null?void 0:y.fuelType)||((O=c.vehicleDetails)==null?void 0:O.fuelType)||""},driverDetails:{driverName:((M=c.driverId)==null?void 0:M.driverName)||((A=c.driverDetails)==null?void 0:A.driverName)||""},fuelQuantity:c.fuelQuantity,costPerLiter:c.costPerLiter,totalCost:c.totalCost,currentMileage:c.currentMileage||"",fuelType:c.fuelType||"",route:{start:c.route.start,end:c.route.end,distance:c.route.distance},litersPer100km:c.litersPer100km,kmPerLiter:c.kmPerLiter,mpg:c.mpg,notes:c.notes||""}),[V,B]=o.useState(!1);o.useEffect(()=>{c!=null&&c.receiptImage&&k(`${H}uploads/receipts/${c.receiptImage}`)},[c]),o.useEffect(()=>{(async()=>{try{j(!0);const[b,g]=await Promise.all([K.get("api/v1/driver"),K.get("api/v1/vehicle/in-use")]);E(b.data.data),T(g.data.data)}catch{z("Error fetching initial data")}finally{j(!1)}})()},[]);const x=P=>{const{id:b,value:g}=P.target;if(b.includes("route.")){const m=b.split(".")[1];f(N=>{const v={...N,route:{...N.route,[m]:g}};if(v.route.distance&&v.fuelQuantity){const C=parseFloat(v.route.distance),S=parseFloat(v.fuelQuantity);if(C>0&&S>0){const D=S/C*100;v.litersPer100km=D.toFixed(2);const R=C/S;v.kmPerLiter=R.toFixed(2);const fe=S*.264172,Ce=C*.621371/fe;v.mpg=Ce.toFixed(2)}}return v})}else if(b==="vehicleId"){const m=$.find(v=>v._id===g),N=G.find(v=>v._id===(m==null?void 0:m.assignedDriver));f(v=>({...v,vehicleId:g,driverId:(m==null?void 0:m.assignedDriver)||"",vehicleDetails:{brand:(m==null?void 0:m.brand)||"",model:(m==null?void 0:m.model)||"",regisNumber:(m==null?void 0:m.regisNumber)||"",fuelType:(m==null?void 0:m.fuelType)||""},driverDetails:{driverName:(N==null?void 0:N.driverName)||""},currentMileage:(m==null?void 0:m.currentMileage)||"",fuelType:(m==null?void 0:m.fuelType)||""}))}else f(b==="fuelQuantity"||b==="costPerLiter"?m=>{const N={...m,[b]:g},v=parseFloat(b==="fuelQuantity"?g:m.fuelQuantity),C=parseFloat(b==="costPerLiter"?g:m.costPerLiter);if(!isNaN(v)&&!isNaN(C)&&(N.totalCost=(v*C).toFixed(2)),b==="fuelQuantity"&&N.route.distance){const S=parseFloat(N.route.distance),D=parseFloat(g);if(S>0&&D>0){const R=D/S*100;N.litersPer100km=R.toFixed(2);const fe=S/D;N.kmPerLiter=fe.toFixed(2);const Ne=D*.264172,Fe=S*.621371/Ne;N.mpg=Fe.toFixed(2)}}return N}:m=>({...m,[b]:g}))},L=P=>{const b=P.target.files[0];if(b){f(m=>({...m,receiptImage:b}));const g=new FileReader;g.onloadend=()=>{k(g.result)},g.readAsDataURL(b)}},J=async P=>{var g,m,N,v;if(P.preventDefault(),!P.currentTarget.checkValidity()){P.stopPropagation(),B(!0);return}j(!0);try{const C=new FormData;Object.keys(i).forEach(D=>{D==="route"?Object.keys(i.route).forEach(R=>{C.append(`route[${R}]`,i.route[R])}):D==="vehicleDetails"?Object.keys(i.vehicleDetails).forEach(R=>{C.append(`vehicleDetails[${R}]`,i.vehicleDetails[R])}):D==="driverDetails"?Object.keys(i.driverDetails).forEach(R=>{C.append(`driverDetails[${R}]`,i.driverDetails[R])}):(D==="receiptImage"&&i[D],C.append(D,i[D]))});const S=await K.put(`api/v1/fuelLogs/fuel-logs/${c._id}`,C);S.data.success&&(ae(S.data.message),U({...S.data.data,vehicleId:{_id:i.vehicleId,brand:i.vehicleDetails.brand,model:i.vehicleDetails.model,regisNumber:i.vehicleDetails.regisNumber},driverId:{_id:i.driverId,driverName:i.driverDetails.driverName}}),F())}catch(C){z(((m=(g=C.response)==null?void 0:g.data)==null?void 0:m.message)||"Error updating fuel log"),le(((v=(N=C.response)==null?void 0:N.data)==null?void 0:v.message)||"Error updating fuel log")}finally{j(!1)}};return e.jsxs(de,{visible:X,onClose:F,size:"lg",backdrop:"static",children:[e.jsx(me,{children:e.jsx(De,{children:"Update Fuel Log"})}),Z&&e.jsx(oe,{color:"danger",className:"m-3",children:Z}),ie&&e.jsx(oe,{color:"success",className:"m-3",children:ie}),e.jsx(ue,{children:e.jsxs(Le,{noValidate:!0,validated:V,children:[e.jsxs(w,{children:[e.jsx(u,{type:"date",className:"mb-3",floatingLabel:"Date",label:"Date",id:"date",max:l,value:i.date,onChange:x,required:!0}),e.jsx(he,{className:"mb-3",floatingLabel:"Vehicle",label:"Vehicle",id:"vehicleId",value:i.vehicleId||"",onChange:x,required:!0,disabled:!0,children:e.jsx("option",{value:"",children:`${i.vehicleDetails.brand} / ${i.vehicleDetails.model} / ${i.vehicleDetails.regisNumber} `})})]}),e.jsxs(w,{children:[e.jsx(u,{className:"mb-3",type:"text",floatingLabel:"Driver Name",placeholder:"Driver Name",id:"driverName",value:((re=G.find(P=>P._id===i.driverId))==null?void 0:re.driverName)||`${i.driverDetails.driverName} [DELETED]`,onChange:x,disabled:!0}),e.jsxs(he,{className:"mb-3",floatingLabel:"Fuel Type",label:"Fuel Type",id:"fuelType",required:!0,value:i.fuelType||"",onChange:x,disabled:!0,children:[e.jsx("option",{value:"",children:"Select Fuel Type"}),e.jsx("option",{value:"Gasoline",children:"Gasoline"}),e.jsx("option",{value:"Diesel",children:"Diesel"})]})]}),e.jsxs(w,{children:[e.jsx(u,{className:"mb-3",type:"text",floatingLabel:"Official Receipt",placeholder:"Official Receipt",id:"receiptNumber",value:i.receiptNumber,onChange:x,required:!0,autoComplete:"off"}),e.jsx(u,{className:"mb-3",type:"number",floatingLabel:"Fuel Quantity",placeholder:"Fuel Quantity",id:"fuelQuantity",value:i.fuelQuantity,onChange:x,required:!0,autoComplete:"off",min:"0",step:"0.01",feedbackInvalid:"Please enter a valid fuel quantity"}),e.jsx(u,{className:"mb-3",type:"number",floatingLabel:"Cost Per Liter",placeholder:"Cost Per Liter",id:"costPerLiter",value:i.costPerLiter,onChange:x,autoComplete:"off",feedbackInvalid:"Please enter a valid cost per liter"}),e.jsx(u,{className:"mb-3",type:"number",floatingLabel:"Total Cost",placeholder:"Total Cost",id:"totalCost",value:i.totalCost,onChange:x,autoComplete:"off",min:"0",step:"0.01",disabled:!0,feedbackInvalid:"Please enter a valid total cost"})]}),e.jsxs(w,{children:[e.jsx(u,{className:"mb-3",type:"number",floatingLabel:"Odometer Reading",placeholder:"Odometer Reading",id:"currentMileage",value:i.currentMileage,onChange:x,autoComplete:"off",feedbackInvalid:"Please enter a valid odometer reading"}),e.jsx(u,{className:"mb-3",type:"text",floatingLabel:"Start Location",placeholder:"Start Location",id:"route.start",value:i.route.start,onChange:x,autoComplete:"off",feedbackInvalid:"Please enter a valid start location"}),e.jsx(u,{className:"mb-3",type:"text",floatingLabel:"End Location",placeholder:"End Location",id:"route.end",value:i.route.end,onChange:x,autoComplete:"off",feedbackInvalid:"Please enter a valid end location"}),e.jsx(u,{className:"mb-3",type:"number",floatingLabel:"Distance/kilometers",placeholder:"Distance",id:"route.distance",value:i.route.distance,onChange:x,autoComplete:"off",min:"0",step:"0.01",feedbackInvalid:"Please enter a valid distance"})]}),e.jsxs(w,{className:"mb-3",children:[e.jsx(u,{type:"text",floatingLabel:"L/100km",placeholder:"Liters per 100km",id:"litersPer100km",value:i.litersPer100km,disabled:!0}),e.jsx(u,{type:"text",floatingLabel:"km/L",placeholder:"Kilometers per Liter",id:"kmPerLiter",value:i.kmPerLiter,disabled:!0}),e.jsx(u,{type:"text",floatingLabel:"MPG",placeholder:"Miles per Gallon",id:"mpg",value:i.mpg,disabled:!0})]}),e.jsx(Pe,{htmlFor:"receipt",children:"Picture Of Receipts"}),e.jsx(w,{className:"mb-3",children:e.jsx(u,{type:"file",id:"receipt",accept:"images/*",onChange:L})}),se&&e.jsx("div",{className:"mb-3",children:e.jsx(ge,{src:se,rounded:!0,align:"center",alt:"Receipts",width:200,height:200})}),e.jsx(ke,{className:"mb-3",type:"text",floatingLabel:"Notes",placeholder:"Notes",rows:3,id:"notes",value:i.notes,autoCapitalize:"on",autoComplete:"off",onChange:x,feedbackInvalid:"Please enter a valid notes"})]})}),e.jsxs(pe,{children:[e.jsx(Q,{color:"secondary",variant:"outline",onClick:F,children:"Close"}),e.jsx(Q,{color:"primary",variant:"outline",onClick:J,disabled:Y,children:Y?e.jsx(ce,{color:"primary",size:"sm"}):"Update"})]})]})},gt=()=>{const c="http://localhost:5057/",{showSuccess:X,showError:F}=be(),[U,I]=o.useState([]),[G,ae]=o.useState([]),[z,H]=o.useState([]),[Y,j]=o.useState(!1),[ie,ne]=o.useState(null),[se,k]=o.useState(!1),[Z,le]=o.useState(null),[$,T]=o.useState(!1),[_,E]=o.useState(null),[l,i]=o.useState(!1),[f,V]=o.useState(null),B=async()=>{var a,t;j(!0);try{const[s,n,d]=await Promise.all([K.get("api/v1/fuelLogs/fuel-logs"),K.get("api/v1/vehicle/in-use"),K.get("api/v1/driver")]);I(s.data.data),console.log("Fuel Logs:",s.data.data),ae(n.data.data),H(d.data.data),X("Data fetched successfully")}catch(s){F(((t=(a=s.response)==null?void 0:a.data)==null?void 0:t.message)||"Error fetching data"),ne(s.message)}finally{j(!1)}},x=a=>{le(a),k(!0)},L=async()=>{var a,t;try{await K.delete(`api/v1/fuelLogs/fuel-logs/${Z}`),I(s=>s.filter(n=>n._id!==Z)),X("Fuel log deleted successfully"),k(!1)}catch(s){F(((t=(a=s.response)==null?void 0:a.data)==null?void 0:t.message)||"Error deleting fuel log")}},J=a=>{V(a),i(!0)},p=a=>{I(t=>t.map(s=>s._id===a._id?a:s)),i(!1),V(null)},h=a=>{if(a.receiptImage){const t=`${c}uploads/receipts/${a.receiptImage}`;E(t),T(!0),X("Receipt image loaded successfully")}else F("No receipt image available")};if(o.useEffect(()=>{B()},[]),Y)return e.jsx(ce,{color:"primary",size:"sm",children:"Loading..."});const r=a=>{I(t=>[...t,a]),B()};return e.jsx(e.Fragment,{children:e.jsxs(je,{children:[e.jsx(We,{children:"Fuel Management"}),e.jsx(ee,{children:e.jsxs(te,{children:[e.jsx(je,{className:"mb-3",children:e.jsx(Ke,{onAddFuelog:r})}),e.jsx(Xe,{fuelLogs:U,vehicles:G,drivers:z,loading:Y,error:ie,onDeleteFuelLog:x,onUpdateFuelLog:J,onViewReceipt:h})]})}),l&&e.jsx(Ye,{fuelLog:f,visible:l,onClose:()=>{i(!1),V(null)},onUpdate:p,vehicles:G,drivers:z}),e.jsxs(de,{visible:se,onClose:()=>k(!1),alignment:"center",children:[e.jsx(me,{closeButton:!0,children:"Confirm Delete"}),e.jsx(ue,{children:"Are you sure you want to delete this fuel log? This action cannot be undone."}),e.jsxs(pe,{children:[e.jsx(Q,{color:"secondary",variant:"outline",onClick:()=>k(!1),children:"Cancel"}),e.jsx(Q,{color:"danger",variant:"outline",onClick:L,children:"Delete"})]})]}),e.jsxs(de,{visible:$,onClose:()=>{T(!1),E(null)},size:"lg",alignment:"center",children:[e.jsx(me,{closeButton:!0,children:"Receipt Image"}),e.jsx(ue,{className:"text-center",children:_&&e.jsx(ge,{src:_,alt:"Receipt",style:{maxWidth:"100%",maxHeight:"70vh",objectFit:"contain"},onError:a=>{F("Error loading image"),a.target.src="placeholder-image-url.jpg"}})}),e.jsxs(pe,{children:[e.jsx(Q,{color:"secondary",variant:"outline",onClick:()=>{T(!1),E(null)},children:"Close"}),e.jsx("a",{href:_,target:"_blank",rel:"noopener noreferrer",children:e.jsx(Q,{color:"primary",variant:"outline",children:"Open in New Tab"})})]})]})]})})};export{gt as default};
