import{B as z,r as n,j as e,k as $,A as E,D as he}from"./index-BQNKW3Oi.js";import{F as R,l as xe,g as fe,e as J,a as K,h as je}from"./index-Bl5PiANI.js";import{C as I}from"./CAlert-m8lQ_dLd.js";import{a as F}from"./CButton-CDTCjSee.js";import{C as Y,a as Z,b as ee,c as se,d as te}from"./CModalTitle-Dbqmlo5Z.js";import{C as ae}from"./CForm-ChwbRa0e.js";import{C as M}from"./CFormInput-DT3Aafzt.js";import{C as re}from"./CFormTextarea-BHwh52--.js";import{C as ne}from"./CFormSelect-B66-L5-O.js";import{C as q}from"./CContainer-Cx55YM07.js";import{C as V,a as G}from"./CInputGroupText-CmPr8mzE.js";import{C as pe,a as ye,b as ge,c as Ne}from"./CAccordionHeader-DdBDEO78.js";import{C as T,a as we}from"./DefaultLayout-UGwOVka3.js";import{C as oe,a as ce,b as B,c as A,d as ie,e as P}from"./CTable-BRY9a1Hg.js";import{C as le,a as W}from"./CPaginationItem-kD9GfuTS.js";import{C as Ce,a as Se,b as U,c as H}from"./CTabList-kpfxZKpk.js";import{C as X}from"./CCard-DLIXfnJP.js";import"./index.esm-abRcLFOT.js";import"./1-D9IfqWlz.js";import"./cil-user-Ddrdy7PS.js";import"./getTransitionDurationFromElement-Cpu4p4hx.js";const be=({warehousing:d,onDeleteItem:m})=>{const{showError:b,showSuccess:x}=z(),[p,u]=n.useState(null),[w,g]=n.useState(!1),N=async()=>{g(!0);const i=await E.delete(`/api/v1/warehouse/delete/${d._id}`);i.data.success?(x(i.data.message),m(d._id),g(!1)):(g(!1),u(i.data.message),b(i.data.message))};return p?e.jsxs(I,{color:"danger",className:"text-center mt-5 w-75 mx-auto",children:["Error: ",p.message]}):e.jsx(e.Fragment,{children:e.jsx(F,{color:"danger",variant:"outline",onClick:N,className:"me-2",children:w?e.jsx($,{size:"sm"}):e.jsx(R,{icon:xe})})})},ve=({warehousing:d,onUpdateItem:m})=>{const{showSuccess:b,showErrors:x}=z(),[p,u]=n.useState(null),[w,g]=n.useState(!1),[N,i]=n.useState(null),[C,h]=n.useState(!1),[S,v]=n.useState([]),f=new Date().toISOString().split("T")[0],[t,c]=n.useState({from:d.from||"",items:d.items||"",dateArrival:f,warehouse:d.warehouse||"",warehouseLocDetails:{warehouseName:d.warehouseName||"",address:d.address||""},status:d.status});n.useEffect(()=>{(async()=>{try{const s=await E.get("/api/v1/warehouseLoc/locations");v(s.data.data)}catch(s){u(s.response.data.message),x(s.response.data.message)}})()},[]);const y=a=>{const{id:s,value:r}=a.target;c(l=>{if(["length","width","height"].includes(s)){const o=r===""?"":Math.max(1,Number(r));return{...l,[s]:o}}if(s==="items"){const o=JSON.parse(r);return{...l,items:o}}return{...l,[s]:r}})},j=async a=>{a.preventDefault();const r=JSON.parse(sessionStorage.getItem("user")).email;if(!r){u("User email not found. Please log in again.");return}const l=S.find(o=>o._id===t.warehouse);if(!l){u("Warehouse not found.");return}t.warehouseLocDetails={warehouseName:l.warehouseName,address:l.address},g(!0);try{const o=await E.put(`/api/v1/warehouse/update/${d._id}`,{...t,byReceived:r});if(o.data.success){const L=o.data.data,k=S.find(Q=>Q._id===L.warehouse);L.warehouse=k,b(o.data.message),m(o.data.data),setTimeout(()=>{i(null),h(!1)},2e3)}}catch(o){u(o.response.data.message),x(o.response.data.message),setTimeout(()=>{u(null)},2e3)}g(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(F,{color:"primary",variant:"outline",className:"me-2",onClick:()=>h(!0),children:w?e.jsx($,{size:"sm"}):e.jsx(R,{icon:fe})}),e.jsxs(Y,{visible:C,onClose:()=>h(!1),children:[e.jsx(Z,{children:e.jsx(ee,{children:"Recieved Items"})}),p&&e.jsx(I,{color:"danger",children:p}),N&&e.jsx(I,{color:"success",children:N}),e.jsx(se,{children:e.jsxs(ae,{children:[e.jsx(M,{type:"text",placeholder:"From",className:"mb-3",floatingLabel:"From",id:"from",onChange:y,value:t.from,required:!0,readOnly:!0}),e.jsx(re,{placeholder:"Items List",className:"mb-3 justify-content-center h-50",floatingLabel:"Items List",id:"items",rows:5,value:Array.isArray(t.items)?t.items.map((a,s)=>`${s+1}. ${a.itemName} (Quantity: ${a.quantity})`).join(`
`):t.items,readOnly:!0}),e.jsxs(ne,{placeholder:"Warehouse",className:"mb-3",floatingLabel:"Warehouse",id:"warehouse",onChange:y,value:t.warehouse||"",required:!0,children:[e.jsx("option",{value:"",children:"Select Warehouse"})," ",S.map(a=>e.jsx("option",{value:a._id,children:a.warehouseName||""},a._id))]})]})}),e.jsxs(te,{children:[e.jsx(F,{color:"secondary",variant:"outline",onClick:()=>h(!1),children:"Close"}),e.jsx(F,{color:"primary",variant:"outline",onClick:j,children:"Update Item"})]})]})]})},Ie=({warehousing:d,loading:m,error:b,onDeleteItem:x,onUpdateItem:p})=>{const[u,w]=n.useState([]),[g,N]=n.useState(null),[i,C]=n.useState(""),h=he(),S=["manager","admin"];n.useEffect(()=>{const t=setTimeout(()=>{try{if(!i.trim()){w(d),N(null);return}const c=i.toLowerCase().trim(),y=d.filter(j=>j.PoNumber&&j.PoNumber.toLowerCase().includes(c)||j.from&&j.from.toLowerCase().includes(c)||j.dateArrival&&v(j.dateArrival).includes(c)?!0:Array.isArray(j.items)?j.items.some(a=>a.itemName&&a.itemName.toLowerCase().includes(c)||a.quantity&&a.quantity.toString().includes(c)):!1);w(y),N(y.length===0?"No items found":null)}catch(c){console.error("Search error:",c),N("An error occurred while searching")}},300);return()=>clearTimeout(t)},[i,d]);const v=t=>new Date(t).toLocaleDateString(),f=t=>{C(t.target.value)};return m?e.jsx($,{color:"primary",className:"mt-5 w-15 mx-auto justify-content-center"}):d.length===0?e.jsx(I,{color:"warning",className:"text-center mt-5 w-75 mx-auto",children:"No data available"}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"mt-3",children:e.jsxs(V,{className:"w-50 mb-3",children:[e.jsx(M,{type:"text",placeholder:"Search Items...",value:i,id:"searchItem",onChange:f}),e.jsx(G,{children:e.jsx(R,{icon:J})})]})}),b&&e.jsx(I,{color:"danger",className:"text-center mt-5 w-75 mx-auto",children:b}),g&&e.jsx(I,{color:"danger",className:"text-center mt-5 w-75 mx-auto",children:g}),e.jsx(pe,{className:"m-2 ",children:u.map(t=>e.jsxs(ye,{children:[e.jsx(ge,{children:e.jsxs("ul",{className:"list-unstyled p-0 m-0 w-100",children:[e.jsxs("li",{children:["From:"," ",t.warehouse?e.jsxs("div",{className:"d-inline-flex align-items-center",children:[console.log("Warehouse data:",t.warehouse),t.warehouse.warehouseName,t.warehouse.deleted?e.jsx(K,{color:"danger",className:"ms-2",children:"Deleted"}):null]}):`${t.warehouseLocDetails.warehouseName} [DELETED to database]`]}),e.jsxs("li",{children:["Purcahse Order: ",e.jsx("strong",{children:t.PoNumber})]})]})}),e.jsxs(Ne,{children:[t.items.map((c,y)=>e.jsx("div",{children:e.jsx(T,{children:`Item name: ${c.itemName} Quantity: (${c.quantity})`})},y)),e.jsxs(T,{children:["Date receive: ",new Date(t.dateArrival).toLocaleDateString()]}),e.jsxs(T,{children:["Received By: ",t.byReceived]}),e.jsxs(T,{children:["Warehouse: ",t.warehouse?t.warehouse.warehouseName:"Unknown"]}),e.jsxs(q,{className:"d-flex justify-content-end mt-3",children:[e.jsx(ve,{warehousing:t,onUpdateItem:p}),S.includes(h)&&e.jsx(be,{warehousing:t,onDeleteItem:x})]})]})]},t._id))})]})},Le=({onAddItem:d,item:m={}})=>{const{showSuccess:b,showError:x}=z(),[p,u]=n.useState("Add Item"),[w,g]=n.useState(!1),[N,i]=n.useState(!1),[C,h]=n.useState(""),[S,v]=n.useState([]),f=new Date().toISOString().split("T")[0],[t,c]=n.useState({from:m.from,items:m.items,PoNumber:m.PoNumber,dateArrival:f,warehouse:"",warehouseLocDetails:{warehouseName:"",address:""},byReceived:""}),y=s=>{const{id:r,value:l}=s.target;c(o=>({...o,[r]:l}))},j=async s=>{try{return(await E.get(`/api/v1/warehouse/checkPoNumber/${s}`)).data.exists}catch(r){return console.error(r),!1}};n.useEffect(()=>{(async()=>{await j(m.PoNumber)&&u("Already Added")})()},[m.PoNumber]),n.useEffect(()=>{(async()=>{try{const r=await E.get("/api/v1/warehouseLoc/locations");v(r.data.data)}catch(r){h(r.response.data.message),x(r.response.data.message)}})()},[]),m.items&&m.items.map((s,r)=>`${r+1}. Item Name: (${s.itemName})    Quantity: (${s.quantity})`).join(`
`);const a=async s=>{var o,L,k,Q;s.preventDefault();const l=JSON.parse(sessionStorage.getItem("user")).email;if(!l){h("User email not found. Please log in again.");return}try{if(!t.warehouse){h("Please select a warehouse.");return}const D=S.find(O=>O._id===t.warehouse);if(!D){h("Selected warehouse not found.");return}t.warehouseLocDetails={warehouseName:D.warehouseName,address:D.address};const _=await E.post("/api/v1/warehouse/addItem",{...t,byReceived:l});if(_.data.success){const O=_.data.data,me=S.find(ue=>ue._id===O.warehouse);O.warehouse=me,b(_.data.message),d(O),u("Already Added"),setTimeout(()=>{i(!1),g("")},1500)}else h(_.data.message||"An unexpected error occurred"),x(_.data.message||"An unexpected error occurred")}catch(D){h(((L=(o=D.response)==null?void 0:o.data)==null?void 0:L.message)||D.message),x(((Q=(k=D.response)==null?void 0:k.data)==null?void 0:Q.message)||D.message)}};return e.jsxs(e.Fragment,{children:[e.jsx(F,{color:"primary",variant:"outline",onClick:()=>i(!0),disabled:p==="Already Added",children:p==="Already Added"?e.jsx("span",{className:"me-1",children:"Already Added"}):e.jsx(R,{icon:je})}),e.jsxs(Y,{visible:N,onClose:()=>i(!1),children:[e.jsx(Z,{children:e.jsx(ee,{children:"Add Item"})}),C&&e.jsx(I,{color:"danger",children:C}),w&&e.jsx(I,{color:"success",children:w}),e.jsx(se,{children:e.jsxs(ae,{children:[e.jsx(M,{type:"text",placeholder:"From",className:"mb-3",floatingLabel:"From",id:"from",onChange:y,value:t.from,required:!0,readOnly:!0}),e.jsx(re,{placeholder:"Items List",className:"mb-3 justify-content-center h-50",floatingLabel:"Items List",id:"items",rows:5,value:Array.isArray(t.items)?t.items.map((s,r)=>`${r+1}. ${s.itemName} (Quantity: ${s.quantity})`).join(`
`):t.items,readOnly:!0}),e.jsxs(ne,{placeholder:"Warehouse",className:"mb-3",floatingLabel:"Warehouse",id:"warehouse",onChange:y,value:t.warehouse,required:!0,children:[e.jsx("option",{value:"",children:"Select Warehouse"}),S.map(s=>e.jsx("option",{value:s._id,children:s.warehouseName},s._id))]})]})}),e.jsxs(te,{children:[e.jsx(F,{color:"secondary",variant:"outline",onClick:()=>i(!1),children:"Close"}),e.jsx(F,{color:"primary",variant:"outline",onClick:a,children:"Add Item"})]})]})]})},Ae=({onAddItem:d})=>{const[m,b]=n.useState([]),[x,p]=n.useState(1),[u,w]=n.useState(null),[g,N]=n.useState(!0),[i,C]=n.useState(""),[h,S]=n.useState([]),v=10,[f,t]=n.useState([{id:1,PoNumber:"123456",from:"Supplier A",items:[{itemName:"Item 1",quantity:10},{itemName:"Item 2",quantity:5}]},{id:2,PoNumber:"563424",from:"Supplier B",items:[{itemName:"Item 1",quantity:8},{itemName:"Item 4",quantity:12},{itemName:"Item 5",quantity:12}]},{id:3,PoNumber:"56323224",from:"Supplier C",items:[{itemName:"Item 6",quantity:8},{itemName:"Item 7",quantity:12},{itemName:"Item 8",quantity:12},{itemName:"Item 9",quantity:12}]},{id:4,PoNumber:"56342234",from:"Supplier D",items:[{itemName:"Item 10",quantity:8},{itemName:"Item 11",quantity:8}]},{id:5,PoNumber:"563433334",from:"Supplier E",items:[{itemName:"Item 12",quantity:8},{itemName:"Item 13",quantity:8},{itemName:"Item 14",quantity:8},{itemName:"Item 15",quantity:8}]}]);if(n.useEffect(()=>{b(f),N(!1)},[]),n.useEffect(()=>{if(i==="")S(m);else{const s=m.filter(r=>{const l=r.PoNumber.toLowerCase().includes(i.toLowerCase()),o=r.from.toLowerCase().includes(i.toLowerCase()),L=r.items.some(k=>k.itemName.toLowerCase().includes(i.toLowerCase()));return l||o||L});S(s),p(1),s.length===0?w("No matching records found."):w(null)}},[i,m]),g)return e.jsx($,{color:"primary",className:"mt-5 w-15 mx-auto justify-content-center"});const c=x*v,y=c-v;m.slice(y,c);const j=Math.ceil(m.length/v),a=s=>{C(s.target.value)};return e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"mt-3",children:e.jsxs(V,{className:"w-50 mb-3",children:[e.jsx(M,{type:"text",placeholder:"Search by PO Number, Supplier, or Item Name",value:i,id:"searchInput",onChange:a}),e.jsx(G,{children:e.jsx(R,{icon:J})})]})}),e.jsxs(oe,{hover:!0,responsive:!0,size:"sm",className:"text-center",children:[e.jsx(ce,{children:e.jsxs(B,{children:[e.jsx(A,{children:"PO Number"}),e.jsx(A,{children:"From"}),e.jsx(A,{children:"Item Name"}),e.jsx(A,{children:"Quantity"}),e.jsx(A,{children:"Actions"})]})}),e.jsx(ie,{children:h.map((s,r)=>e.jsxs(B,{children:[e.jsx(P,{className:"text-center",children:s.PoNumber}),e.jsx(P,{children:s.from}),e.jsx(P,{children:s.items.map(l=>e.jsx("div",{children:l.itemName},l.itemName))}),e.jsx(P,{children:s.items.map(l=>e.jsx("div",{children:l.quantity},l.itemName))}),e.jsx(P,{children:e.jsx(Le,{onAddItem:d,mockDataReiceving:f,item:s})})]},r))})]}),h.length>0&&e.jsxs(q,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs(q,{children:["Showing ",y+1," to ",Math.min(c,h.length)," of"," ",h.length," entries"]}),e.jsxs(le,{className:"mt-3",children:[e.jsx(W,{disabled:x===1,onClick:()=>p(s=>Math.max(s-1,1)),children:"Previous"}),[...Array(j).keys()].map(s=>e.jsx(W,{active:s+1===x,onClick:()=>p(s+1),children:s+1},s+1)),e.jsx(W,{disabled:x===j,onClick:()=>p(s=>Math.min(s+1,j)),children:"Next"})]})]}),u&&e.jsx(I,{color:"danger",className:"text-center mt-5 w-75 mx-auto justify-content-center",children:u})]})},Pe=({items:d,loading:m,error:b})=>{const[x,p]=n.useState([]),[u,w]=n.useState(""),[g,N]=n.useState(null),i=10,[C,h]=n.useState(1),S=a=>{switch(a){case"Stocked":return"success";case"Out of Stock":return"danger";default:return"secondary"}};n.useEffect(()=>{p(d)},[d]),n.useEffect(()=>{if(u==="")p(d),N(null);else{const a=d.filter(s=>{const r=s.itemName.toLowerCase().includes(u.toLowerCase()),l=s.locations.some(o=>{const L=o.warehouse;return L.warehouseName.toLowerCase().includes(u.toLowerCase())||L.address.toLowerCase().includes(u.toLowerCase())});return r||l});p(a),h(1),a.length===0?N("No results found"):N(null)}},[u,d]);const v=a=>{w(a.target.value)},f=a=>{if(!a||!Array.isArray(a))return[];const s=new Map;return a.forEach(r=>{if(!(r!=null&&r.warehouse))return;const l=r.warehouse._id||"deleted";if(!s.has(l))s.set(l,{warehouse:{...r.warehouse,deleted:r.warehouse.deleted||!r.warehouse._id},quantity:r.quantity||0});else{const o=s.get(l);o.quantity+=r.quantity||0,s.set(l,o)}}),Array.from(s.values())};if(m)return e.jsx($,{color:"primary",className:"text-center mt-5 w-75 mx-auto justify-content-center"});if(b)return e.jsxs(I,{color:"danger",className:"text-center mt-5 w-75 mx-auto justify-content-center",children:["Error: ",b]});const t=C*i,c=t-i,y=x.slice(c,t),j=Math.ceil(x.length/i);return e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"m-3",children:e.jsxs(V,{className:"w-50 mb-3",children:[e.jsx(M,{type:"text",id:"search",value:u,onChange:v,placeholder:"Search by item name or warehouse..."}),e.jsx(G,{children:e.jsx(R,{icon:J})})]})}),e.jsxs("strong",{className:"m-3 align-self-start",children:["Total Items: ",y.length]}),g?e.jsx(I,{color:"warning",children:g}):e.jsxs(oe,{hover:!0,responsive:!0,striped:!0,className:"text-center",children:[e.jsx(ce,{children:e.jsxs(B,{children:[e.jsx(A,{scope:"col",children:"Item Name"}),e.jsx(A,{scope:"col",children:"Total Quantity"}),e.jsx(A,{scope:"col",children:"Warehouse Locations"}),e.jsx(A,{scope:"col",children:"Status"})]})}),e.jsx(ie,{children:y.map((a,s)=>e.jsxs(B,{children:[e.jsx(P,{children:a.itemName}),e.jsx(P,{children:e.jsx("strong",{children:a.quantity})}),e.jsx(P,{children:e.jsx(q,{className:"locations-list",children:f(a.locations).map((r,l)=>{const o=r.warehouse;return e.jsx(q,{className:"location-item",children:e.jsxs(q,{className:"location-details",children:[e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("span",{className:"warehouse-name",children:(o==null?void 0:o.warehouseName)||"Unknown Warehouse"}),e.jsx(K,{color:o!=null&&o.deleted?"danger":"success",className:"ms-2",children:o!=null&&o.deleted?"Deleted":"Active"})]}),e.jsx("span",{className:"warehouse-address",children:(o==null?void 0:o.address)||"No address available"}),e.jsxs("span",{className:"quantity-badge",children:["Qty: ",r.quantity]})]})},(o==null?void 0:o._id)||`deleted-${l}`)})})}),e.jsx(P,{children:e.jsx(K,{color:S(a.status||(a.quantity>0?"Stocked":"Out of Stock")),children:a.status||(a.quantity>0?"Stocked":"Out of Stock")})})]},a._id||s))})]}),x.length===0&&!g&&e.jsx(I,{color:"warning",className:"text-center mt-5 w-75 mx-auto",children:"No items found."}),e.jsxs(le,{align:"center",children:[e.jsx(W,{disabled:C===1,onClick:()=>h(a=>Math.max(a-1,1)),children:"Previous"}),[...Array(j).keys()].map(a=>e.jsx(W,{active:a+1===C,onClick:()=>h(a+1),children:a+1},a+1)),e.jsx(W,{disabled:C===j,onClick:()=>h(a=>Math.min(a+1,j)),children:"Next"})]})]})},qe=`
  .locations-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .location-item {
    display: flex;
    flex-direction: column;
    padding: 8px;
    background-color: #f8f9fa;
    border-radius: 4px;
    width: fit-content;

  }

  .location-details {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 4px;
  }

  .warehouse-name {
    font-weight: 500;
    color: #495057;
  }

  .warehouse-address {
    color: #6c757d;
    font-size: 0.9em;
    font-style: italic;
  }

  .quantity-badge {
    background-color: #e9ecef;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 0.85em;
    color: #495057;
  }

`,de=document.createElement("style");de.innerText=qe;document.head.appendChild(de);const Ye=()=>{const[d,m]=n.useState([]),[b,x]=n.useState([]),[p,u]=n.useState(!1),[w,g]=n.useState(null),[N,i]=n.useState(0);n.useEffect(()=>{(async()=>{var t,c;u(!0);try{const[y,j]=await Promise.all([E.get("/api/v1/warehouse/items/all"),E.get("/api/v1/warehouse/items")]);y.data.success&&x(y.data.data),j.status===200&&m(j.data.data)}catch(y){g(((c=(t=y.response)==null?void 0:t.data)==null?void 0:c.message)||y.message||"Failed to fetch data")}finally{u(!1)}})()},[N]);const C=()=>{i(f=>f+1)},h=f=>{m(t=>[...t,f]),x(t=>[...t,f]),C()},S=f=>{m(t=>t.filter(c=>c._id!==f)),x(t=>t.filter(c=>c._id!==f)),C()},v=f=>{m(t=>t.map(c=>c._id===f._id?f:c)),x(t=>t.map(c=>c._id===f._id?f:c)),C()};return e.jsx(e.Fragment,{children:e.jsxs(Ce,{activeItemKey:"Warehouse Items Details",children:[e.jsxs(Se,{variant:"tabs",children:[e.jsx(U,{itemKey:"Warehouse Items Details",children:"Warehouse Items Details"}),e.jsx(U,{itemKey:"For Reiceve",children:"For Reiceve"}),e.jsx(U,{itemKey:"Items",children:"Items"})]}),e.jsxs(we,{children:[e.jsx(H,{className:"p-3",itemKey:"Warehouse Items Details",children:e.jsx(Ie,{warehousing:d,loading:p,error:w,onDeleteItem:S,onUpdateItem:v})}),e.jsx(H,{className:"p-3",itemKey:"For Reiceve",children:e.jsxs(X,{children:[e.jsx(T,{children:"Item Reicevig"}),e.jsx(Ae,{onAddItem:h})]})}),e.jsx(H,{className:"p-3",itemKey:"Items",children:e.jsxs(X,{children:[e.jsx(T,{children:"Items"}),e.jsx(Pe,{items:b,loading:p,error:w})]})})]})]})})};export{Ye as default};
