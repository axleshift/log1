import{r as s,_ as fe,u as he,a as P,R as E,C as pe,c as xe,P as f,d as ge,E as je,B as $,j as e,k as L,A as G,D as Ce,l as be}from"./index-BsAuDz7v.js";import{F as O,h as ye,i as ve,g as Ne,e as we}from"./index-DdzPpfT1.js";import{a as W}from"./CButton-1aJwC6WA.js";import{C as ae,a as te,b as oe,c as re,d as ne}from"./CModalTitle-9RnGyc5_.js";import{a as A,C as le}from"./CForm-DJmgfv4a.js";import{C as R}from"./CFormInput-De0-5chn.js";import{C as Se}from"./CContainer-D4HQE-qk.js";import{C as ke,a as Pe}from"./CInputGroupText-scgwoFmL.js";import{C as Le}from"./CCard-BQgonU39.js";import{u as Te,C as ie}from"./DefaultLayout-DeL5tmJy.js";import{C as Ee}from"./CCardBody-D4BA6tNM.js";import{C as We,a as Ae,b as ee,c as H,d as Fe,e as z}from"./CTable-CA166WLX.js";import{g as Ie,e as Re}from"./getRTLPlacement-DfCXL3YU.js";import{C as Be,a as q}from"./CPaginationItem-CeIFQBOh.js";import"./index.esm-CMByg3QK.js";import"./1-DdutqShQ.js";import"./cil-user-Ddrdy7PS.js";import"./getTransitionDurationFromElement-Cpu4p4hx.js";var I=s.forwardRef(function(a,j){var w=a.children,C=a.animation,g=C===void 0?!0:C,l=a.className,p=a.container,i=a.content,d=a.delay,n=d===void 0?0:d,o=a.fallbackPlacements,c=o===void 0?["top","right","bottom","left"]:o,u=a.offset,y=u===void 0?[0,6]:u,x=a.onHide,v=a.onShow,N=a.placement,T=N===void 0?"top":N,h=a.popperConfig,S=a.trigger,m=S===void 0?["hover","focus"]:S,b=a.visible,t=fe(a,["children","animation","className","container","content","delay","fallbackPlacements","offset","onHide","onShow","placement","popperConfig","trigger","visible"]),r=s.useRef(null),k=s.useRef(null),_=he(j,r),B="tooltip".concat(s.useId()),J=s.useState(!1),V=J[0],Q=J[1],K=s.useState(b),F=K[0],X=K[1],U=Te(),ce=U.initPopper,de=U.destroyPopper,ue=U.updatePopper,Y=typeof n=="number"?{show:n,hide:n}:n,Z={modifiers:[{name:"arrow",options:{element:".tooltip-arrow"}},{name:"flip",options:{fallbackPlacements:c}},{name:"offset",options:{offset:y}}],placement:Ie(T,k.current)},me=P(P({},Z),typeof h=="function"?h(Z):h);s.useEffect(function(){if(b){D();return}M()},[b]),s.useEffect(function(){if(V&&k.current&&r.current){ce(k.current,r.current,me),setTimeout(function(){X(!0)},Y.show);return}!V&&k.current&&r.current&&de()},[V]),s.useEffect(function(){!F&&k.current&&r.current&&Re(function(){Q(!1)},r.current)},[F]);var D=function(){Q(!0),v&&v()},M=function(){setTimeout(function(){X(!1),x&&x()},Y.hide)};return s.useEffect(function(){ue()},[i]),E.createElement(E.Fragment,null,E.cloneElement(w,P(P(P(P(P({},F&&{"aria-describedby":B}),{ref:k}),(m==="click"||m.includes("click"))&&{onClick:function(){return F?M():D()}}),(m==="focus"||m.includes("focus"))&&{onFocus:function(){return D()},onBlur:function(){return M()}}),(m==="hover"||m.includes("hover"))&&{onMouseEnter:function(){return D()},onMouseLeave:function(){return M()}})),E.createElement(pe,{container:p,portal:!0},V&&E.createElement("div",P({className:xe("tooltip","bs-tooltip-auto",{fade:g,show:F},l),id:B,ref:_,role:"tooltip"},t),E.createElement("div",{className:"tooltip-arrow"}),E.createElement("div",{className:"tooltip-inner"},i))))});I.propTypes={animation:f.bool,children:f.node,container:f.any,content:f.oneOfType([f.string,f.node]),delay:f.oneOfType([f.number,f.shape({show:f.number.isRequired,hide:f.number.isRequired})]),fallbackPlacements:je,offset:f.any,onHide:f.func,onShow:f.func,placement:f.oneOf(["auto","top","right","bottom","left"]),popperConfig:f.oneOfType([f.func,f.object]),trigger:ge,visible:f.bool};I.displayName="CTooltip";const Ve=({onAddWarehouseLoc:a})=>{const{showSuccess:j,showError:w}=$(),[C,g]=s.useState(!1),[l,p]=s.useState(!1),[i,d]=s.useState(!1),[n,o]=s.useState(null),[c,u]=s.useState(null),y={warehouseName:"",address:""},[x,v]=s.useState(y),N=h=>{const{id:S,value:m}=h.target;v(b=>({...b,[S]:m}))},T=async h=>{const m=h.currentTarget.checkValidity();if(m||(h.preventDefault(),h.stopPropagation()),g(m),m){const t=JSON.parse(sessionStorage.getItem("user")).email;if(!t){o("User email not found. Please log in again.");return}d(!0);try{const r=await G.post("/api/v1/warehouseLoc/add",{...x,createdBy:t});r.data.success&&(j(r.data.message),a(r.data.data),setTimeout(()=>{d(!1),p(!1),o(null),v(y),g(!1)},2e3))}catch(r){o(r.response.data.message),w(r.response.data.message),setTimeout(()=>{o(null)},2e3)}d(!1)}};return e.jsx(e.Fragment,{children:i?e.jsx(L,{color:"primary",size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsxs(W,{color:"primary",variant:"outline",disabled:i,onClick:()=>p(!0),children:[i?e.jsx(L,{color:"secondary",size:"sm"}):e.jsx(O,{icon:ye})," ","Add Warehouse Location"]}),e.jsxs(ae,{visible:l,onClose:()=>p(!1),children:[e.jsx(te,{closeButton:!0,children:e.jsx(oe,{children:"Add Warehouse Location"})}),n&&e.jsx(A,{color:"danger",className:"m-3",children:n}),c&&e.jsx(A,{color:"success",className:"m-3",children:c}),e.jsx(re,{children:e.jsxs(le,{noValidate:!0,validated:C,children:[e.jsx(R,{type:"text",id:"warehouseName",className:"mb-3",placeholder:"Warehouse Name",floatingLabel:"Warehouse Name",onChange:N,value:x.warehouseName,autoComplete:"off",required:!0,feedbackInvalid:"Please enter a warehouse name",feedbackValid:"Looks good!"}),e.jsx(R,{type:"text",id:"address",className:"mb-3",placeholder:"Address",floatingLabel:"Address",onChange:N,value:x.address,autoComplete:"off",required:!0,feedbackInvalid:"Please enter an address",feedbackValid:"Looks good!"})]})}),e.jsxs(ne,{children:[e.jsx(W,{color:"secondary",variant:"outline",disabled:i,onClick:()=>{p(!1),v(y),p(!1),o(null),g(!1)},children:i?e.jsx(L,{color:"secondary",size:"sm"}):"Cancel"}),e.jsx(W,{color:"primary",variant:"outline",disabled:i,onClick:T,children:i?e.jsx(L,{color:"primary",size:"sm"}):"Add"})]})]})]})})},De=({warehouseLoc:a,onDeleteWarehouseLoc:j})=>{const{showSuccess:w,showError:C}=$(),[g,l]=s.useState(!1),[p,i]=s.useState(null),d=async()=>{l(!0);try{const n=await G.delete(`/api/v1/warehouseLoc/delete/${a._id}`);n.data.success&&(w(n.data.message),j(a._id),l(!1),i(null))}catch(n){i(n),C(n.message)}finally{l(!1)}};return p?e.jsxs(A,{color:"danger",className:"text-center mt-5 w-75 mx-auto",children:["Error: ",p.message]}):e.jsx(e.Fragment,{children:e.jsx(W,{color:"danger",disabled:g,variant:"outline",onClick:d,className:"me-2",children:g?e.jsx(L,{size:"sm"}):e.jsx(O,{icon:ve})})})},Me=({warehouseLoc:a,onUpdateWarehouseLoc:j})=>{const{showSuccess:w,showErrors:C}=$(),[g,l]=s.useState(!1),[p,i]=s.useState(!1),[d,n]=s.useState(!1),[o,c]=s.useState(null),[u,y]=s.useState(null),[x,v]=s.useState({warehouseName:a.warehouseName,address:a.address}),N=h=>{const{id:S,value:m}=h.target;v(b=>({...b,[S]:m}))},T=async h=>{const m=h.currentTarget.checkValidity();m||(h.preventDefault(),h.stopPropagation()),i(m);const t=JSON.parse(sessionStorage.getItem("user")).email;if(!t){c("User email not found. Please log in again.");return}n(!0);try{const r=await G.put(`/api/v1/warehouseLoc/update/${a._id}`,{...x,createdBy:t});r.data.success&&(w(r.data.message),j(r.data.data),setTimeout(()=>{y(null),l(!1),c(null),i(!1)},2e3))}catch(r){c(r.response.data.message),C(r.response.data.message),setTimeout(()=>{c(null)},2e3)}n(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(W,{color:"primary",variant:"outline",disabled:d,onClick:()=>l(!0),className:"me-2",children:d?e.jsx(L,{size:"sm"}):e.jsx(O,{icon:Ne})}),e.jsxs(ae,{visible:g,onClose:()=>l(!1),children:[e.jsx(te,{closeButton:!0,children:e.jsx(oe,{children:"Update Warehouse Location"})}),o&&e.jsx(A,{color:"danger",className:"m-3",children:o}),u&&e.jsx(A,{color:"success",className:"m-3",children:u}),e.jsx(re,{children:e.jsxs(le,{noValidate:!0,validated:p,children:[e.jsx(R,{type:"text",id:"warehouseName",className:"mb-3",placeholder:"Warehouse Name",floatingLabel:"Warehouse Name",onChange:N,value:x.warehouseName,autoComplete:"off",required:!0,feedbackInvalid:"Please enter a warehouse name.",feedbackValid:"Looks good!"}),e.jsx(R,{type:"text",id:"address",className:"mb-3",placeholder:"Address",floatingLabel:"Address",onChange:N,value:x.address,autoComplete:"off",required:!0,feedbackInvalid:"Please enter an address.",feedbackValid:"Looks good!"})]})}),e.jsxs(ne,{children:[e.jsx(W,{color:"secondary",variant:"outline",disabled:d,onClick:()=>{l(!1),c(null),i(!1)},children:d?e.jsx(L,{size:"sm",color:"secondary"}):"Cancel"}),e.jsx(W,{color:"primary",variant:"outline",disabled:d,onClick:T,children:d?e.jsx(L,{size:"sm",color:"success"}):"Update"})]})]})]})},He=({warehouseLoc:a,loading:j,error:w,onDeleteWarehouseLoc:C,onUpdateWarehouseLoc:g})=>{const[l,p]=s.useState(""),[i,d]=s.useState([]),[n,o]=s.useState(1),[c,u]=s.useState(null),y=10,x=Ce(),v=["manager","admin"],N="admin";if(s.useEffect(()=>{d(a)},[a]),s.useEffect(()=>{if(l==="")d(a);else{const t=a.filter(r=>{const k=r.warehouseName.toLowerCase().includes(l.toLowerCase()),_=r.address.toLowerCase().includes(l.toLowerCase()),B=v.includes(x)&&r.createdBy.toLowerCase().includes(l.toLowerCase());return k||_||B});d(t),o(1),t.length===0?u("No results found"):u(null)}},[l,a]),a.length===0)return e.jsx(A,{color:"danger",className:"text-center mt-5 w-75 mx-auto justify-content-center",children:"No Warehouse Location Found"});const T=t=>{p(t.target.value)},h=n*y,S=h-y,m=i.slice(S,h),b=Math.ceil(i.length/y);return e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"m-3",children:e.jsxs(ke,{className:"w-50 mb-3",children:[e.jsx(R,{type:"text",id:"search",value:l,onChange:T,placeholder:"Search Warehouse Location..."}),e.jsx(Pe,{children:e.jsx(O,{icon:we})})]})}),e.jsxs(Le,{children:[e.jsx(ie,{children:"Warehouse Location List"}),e.jsxs(Ee,{className:"md-3",children:[e.jsxs(We,{bordered:!0,hover:!0,responsive:!0,className:"mx-auto ",children:[e.jsx(Ae,{className:"text-center  ",children:e.jsxs(ee,{children:[e.jsx(H,{className:"fixed-width bg-secondary",children:"Warehouse Name"}),e.jsx(H,{className:"fixed-width bg-secondary",children:"Address"}),N.includes(x)&&e.jsx(H,{className:"fixed-width bg-secondary",children:"Created By"}),e.jsx(H,{className:"fixed-width bg-secondary",children:"Actions"})]})}),e.jsx(Fe,{className:"text-center",children:m.map(t=>e.jsxs(ee,{children:[e.jsx(z,{className:"fixed-width",children:e.jsx(I,{content:t.warehouseName,children:e.jsx("span",{children:t.warehouseName})})}),e.jsx(z,{className:"fixed-width",children:e.jsx(I,{content:t.address,children:e.jsx("span",{children:t.address})})}),N.includes(x)&&e.jsx(z,{className:"fixed-width",color:"danger",children:e.jsx(I,{content:t.createdBy,children:e.jsx("span",{children:t.createdBy})})}),e.jsxs(z,{className:"fixed-width",children:[e.jsx(Me,{warehouseLoc:t,onUpdateWarehouseLoc:g}),v.includes(x)&&e.jsx(De,{warehouseLoc:t,onDeleteWarehouseLoc:C})]})]},t._id))})]}),c&&e.jsx(A,{color:"danger",className:"text-center mt-5 w-75 mx-auto justify-content-center",children:c}),e.jsxs(Be,{align:"center",children:[e.jsx(q,{disabled:n===1,onClick:()=>o(t=>Math.max(t-1,1)),children:"Previous"}),[...Array(b).keys()].map(t=>e.jsx(q,{active:t+1===n,onClick:()=>o(t+1),children:t+1},t+1)),e.jsx(q,{disabled:n===b,onClick:()=>o(t=>Math.min(t+1,b)),children:"Next"})]})]})]})]})},se=sessionStorage.getItem("accessToken"),ze="http://localhost:5057",Oe=be.create({baseURL:ze,withCredentials:!0,headers:{"Content-Type":"application/json",...se&&{Authorization:`Bearer ${se}`}}}),ls=()=>{const[a,j]=s.useState([]),[w,C]=s.useState(!1),[g,l]=s.useState(null),p=async()=>{var o,c;C(!0);try{const u=await Oe.get("/api/v1/warehouseLoc/locations");u.status===200?j(u.data.data):l(u.data.message)}catch(u){l(((c=(o=u.response)==null?void 0:o.data)==null?void 0:c.message)||u.message)}finally{C(!1)}};s.useEffect(()=>{p()},[]);const i=o=>{j(c=>[...c,o])},d=o=>{j(c=>c.filter(u=>u._id!==o))},n=o=>{j(c=>c.map(u=>u._id===o._id?o:u))};return e.jsxs(e.Fragment,{children:[e.jsx(ie,{children:"Warehouse location"}),e.jsx(Ve,{onAddWarehouseLoc:i}),e.jsx(He,{warehouseLoc:a,loading:w,error:g,onDeleteWarehouseLoc:d,onUpdateWarehouseLoc:n})]})};export{ls as default};
