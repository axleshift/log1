import{l as q,r as a,j as e,k as w,n as k,A as $}from"./index-BTSAY1jP.js";import{s as Y,F,t as J,v as K,m as W,u as X}from"./index-Dn9UYZt8.js";import{a as E}from"./CButton-DR-vKXAR.js";import{C as O,a as H,b as U,c as B}from"./CModalHeader-CilGuV6x.js";import{C as R}from"./CModalTitle-BJWUHLpp.js";import{C as _}from"./CAlert-D-e74jgy.js";import{C as G}from"./CForm-DQbMisVi.js";import{C as v}from"./CFormInput-PBNeC-mo.js";import{C as z}from"./CFormSelect-Bfwswoto.js";import{C as P}from"./CContainer-DEEd9IWu.js";import{C as Z}from"./CInputGroup-CQKjyylt.js";import{C as ee}from"./CInputGroupText-BsTVzfJV.js";import{C as se,a as ae,b as te,c as le}from"./CAccordionHeader-D0Ivzz_g.js";import{C as M}from"./DefaultLayout-C2YjAy5i.js";import{C as re,a as T}from"./CPaginationItem-DER1Jz8K.js";import{C as ne}from"./CCard-nIY_lqVA.js";import{C as oe}from"./CCardBody-on8ISP2K.js";import"./index.esm-Dl38YfVk.js";import"./1-0rsEpf3b.js";import"./cil-user-Ddrdy7PS.js";const ie=({onAddDriver:i})=>{const{showSuccess:A,showError:y}=q(),[m,b]=a.useState(!1),[p,N]=a.useState(null),[D,c]=a.useState(null),[V,o]=a.useState(!1),[L,g]=a.useState([]),[j,h]=a.useState(!1),S={idNum:Math.floor(Math.random()*1e6).toString(),driverName:"",email:"",phone:"",address:"",licenseNumber:"",status:"available",assignedVehicle:""},[r,d]=a.useState(S),n=l=>{const{id:t,value:f}=l.target;d(C=>({...C,[t]:f}))},x=async()=>{try{const l=await k.get("api/v1/vehicle/available");g(l.data.data)}catch(l){console.error("Error fetching vehicles:",l)}};a.useEffect(()=>{x()},[]);const s=async l=>{l.currentTarget.checkValidity()===!1&&(l.preDefault(),l.stopPropagation()),h(!0),{...r},b(!0);try{const f=await k.post("api/v1/driver",r);f.status===201&&(A(f.data.message),i(f.data.data),setTimeout(()=>{d(S),h(!1),o(!1),b(!1)},2e3))}catch(f){c(f.response.data.message),y(f.response.data.message),setTimeout(()=>{c(null)},3e3)}finally{b(!1)}},u=({icon:l})=>{const[t,f]=a.useState(!1);return e.jsx(F,{icon:l,bounce:t,onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1)})};return e.jsx(e.Fragment,{children:m?e.jsx(w,{color:"primary",size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsxs(E,{color:"primary",disabled:m,variant:"outline",onClick:()=>o(!0),children:[m?e.jsx(w,{color:"primary",size:"sm"}):e.jsx(u,{icon:Y})," Add Driver"]}),e.jsxs(O,{visible:V,onClose:()=>o(!1),children:[e.jsx(H,{children:e.jsx(R,{children:"Add Driver"})}),D&&e.jsx(_,{color:"danger",className:"m-3",children:D}),p&&e.jsx(_,{color:"success",className:"m-3",children:p}),e.jsx(U,{children:e.jsxs(G,{noValidate:!0,validated:j,children:[e.jsx(v,{className:"mb-3",floatingLabel:"ID Number",placeholder:"ID Number",type:"text",id:"idNum",label:"ID Number",value:r.idNum,disabled:!0}),e.jsx(v,{className:"mb-3",floatingLabel:"Name",placeholder:"Name",type:"text",id:"driverName",label:"Name",autoComplete:"off",required:!0,value:r.driverName,onChange:n}),e.jsx(v,{className:"mb-3",floatingLabel:"email",placeholder:"Model",type:"email",id:"email",label:"Email",autoComplete:"off",required:!0,value:r.email,onChange:n}),e.jsx(v,{type:"phone",className:"mb-3",floatingLabel:"phone",placeholder:"phone",id:"phone",label:"Phone",title:"Please enter a valid phone number",autoComplete:"off",value:r.phone,required:!0,onChange:n}),e.jsx(v,{className:"mb-3",floatingLabel:"Address",placeholder:"Address",type:"text",id:"address",label:"Address",autoComplete:"off",required:!0,value:r.address,onChange:n}),e.jsx(v,{className:"mb-3",floatingLabel:"License Number",placeholder:"License Number",type:"text",id:"licenseNumber",label:"License Number",autoComplete:"off",required:!0,value:r.licenseNumber,onChange:n}),e.jsxs(z,{className:"mb-3",floatingLabel:"Vehicle",label:"Vehicle",id:"assignedVehicle",required:!0,value:r.assignedVehicle,onChange:n,children:[e.jsx("option",{value:null,children:"Select Vehicle"}),L.map(l=>e.jsxs("option",{value:l._id,children:[l.brand," /",l.model," /",l.regisNumber]},l._id))]})]})}),e.jsxs(B,{children:[e.jsx(E,{color:"secondary",variant:"outline",disabled:m,onClick:()=>{o(!1),d(S),c(null),h(!1)},children:m?e.jsx(w,{color:"secondary",size:"sm"}):"Cancel"}),e.jsx(E,{color:"primary",variant:"outline",onClick:s,disabled:m,children:m?e.jsx(w,{color:"primary",size:"sm"}):"Add Driver"})]})]})]})})},ce=({driver:i,onUpdateDriver:A})=>{const{showSuccess:y,showError:m}=q(),[b,p]=a.useState(!1),[N,D]=a.useState(null),[c,V]=a.useState([]),[o,L]=a.useState(!1),[g,j]=a.useState(null),[h,I]=a.useState(!1),S={idNum:i.idNum,driverName:i.driverName,email:i.email,phone:i.phone,address:i.address,licenseNumber:i.licenseNumber,status:i.status,assignedVehicle:i.assignedVehicle},[r,d]=a.useState(S),n=t=>{const{id:f,value:C}=t.target;d(Q=>({...Q,[f]:C}))},x=async()=>{try{const t=await k.get("api/v1/vehicle/available");V(t.data.data)}catch(t){m(t.message)}};a.useEffect(()=>{x()},[]);const s=async t=>{t.preventDefault(),t.currentTarget.checkValidity()===!1&&t.stopPropagation(),L(!0),I(!0),{...r};try{const C=await k.put(`/api/v1/driver/${i._id}`,r);C.data.success&&(y(C.data.message),A(C.data.data),setTimeout(()=>{p(!1),d(S)},2e3))}catch(C){j(C.response.data.message),m(C.response.data.message),setTimeout(()=>{j(null)},2e3)}finally{I(!1)}},u=[{value:"available",label:"Available"},{value:"on_duty",label:"On Duty"},{value:"off_duty",label:"Off Duty"}],l=({icon:t})=>{const[f,C]=a.useState(!1);return e.jsx(F,{icon:t,bounce:f,onMouseEnter:()=>C(!0),onMouseLeave:()=>C(!1)})};return e.jsxs(e.Fragment,{children:[e.jsxs(E,{color:"primary",variant:"outline",disabled:h,onClick:()=>p(!0),className:"me-2",children:[h?e.jsx(w,{size:"sm"}):e.jsx(l,{icon:J})," Update"]}),e.jsxs(O,{visible:b,onClose:()=>p(!1),children:[e.jsx(H,{children:e.jsx(R,{children:"Update Driver"})}),g&&e.jsx(_,{color:"danger",className:"m-3",children:g}),N&&e.jsx(_,{color:"success",className:"m-3",children:N}),e.jsx(U,{children:e.jsx(G,{noValidate:!0,validated:o,children:e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"mb-3",floatingLabel:"ID Number",placeholder:"ID Number",type:"text",id:"idNum",label:"ID Number",value:r.idNum,disabled:!0}),e.jsx(v,{className:"mb-3",floatingLabel:"Name",placeholder:"Name",type:"text",id:"driverName",label:"Name",autoComplete:"off",required:!0,value:r.driverName,onChange:n}),e.jsx(v,{className:"mb-3",floatingLabel:"email",placeholder:"Model",type:"email",id:"email",label:"Email",autoComplete:"off",required:!0,value:r.email,onChange:n}),e.jsx(v,{type:"phone",className:"mb-3",floatingLabel:"phone",placeholder:"phone",id:"phone",label:"Phone",title:"Please enter a valid phone number",autoComplete:"off",value:r.phone,required:!0,onChange:n}),e.jsx(v,{className:"mb-3",floatingLabel:"Address",placeholder:"Address",type:"text",id:"address",label:"Address",autoComplete:"off",required:!0,value:r.address,onChange:n}),e.jsx(v,{className:"mb-3",floatingLabel:"License Number",placeholder:"License Number",type:"text",id:"licenseNumber",label:"License Number",autoComplete:"off",required:!0,value:r.licenseNumber,onChange:n}),e.jsx(z,{className:"mb-3",floatingLabel:"Status",placeholder:"Status",id:"status",label:"Status",autoComplete:"off",required:!0,value:r.status||"",onChange:n,children:u.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),r.status==="available"||r.status==="on_duty"&&e.jsxs(z,{className:"mb-3",floatingLabel:"Assigned Vehicle",label:"Assigned Vehicle",id:"assignedVehicle",value:r.assignedVehicle||"",onChange:n,children:[e.jsx("option",{value:"",children:"Select a vehicle"}),c.map(t=>e.jsxs("option",{value:t._id,children:[t.brand," / ",t.model," / ",t.regisNumber]},t._id))]})]})})}),e.jsxs(B,{children:[e.jsx(E,{color:"secondary",variant:"outline",disabled:h,onClick:()=>{p(!1),j(null),L(!1)},children:h?e.jsx(w,{color:"secondary",size:"sm"}):"Close"}),e.jsx(E,{color:"success",variant:"outline",disabled:h,onClick:s,children:h?e.jsx(w,{color:"success",size:"sm"}):"Save Changes"})]})]})]})},de=({driver:i,onDeleteDriver:A})=>{const[y,m]=a.useState(!1),[b,p]=a.useState(null),{showError:N,showSuccess:D}=q(),c=async()=>{m(!0);try{const o=await k.delete(`api/v1/driver/${i._id}`);o.status===200&&(D(o.data.message),A(i._id),m(!1),p(null))}catch(o){p(o),N(o.response.data.message)}finally{m(!1)}},V=({icon:o})=>{const[L,g]=a.useState(!1);return e.jsx(F,{icon:o,bounce:L,onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1)})};return e.jsx(e.Fragment,{children:e.jsxs(E,{color:"danger",variant:"outline",onClick:c,className:"me-2",disabled:y,children:[y?e.jsx(w,{size:"sm"}):e.jsx(V,{icon:K})," Delete"]})})},ue=({driver:i,loading:A,onDeleteDriver:y,onUpdateDriver:m})=>{const b=$(),p=["manager","admin","super admin","fleet manager"],[N,D]=a.useState(null),[c,V]=a.useState(""),[o,L]=a.useState([]),[g,j]=a.useState(1),[h]=a.useState(10),I=g*h,S=I-h,r=o.slice(S,I),d=Math.ceil(o.length/h);a.useEffect(()=>{(async()=>{if(j(1),c==="")L(i);else{const u=i.filter(l=>l.driverName.toLowerCase().includes(c.toLowerCase())||l.idNum.toString().includes(c)||l.email.toLowerCase().includes(c.toLowerCase())||l.phone.toString().includes(c)||l.address.toLowerCase().includes(c.toLowerCase())||l.licenseNumber.toString().includes(c)||x.find(t=>t.value===l.status).label.toLowerCase().includes(c.toLowerCase()));L(u),u.length===0?D("No results found"):D(null)}})()},[c,i]);const n=s=>{switch(s){case"available":return"green";case"on_duty":return"red";case"off_duty":return"orange";default:return"black"}},x=[{label:"Available",value:"available"},{label:"On Duty",value:"on_duty"},{label:"Off Duty",value:"off_duty"}];return i.length===0?e.jsx(_,{color:"danger",className:"justfy-content-center",children:"No drivers found"}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"mt-3",children:e.jsxs(Z,{className:"w-50 mb-3 ",children:[e.jsx(v,{type:"text",placeholder:"Search Drivers...",id:"search",value:c,onChange:s=>V(s.target.value),className:"w-50 me-2 "}),e.jsx(ee,{children:e.jsx(F,{icon:W})})]})}),e.jsx(se,{className:"m-2",children:r.map(s=>e.jsxs(ae,{children:[e.jsx(te,{children:e.jsxs("p",{className:"w-100 m-1",children:["Driver Name: ",e.jsxs("strong",{children:[" ",s.driverName," "]}),e.jsx(F,{icon:X,color:n(s.status),className:"m-2 float-end"}),e.jsxs("small",{className:"m-2 float-end",children:[" ",x.find(u=>u.value===s.status).label]})]})}),e.jsxs(le,{children:[e.jsxs(M,{children:["ID: ",s.idNum]}),e.jsxs(M,{children:["Email: ",s.email]}),e.jsxs(M,{children:["Phone: ",s.phone]}),e.jsxs(M,{children:["Address: ",s.address]}),e.jsxs(M,{children:["License Number: ",s.licenseNumber]}),e.jsxs(M,{children:["Vehicle:"," ",s.assignedVehicle?`${s.assignedVehicle.regisNumber} - ${s.assignedVehicle.brand} ${s.assignedVehicle.model}`:"No vehicle assigned"]}),e.jsxs(M,{children:["Status: ",x.find(u=>u.value===s.status).label]}),e.jsxs(P,{className:"d-flex justify-content-end mt-3",children:[A?e.jsx(w,{color:"primary",size:"sm"}):e.jsx(ce,{driver:s,onUpdateDriver:m}),p.includes(b)&&e.jsx(de,{driver:s,onDeleteDriver:y})]})]})]},s._id))}),o.length>0&&e.jsxs(P,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs(P,{children:["Showing ",S+1," to ",Math.min(I,o.length)," of"," ",o.length," entries"]}),e.jsxs(re,{className:"mt-3",children:[e.jsx(T,{disabled:g===1,onClick:()=>j(s=>Math.max(s-1,1)),children:"Previous"}),Array.from({length:d},(s,u)=>u+1).map(s=>e.jsx(T,{active:s===g,onClick:()=>j(s),children:s},s)),e.jsx(T,{disabled:g===d,onClick:()=>j(s=>Math.min(s+1,d)),children:"Next"})]})]}),N&&e.jsx(_,{color:"danger",className:"text-center justify-content-center",children:N})]})},Ee=()=>{const i=$(),A=["super admin","admin","manager","fleet manager"],{showError:y}=q(),[m,b]=a.useState([]),[p,N]=a.useState(!1),[D,c]=a.useState(null),[V,o]=a.useState(!1),[L,g]=a.useState(null),j=async()=>{var d,n,x,s;N(!0);try{const u=await k.get("api/v1/driver");u.status===200?(b(u.data.data),N(!1)):(c(u.data.message),y(u.data.message))}catch(u){c(((n=(d=u.response)==null?void 0:d.data)==null?void 0:n.message)||u.message),y(((s=(x=u.response)==null?void 0:x.data)==null?void 0:s.message)||u.message)}finally{N(!1)}};a.useEffect(()=>{j()},[]);const h=d=>{b(n=>[...n,d]),j()},I=d=>{g(d),o(!0)},S=d=>{b(n=>n.filter(x=>x._id!==d))},r=d=>{b(n=>n.map(x=>x._id===d._id?d:x))};return p?e.jsx("div",{className:"text-center  ",children:e.jsx(w,{color:"primary",size:"sm"})}):e.jsx(e.Fragment,{children:i&&A.includes(i)?e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"text-center",children:"Driver Management"}),e.jsx(P,{className:"m-3",children:e.jsx(ie,{onAddDriver:h})}),e.jsxs(ne,{children:[e.jsx(M,{children:"Drivers list"}),e.jsx(oe,{className:"md-3",children:e.jsx(ue,{driver:m,loading:p,error:D,onDeleteDriver:I,onUpdateDriver:r})})]}),e.jsxs(O,{visible:V,onClose:()=>o(!1),alignment:"center",children:[e.jsx(H,{closeButton:!0,children:"Confirm Delete"}),e.jsx(U,{children:"Are you sure you want to delete this driver? This action cannot be undone."}),e.jsxs(B,{children:[e.jsx(E,{color:"secondary",onClick:()=>o(!1),children:"Cancel"}),e.jsx(E,{color:"danger",onClick:S,children:"Delete"})]})]})]}):e.jsx(_,{color:"danger",className:"text-center w-100 mx-auto mt-5 justify-content-center",children:"You are not authorized to access this page."})})};export{Ee as default};
