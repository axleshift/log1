import{B as F,r as l,j as e,k as V,A as _,D as H}from"./index-DROWpYL_.js";import{F as k,h as R,j as Q,i as J,k as K,l as W}from"./index-CMSYnzFr.js";import{a as A}from"./CButton-B9J2LueU.js";import{C as z,a as P,b as U,c as O,d as B}from"./CModalTitle-BTa5ve_X.js";import{a as I,C as $}from"./CForm-BCO_fxSv.js";import{C as p}from"./CFormInput-Bk8len5H.js";import{C as q}from"./CFormSelect-CUJJWTLn.js";import{C as T}from"./CContainer-CdWzMoCP.js";import{C as X,a as Y}from"./CInputGroupText-DF8EFEoQ.js";import{C as Z,a as ee,b as se,c as ae}from"./CAccordionHeader-CipZyu_X.js";import{C as w}from"./DefaultLayout-B1sY_SSj.js";import{C as le}from"./CCard-DQFhcyJv.js";import{C as te}from"./CCardBody-CRiEzVZv.js";import"./index.esm-DzHzV93o.js";import"./1-CyQxF0Py.js";import"./cil-user-Ddrdy7PS.js";const re=({onAddDriver:n})=>{const{showSuccess:L,showError:h}=F(),[i,x]=l.useState(!1),[u,j]=l.useState(null),[v,r]=l.useState(null),[b,y]=l.useState(!1),[D,E]=l.useState([]),[C,s]=l.useState(!1),t={idNum:Math.floor(Math.random()*1e6).toString(),driverName:"",email:"",phone:"",address:"",licenseNumber:"",status:"available",assignedVehicle:""},[a,m]=l.useState(t),c=d=>{const{id:o,value:N}=d.target;m(S=>({...S,[o]:N}))},f=async()=>{try{const d=await _.get("/api/v1/vehicle/available");E(d.data.data)}catch(d){console.error("Error fetching vehicles:",d)}};l.useEffect(()=>{f()},[]);const M=async d=>{d.currentTarget.checkValidity()===!1&&(d.preDefault(),d.stopPropagation()),s(!0),{...a},x(!0);try{const N=await _.post("/api/v1/driver",a);N.status===201&&(L(N.data.message),n(N.data.data),setTimeout(()=>{m(t),s(!1),y(!1),x(!1)},2e3))}catch(N){r(N.response.data.message),h(N.response.data.message),setTimeout(()=>{r(null)},3e3)}finally{x(!1)}};return e.jsx(e.Fragment,{children:i?e.jsx(V,{color:"primary",size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsxs(A,{color:"primary",disabled:i,variant:"outline",onClick:()=>y(!0),children:[i?e.jsx(V,{color:"primary",size:"sm"}):e.jsx(k,{icon:R})," ","Add Driver"]}),e.jsxs(z,{visible:b,onClose:()=>y(!1),children:[e.jsx(P,{children:e.jsx(U,{children:"Add Driver"})}),v&&e.jsx(I,{color:"danger",className:"m-3",children:v}),u&&e.jsx(I,{color:"success",className:"m-3",children:u}),e.jsx(O,{children:e.jsxs($,{noValidate:!0,validated:C,children:[e.jsx(p,{className:"mb-3",floatingLabel:"ID Number",placeholder:"ID Number",type:"text",id:"idNum",label:"ID Number",value:a.idNum,disabled:!0}),e.jsx(p,{className:"mb-3",floatingLabel:"Name",placeholder:"Name",type:"text",id:"driverName",label:"Name",autoComplete:"off",required:!0,value:a.driverName,onChange:c}),e.jsx(p,{className:"mb-3",floatingLabel:"email",placeholder:"Model",type:"email",id:"email",label:"Email",autoComplete:"off",required:!0,value:a.email,onChange:c}),e.jsx(p,{type:"phone",className:"mb-3",floatingLabel:"phone",placeholder:"phone",id:"phone",label:"Phone",title:"Please enter a valid phone number",autoComplete:"off",value:a.phone,required:!0,onChange:c}),e.jsx(p,{className:"mb-3",floatingLabel:"Address",placeholder:"Address",type:"text",id:"address",label:"Address",autoComplete:"off",required:!0,value:a.address,onChange:c}),e.jsx(p,{className:"mb-3",floatingLabel:"License Number",placeholder:"License Number",type:"text",id:"licenseNumber",label:"License Number",autoComplete:"off",required:!0,value:a.licenseNumber,onChange:c}),e.jsxs(q,{className:"mb-3",floatingLabel:"Vehicle",label:"Vehicle",id:"assignedVehicle",required:!0,value:a.assignedVehicle,onChange:c,children:[e.jsx("option",{value:null,children:"Select Vehicle"}),D.map(d=>e.jsxs("option",{value:d._id,children:[d.brand," /",d.model," /",d.regisNumber]},d._id))]})]})}),e.jsxs(B,{children:[e.jsx(A,{color:"secondary",variant:"outline",disabled:i,onClick:()=>{y(!1),m(t),r(null),s(!1)},children:i?e.jsx(V,{color:"secondary",size:"sm"}):"Cancel"}),e.jsx(A,{color:"primary",variant:"outline",onClick:M,disabled:i,children:i?e.jsx(V,{color:"primary",size:"sm"}):"Add Driver"})]})]})]})})},ne=({driver:n,onUpdateDriver:L})=>{const{showSuccess:h,showError:i}=F(),[x,u]=l.useState(!1),[j,v]=l.useState(null),[r,b]=l.useState([]),[y,D]=l.useState(!1),[E,C]=l.useState(null),[s,g]=l.useState(!1),t={idNum:n.idNum,driverName:n.driverName,email:n.email,phone:n.phone,address:n.address,licenseNumber:n.licenseNumber,status:n.status,assignedVehicle:n.assignedVehicle},[a,m]=l.useState(t),c=o=>{const{id:N,value:S}=o.target;m(G=>({...G,[N]:S}))},f=async()=>{try{const o=await _.get("/api/v1/vehicle/available");b(o.data.data)}catch(o){i(o.message)}};l.useEffect(()=>{f()},[]);const M=async o=>{o.preventDefault(),o.currentTarget.checkValidity()===!1&&o.stopPropagation(),D(!0),g(!0),{...a};try{const S=await _.put(`/api/v1/driver/${n._id}`,a);S.data.success&&(h(S.data.message),L(S.data.data),setTimeout(()=>{u(!1),m(t)},2e3))}catch(S){C(S.response.data.message),i(S.response.data.message),setTimeout(()=>{C(null)},2e3)}finally{g(!1)}},d=[{value:"available",label:"Available"},{value:"on_duty",label:"On Duty"},{value:"off_duty",label:"Off Duty"}];return e.jsxs(e.Fragment,{children:[e.jsx(A,{color:"primary",variant:"outline",disabled:s,onClick:()=>u(!0),className:"me-2",children:s?e.jsx(V,{size:"sm"}):e.jsx(k,{icon:Q})}),e.jsxs(z,{visible:x,onClose:()=>u(!1),children:[e.jsx(P,{children:e.jsx(U,{children:"Update Driver"})}),E&&e.jsx(I,{color:"danger",className:"m-3",children:E}),j&&e.jsx(I,{color:"success",className:"m-3",children:j}),e.jsx(O,{children:e.jsx($,{noValidate:!0,validated:y,children:e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"mb-3",floatingLabel:"ID Number",placeholder:"ID Number",type:"text",id:"idNum",label:"ID Number",value:a.idNum,disabled:!0}),e.jsx(p,{className:"mb-3",floatingLabel:"Name",placeholder:"Name",type:"text",id:"driverName",label:"Name",autoComplete:"off",required:!0,value:a.driverName,onChange:c}),e.jsx(p,{className:"mb-3",floatingLabel:"email",placeholder:"Model",type:"email",id:"email",label:"Email",autoComplete:"off",required:!0,value:a.email,onChange:c}),e.jsx(p,{type:"phone",className:"mb-3",floatingLabel:"phone",placeholder:"phone",id:"phone",label:"Phone",title:"Please enter a valid phone number",autoComplete:"off",value:a.phone,required:!0,onChange:c}),e.jsx(p,{className:"mb-3",floatingLabel:"Address",placeholder:"Address",type:"text",id:"address",label:"Address",autoComplete:"off",required:!0,value:a.address,onChange:c}),e.jsx(p,{className:"mb-3",floatingLabel:"License Number",placeholder:"License Number",type:"text",id:"licenseNumber",label:"License Number",autoComplete:"off",required:!0,value:a.licenseNumber,onChange:c}),e.jsx(q,{className:"mb-3",floatingLabel:"Status",placeholder:"Status",id:"status",label:"Status",autoComplete:"off",required:!0,value:a.status||"",onChange:c,children:d.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))}),a.status==="available"||a.status==="on_duty"&&e.jsxs(q,{className:"mb-3",floatingLabel:"Assigned Vehicle",label:"Assigned Vehicle",id:"assignedVehicle",value:a.assignedVehicle||"",onChange:c,children:[e.jsx("option",{value:"",children:"Select a vehicle"}),r.map(o=>e.jsxs("option",{value:o._id,children:[o.brand," / ",o.model," / ",o.regisNumber]},o._id))]})]})})}),e.jsxs(B,{children:[e.jsx(A,{color:"secondary",variant:"outline",disabled:s,onClick:()=>{u(!1),C(null),D(!1)},children:s?e.jsx(V,{color:"secondary",size:"sm"}):"Close"}),e.jsx(A,{color:"success",variant:"outline",disabled:s,onClick:M,children:s?e.jsx(V,{color:"success",size:"sm"}):"Save Changes"})]})]})]})},oe=({driver:n,onDeleteDriver:L})=>{const[h,i]=l.useState(!1),[x,u]=l.useState(null),{showError:j,showSuccess:v}=F(),r=async()=>{i(!0);try{const b=await _.delete(`/api/v1/driver/${n._id}`);b.status===200&&(v(b.data.message),L(n._id),i(!1),u(null))}catch(b){u(b),j(b.response.data.message)}finally{i(!1)}};return e.jsx(e.Fragment,{children:e.jsx(A,{color:"danger",variant:"outline",onClick:r,className:"me-2",disabled:h,children:h?e.jsx(V,{size:"sm"}):e.jsx(k,{icon:J})})})},ie=({driver:n,loading:L,onDeleteDriver:h,onUpdateDriver:i})=>{const x=H(),u=["manager","admin"],[j,v]=l.useState(null),[r,b]=l.useState(""),[y,D]=l.useState([]);l.useEffect(()=>{(async()=>{if(r==="")D(n);else{const g=n.filter(t=>t.driverName.toLowerCase().includes(r.toLowerCase())||t.idNum.toString().includes(r)||t.email.toLowerCase().includes(r.toLowerCase())||t.phone.toString().includes(r)||t.address.toLowerCase().includes(r.toLowerCase())||t.licenseNumber.toString().includes(r)||C.find(a=>a.value===t.status).label.toLowerCase().includes(r.toLowerCase()));D(g),g.length===0?v("No results found"):v(null)}})()},[r,n]);const E=s=>{switch(s){case"available":return"green";case"on_duty":return"red";case"off_duty":return"orange";default:return"black"}},C=[{label:"Available",value:"available"},{label:"On Duty",value:"on_duty"},{label:"Off Duty",value:"off_duty"}];return n.length===0?e.jsx(I,{color:"danger",className:"justfy-content-center",children:"No drivers found"}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"mt-3",children:e.jsxs(X,{className:"w-50 mb-3 ",children:[e.jsx(p,{type:"text",placeholder:"Search Drivers...",id:"search",value:r,onChange:s=>b(s.target.value),className:"w-50 me-2 "}),e.jsx(Y,{children:e.jsx(k,{icon:K})})]})}),e.jsx(Z,{className:"m-2",children:y.map(s=>e.jsxs(ee,{children:[e.jsx(se,{children:e.jsxs("p",{className:"w-100 m-1",children:["Driver Name: ",e.jsxs("strong",{children:[" ",s.driverName," "]}),e.jsx(k,{icon:W,color:E(s.status),className:"m-2 float-end"}),e.jsxs("small",{className:"m-2 float-end",children:[" ",C.find(g=>g.value===s.status).label]})]})}),e.jsxs(ae,{children:[e.jsxs(w,{children:["ID: ",s.idNum]}),e.jsxs(w,{children:["Email: ",s.email]}),e.jsxs(w,{children:["Phone: ",s.phone]}),e.jsxs(w,{children:["Address: ",s.address]}),e.jsxs(w,{children:["License Number: ",s.licenseNumber]}),e.jsxs(w,{children:["Vehicle:"," ",s.assignedVehicle?`${s.assignedVehicle.regisNumber} - ${s.assignedVehicle.brand} ${s.assignedVehicle.model}`:"No vehicle assigned"]}),e.jsxs(w,{children:["Status: ",C.find(g=>g.value===s.status).label]}),e.jsxs(T,{className:"d-flex justify-content-end mt-3",children:[L?e.jsx(V,{color:"primary",size:"sm"}):e.jsx(ne,{driver:s,onUpdateDriver:i}),u.includes(x)&&e.jsx(oe,{driver:s,onDeleteDriver:h})]})]})]},s._id))}),j&&e.jsx(I,{color:"danger",className:"text-center justify-content-center",children:j})]})},Se=()=>{const{showError:n}=F(),[L,h]=l.useState([]),[i,x]=l.useState(!1),[u,j]=l.useState(null),[v,r]=l.useState(!1),[b,y]=l.useState(null),D=async()=>{var t,a,m,c;x(!0);try{const f=await _.get("/api/v1/driver");f.status===200?(h(f.data.data),x(!1)):(j(f.data.message),n(f.data.message))}catch(f){j(((a=(t=f.response)==null?void 0:t.data)==null?void 0:a.message)||f.message),n(((c=(m=f.response)==null?void 0:m.data)==null?void 0:c.message)||f.message)}finally{x(!1)}};l.useEffect(()=>{D()},[]);const E=t=>{h(a=>[...a,t]),D()},C=t=>{y(t),r(!0)},s=t=>{h(a=>a.filter(m=>m._id!==t))},g=t=>{h(a=>a.map(m=>m._id===t._id?t:m))};return e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"text-center",children:"Driver Management"}),e.jsx(T,{className:"m-3",children:e.jsx(re,{onAddDriver:E})}),e.jsxs(le,{children:[e.jsx(w,{children:"Drivers list"}),e.jsx(te,{className:"md-3",children:e.jsx(ie,{driver:L,loading:i,error:u,onDeleteDriver:C,onUpdateDriver:g})})]}),e.jsxs(z,{visible:v,onClose:()=>r(!1),alignment:"center",children:[e.jsx(P,{closeButton:!0,children:"Confirm Delete"}),e.jsx(O,{children:"Are you sure you want to delete this driver? This action cannot be undone."}),e.jsxs(B,{children:[e.jsx(A,{color:"secondary",onClick:()=>r(!1),children:"Cancel"}),e.jsx(A,{color:"danger",onClick:s,children:"Delete"})]})]})]})};export{Se as default};
