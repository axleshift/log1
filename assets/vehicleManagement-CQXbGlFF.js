import{r as x,_ as z,R as V,a as F,c as O,P as C,j as e,L as P}from"./index-DegyTHJB.js";import{C as v,a as G}from"./index.esm-BJ5D7Ll7.js";import{F as N,f as U,a as J,C as I,b as k,c as B,d as _,e as M,g as H,h as Q}from"./index-D6lz90AG.js";import{a as b}from"./CButton-BbZPCYw4.js";import{C as q}from"./CForm-Dwdouy1D.js";import{b as c,C as $,a as X}from"./CInputGroupText-CbCuM1Pv.js";import{C as D}from"./CFormSelect-ByfXb323.js";import{C as L}from"./CCol-DdnTt7MC.js";import"./CCloseButton-Bdh2YDy4.js";import"./DefaultLayout-BgU6WM7d.js";import"./axios-CCb-kr4I.js";import"./cil-user-Ddrdy7PS.js";var S=x.forwardRef(function(s,a){var o,r=s.children,i=s.className,m=s.size,g=s.vertical,d=z(s,["children","className","size","vertical"]);return V.createElement("div",F({className:O(g?"btn-group-vertical":"btn-group",(o={},o["btn-group-".concat(m)]=m,o),i)},d,{ref:a}),r)});S.propTypes={children:C.node,className:C.string,size:C.oneOf(["sm","lg"]),vertical:C.bool};S.displayName="CButtonGroup";var K=["512 512","<polygon fill='var(--ci-primary-color, currentColor)' points='440 240 272 240 272 72 240 72 240 240 72 240 72 272 240 272 240 440 272 440 272 272 440 272 440 240' class='ci-primary'/>"];const T=s=>{let a;const o=new Set,r=(l,p)=>{const h=typeof l=="function"?l(a):l;if(!Object.is(h,a)){const j=a;a=p??(typeof h!="object"||h===null)?h:Object.assign({},a,h),o.forEach(f=>f(a,j))}},i=()=>a,d={setState:r,getState:i,getInitialState:()=>n,subscribe:l=>(o.add(l),()=>o.delete(l))},n=a=s(r,i,d);return d},W=s=>s?T(s):T,Z=s=>s;function ee(s,a=Z){const o=V.useSyncExternalStore(s.subscribe,()=>a(s.getState()),()=>a(s.getInitialState()));return V.useDebugValue(o),o}const E=s=>{const a=W(s),o=r=>ee(a,r);return Object.assign(o,a),o},ae=s=>s?E(s):E,w=ae(s=>({vehicle:[],setVehicle:a=>s({vehicle:a}),createVehicle:async a=>{if(!a.idNum||!a.brand||!a.model||!a.year||!a.regisNumber||!a.type||!a.capacity)return{success:!1,message:"All fields are required"};const r=await(await fetch("/api/v1/vehicle",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).json();return s(i=>({vehicle:[...i.vehicle,r.data]})),{success:!0,message:"Vehicle created successfully"}},fetchVehicles:async()=>{const o=await(await fetch("/api/v1/vehicle")).json();s({vehicle:o.data})},deleteVehicle:async a=>{const r=await(await fetch(`/api/v1/vehicle/${a}`,{method:"DELETE"})).json();return r.success?(s(i=>({vehicle:i.vehicle.filter(m=>m._id!==a)})),{success:!0,message:r.message}):{success:!1,message:r.message}},updateVehicle:async(a,o)=>{const i=await(await fetch(`/api/v1/vehicle/${a}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})).json();return i.success?(s(m=>({vehicle:m.vehicle.map(g=>g._id===a?i.data:g)})),{success:!0,message:i.message}):{success:!1,message:i.message}}})),te=({vehicle:s})=>{const a=JSON.parse(sessionStorage.getItem("user")),o=["manager","admin"],{deleteVehicle:r,updateVehicle:i}=w(),m=async t=>{const{success:y,message:u}=await r(t);alert(u)},[g,d]=x.useState(!1),[n,l]=x.useState(s),p=async(t,y)=>{const{success:u,message:R}=await i(y._id,y);u?d(!1):alert(R)},h=[{key:"idNum",label:"ID",_props:{scope:"col",color:"light"}},{key:"brand",label:"Brand",_props:{scope:"col",color:"light"}},{key:"model",label:"Model",_props:{scope:"col",color:"light"}},{key:"year",label:"Year",_props:{scope:"col",color:"light"}},{key:"regisNumber",label:"Plate Number",_props:{scope:"col",color:"light"}},{key:"type",label:"Type",_props:{scope:"col",color:"light"}},{key:"capacity",label:"Capacity",_props:{scope:"col",color:"light"}},{key:"action",label:"Action",_props:{scope:"col",color:"light"}}],j=s.map(t=>({_id:t._id,idNum:t.idNum,brand:t.brand,model:t.model,year:t.year,regisNumber:t.regisNumber,type:t.type,capacity:t.capacity,action:e.jsxs(S,{children:[e.jsx(b,{color:"primary",onClick:()=>{l(t),d(!0)},children:e.jsx(N,{icon:U})}),o.includes(a.data.user.role)&&e.jsx(b,{color:"danger",onClick:()=>m(t._id),children:e.jsx(N,{icon:J})})]})})),[f,A]=x.useState(""),Y=j.filter(t=>f.toLowerCase().split(" ").every(u=>t.idNum.toLowerCase().includes(u)||t.brand.toLowerCase().includes(u)||t.model.toLowerCase().includes(u)||t.year.toString().includes(u)||t.regisNumber.toLowerCase().includes(u)||t.type.toLowerCase().includes(u)||t.capacity.toString().includes(u)));return e.jsxs(v,{children:[e.jsxs(I,{visible:g,onClose:()=>d(!1),"aria-labelledby":"LiveDemoExampleLabel",children:[e.jsx(k,{children:e.jsx(B,{id:"LiveDemoExampleLabel",children:"Update Vehicle"})}),e.jsx(_,{children:e.jsxs(q,{children:[e.jsx(c,{name:"idNum",floatingLabel:"Vehicle ID",className:"mb-3",type:"text",placeholder:"Enter ID",required:!0,value:n.idNum,style:{width:"100%",marginBottom:"10px"},disabled:!0,onChange:t=>{l({...n,idNum:t.target.value})}}),e.jsx(c,{name:"brand",floatingLabel:"Vehicle Brand",floatingClassName:"mb-3",type:"text",placeholder:"Enter brand",text:"Ex. Toyota/Nissan/Mitsubishi",required:!0,value:n.brand,style:{width:"100%",marginTop:"10px"},onChange:t=>{l({...n,brand:t.target.value})}}),e.jsx(c,{name:"model",floatingLabel:"Vehicle Model",floatingClassName:"mb-3",type:"text",placeholder:"Enter model",required:!0,value:n.model,text:"Ex. L-300/altis/avanza",style:{width:"100%",marginBottom:"10px"},onChange:t=>{l({...n,model:t.target.value})}}),e.jsx(c,{name:"year",floatingLabel:"Vehicle Year",floatingClassName:"mb-3",type:"number",required:!0,value:n.year,min:"1900",placeholder:"Vehicle Year",max:new Date().getFullYear(),style:{width:"100%",marginBottom:"10px"},onChange:t=>{let y=parseInt(t.target.value);y!==1900&&y>new Date().getFullYear()?(l({...n,year:1900}),alert("Invalid year: Must be 1900 or the current year.")):l({...n,year:y})}}),e.jsx(c,{name:"regisNumber",floatingLabel:"Vehicle Registration Number",floatingClassName:"mb-3",type:"text",required:!0,value:n.regisNumber,placeholder:"Enter Registration Number",style:{width:"100%",marginBottom:"10px"},onChange:t=>{l({...n,regisNumber:t.target.value})}}),e.jsx(D,{name:"type",floatingLabel:"Vehicle Type",floatingClassName:"mb-3",required:!0,value:n.type,style:{width:"100%",marginBottom:"10px"},onChange:t=>{l({...n,type:t.target.value})},options:["Select Vehicle Type",{label:"One",value:"1"},{label:"Two",value:"2"},{label:"Three",value:"3"}]}),e.jsx(c,{name:"capacity",floatingLabel:"Vehicle Capacity",floatingClassName:"mb-3",type:"number",label:"Vehicle Capacity",min:1,required:!0,value:n.capacity,placeholder:"Enter Vehicle Capacity",style:{width:"100%",marginBottom:"10px"},onChange:t=>{l({...n,capacity:t.target.value})}})]})}),e.jsxs(M,{children:[e.jsx(b,{color:"secondary",onClick:()=>d(!1),children:"Close"}),e.jsx(b,{type:"submit",color:"primary",onClick:()=>p(s._id,n),children:"Save changes"})]})]}),e.jsx(v,{className:"mb-3",style:{position:"sticky",top:0,zIndex:1,width:"70%"},children:e.jsxs($,{className:"mb-3",children:[e.jsx(X,{children:e.jsx(N,{icon:H})}),e.jsx(c,{type:"text",placeholder:"Search vehicles",value:f,onChange:t=>A(t.target.value)})]})}),e.jsx(v,{style:{height:"500px",overflowX:"hidden",textAlign:"center",overflowY:"scroll"},children:e.jsx(Q,{striped:!0,columns:h,items:Y,tableHeadProps:{style:{textAlign:"center",position:"sticky",top:0,backgroundColor:"#fff",zIndex:1}}})})]})},ge=()=>{const[s,a]=x.useState(!1),o=Math.floor(Math.random()*1e10).toString(),[r,i]=x.useState({idNum:o,brand:"",model:"",year:"",regisNumber:"",type:"",capacity:""}),{createVehicle:m}=w(),g=async()=>{if(n.find(h=>h.regisNumber&&h.regisNumber===r.regisNumber)){alert("Vehicle Registration Number all ready exist");return}const{success:l,message:p}=await m(r);l?(i({idNum:o,brand:"",model:"",year:"",regisNumber:"",type:"",capacity:""}),setToast({visible:!0,title:"Added Succesfull",body:"Success"})):alert(p)},{fetchVehicles:d,vehicle:n}=w();return x.useEffect(()=>{d()},[d]),console.log(n),e.jsxs("div",{children:[e.jsx("h1",{style:{textAlign:"center"},children:"Vehicle Management"}),e.jsx(v,{fluid:!0,children:e.jsxs(L,{children:[e.jsxs(b,{color:"primary",size:"lg",onClick:()=>a(!s),style:{margin:"10px"},children:[e.jsx(G,{icon:K,size:"lg",space:2,style:{marginRight:"5px"}}),"Add"]}),e.jsxs(I,{visible:s,onClose:()=>a(!1),"aria-labelledby":"LiveDemoExampleLabel",children:[e.jsx(k,{children:e.jsx(B,{id:"LiveDemoExampleLabel",children:"Adding Vehicle"})}),e.jsx(_,{children:e.jsxs(q,{children:[e.jsx(c,{floatingLabel:"Vehicle ID",name:"idNum",type:"text",placeholder:"Enter ID",required:!0,style:{width:"100%",marginBottom:"10px"},value:r.idNum,onChange:l=>i({...r,idNum:l.target.value}),disabled:!0}),e.jsx(c,{floatingLabel:"Vehicle Brand",name:"brand",type:"text",placeholder:"Enter brand",text:"Ex. Toyota/Nissan/Mitsubishi",required:!0,style:{width:"100%",marginTop:"10px"},value:r.brand,onChange:l=>i({...r,brand:l.target.value})}),e.jsx(c,{floatingLabel:"Vehicle Model",name:"model",type:"text",placeholder:"Enter model",required:!0,text:"Ex. L-300/altis/avanza",style:{width:"100%",marginBottom:"10px"},value:r.model,onChange:l=>i({...r,model:l.target.value})}),e.jsx(c,{floatingLabel:"Vehicle Year",name:"year",type:"number",required:!0,min:"1900",placeholder:"Vehicle Year",value:r.year,max:new Date().getFullYear(),style:{width:"100%",marginBottom:"10px"},onChange:l=>{let p=parseInt(l.target.value);p!==1900&&p>new Date().getFullYear()?(i({...r,year:1900}),alert("Invalid year: Must be 1900 or the current year.")):i({...r,year:p})}}),e.jsx(c,{floatingLabel:"Vehicle Registration Number",name:"regisNumber",type:"text",required:!0,placeholder:"Enter Registration Number",style:{width:"100%",marginBottom:"10px"},value:r.regisNumber,onChange:l=>i({...r,regisNumber:l.target.value})}),e.jsx(D,{floatingLabel:"Vehicle Type",name:"type",required:!0,style:{width:"100%",marginBottom:"10px"},value:r.type,onChange:l=>i({...r,type:l.target.value}),options:["Select Vehicle Type",{label:"One",value:"1"},{label:"Two",value:"2"},{label:"Three",value:"3"}]}),e.jsx(c,{floatingLabel:"Vehicle Capacity",name:"capacity",type:"number",label:"Vehicle Capacity",min:1,required:!0,placeholder:"Enter Vehicle Capacity",style:{width:"100%",marginBottom:"10px"},value:r.capacity,onChange:l=>i({...r,capacity:l.target.value})})]})}),e.jsxs(M,{children:[e.jsx(b,{color:"secondary",onClick:()=>a(!1),children:"Close"}),e.jsx(b,{type:"submit",color:"primary",onClick:g,children:"Add Vehicle"})]})]})]})}),e.jsx(te,{vehicle:n},n._id),n.length===0&&e.jsx(L,{children:e.jsxs("p",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:["No Vehicles found "," ",e.jsx(P,{color:"primary",onClick:()=>a(!0),children:"Add Vehicle"})]})})]})};export{ge as default};
