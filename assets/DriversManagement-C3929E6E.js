import{r as l,j as e,C as y,x as A,z as $}from"./index-jiNyKwsp.js";import{F as _,i as B,k as G,j as H,l as R,m as Q}from"./index-DFyN7MmU.js";import{a as V}from"./CButton-BYhtaUES.js";import{C as M,a as k,b as z,c as T,d as P}from"./CModalTitle-CoYR5CZO.js";import{a as w,C as O}from"./CForm-DqhKtZxf.js";import{C as b}from"./CFormInput-Aogae6Re.js";import{C as I}from"./CFormSelect-kO3egkmH.js";import{C as q}from"./CContainer-DTmQoVhq.js";import{C as J,a as K}from"./CInputGroupText-vwwZNSfW.js";import{C as W,a as X,b as Y,c as Z}from"./CAccordionHeader-D_yOs315.js";import{C as v}from"./DefaultLayout-Cmm6rABs.js";import{C as ee}from"./CCard-DdcUPz_T.js";import{C as se}from"./CCardBody-DHnVSZdn.js";import"./CCloseButton-BXXgN7mW.js";import"./index.esm-CbrbfJev.js";import"./cil-user-Ddrdy7PS.js";import"./CImage-BSkrlDg4.js";const ae=({onAddDriver:n})=>{const[i,x]=l.useState(!1),[c,N]=l.useState(null),[p,j]=l.useState(null),[g,o]=l.useState(!1),[D,m]=l.useState([]),[d,t]=l.useState(!1),a={idNum:Math.floor(Math.random()*1e6).toString(),driverName:"",email:"",phone:"",address:"",licenseNumber:"",status:"available",assignedVehicle:""},[s,f]=l.useState(a),h=u=>{const{id:r,value:C}=u.target;f(S=>({...S,[r]:C}))},E=async()=>{try{const u=await A.get("/api/v1/vehicle/available");m(u.data.data)}catch(u){console.error("Error fetching vehicles:",u)}};l.useEffect(()=>{E()},[]);const F=async u=>{u.currentTarget.checkValidity()===!1&&(u.preDefault(),u.stopPropagation()),t(!0),{...s},x(!0);try{const C=await A.post("/api/v1/driver",s);C.status===201&&(N("Driver added successfully"),n(C.data.data),setTimeout(()=>{f(a),t(!1),o(!1),x(!1)},2e3))}catch(C){j(C.response.data.message)}finally{x(!1)}};return e.jsx(e.Fragment,{children:i?e.jsx(y,{color:"primary",size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsxs(V,{color:"primary",disabled:i,variant:"outline",onClick:()=>o(!0),children:[i?e.jsx(y,{color:"primary",size:"sm"}):e.jsx(_,{icon:B})," ","Add Driver"]}),e.jsxs(M,{visible:g,onClose:()=>o(!1),children:[e.jsx(k,{children:e.jsx(z,{children:"Add Driver"})}),p&&e.jsx(w,{color:"danger",className:"m-3",children:p}),c&&e.jsx(w,{color:"success",className:"m-3",children:c}),e.jsx(T,{children:e.jsxs(O,{noValidate:!0,validated:d,children:[e.jsx(b,{className:"mb-3",floatingLabel:"ID Number",placeholder:"ID Number",type:"text",id:"idNum",label:"ID Number",value:s.idNum,disabled:!0}),e.jsx(b,{className:"mb-3",floatingLabel:"Name",placeholder:"Name",type:"text",id:"driverName",label:"Name",autoComplete:"off",required:!0,value:s.driverName,onChange:h}),e.jsx(b,{className:"mb-3",floatingLabel:"email",placeholder:"Model",type:"email",id:"email",label:"Email",autoComplete:"off",required:!0,value:s.email,onChange:h}),e.jsx(b,{type:"phone",className:"mb-3",floatingLabel:"phone",placeholder:"phone",id:"phone",label:"Phone",title:"Please enter a valid phone number",autoComplete:"off",value:s.phone,required:!0,onChange:h}),e.jsx(b,{className:"mb-3",floatingLabel:"Address",placeholder:"Address",type:"text",id:"address",label:"Address",autoComplete:"off",required:!0,value:s.address,onChange:h}),e.jsx(b,{className:"mb-3",floatingLabel:"License Number",placeholder:"License Number",type:"text",id:"licenseNumber",label:"License Number",autoComplete:"off",required:!0,value:s.licenseNumber,onChange:h}),e.jsxs(I,{className:"mb-3",floatingLabel:"Vehicle",label:"Vehicle",id:"vehicle",required:!0,value:s.assignedVehicle,onChange:h,children:[e.jsx("option",{value:null,children:"Select Vehicle"}),D.map(u=>e.jsxs("option",{value:u._id,children:[u.brand," /",u.model," /",u.regisNumber]},u._id))]})]})}),e.jsxs(P,{children:[e.jsx(V,{color:"secondary",variant:"outline",disabled:i,onClick:()=>{o(!1),f(a),j(null),t(!1)},children:i?e.jsx(y,{color:"secondary",size:"sm"}):"Cancel"}),e.jsx(V,{color:"primary",variant:"outline",onClick:F,disabled:i,children:i?e.jsx(y,{color:"primary",size:"sm"}):"Add Driver"})]})]})]})})},le=({driver:n,onUpdateDriver:i})=>{const[x,c]=l.useState(!1),[N,p]=l.useState(null),[j,g]=l.useState([]),[o,D]=l.useState(!1),[m,d]=l.useState(null),[t,L]=l.useState(!1),a={idNum:n.idNum,driverName:n.driverName,email:n.email,phone:n.phone,address:n.address,licenseNumber:n.licenseNumber,status:n.status,assignedVehicle:n.assignedVehicle},[s,f]=l.useState(a),h=r=>{const{id:C,value:S}=r.target;f(U=>({...U,[C]:S}))},E=async()=>{try{const r=await A.get("/api/v1/vehicle/available");g(r.data.data)}catch(r){console.error("Error fetching vehicles:",r)}};l.useEffect(()=>{E()},[]);const F=async r=>{r.preventDefault(),r.currentTarget.checkValidity()===!1&&r.stopPropagation(),D(!0),L(!0),{...s};try{const S=await A.put(`/api/v1/driver/${n._id}`,s);S.status===200&&(p("Driver updated successfully"),i(S.data.data),setTimeout(()=>{p(null),c(!1),f(a)},2e3))}catch(S){d(S.response.data.message),setTimeout(()=>{d(null)},2e3)}finally{L(!1)}},u=[{value:"available",label:"Available"},{value:"on_duty",label:"On Duty"},{value:"off_duty",label:"Off Duty"}];return e.jsxs(e.Fragment,{children:[e.jsx(V,{color:"primary",variant:"outline",disabled:t,onClick:()=>c(!0),className:"me-2",children:t?e.jsx(y,{size:"sm"}):e.jsx(_,{icon:G})}),e.jsxs(M,{visible:x,onClose:()=>c(!1),children:[e.jsx(k,{children:e.jsx(z,{children:"Update Driver"})}),m&&e.jsx(w,{color:"danger",className:"m-3",children:m}),N&&e.jsx(w,{color:"success",className:"m-3",children:N}),e.jsx(T,{children:e.jsx(O,{noValidate:!0,validated:o,children:e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"mb-3",floatingLabel:"ID Number",placeholder:"ID Number",type:"text",id:"idNum",label:"ID Number",value:s.idNum,disabled:!0}),e.jsx(b,{className:"mb-3",floatingLabel:"Name",placeholder:"Name",type:"text",id:"driverName",label:"Name",autoComplete:"off",required:!0,value:s.driverName,onChange:h}),e.jsx(b,{className:"mb-3",floatingLabel:"email",placeholder:"Model",type:"email",id:"email",label:"Email",autoComplete:"off",required:!0,value:s.email,onChange:h}),e.jsx(b,{type:"phone",className:"mb-3",floatingLabel:"phone",placeholder:"phone",id:"phone",label:"Phone",title:"Please enter a valid phone number",autoComplete:"off",value:s.phone,required:!0,onChange:h}),e.jsx(b,{className:"mb-3",floatingLabel:"Address",placeholder:"Address",type:"text",id:"address",label:"Address",autoComplete:"off",required:!0,value:s.address,onChange:h}),e.jsx(b,{className:"mb-3",floatingLabel:"License Number",placeholder:"License Number",type:"text",id:"licenseNumber",label:"License Number",autoComplete:"off",required:!0,value:s.licenseNumber,onChange:h}),e.jsx(I,{className:"mb-3",floatingLabel:"Status",placeholder:"Status",id:"status",label:"Status",autoComplete:"off",required:!0,value:s.status,onChange:h,children:u.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))}),s.status==="available"||s.status==="on_duty"&&e.jsx(I,{className:"mb-3",floatingLabel:"Vehicle",label:"Vehicle",id:"vehicle",value:s.assignedVehicle,onChange:h,children:j.map(r=>e.jsxs("option",{value:r._id,children:[r.brand," / ",r.model," / ",r.regisNumber]},r._id))})]})})}),e.jsxs(P,{children:[e.jsx(V,{color:"secondary",variant:"outline",disabled:t,onClick:()=>{c(!1),d(null),D(!1)},children:t?e.jsx(y,{color:"secondary",size:"sm"}):"Close"}),e.jsx(V,{color:"success",variant:"outline",disabled:t,onClick:F,children:t?e.jsx(y,{color:"success",size:"sm"}):"Save Changes"})]})]})]})},te=({driver:n,onDeleteDriver:i})=>{const[x,c]=l.useState(!1),[N,p]=l.useState(null),j=async()=>{c(!0);try{(await A.delete(`/api/v1/driver/${n._id}`)).status===200&&(alert("Driver deleted successfully"),i(n._id),c(!1),p(null))}catch(g){p(g)}finally{c(!1)}};return e.jsx(e.Fragment,{children:e.jsx(V,{color:"danger",variant:"outline",onClick:j,className:"me-2",disabled:x,children:x?e.jsx(y,{size:"sm"}):e.jsx(_,{icon:H})})})},re=({driver:n,loading:i,onDeleteDriver:x,onUpdateDriver:c})=>{const N=$(),p=["manager","admin"],[j,g]=l.useState(null),[o,D]=l.useState(""),[m,d]=l.useState([]);l.useEffect(()=>{(async()=>{if(o==="")d(n);else{const s=n.filter(f=>f.driverName.toLowerCase().includes(o.toLowerCase())||f.idNum.toString().includes(o)||f.email.toLowerCase().includes(o.toLowerCase())||f.phone.toString().includes(o)||f.address.toLowerCase().includes(o.toLowerCase())||f.licenseNumber.toString().includes(o)||L.find(h=>h.value===f.status).label.toLowerCase().includes(o.toLowerCase()));d(s),s.length===0?g("No results found"):g(null)}})()},[o,n]);const t=a=>{switch(a){case"available":return"green";case"on_duty":return"red";case"off_duty":return"orange";default:return"black"}},L=[{label:"Available",value:"available"},{label:"On Duty",value:"on_duty"},{label:"Off Duty",value:"off_duty"}];return n.length===0?e.jsx(w,{color:"danger",className:"justfy-content-center",children:"No drivers found"}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"mt-3",children:e.jsxs(J,{className:"w-50 mb-3 ",children:[e.jsx(b,{type:"text",placeholder:"Search Drivers...",id:"search",value:o,onChange:a=>D(a.target.value),className:"w-50 me-2 "}),e.jsx(K,{children:e.jsx(_,{icon:R})})]})}),e.jsx(W,{className:"m-2",children:m.map(a=>e.jsxs(X,{children:[e.jsx(Y,{children:e.jsxs("p",{className:"w-100 m-1",children:["Driver Name: ",e.jsxs("strong",{children:[" ",a.driverName," "]}),e.jsx(_,{icon:Q,color:t(a.status),className:"m-2 float-end"}),e.jsxs("small",{className:"m-2 float-end",children:[" ",L.find(s=>s.value===a.status).label]})]})}),e.jsxs(Z,{children:[e.jsxs(v,{children:["ID: ",a.idNum]}),e.jsxs(v,{children:["Email: ",a.email]}),e.jsxs(v,{children:["Phone: ",a.phone]}),e.jsxs(v,{children:["Address: ",a.address]}),e.jsxs(v,{children:["License Number: ",a.licenseNumber]}),e.jsxs(v,{children:["Vehicle:"," ",a.assignedVehicle?`${a.assignedVehicle.regisNumber} - ${a.assignedVehicle.brand} ${a.assignedVehicle.model}`:"No vehicle assigned"]}),e.jsxs(v,{children:["Status: ",L.find(s=>s.value===a.status).label]}),e.jsxs(q,{className:"d-flex justify-content-end mt-3",children:[i?e.jsx(y,{color:"primary",size:"sm"}):e.jsx(le,{driver:a,onUpdateDriver:c}),p.includes(N)&&e.jsx(te,{driver:a,onDeleteDriver:x})]})]})]},a._id))}),j&&e.jsx(w,{color:"danger",className:"text-center justify-content-center",children:j})]})},ye=()=>{const[n,i]=l.useState([]),[x,c]=l.useState(!1),[N,p]=l.useState(null),j=async()=>{var m,d;c(!0);try{const t=await A.get("/api/v1/driver");t.status===200?(i(t.data.data),c(!1)):p(t.data.message)}catch(t){p(((d=(m=t.response)==null?void 0:m.data)==null?void 0:d.message)||t.message)}finally{c(!1)}};l.useEffect(()=>{j()},[]);const g=m=>{i(d=>[...d,m])},o=m=>{i(d=>d.filter(t=>t._id!==m))},D=m=>{i(d=>d.map(t=>t._id===m._id?m:t))};return e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"text-center",children:"Driver Management"}),e.jsx(q,{className:"m-3",children:e.jsx(ae,{onAddDriver:g})}),e.jsxs(ee,{children:[e.jsx(v,{children:"Drivers list"}),e.jsx(se,{className:"md-3",children:e.jsx(re,{driver:n,loading:x,error:N,onDeleteDriver:o,onUpdateDriver:D})})]})]})};export{ye as default};
