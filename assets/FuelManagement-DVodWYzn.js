import{A as be,r as o,j as e,k as oe,m as H,B as Ie}from"./index-BeKiQw6a.js";import{F as le,n as Te,e as we,s as ye,t as Ne,a as ve,u as Ee,g as Re,q as Me}from"./index-DIG6Rwhb.js";import{a as E}from"./CButton-CzNR3q56.js";import{C as de,a as ue,b as Pe,c as me,d as pe}from"./CModalTitle-OJLBEPAs.js";import{C as ne}from"./CAlert-C5w5tliL.js";import{C as Le}from"./CForm-CCHDwsFR.js";import{C as w}from"./CInputGroup-DmB5kmto.js";import{C as m,a as ke}from"./CFormInput-ODb4_IM0.js";import{C as fe}from"./CFormSelect-DqlEUSnt.js";import{C as ge}from"./1-0EBiHhkJ.js";import{C as Fe}from"./CFormTextarea-DwjvXPiP.js";import{C as ie}from"./CContainer-CyloyU6_.js";import{C as Qe}from"./CInputGroupText-DWTRPT8x.js";import{C as $e,a as _e,b as De,c as V,d as Oe,e as ee}from"./CTable-CUOd11qw.js";import{c as Ae,d as qe,e as Ue,C as Ge}from"./DefaultLayout-JoM_S2aV.js";import{C as ze,a as xe}from"./CPaginationItem-CxndWfYN.js";import{C as Be}from"./CCard-CewVpMeC.js";import{C as He}from"./CCardBody-Il_6O3qr.js";import"./index.esm-zXrjU7C-.js";import"./cil-user-Ddrdy7PS.js";const We=({onAddFuelog:c})=>{var f,z;const{showSuccess:W,showError:k}=be(),[$,F]=o.useState(!1),[_,te]=o.useState(null),[O,A]=o.useState(!1),[J,p]=o.useState(!1),[ae,D]=o.useState(!1),[q,P]=o.useState(null),[X,U]=o.useState([]),[L,R]=o.useState([]),Y=new Date().toISOString().split("T")[0],M={vehicleId:"",driverId:"",vehicleDetails:{brand:"",model:"",regisNumber:"",fuelType:""},driverDetails:{driverName:""},date:"",receiptNumber:"",fuelQuantity:"",fuelType:"",costPerLiter:"",totalCost:"",currentMileage:"",receiptImage:null,route:{start:"",end:"",distance:""},notes:"",litersPer100km:"",kmPerLiter:"",mpg:""},[l,i]=o.useState(M);o.useEffect(()=>{(async()=>{try{F(!0);const[v,s]=await Promise.all([H.get("api/v1/driver"),H.get("api/v1/vehicle/in-use")]);U(v.data.data),R(s.data.data)}catch{k("Error fetching initial data")}finally{F(!1)}})()},[]);const u=h=>{const{id:v,value:s}=h.target;if(v.includes("route.")){const t=v.split(".")[1];i(a=>{const r={...a,route:{...a.route,[t]:s}};if(r.route.distance&&r.fuelQuantity){const n=parseFloat(r.route.distance),x=parseFloat(r.fuelQuantity);if(n>0&&x>0){const S=x/n*100;r.litersPer100km=S.toFixed(2);const Z=n/x;r.kmPerLiter=Z.toFixed(2);const K=x*.264172,se=n*.621371/K;r.mpg=se.toFixed(2)}}return r})}else if(v==="vehicleId"){const t=L.find(r=>r._id===s),a=X.find(r=>r._id===(t==null?void 0:t.assignedDriver));i(r=>({...r,vehicleId:s,driverId:(t==null?void 0:t.assignedDriver)||"",vehicleDetails:{brand:(t==null?void 0:t.brand)||"",model:(t==null?void 0:t.model)||"",regisNumber:(t==null?void 0:t.regisNumber)||"",fuelType:(t==null?void 0:t.fuelType)||""},driverDetails:{driverName:(a==null?void 0:a.driverName)||""},currentMileage:(t==null?void 0:t.currentMileage)||"",fuelType:(t==null?void 0:t.fuelType)||""}))}else i(v==="fuelQuantity"||v==="costPerLiter"?t=>{const a={...t,[v]:s},r=parseFloat(v==="fuelQuantity"?s:t.fuelQuantity),n=parseFloat(v==="costPerLiter"?s:t.costPerLiter);if(!isNaN(r)&&!isNaN(n)&&(a.totalCost=(r*n).toFixed(2)),v==="fuelQuantity"&&a.route.distance){const x=parseFloat(a.route.distance),S=parseFloat(s);if(x>0&&S>0){const Z=S/x*100;a.litersPer100km=Z.toFixed(2);const K=x/S;a.kmPerLiter=K.toFixed(2);const re=S*.264172,ce=x*.621371/re;a.mpg=ce.toFixed(2)}}return a}:t=>({...t,[v]:s}))},Q=h=>{const v=h.target.files[0];if(v){i(t=>({...t,receiptImage:v}));const s=new FileReader;s.onloadend=()=>{P(s.result)},s.readAsDataURL(v)}},G=async h=>{if(h.preventDefault(),h.stopPropagation(),h.currentTarget.checkValidity()===!1){D(!0);return}F(!0);try{const s=new FormData;s.append("vehicleId",l.vehicleId),s.append("driverId",l.driverId),s.append("vehicleDetails[brand]",l.vehicleDetails.brand),s.append("vehicleDetails[model]",l.vehicleDetails.model),s.append("vehicleDetails[regisNumber]",l.vehicleDetails.regisNumber),s.append("vehicleDetails[fuelType]",l.vehicleDetails.fuelType),s.append("driverDetails[driverName]",l.driverDetails.driverName),s.append("date",l.date),s.append("receiptNumber",l.receiptNumber),s.append("fuelQuantity",l.fuelQuantity),s.append("fuelType",l.fuelType),s.append("costPerLiter",l.costPerLiter),s.append("totalCost",l.totalCost),s.append("currentMileage",l.currentMileage),s.append("notes",l.notes),s.append("litersPer100km",l.litersPer100km),s.append("kmPerLiter",l.kmPerLiter),s.append("mpg",l.mpg),s.append("route[start]",l.route.start),s.append("route[end]",l.route.end),s.append("route[distance]",l.route.distance),l.receiptImage&&s.append("receiptImage",l.receiptImage);const t=await H.post("api/v1/fuelLogs/fuel-logs",s);t.data.success&&(c(t.data.data),W(t.data.message),A(t.data.message),setTimeout(()=>{A(!1),i(M),P(null),p(!1)},2e3))}catch(s){k(s.response.data.message),te(s.response.data.message),setTimeout(()=>{te(null)},5e3)}finally{F(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs(E,{color:"primary",variant:"outline",disabled:$,onClick:()=>p(!0),children:[$?e.jsx(oe,{color:"primary",size:"sm"}):e.jsx(le,{icon:Te}),"Add Fuel Log"]}),e.jsxs(de,{visible:J,onClose:()=>p(!1),size:"lg",children:[e.jsx(ue,{children:e.jsx(Pe,{children:"Add Fuel Log"})}),_&&e.jsx(ne,{color:"danger",className:"m-3",children:_}),O&&e.jsx(ne,{color:"success",className:"m-3",children:O}),e.jsx(me,{children:e.jsxs(Le,{noValidate:!0,validated:ae,children:[e.jsxs(w,{children:[e.jsx(m,{type:"date",className:"mb-3",floatingLabel:"date",label:"Receipt Number",id:"date",max:Y,value:l.date,onChange:u,required:!0}),e.jsxs(fe,{className:"mb-3",floatingLabel:"Vehicle",label:"Vehicle",id:"vehicleId",value:l.vehicleId,onChange:u,required:!0,children:[e.jsx("option",{value:"",children:"Select Vehicle"}),L==null?void 0:L.map(h=>e.jsx("option",{value:h._id,children:`${h.brand} / ${h.model} / ${h.regisNumber}`},h._id))]}),e.jsx(m,{className:"mb-3",floatingLabel:"Driver",label:"Driver",id:"driverId",value:((f=X.find(h=>h._id===l.driverId))==null?void 0:f.driverName)||"",onChange:u,disabled:!0}),e.jsxs(fe,{className:"mb-3",floatingLabel:"Fuel Type",label:"Fuel Type",id:"fuelType",required:!0,value:((z=L.find(h=>h._id===l.vehicleId))==null?void 0:z.fuelType)||"",onChange:u,disabled:!0,children:[e.jsx("option",{value:"",children:"Select Fuel Type"}),e.jsx("option",{value:"Gasoline",children:"Gasoline"}),e.jsx("option",{value:"Diesel",children:"Diesel"})]})]}),e.jsxs(w,{children:[e.jsx(m,{className:"mb-3",type:"text",floatingLabel:"Official Reciept",placeholder:"Official Reciept",id:"receiptNumber",value:l.receiptNumber,onChange:u,required:!0,autoComplete:"off"}),e.jsx(m,{className:"mb-3",type:"number",floatingLabel:"Fuel Quantity",placeholder:"Fuel Quantity",id:"fuelQuantity",value:l.fuelQuantity,onChange:u,required:!0,autoComplete:"off",min:"0",step:"0.01",feedbackInvalid:"Please enter a valid fuel quantity"}),e.jsx(m,{className:"mb-3",type:"number",floatingLabel:"Cost Per Liter",placeholder:"Cost Per Liter",id:"costPerLiter",value:l.costPerLiter,onChange:u,autoComplete:"off",feedbackInvalid:"Please enter a valid cost per liter"}),e.jsx(m,{className:"mb-3",type:"number",floatingLabel:"Total Cost",placeholder:"Total Cost",id:"totalCost",value:l.totalCost,onChange:u,autoComplete:"off",min:"0",step:"0.01",disabled:!0,feedbackInvalid:"Please enter a valid total cost"})]}),e.jsxs(w,{children:[e.jsx(m,{className:"mb-3",type:"number",floatingLabel:"Odometer Reading",placeholder:"Odometer Reading",id:"currentMileage",value:l.currentMileage,onChange:u,autoComplete:"off",feedbackInvalid:"Please enter a valid odometer reading"}),e.jsx(m,{className:"mb-3",type:"text",floatingLabel:"Start Location",placeholder:"Start Location",id:"route.start",value:l.route.start,onChange:u,autoComplete:"off",feedbackInvalid:"Please enter a valid start location"}),e.jsx(m,{className:"mb-3",type:"text",floatingLabel:"End Location",placeholder:"End Location",id:"route.end",value:l.route.end,onChange:u,autoComplete:"off",feedbackInvalid:"Please enter a valid end location"}),e.jsx(m,{className:"mb-3",type:"number",floatingLabel:"Distance/kilometers",placeholder:"Distance",id:"route.distance",value:l.route.distance,onChange:u,autoComplete:"off",feedbackInvalid:"Please enter a valid distance"})]}),e.jsxs(w,{className:"mb-3",children:[e.jsx(m,{type:"text",floatingLabel:"L/100km",placeholder:"Liters per 100km",id:"litersPer100km",value:l.litersPer100km,disabled:!0}),e.jsx(m,{type:"text",floatingLabel:"km/L",placeholder:"Kilometers per Liter",id:"kmPerLiter",value:l.kmPerLiter,disabled:!0}),e.jsx(m,{type:"text",floatingLabel:"MPG",placeholder:"Miles per Gallon",id:"mpg",value:l.mpg,disabled:!0})]}),e.jsx(ke,{htmlFor:"receipt",children:"Picture Of Receipts"}),e.jsx(w,{className:"mb-3",children:e.jsx(m,{type:"file",id:"receipt",accept:"images/*",onChange:Q})}),q&&e.jsx("div",{className:"mb-3",children:e.jsx(ge,{src:q,rounded:!0,align:"center",alt:"Receipts",width:200,height:200})}),e.jsx(Fe,{className:"mb-3",type:"text",floatingLabel:"Notes",placeholder:"Notes",rows:3,id:"notes",value:l.notes,autoCapitalize:"on",autoComplete:"off",onChange:u,feedbackInvalid:"Please enter a valid notes"})]})}),e.jsxs(pe,{children:[e.jsx(E,{color:"secondary",onClick:()=>p(!1),children:"Close"}),e.jsx(E,{color:"primary",onClick:G,disabled:$,children:$?e.jsx(oe,{color:"primary",size:"sm"}):"Add"})]})]})]})},Je=({fuelLogs:c,vehicles:W,drivers:k,loading:$,error:F,onDeleteFuelLog:_,onUpdateFuelLog:te,onViewReceipt:O})=>{const[A,J]=o.useState(""),[p,ae]=o.useState("date"),[D,q]=o.useState("desc"),[P,X]=o.useState(""),[U,L]=o.useState(1),[R]=o.useState(10),[Y,M]=o.useState(null),l=Ie(),i=["manager","admin"],u=t=>{p===t?q(D==="asc"?"desc":"asc"):(ae(t),q("asc"))},Q=(t,a)=>{if(typeof t=="object"&&(t!=null&&t.brand)&&(t!=null&&t.model)&&(t!=null&&t.regisNumber))return`${t.brand} ${t.model} (${t.regisNumber})`;if(!t&&(a!=null&&a.vehicleDetails))return`${a.vehicleDetails.brand} ${a.vehicleDetails.model} (${a.vehicleDetails.regisNumber}) [Deleted]`;const r=W.find(n=>n._id===t);if(r)return`${r.brand} ${r.model} (${r.regisNumber})`;if(r.deleted===!0)return`${r.brand} ${r.model} (${r.regisNumber}) [Deleted]`},G=(t,a)=>{var n;if(typeof t=="object"&&(t!=null&&t.driverName))return t.driverName;if(!t&&((n=a==null?void 0:a.driverDetails)!=null&&n.driverName))return`${a.driverDetails.driverName} [Deleted]`;const r=k.find(x=>x._id===t);if(r!=null&&r.driverName)return r.driverName},f=c.filter(t=>{var Z,K,re,se;if(!t)return!1;const a=Q(t.vehicleId,t).toLowerCase(),r=G(t.driverId,t).toLowerCase(),n=A.toLowerCase(),x=(((Z=t.receiptNumber)==null?void 0:Z.toLowerCase())||"").includes(n)||a.includes(n)||r.includes(n)||(t.date?new Date(t.date).toLocaleDateString().includes(n):!1)||(((K=t.fuelQuantity)==null?void 0:K.toString())||"").includes(n)||(((re=t.totalCost)==null?void 0:re.toString())||"").includes(n),S=P?(typeof t.vehicleId=="object"?(se=t.vehicleId)==null?void 0:se._id:t.vehicleId)===P:!0;return x&&S}).sort((t,a)=>{let r,n;switch(p){case"vehicle":r=Q(t.vehicleId,t),n=Q(a.vehicleId,a);break;case"driver":r=G(t.driverId,t),n=G(a.driverId,a);break;case"date":r=new Date(t.date||"").getTime(),n=new Date(a.date||"").getTime();break;case"fuelQuantity":case"costPerLiter":case"totalCost":r=parseFloat(t[p]||0),n=parseFloat(a[p]||0);break;default:r=t[p]||"",n=a[p]||""}return!r&&!n?0:r?n?D==="asc"?r>n?1:-1:r<n?1:-1:-1:1}),z=U*R,h=z-R,v=f.slice(h,z),s=Math.ceil(f.length/R);return o.useEffect(()=>{L(1)},[A,P]),o.useEffect(()=>{f.length===0?M("No matching records found"):M(null)},[f]),$?e.jsx(oe,{}):F?e.jsx(ne,{color:"danger",children:F}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"col-6 mt-3 mb-3",children:e.jsxs(w,{children:[e.jsx(m,{placeholder:"Search by receipt #, vehicle, driver, date...",value:A,onChange:t=>J(t.target.value),id:"search"}),e.jsx(Qe,{children:e.jsx(le,{icon:we})})]})}),e.jsxs($e,{hover:!0,responsive:!0,className:"text-center",children:[e.jsx(_e,{children:e.jsxs(De,{children:[e.jsxs(V,{onClick:()=>u("date"),style:{cursor:"pointer"},children:["Date"," ",p==="date"&&e.jsx(le,{icon:D==="asc"?ye:Ne})]}),e.jsxs(V,{onClick:()=>u("receiptNumber"),style:{cursor:"pointer"},children:["Receipt #"," ",p==="receiptNumber"&&e.jsx(le,{icon:D==="asc"?ye:Ne})]}),e.jsxs(V,{onClick:()=>u("vehicle"),style:{cursor:"pointer"},children:["Vehicle ",p==="vehicle"&&(D==="asc"?"↑":"↓")]}),e.jsxs(V,{onClick:()=>u("driver"),style:{cursor:"pointer"},children:["Driver ",p==="driver"&&(D==="asc"?"↑":"↓")]}),e.jsxs(V,{onClick:()=>u("fuelQuantity"),style:{cursor:"pointer"},children:["Quantity (L) ",p==="fuelQuantity"&&(D==="asc"?"↑":"↓")]}),e.jsxs(V,{onClick:()=>u("costPerLiter"),style:{cursor:"pointer"},children:["Cost/L ",p==="costPerLiter"&&(D==="asc"?"↑":"↓")]}),e.jsxs(V,{onClick:()=>u("totalCost"),style:{cursor:"pointer"},children:["Total Cost ",p==="totalCost"&&(D==="asc"?"↑":"↓")]}),e.jsx(V,{children:"Fuel Efficiency"}),e.jsx(V,{children:"Actions"})]})}),e.jsx(Oe,{className:"align-middle",children:v.map(t=>e.jsxs(De,{children:[e.jsx(ee,{children:new Date(t.date).toLocaleDateString()}),e.jsx(ee,{children:t.receiptNumber}),e.jsx(ee,{children:t.vehicleId?e.jsxs(e.Fragment,{children:[`${t.vehicleId.brand} ${t.vehicleId.model} (${t.vehicleId.regisNumber})`,t.vehicleId.deleted&&e.jsx(ve,{color:"danger",className:"ms-2",children:"Deleted"})]}):e.jsxs(e.Fragment,{children:[`${t.vehicleDetails.brand} ${t.vehicleDetails.model} (${t.vehicleDetails.regisNumber}) `,e.jsx(ve,{color:"danger",className:"ms-2",children:"Deleted"})]})}),e.jsx(ee,{children:t.driverId?t.driverId.driverName:e.jsxs(e.Fragment,{children:[t.driverDetails.driverName," ",e.jsx(ve,{color:"danger",className:"ms-2",children:"Deleted"})]})}),e.jsx(ee,{children:t.fuelQuantity}),e.jsx(ee,{children:t.costPerLiter}),e.jsx(ee,{children:t.totalCost}),e.jsxs(ee,{children:[e.jsxs(ie,{children:[t.litersPer100km," L/100km"]}),e.jsxs(ie,{children:[t.kmPerLiter," km/L"]}),e.jsxs(ie,{children:[t.mpg," MPG"]})]}),e.jsx(ee,{children:e.jsxs(Ae,{variant:"input-group",children:[e.jsx(qe,{color:"secondary",variant:"outline",children:"Actions"}),e.jsxs(Ue,{children:[e.jsxs(E,{color:"primary",variant:"ghost",className:"m-2",onClick:()=>O(t),children:[e.jsx(le,{icon:Ee})," View Receipt"]}),t.vehicleId.deleted!==!0&&e.jsxs(E,{color:"info",variant:"ghost",className:"m-2",onClick:()=>te(t),children:[e.jsx(le,{icon:Re})," Edit"]}),i.includes(l)&&e.jsxs(E,{color:"danger",variant:"ghost",className:"m-2",onClick:()=>_(t._id),children:[e.jsx(le,{icon:Me})," Delete"]})]})]})})]},t._id))})]}),f.length>0&&e.jsxs(ie,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs(ie,{children:["Showing ",h+1," to"," ",Math.min(z,f.length)," of"," ",f.length," entries"]}),e.jsxs(ze,{className:"mt-3",children:[e.jsx(xe,{disabled:U===1,onClick:()=>L(t=>Math.max(t-1,1)),children:"Previous"}),Array.from({length:s},(t,a)=>a+1).map(t=>e.jsx(xe,{active:t===U,onClick:()=>L(t),children:t},t)),e.jsx(xe,{disabled:U===s,onClick:()=>L(t=>Math.min(t+1,s)),children:"Next"})]})]}),Y&&e.jsx(ne,{color:"info",className:"text-center",children:Y})]})},Xe=({fuelLog:c,visible:W,onClose:k,onUpdate:$,vehicles:F,drivers:_})=>{var v,s,t,a,r,n,x,S,Z,K,re,se,ce;const{showSuccess:te,showError:O}=be(),A="https://backend-log1.axleshift.com/",[J,p]=o.useState(!1),[ae,D]=o.useState(null),[q,P]=o.useState(null),[X,U]=o.useState(null),[L,R]=o.useState([]),[Y,M]=o.useState([]),l=new Date().toISOString().split("T")[0],[i,u]=o.useState({date:new Date(c.date).toISOString().split("T")[0],receiptNumber:c.receiptNumber,vehicleId:((v=c.vehicleId)==null?void 0:v._id)||c.vehicleId,driverId:((s=c.driverId)==null?void 0:s._id)||c.driverId,vehicleDetails:{brand:((t=c.vehicleId)==null?void 0:t.brand)||((a=c.vehicleDetails)==null?void 0:a.brand)||"",model:((r=c.vehicleId)==null?void 0:r.model)||((n=c.vehicleDetails)==null?void 0:n.model)||"",regisNumber:((x=c.vehicleId)==null?void 0:x.regisNumber)||((S=c.vehicleDetails)==null?void 0:S.regisNumber)||"",fuelType:((Z=c.vehicleId)==null?void 0:Z.fuelType)||((K=c.vehicleDetails)==null?void 0:K.fuelType)||""},driverDetails:{driverName:((re=c.driverId)==null?void 0:re.driverName)||((se=c.driverDetails)==null?void 0:se.driverName)||""},fuelQuantity:c.fuelQuantity,costPerLiter:c.costPerLiter,totalCost:c.totalCost,currentMileage:c.currentMileage||"",fuelType:c.fuelType||"",route:{start:c.route.start,end:c.route.end,distance:c.route.distance},litersPer100km:c.litersPer100km,kmPerLiter:c.kmPerLiter,mpg:c.mpg,notes:c.notes||""}),[Q,G]=o.useState(!1);o.useEffect(()=>{c!=null&&c.receiptImage&&P(`${A}uploads/receipts/${c.receiptImage}`)},[c]),o.useEffect(()=>{(async()=>{try{p(!0);const[g,j]=await Promise.all([H.get("api/v1/driver"),H.get("api/v1/vehicle/in-use")]);M(g.data.data),R(j.data.data)}catch{O("Error fetching initial data")}finally{p(!1)}})()},[]);const f=B=>{const{id:g,value:j}=B.target;if(g.includes("route.")){const d=g.split(".")[1];u(C=>{const b={...C,route:{...C.route,[d]:j}};if(b.route.distance&&b.fuelQuantity){const y=parseFloat(b.route.distance),I=parseFloat(b.fuelQuantity);if(y>0&&I>0){const N=I/y*100;b.litersPer100km=N.toFixed(2);const T=y/I;b.kmPerLiter=T.toFixed(2);const he=I*.264172,Ce=y*.621371/he;b.mpg=Ce.toFixed(2)}}return b})}else if(g==="vehicleId"){const d=L.find(b=>b._id===j),C=_.find(b=>b._id===(d==null?void 0:d.assignedDriver));u(b=>({...b,vehicleId:j,driverId:(d==null?void 0:d.assignedDriver)||"",vehicleDetails:{brand:(d==null?void 0:d.brand)||"",model:(d==null?void 0:d.model)||"",regisNumber:(d==null?void 0:d.regisNumber)||"",fuelType:(d==null?void 0:d.fuelType)||""},driverDetails:{driverName:(C==null?void 0:C.driverName)||""},currentMileage:(d==null?void 0:d.currentMileage)||"",fuelType:(d==null?void 0:d.fuelType)||""}))}else u(g==="fuelQuantity"||g==="costPerLiter"?d=>{const C={...d,[g]:j},b=parseFloat(g==="fuelQuantity"?j:d.fuelQuantity),y=parseFloat(g==="costPerLiter"?j:d.costPerLiter);if(!isNaN(b)&&!isNaN(y)&&(C.totalCost=(b*y).toFixed(2)),g==="fuelQuantity"&&C.route.distance){const I=parseFloat(C.route.distance),N=parseFloat(j);if(I>0&&N>0){const T=N/I*100;C.litersPer100km=T.toFixed(2);const he=I/N;C.kmPerLiter=he.toFixed(2);const je=N*.264172,Se=I*.621371/je;C.mpg=Se.toFixed(2)}}return C}:d=>({...d,[g]:j}))},z=B=>{const g=B.target.files[0];if(g){u(d=>({...d,receiptImage:g}));const j=new FileReader;j.onloadend=()=>{P(j.result)},j.readAsDataURL(g)}},h=async B=>{var j,d,C,b;if(B.preventDefault(),!B.currentTarget.checkValidity()){B.stopPropagation(),G(!0);return}p(!0);try{const y=new FormData;Object.keys(i).forEach(N=>{N==="route"?Object.keys(i.route).forEach(T=>{y.append(`route[${T}]`,i.route[T])}):N==="vehicleDetails"?Object.keys(i.vehicleDetails).forEach(T=>{y.append(`vehicleDetails[${T}]`,i.vehicleDetails[T])}):N==="driverDetails"?Object.keys(i.driverDetails).forEach(T=>{y.append(`driverDetails[${T}]`,i.driverDetails[T])}):(N==="receiptImage"&&i[N],y.append(N,i[N]))});const I=await H.put(`api/v1/fuelLogs/fuel-logs/${c._id}`,y);I.data.success&&(te(I.data.message),$({...I.data.data,vehicleId:{_id:i.vehicleId,brand:i.vehicleDetails.brand,model:i.vehicleDetails.model,regisNumber:i.vehicleDetails.regisNumber},driverId:{_id:i.driverId,driverName:i.driverDetails.driverName}}),k())}catch(y){O(((d=(j=y.response)==null?void 0:j.data)==null?void 0:d.message)||"Error updating fuel log"),U(((b=(C=y.response)==null?void 0:C.data)==null?void 0:b.message)||"Error updating fuel log")}finally{p(!1)}};return e.jsxs(de,{visible:W,onClose:k,size:"lg",backdrop:"static",children:[e.jsx(ue,{children:e.jsx(Pe,{children:"Update Fuel Log"})}),X&&e.jsx(ne,{color:"danger",className:"m-3",children:X}),ae&&e.jsx(ne,{color:"success",className:"m-3",children:ae}),e.jsx(me,{children:e.jsxs(Le,{noValidate:!0,validated:Q,children:[e.jsxs(w,{children:[e.jsx(m,{type:"date",className:"mb-3",floatingLabel:"Date",label:"Date",id:"date",max:l,value:i.date,onChange:f,required:!0}),e.jsx(fe,{className:"mb-3",floatingLabel:"Vehicle",label:"Vehicle",id:"vehicleId",value:i.vehicleId||"",onChange:f,required:!0,disabled:!0,children:e.jsx("option",{value:"",children:`${i.vehicleDetails.brand} / ${i.vehicleDetails.model} / ${i.vehicleDetails.regisNumber} `})})]}),e.jsxs(w,{children:[e.jsx(m,{className:"mb-3",type:"text",floatingLabel:"Driver Name",placeholder:"Driver Name",id:"driverName",value:((ce=_.find(B=>B._id===i.driverId))==null?void 0:ce.driverName)||`${i.driverDetails.driverName} [DELETED]`,onChange:f,disabled:!0}),e.jsxs(fe,{className:"mb-3",floatingLabel:"Fuel Type",label:"Fuel Type",id:"fuelType",required:!0,value:i.fuelType||"",onChange:f,disabled:!0,children:[e.jsx("option",{value:"",children:"Select Fuel Type"}),e.jsx("option",{value:"Gasoline",children:"Gasoline"}),e.jsx("option",{value:"Diesel",children:"Diesel"})]})]}),e.jsxs(w,{children:[e.jsx(m,{className:"mb-3",type:"text",floatingLabel:"Official Receipt",placeholder:"Official Receipt",id:"receiptNumber",value:i.receiptNumber,onChange:f,required:!0,autoComplete:"off"}),e.jsx(m,{className:"mb-3",type:"number",floatingLabel:"Fuel Quantity",placeholder:"Fuel Quantity",id:"fuelQuantity",value:i.fuelQuantity,onChange:f,required:!0,autoComplete:"off",min:"0",step:"0.01",feedbackInvalid:"Please enter a valid fuel quantity"}),e.jsx(m,{className:"mb-3",type:"number",floatingLabel:"Cost Per Liter",placeholder:"Cost Per Liter",id:"costPerLiter",value:i.costPerLiter,onChange:f,autoComplete:"off",feedbackInvalid:"Please enter a valid cost per liter"}),e.jsx(m,{className:"mb-3",type:"number",floatingLabel:"Total Cost",placeholder:"Total Cost",id:"totalCost",value:i.totalCost,onChange:f,autoComplete:"off",min:"0",step:"0.01",disabled:!0,feedbackInvalid:"Please enter a valid total cost"})]}),e.jsxs(w,{children:[e.jsx(m,{className:"mb-3",type:"number",floatingLabel:"Odometer Reading",placeholder:"Odometer Reading",id:"currentMileage",value:i.currentMileage,onChange:f,autoComplete:"off",feedbackInvalid:"Please enter a valid odometer reading"}),e.jsx(m,{className:"mb-3",type:"text",floatingLabel:"Start Location",placeholder:"Start Location",id:"route.start",value:i.route.start,onChange:f,autoComplete:"off",feedbackInvalid:"Please enter a valid start location"}),e.jsx(m,{className:"mb-3",type:"text",floatingLabel:"End Location",placeholder:"End Location",id:"route.end",value:i.route.end,onChange:f,autoComplete:"off",feedbackInvalid:"Please enter a valid end location"}),e.jsx(m,{className:"mb-3",type:"number",floatingLabel:"Distance/kilometers",placeholder:"Distance",id:"route.distance",value:i.route.distance,onChange:f,autoComplete:"off",min:"0",step:"0.01",feedbackInvalid:"Please enter a valid distance"})]}),e.jsxs(w,{className:"mb-3",children:[e.jsx(m,{type:"text",floatingLabel:"L/100km",placeholder:"Liters per 100km",id:"litersPer100km",value:i.litersPer100km,disabled:!0}),e.jsx(m,{type:"text",floatingLabel:"km/L",placeholder:"Kilometers per Liter",id:"kmPerLiter",value:i.kmPerLiter,disabled:!0}),e.jsx(m,{type:"text",floatingLabel:"MPG",placeholder:"Miles per Gallon",id:"mpg",value:i.mpg,disabled:!0})]}),e.jsx(ke,{htmlFor:"receipt",children:"Picture Of Receipts"}),e.jsx(w,{className:"mb-3",children:e.jsx(m,{type:"file",id:"receipt",accept:"images/*",onChange:z})}),q&&e.jsx("div",{className:"mb-3",children:e.jsx(ge,{src:q,rounded:!0,align:"center",alt:"Receipts",width:200,height:200})}),e.jsx(Fe,{className:"mb-3",type:"text",floatingLabel:"Notes",placeholder:"Notes",rows:3,id:"notes",value:i.notes,autoCapitalize:"on",autoComplete:"off",onChange:f,feedbackInvalid:"Please enter a valid notes"})]})}),e.jsxs(pe,{children:[e.jsx(E,{color:"secondary",onClick:k,children:"Close"}),e.jsx(E,{color:"primary",onClick:h,disabled:J,children:J?e.jsx(oe,{color:"primary",size:"sm"}):"Update"})]})]})},vt=()=>{const c="https://backend-log1.axleshift.com/",{showSuccess:W,showError:k}=be(),[$,F]=o.useState([]),[_,te]=o.useState([]),[O,A]=o.useState([]),[J,p]=o.useState(!1),[ae,D]=o.useState(null),[q,P]=o.useState(!1),[X,U]=o.useState(null),[L,R]=o.useState(!1),[Y,M]=o.useState(null),[l,i]=o.useState(!1),[u,Q]=o.useState(null),G=async()=>{var a,r;p(!0);try{const[n,x,S]=await Promise.all([H.get("api/v1/fuelLogs/fuel-logs"),H.get("api/v1/vehicle/in-use"),H.get("api/v1/driver")]);F(n.data.data),te(x.data.data),A(S.data.data),W("Data fetched successfully")}catch(n){k(((r=(a=n.response)==null?void 0:a.data)==null?void 0:r.message)||"Error fetching data"),D(n.message)}finally{p(!1)}},f=a=>{U(a),P(!0)},z=async()=>{var a,r;try{await H.delete(`api/v1/fuelLogs/fuel-logs/${X}`),F(n=>n.filter(x=>x._id!==X)),W("Fuel log deleted successfully"),P(!1)}catch(n){k(((r=(a=n.response)==null?void 0:a.data)==null?void 0:r.message)||"Error deleting fuel log")}},h=a=>{Q(a),i(!0)},v=a=>{F(r=>r.map(n=>n._id===a._id?a:n)),i(!1),Q(null)},s=a=>{if(a.receiptImage){const r=`${c}uploads/receipts/${a.receiptImage}`;M(r),R(!0),W("Receipt image loaded successfully")}else k("No receipt image available")};if(o.useEffect(()=>{G()},[]),J)return e.jsx(oe,{color:"primary",size:"sm",children:"Loading..."});const t=a=>{F(r=>[...r,a]),G()};return e.jsx(e.Fragment,{children:e.jsxs(ie,{children:[e.jsx(Ge,{children:"Fuel Management"}),e.jsx(Be,{children:e.jsxs(He,{children:[e.jsx(ie,{className:"mb-3",children:e.jsx(We,{onAddFuelog:t})}),e.jsx(Je,{fuelLogs:$,vehicles:_,drivers:O,loading:J,error:ae,onDeleteFuelLog:f,onUpdateFuelLog:h,onViewReceipt:s})]})}),l&&e.jsx(Xe,{fuelLog:u,visible:l,onClose:()=>{i(!1),Q(null)},onUpdate:v,vehicles:_,drivers:O}),e.jsxs(de,{visible:q,onClose:()=>P(!1),alignment:"center",children:[e.jsx(ue,{closeButton:!0,children:"Confirm Delete"}),e.jsx(me,{children:"Are you sure you want to delete this fuel log? This action cannot be undone."}),e.jsxs(pe,{children:[e.jsx(E,{color:"secondary",variant:"outline",onClick:()=>P(!1),children:"Cancel"}),e.jsx(E,{color:"danger",variant:"outline",onClick:z,children:"Delete"})]})]}),e.jsxs(de,{visible:L,onClose:()=>{R(!1),M(null)},size:"lg",alignment:"center",children:[e.jsx(ue,{closeButton:!0,children:"Receipt Image"}),e.jsx(me,{className:"text-center",children:Y&&e.jsx(ge,{src:Y,alt:"Receipt",style:{maxWidth:"100%",maxHeight:"70vh",objectFit:"contain"},onError:a=>{k("Error loading image"),a.target.src="placeholder-image-url.jpg"}})}),e.jsxs(pe,{children:[e.jsx(E,{color:"secondary",variant:"outline",onClick:()=>{R(!1),M(null)},children:"Close"}),e.jsx("a",{href:Y,target:"_blank",rel:"noopener noreferrer",children:e.jsx(E,{color:"primary",variant:"outline",children:"Open in New Tab"})})]})]})]})})};export{vt as default};
