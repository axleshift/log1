import{r as l,j as e,C}from"./index-BGH5WKgn.js";import{a as w}from"./index-DW_MHI2K.js";import{F as _,f as O,b as $,a as B,c as G,d as H,C as N}from"./DefaultLayout-D-YVYAE7.js";import{a as L}from"./CButton-Bwssm7-p.js";import{C as F,a as q,b as M,c as k,d as T}from"./CModalTitle-D48pPIQc.js";import{C as S}from"./CAlert-8_0YzkvJ.js";import{C as z}from"./CForm-BZRjToy7.js";import{C as p}from"./CFormInput-BE5aKP1g.js";import{C as E}from"./CFormSelect-DfnBAduD.js";import{C as R}from"./index.esm-CQ0Ql4Ln.js";import{C as Q,a as J}from"./CInputGroupText-DTBNZhpZ.js";import{C as K,a as W,b as X,c as Y}from"./CAccordionHeader-ByNUPfl8.js";import{C as Z}from"./CCard--Vw0nMq9.js";import{C as ee}from"./CCardBody-DbRd0EZb.js";import"./CCloseButton-C08nsniV.js";import"./cil-user-Ddrdy7PS.js";const ae=({onAddDriver:n})=>{const v=w.create({baseURL:"http://localhost:5057"}),[i,b]=l.useState(!1),[h,y]=l.useState(null),[x,g]=l.useState(null),[c,d]=l.useState(!1),[m,o]=l.useState([]),[A,D]=l.useState(!1),f={idNum:Math.floor(Math.random()*1e6).toString(),driverName:"",email:"",phone:"",address:"",licenseNumber:"",status:"available",assignedVehicle:""},[a,u]=l.useState(f),U=async()=>{try{const t=await v.get("/api/v1/vehicle/available");o(t.data.data)}catch(t){console.error("Error fetching vehicles:",t)}};l.useEffect(()=>{U()},[]);const P=async t=>{t.currentTarget.checkValidity()===!1&&(t.preDefault(),t.stopPropagation()),D(!0),{...a},b(!0);try{const V=await v.post("/api/v1/driver",a);V.status===201&&(y("Driver added successfully"),n(V.data.data),setTimeout(()=>{u(f),D(!1),d(!1),b(!1)},2e3))}catch(V){g(V.response.data.message)}finally{b(!1)}};return e.jsx(e.Fragment,{children:i?e.jsx(C,{color:"primary",size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsxs(L,{color:"primary",disabled:i,variant:"outline",onClick:()=>d(!0),children:[i?e.jsx(C,{color:"primary",size:"sm"}):e.jsx(_,{icon:O})," ","Add Driver"]}),e.jsxs(F,{visible:c,onClose:()=>d(!1),children:[e.jsx(q,{children:e.jsx(M,{children:"Add Driver"})}),x&&e.jsx(S,{color:"danger",className:"m-3",children:x}),h&&e.jsx(S,{color:"success",className:"m-3",children:h}),e.jsx(k,{children:e.jsxs(z,{noValidate:!0,validated:A,children:[e.jsx(p,{className:"mb-3",floatingLabel:"ID Number",placeholder:"ID Number",type:"text",id:"idNum",label:"ID Number",value:a.idNum,disabled:!0}),e.jsx(p,{className:"mb-3",floatingLabel:"Name",placeholder:"Name",type:"text",id:"Name",label:"Name",autoComplete:"off",required:!0,value:a.driverName,onChange:t=>u({...a,driverName:t.target.value})}),e.jsx(p,{className:"mb-3",floatingLabel:"email",placeholder:"Model",type:"email",id:"email",label:"Email",autoComplete:"off",required:!0,value:a.email,onChange:t=>u({...a,email:t.target.value})}),e.jsx(p,{type:"phone",className:"mb-3",floatingLabel:"phone",placeholder:"phone",id:"phone",label:"Phone",title:"Please enter a valid phone number",autoComplete:"off",value:a.phone,required:!0,onChange:t=>u({...a,phone:t.target.value})}),e.jsx(p,{className:"mb-3",floatingLabel:"Address",placeholder:"Address",type:"text",id:"address",label:"Address",autoComplete:"off",required:!0,value:a.address,onChange:t=>u({...a,address:t.target.value})}),e.jsx(p,{className:"mb-3",floatingLabel:"License Number",placeholder:"License Number",type:"text",id:"licenseNumber",label:"License Number",autoComplete:"off",required:!0,value:a.licenseNumber,onChange:t=>u({...a,licenseNumber:t.target.value})}),e.jsxs(E,{className:"mb-3",floatingLabel:"Vehicle",label:"Vehicle",id:"vehicle",required:!0,value:a.assignedVehicle,onChange:t=>u({...a,assignedVehicle:t.target.value}),children:[e.jsx("option",{value:null,children:"Select Vehicle"}),m.map(t=>e.jsxs("option",{value:t._id,children:[t.brand," /",t.model," /",t.regisNumber]},t._id))]})]})}),e.jsxs(T,{children:[e.jsx(L,{color:"secondary",variant:"outline",disabled:i,onClick:()=>{d(!1),u(f),g(null),D(!1)},children:i?e.jsx(C,{color:"secondary",size:"sm"}):"Cancel"}),e.jsx(L,{color:"primary",variant:"outline",onClick:P,disabled:i,children:i?e.jsx(C,{color:"primary",size:"sm"}):"Add Driver"})]})]})]})})},se=({driver:n,onUpdateDriver:j})=>{const[v,i]=l.useState(!1),[b,h]=l.useState(null),[y,x]=l.useState([]),[g,c]=l.useState(!1),[d,m]=l.useState(null),[o,A]=l.useState(!1),r=w.create({baseURL:"http://localhost:5057",withCredentials:!0}),f={idNum:n.idNum,driverName:n.driverName,email:n.email,phone:n.phone,address:n.address,licenseNumber:n.licenseNumber,status:n.status,assignedVehicle:n.assignedVehicle},[a,u]=l.useState(f),U=async()=>{try{const s=await r.get("/api/v1/vehicle/available");x(s.data.data)}catch(s){console.error("Error fetching vehicles:",s)}};l.useEffect(()=>{U()},[]);const P=async s=>{s.preventDefault(),s.currentTarget.checkValidity()===!1&&s.stopPropagation(),c(!0),{...a};try{const I=await r.put(`/api/v1/driver/${n._id}`,a);I.status===200&&(h("Driver updated successfully"),j(I.data.data),setTimeout(()=>{h(null),i(!1),u(f)},2e3))}catch(I){m(I.response.data.message),setTimeout(()=>{m(null)},2e3)}finally{A(!1)}},t=[{value:"available",label:"Available"},{value:"on_duty",label:"On Duty"},{value:"off_duty",label:"Off Duty"}];return e.jsx(e.Fragment,{children:e.jsxs(e.Fragment,{children:[e.jsx(L,{color:"primary",variant:"outline",disabled:o,onClick:()=>i(!0),className:"me-2",children:o?e.jsx(C,{size:"sm"}):e.jsx(_,{icon:$})}),e.jsxs(F,{visible:v,onClose:()=>i(!1),children:[e.jsx(q,{children:e.jsx(M,{children:"Update Driver"})}),d&&e.jsx(S,{color:"danger",className:"m-3",children:d}),b&&e.jsx(S,{color:"success",className:"m-3",children:b}),e.jsx(k,{children:e.jsxs(z,{validated:g,children:[e.jsx(p,{className:"mb-3",floatingLabel:"ID Number",placeholder:"ID Number",type:"text",id:"idNum",label:"ID Number",value:a.idNum,disabled:!0}),e.jsx(p,{className:"mb-3",floatingLabel:"Name",placeholder:"Name",type:"text",id:"Name",label:"Name",autoComplete:"off",required:!0,value:a.driverName,onChange:s=>u({...a,driverName:s.target.value})}),e.jsx(p,{className:"mb-3",floatingLabel:"email",placeholder:"Model",type:"email",id:"email",label:"Email",autoComplete:"off",required:!0,value:a.email,onChange:s=>u({...a,email:s.target.value})}),e.jsx(p,{type:"phone",className:"mb-3",floatingLabel:"phone",placeholder:"phone",id:"phone",label:"Phone",title:"Please enter a valid phone number",autoComplete:"off",value:a.phone,required:!0,onChange:s=>u({...a,phone:s.target.value})}),e.jsx(p,{className:"mb-3",floatingLabel:"Address",placeholder:"Address",type:"text",id:"address",label:"Address",autoComplete:"off",required:!0,value:a.address,onChange:s=>u({...a,address:s.target.value})}),e.jsx(p,{className:"mb-3",floatingLabel:"License Number",placeholder:"License Number",type:"text",id:"licenseNumber",label:"License Number",autoComplete:"off",required:!0,value:a.licenseNumber,onChange:s=>u({...a,licenseNumber:s.target.value})}),e.jsx(E,{className:"mb-3",floatingLabel:"Status",placeholder:"Status",id:"status",label:"Status",autoComplete:"off",required:!0,value:a.status,onChange:s=>u({...a,status:s.target.value}),children:t.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),a.status==="available"||a.status==="on_duty"&&e.jsx(E,{className:"mb-3",floatingLabel:"Vehicle",label:"Vehicle",id:"vehicle",value:a.assignedVehicle,onChange:s=>u({...a,assignedVehicle:s.target.value}),children:y.map(s=>e.jsxs("option",{value:s._id,children:[s.brand," / ",s.model," / ",s.regisNumber]},s._id))})]})}),e.jsxs(T,{children:[e.jsx(L,{color:"secondary",variant:"outline",disabled:o,onClick:()=>{i(!1),m(null),c(!1)},children:o?e.jsx(C,{color:"secondary",size:"sm"}):"Close"}),e.jsx(L,{color:"success",variant:"outline",disabled:o,onClick:P,children:o?e.jsx(C,{color:"success",size:"sm"}):"Save Changes"})]})]})]})})},te=({driver:n,onDeleteDriver:j})=>{const i=w.create({baseURL:"http://localhost:5057",withCredentials:!0}),[b,h]=l.useState(!1),[y,x]=l.useState(null),g=async()=>{h(!0);try{(await i.delete(`/api/v1/driver/${n._id}`)).status===200&&(alert("Driver deleted successfully"),j(n._id),h(!1),x(null))}catch(c){x(c)}finally{h(!1)}};return e.jsx(e.Fragment,{children:e.jsx(L,{color:"danger",variant:"outline",onClick:g,className:"me-2",disabled:b,children:b?e.jsx(C,{size:"sm"}):e.jsx(_,{icon:B})})})},le=({driver:n,loading:j,onDeleteDriver:v,onUpdateDriver:i})=>{w.create({baseURL:"http://localhost:5057",withCredentials:!0});const h=JSON.parse(sessionStorage.getItem("user")),y=["manager","admin"],[x,g]=l.useState(null),[c,d]=l.useState(""),[m,o]=l.useState([]);l.useEffect(()=>{(async()=>{if(c==="")o(n);else{const f=n.filter(a=>a.driverName.toLowerCase().includes(c.toLowerCase())||a.idNum.toString().includes(c)||a.email.toLowerCase().includes(c.toLowerCase())||a.phone.toString().includes(c)||a.address.toLowerCase().includes(c.toLowerCase())||a.licenseNumber.toString().includes(c)||D.find(u=>u.value===a.status).label.toLowerCase().includes(c.toLowerCase()));o(f),f.length===0?g("No results found"):g(null)}})()},[c,n]);const A=r=>{switch(r){case"available":return"green";case"on_duty":return"red";case"off_duty":return"orange";default:return"black"}},D=[{label:"Available",value:"available"},{label:"On Duty",value:"on_duty"},{label:"Off Duty",value:"off_duty"}];return n.length===0?e.jsx(S,{color:"danger",className:"justfy-content-center",children:"No drivers found"}):e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"mt-3",children:e.jsxs(Q,{className:"w-50 mb-3 ",children:[e.jsx(p,{type:"text",placeholder:"Search Drivers...",id:"search",value:c,onChange:r=>d(r.target.value),className:"w-50 me-2 "}),e.jsx(J,{children:e.jsx(_,{icon:G})})]})}),e.jsx(K,{className:"m-2",children:m.map(r=>e.jsxs(W,{children:[e.jsx(X,{children:e.jsxs("p",{className:"w-100 m-1",children:["Driver Name: ",e.jsxs("strong",{children:[" ",r.driverName," "]}),e.jsx(_,{icon:H,color:A(r.status),className:"m-2 float-end"}),e.jsxs("small",{className:"m-2 float-end",children:[" ",D.find(f=>f.value===r.status).label]})]})}),e.jsxs(Y,{children:[e.jsxs(N,{children:["ID: ",r.idNum]}),e.jsxs(N,{children:["Email: ",r.email]}),e.jsxs(N,{children:["Phone: ",r.phone]}),e.jsxs(N,{children:["Address: ",r.address]}),e.jsxs(N,{children:["License Number: ",r.licenseNumber]}),e.jsxs(N,{children:["Vehicle:"," ",r.assignedVehicle?`${r.assignedVehicle.regisNumber} - ${r.assignedVehicle.brand} ${r.assignedVehicle.model}`:"No vehicle assigned"]}),e.jsxs(N,{children:["Status: ",D.find(f=>f.value===r.status).label]}),e.jsxs(R,{className:"d-flex justify-content-end mt-3",children:[j?e.jsx(C,{color:"primary",size:"sm"}):e.jsx(se,{driver:r,onUpdateDriver:i}),y.includes(h.data.user.role)&&e.jsx(te,{driver:r,onDeleteDriver:v})]})]})]},r._id))}),x&&e.jsx(S,{color:"danger",className:"text-center justify-content-center",children:x})]})},re="http://localhost:5057",oe=w.create({baseURL:re}),ye=()=>{const[n,j]=l.useState([]),[v,i]=l.useState(!1),[b,h]=l.useState(null),y=async()=>{var d,m;i(!0);try{const o=await oe.get("/api/v1/driver");o.status===200?(j(o.data.data),i(!1)):h(o.data.message)}catch(o){h(((m=(d=o.response)==null?void 0:d.data)==null?void 0:m.message)||o.message)}finally{i(!1)}};l.useEffect(()=>{y()},[]);const x=d=>{j(m=>[...m,d])},g=d=>{j(m=>m.filter(o=>o._id!==d))},c=d=>{j(m=>m.map(o=>o._id===d._id?d:o))};return e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"text-center",children:"Driver Management"}),e.jsx(R,{className:"m-3",children:e.jsx(ae,{onAddDriver:x})}),e.jsxs(Z,{children:[e.jsx(N,{children:"Drivers list"}),e.jsx(ee,{className:"md-3",children:e.jsx(le,{driver:n,loading:v,error:b,onDeleteDriver:g,onUpdateDriver:c})})]})]})};export{ye as default};
