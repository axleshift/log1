import{l as U,r as n,j as e,k as Y,n as _,A as re}from"./index-DZGJCuOe.js";import{r as he,F as $,s as fe,m as ne,a as le,t as ie,u as be,v as je}from"./index-DIgmdPjR.js";import{a as q}from"./CButton-BnfWto-e.js";import{C as O,a as Q,b as J,c as W}from"./CModalHeader-B0xpTHco.js";import{C as oe}from"./CModalTitle-CGM5eo8Q.js";import{C as B}from"./CAlert-i-kAMGLS.js";import{C as ce}from"./CForm-L-fC1ShP.js";import{C as P}from"./CInputGroup-tUN_7Qvq.js";import{C as y}from"./CFormInput-EZtn8AIz.js";import{C as G}from"./CFormSelect-Cb6rNLBt.js";import{C as k}from"./CContainer-B22YzjYV.js";import{C as de}from"./CInputGroupText-DNXsQkNt.js";import{C as ue,a as me,b as ge,c as xe}from"./CAccordionHeader-Cfk_IHyc.js";import{C as S,a as ye}from"./DefaultLayout-DHRMbFo0.js";import{C as Ce,a as K}from"./CPaginationItem-CvIbgu0h.js";import{C as Ne,a as ve,b as ee,c as ae}from"./CTabList-p-cg4h3o.js";import{C as se}from"./CCard-BTZAUdul.js";import{C as te}from"./CCardBody-O0UQ9Rlq.js";import"./index.esm-3_8T6ype.js";import"./1-tsU9Z8VM.js";import"./cil-user-Ddrdy7PS.js";import"./getTransitionDurationFromElement-Cpu4p4hx.js";const Se=({onAddVehicle:c})=>{const{showSuccess:I,showError:g}=U(),[L,D]=n.useState(!1),[m,b]=n.useState(!1),[E,T]=n.useState(null),[j,h]=n.useState(null),[s,C]=n.useState(!1),o={idNum:Math.floor(Math.random()*1e6).toString(),brand:"",model:"",year:"",regisExprationDate:"",regisNumber:"",capacity:"",fuelType:"",currentMileage:"",status:"available"},[u,l]=n.useState(o),d=a=>{const{id:r,value:t}=a.target;l(p=>({...p,[r]:t}))},f=[{label:"Van",value:"van"},{label:"Pickup Truck",value:"pickup"},{label:"Box Truck",value:"box"},{label:"Straight Truck",value:"straight"},{label:"Semi-Trailer Trucks",value:"semi"},{label:"Refrigerated Trucks",value:"refrigerated"},{label:"Tanker Trucks",value:"tanker"},{label:"Flatbed Trucks",value:"flatbed"}],F=[{label:"Diesel",value:"Diesel"},{label:"Gasoline",value:"Gasoline"}],V=async a=>{var t,p,v,R;a.currentTarget.checkValidity()===!1&&(a.preDefault(),a.stopPropagation()),D(!0),C(!0);try{const w=await _.post("api/v1/vehicle",u);w.data.success&&(I(w.data.message),c(w.data.data),setTimeout(()=>{l(o),C(!1),D(!1),b(!1)},2e3))}catch(w){g(((p=(t=w.response)==null?void 0:t.data)==null?void 0:p.message)||w.message),T(((R=(v=w.response)==null?void 0:v.data)==null?void 0:R.message)||w.message),setTimeout(()=>{T(null)},2e3)}C(!1)},M=new Date().getFullYear(),N=1990,i=new Date().toISOString().split("T")[0],x=({icon:a})=>{const[r,t]=n.useState(!1);return e.jsx($,{icon:a,bounce:r,onMouseEnter:()=>t(!0),onMouseLeave:()=>t(!1)})};return e.jsx(e.Fragment,{children:s?e.jsx(Y,{color:"primary",size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsxs(q,{color:"primary",variant:"outline",onClick:()=>b(!0),children:[e.jsx(x,{icon:he})," Add Vehicle"]}),e.jsxs(O,{visible:m,onClose:()=>b(!1),size:"lg",children:[e.jsx(Q,{closeButton:!0,children:e.jsx(oe,{children:"Add Vehicle"})}),E&&e.jsx(B,{color:"danger",className:"m-3",children:E}),j&&e.jsx(B,{color:"success",className:"m-3",children:j}),e.jsx(J,{children:e.jsxs(ce,{noValidate:!0,validated:L,children:[e.jsxs(P,{children:[e.jsx(y,{className:"mb-3",floatingLabel:"ID Number",placeholder:"ID Number",type:"text",id:"idNum",label:"ID Number",value:u.idNum,disabled:!0}),e.jsx(y,{className:"mb-3",floatingLabel:"Brand",placeholder:"Brand",type:"text",id:"brand",label:"Brand",autoComplete:"off",required:!0,value:u.brand,onChange:d}),e.jsx(y,{className:"mb-3",floatingLabel:"Model",placeholder:"Model",type:"text",id:"model",label:"Model",autoComplete:"off",required:!0,value:u.model,onChange:d})]}),e.jsxs(P,{children:[e.jsx(y,{type:"number",className:"mb-3",floatingLabel:"Year",placeholder:"Year",id:"year",value:u.year,required:!0,min:N,max:M,onChange:d,onBlur:a=>{const r=parseInt(a.target.value);r>=N&&r<=M&&!isNaN(r)||(alert(`Please enter a year between ${N} and ${M}`),l({...u,year:N}))}}),e.jsx(y,{className:"mb-3",floatingLabel:"Registration Number",placeholder:"Registration Number",type:"text",id:"regisNumber",label:"Registration Number",autoComplete:"off",required:!0,value:u.regisNumber,onChange:d}),e.jsx(y,{className:"mb-3",floatingLabel:"Registration Expiration Date",placeholder:"Registration Expiration Date",type:"date",id:"regisExprationDate",label:"Registration Expiration Date",autoComplete:"off",required:!0,min:i,value:u.regisExprationDate,onChange:d})]}),e.jsxs(P,{children:[e.jsx(G,{className:"mb-3",floatingLabel:"Vehicle Type",placeholder:"Vehicle Type",id:"type",value:u.type,required:!0,onChange:d,options:[{label:"Select Vehicle Type",value:""},...f]}),e.jsx(y,{className:"mb-2",type:"number",floatingLabel:"Capacity",placeholder:"Capacity",id:"capacity",label:"Capacity",autoComplete:"off",required:!0,min:"0",value:u.capacity,onChange:d}),e.jsx(G,{className:"mb-3",floatingLabel:"Fuel Type",placeholder:"Fuel Type",id:"fuelType",value:u.fuelType,required:!0,onChange:d,options:[{label:"Select Fuel Type",value:""},...F]})]}),e.jsx(y,{className:"mb-3",floatingLabel:"Current Mileage",placeholder:"Current Mileage",type:"number",id:"currentMileage",label:"Current Mileage",autoComplete:"off",required:!0,value:u.currentMileage,min:"0",max:"100000000000",onChange:d})]})}),e.jsxs(W,{children:[e.jsx(q,{color:"secondary",variant:"outline",disabled:s,onClick:()=>{b(!1),l(o),D(!1),T(null)},children:s?e.jsx(Y,{color:"secondary",size:"sm"}):"Cancel"}),e.jsx(q,{color:"primary",variant:"outline",disabled:s,onClick:V,children:s?e.jsx(Y,{color:"primary",size:"sm"}):"Save"})]})]})]})})},De=({vehicle:c,onUpdateVehicle:I})=>{const{showSuccess:g,showError:L}=U(),[D,m]=n.useState(!1),[b,E]=n.useState(null),[T,j]=n.useState(null),[h,s]=n.useState(!1),[C,o]=n.useState(!1),u={idNum:c.idNum,brand:c.brand,model:c.model,year:c.year,regisExprationDate:c.regisExprationDate,regisNumber:c.regisNumber,type:c.type,capacity:c.capacity,fuelType:c.fuelType,currentMileage:c.currentMileage},[l,d]=n.useState(u),f=r=>{const{id:t,value:p}=r.target;d(v=>({...v,[t]:p}))},F=[{label:"Van",value:"van"},{label:"Pickup Truck",value:"pickup"},{label:"Box Truck",value:"box"},{label:"Straight Truck",value:"straight"},{label:"Semi-Trailer Trucks",value:"semi"},{label:"Refrigerated Trucks",value:"refrigerated"},{label:"Tanker Trucks",value:"tanker"},{label:"Flatbed Trucks",value:"flatbed"}],V=[{label:"Diesel",value:"Diesel"},{label:"Gasoline",value:"Gasoline"}],M=async r=>{var p,v,R,w;r.preventDefault(),s(!0),r.currentTarget.checkValidity()===!1&&(r.preDefault(),r.stopPropagation()),o(!0),s(!0);try{const A=new Date;A.setHours(0,0,0,0);const z=new Date(l.regisExprationDate);if(z.setHours(0,0,0,0),z<=A){j("Registration date must be in the future"),setIsLoading(!1);return}const H=await _.put(`api/v1/vehicle/${c._id}`,l);H.data.success&&(g(H.data.message),I(H.data.data),setTimeout(()=>{s(!1),o(!1),m(!1)},2e3))}catch(A){L(((v=(p=A.response)==null?void 0:p.data)==null?void 0:v.message)||A.message),j(((w=(R=A.response)==null?void 0:R.data)==null?void 0:w.message)||A.message),setTimeout(()=>{j(null)},2e3)}finally{s(!1)}},N=new Date().getFullYear(),i=1990,x=new Date().toISOString().split("T")[0],a=({icon:r})=>{const[t,p]=n.useState(!1);return e.jsx($,{icon:r,bounce:t,onMouseEnter:()=>p(!0),onMouseLeave:()=>p(!1)})};return e.jsxs(e.Fragment,{children:[e.jsxs(q,{color:"primary",variant:"outline",disabled:h,onClick:()=>m(!0),className:"me-2",children:[h?e.jsx(Y,{size:"sm"}):e.jsx(a,{icon:fe})," Update"]}),e.jsxs(O,{visible:D,onClose:()=>m(!1),size:"lg",children:[e.jsx(Q,{closeButton:!0,children:e.jsx(oe,{children:"Update Vehicle"})}),T&&e.jsx(B,{color:"danger",className:"m-3",children:T}),b&&e.jsx(B,{color:"success",className:"m-3",children:b}),e.jsx(J,{children:e.jsxs(ce,{noValidate:!0,validated:C,children:[e.jsxs(P,{children:[e.jsx(y,{className:"mb-3",floatingLabel:"ID Number",placeholder:"ID Number",type:"text",id:"idNum",label:"ID Number",value:l.idNum,disabled:!0}),e.jsx(y,{className:"mb-3",floatingLabel:"Brand",placeholder:"Brand",type:"text",id:"brand",label:"Brand",required:!0,value:l.brand,onChange:f}),e.jsx(y,{className:"mb-3",floatingLabel:"Model",placeholder:"Model",type:"text",id:"model",label:"Model",required:!0,value:l.model,onChange:f})]}),e.jsxs(P,{children:[e.jsx(y,{type:"number",className:"mb-3",floatingLabel:"Year",placeholder:"Year",id:"year",value:l.year,required:!0,min:i,max:N,onChange:f,onBlur:r=>{const t=parseInt(r.target.value);t>=i&&t<=N&&!isNaN(t)||(alert(`Please enter a year between ${i} and ${N}`),d({...l,year:i}))}}),e.jsx(y,{className:"mb-3",floatingLabel:"Registration Number",placeholder:"Registration Number",type:"text",id:"regisNumber",label:"Registration Number",required:!0,value:l.regisNumber,onChange:f}),e.jsx(y,{className:"mb-3",floatingLabel:"Registration Expiration Date",placeholder:"Registration Expiration Date",type:"date",id:"regisExprationDate",label:"Registration Expiration Date",autoComplete:"off",required:!0,min:x,value:l.regisExprationDate.split("T")[0],onChange:f})]}),e.jsxs(P,{children:[e.jsx(G,{className:"mb-3",floatingLabel:"Vehicle Type",placeholder:"Vehicle Type",id:"type",value:l.type,required:!0,onChange:f,options:[{label:"Select Vehicle Type",value:""},...F]}),e.jsx(y,{className:"mb-2",type:"number",floatingLabel:"Capacity",placeholder:"Capacity",id:"capacity",label:"Capacity",required:!0,min:"0",value:l.capacity,onChange:f}),e.jsx(G,{className:"mb-3",floatingLabel:"Fuel Type",placeholder:"Fuel Type",id:"fuelType",label:"Fuel Type",value:l.fuelType,required:!0,onChange:f,options:[{label:"Select Fuel Type",value:""},...V]})]}),e.jsx(y,{className:"mb-3",floatingLabel:"Current Mileage",placeholder:"Current Mileage",type:"number",id:"currentMileage",label:"Current Mileage",required:!0,min:"0",max:"100000000000",value:l.currentMileage,onChange:f})]})}),e.jsxs(W,{children:[e.jsx(q,{color:"secondary",variant:"outline",disabled:h,onClick:()=>{m(!1),j(null),d(u),o(!1)},children:h?e.jsx(Y,{size:"sm",color:"secondary"}):"Cancel"}),e.jsx(q,{color:"success",variant:"outline",disabled:h,onClick:M,children:h?e.jsx(Y,{size:"sm",color:"success"}):"Save Changes"})]})]})]})},Te=({vehicle:c,error:I,loading:g,onDeleteVehicle:L,onUpdateVehicle:D})=>{const[m,b]=n.useState([]),E=re(),T=["manager","admin","super admin"],[j,h]=n.useState(null),[s,C]=n.useState(""),[o,u]=n.useState(1),[l]=n.useState(10),d=o*l,f=d-l,F=m.slice(f,d),V=Math.ceil(m.length/l);n.useEffect(()=>{b(c)},[c]),n.useEffect(()=>{(()=>{if(u(1),s==="")b(c);else{const r=c.filter(t=>{var p,v,R,w,A,z,H,X,Z;return((p=t.idNum)==null?void 0:p.toString().includes(s))||((v=t.brand)==null?void 0:v.toLowerCase().includes(s.toLowerCase()))||((R=t.model)==null?void 0:R.toLowerCase().includes(s.toLowerCase()))||((w=t.year)==null?void 0:w.toString().includes(s))||((A=t.regisExprationDate)==null?void 0:A.toLowerCase().includes(s.toLowerCase()))||((z=t.type)==null?void 0:z.toLowerCase().includes(s.toLowerCase()))||((H=t.regisNumber)==null?void 0:H.toLowerCase().includes(s.toLowerCase()))||((X=t.capacity)==null?void 0:X.toString().includes(s))||(((Z=N.find(pe=>pe.value===t.status))==null?void 0:Z.label)||"").toLowerCase().includes(s.toLowerCase())});b(r),r.length===0?h("No vehicles found"):h(null)}})()},[s,c]);const M=a=>{switch(a){case"available":return"green";case"in_use":return"red";case"maintenance":return"orange";case"inspection":return"yellow";case"forRegistration":return"grey";default:return"black"}},N=[{value:"available",label:"Available"},{value:"in_use",label:"In Use"},{value:"maintenance",label:"Maintenance"},{value:"inactive",label:"Inactive"},{value:"inspection",label:"Inspection"},{value:"forRegistration",label:"For Registration"}];if(c.length===0)return e.jsx(B,{color:"danger",className:"text-center justify-content-center",children:"No vehicles found"});const i=a=>{if(!a)return{text:"No expiration date",badge:"secondary"};const r=new Date;r.setHours(0,0,0,0);const t=new Date(a);t.setHours(0,0,0,0);const p=t.getTime()-r.getTime(),v=Math.ceil(p/(1e3*60*60*24));if(v<0){const R=Math.abs(v);return{text:`Expired ${R} ${R===1?"day":"days"} ago`,badge:"danger"}}return v===0?{text:"Expires Today",badge:"danger"}:v<=14?{text:`Expires in ${v} ${v===1?"day":"days"}`,badge:"warning"}:{text:"Registered",badge:"success"}},x=({icon:a})=>{const[r,t]=n.useState(!1);return e.jsx($,{icon:a,bounce:r,onMouseEnter:()=>t(!0),onMouseLeave:()=>t(!1)})};return e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"mt-3",children:e.jsxs(P,{className:"w-50 mb-3",children:[e.jsx(y,{type:"text",placeholder:"Search vehicles",id:"search",value:s,onChange:a=>C(a.target.value),className:"w-50 me-2 "}),e.jsx(de,{children:e.jsx($,{icon:ne})})]})}),e.jsx(ue,{className:"m-2",children:F.map((a,r)=>e.jsxs(me,{children:[e.jsxs(ge,{className:"d-flex justify-content-between",children:[e.jsx(k,{children:e.jsxs("ul",{className:"list-unstyled",children:[e.jsxs("li",{children:["Registration Number: ",e.jsx("strong",{children:a.regisNumber})]}),e.jsxs("li",{children:["Driver:"," ",e.jsx("strong",{children:a.assignedDriver?`${a.assignedDriver.driverName} - ${a.assignedDriver.licenseNumber}`:"Not assigned"})]}),e.jsxs("li",{children:["Registration expiration Date:"," ",e.jsx("strong",{children:a.regisExprationDate?e.jsxs(e.Fragment,{children:[new Date(a.regisExprationDate).toLocaleDateString()," ",e.jsx(le,{color:i(a.regisExprationDate).badge,children:i(a.regisExprationDate).text})]}):"No expiration date"})]})]})}),e.jsxs(k,{className:"d-flex justify-content-end",children:[e.jsx($,{icon:ie,color:M(a.status),className:"m-2 float-end"}),e.jsx("small",{className:"m-2 float-end",children:N.find(t=>t.value===a.status).label})]})]}),e.jsxs(xe,{children:[e.jsxs(S,{children:["ID: ",a.idNum]}),e.jsxs(S,{children:["Brand: ",a.brand]}),e.jsxs(S,{children:["Model: ",a.model]}),e.jsxs(S,{children:["Year: ",a.year]}),e.jsxs(S,{children:["Type: ",a.type]}),e.jsxs(S,{children:["Capacity: ",a.capacity]}),e.jsxs(S,{children:["Status: ",N.find(t=>t.value===a.status).label]}),e.jsxs(S,{children:["Driver:"," ",a.assignedDriver?`${a.assignedDriver.driverName} - ${a.assignedDriver.licenseNumber}`:"Not assigned"]}),e.jsxs(S,{children:["Fuel Type: ",a.fuelType]}),e.jsxs(S,{children:["Current Mileage: ",a.currentMileage]}),e.jsxs(k,{className:"d-flex justify-content-end mt-3",children:[e.jsx(De,{vehicle:a,onUpdateVehicle:D}),T.includes(E)&&e.jsxs(q,{color:"danger",variant:"outline",onClick:()=>L(a._id),children:[e.jsx(x,{icon:be})," Delete"]})]})]})]},a._id||r))}),m.length>0&&e.jsxs(k,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs(k,{children:["Showing ",f+1," to ",Math.min(d,m.length)," ","of ",m.length," entries"]}),e.jsxs(Ce,{className:"mt-3",children:[e.jsx(K,{disabled:o===1,onClick:()=>u(a=>Math.max(a-1,1)),children:"Previous"}),Array.from({length:V},(a,r)=>r+1).map(a=>e.jsx(K,{active:a===o,onClick:()=>u(a),children:a},a)),e.jsx(K,{disabled:o===V,onClick:()=>u(a=>Math.min(a+1,V)),children:"Next"})]})]}),j&&e.jsx(B,{color:"danger",className:"text-center justify-content-center",children:j})]})},we=({restoredVehicle:c,onRestoreVehicle:I})=>{const[g,L]=n.useState(!1),{showSuccess:D,showError:m}=U(),[b,E]=n.useState(null),T=async()=>{var j,h;L(!0);try{const s=await _.patch(`api/v1/vehicle/restore/${c}`);s.data.success&&(D(s.data.message),I(s.data.data))}catch(s){m(((h=(j=s.response)==null?void 0:j.data)==null?void 0:h.message)||"Error restoring vehicle"),console.error("Error restoring vehicle:",s)}finally{L(!1)}};return e.jsx(q,{color:"success",variant:"outline",onClick:T,disabled:g,className:"mx-1",children:g?e.jsx(Y,{size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsx($,{icon:je,className:"me-1"}),"Restore"]})})},Le=({restoredVehicle:c,onRestoreVehicle:I})=>{const[g,L]=n.useState(""),[D,m]=n.useState([]),[b,E]=n.useState(null);n.useEffect(()=>{(()=>{if(g==="")m(c);else{const C=c.filter(o=>{var u,l,d,f,F,V,M,N,i;return((u=o.idNum)==null?void 0:u.toString().includes(g))||((l=o.brand)==null?void 0:l.toLowerCase().includes(g.toLowerCase()))||((d=o.model)==null?void 0:d.toLowerCase().includes(g.toLowerCase()))||((f=o.year)==null?void 0:f.toString().includes(g))||((F=o.regisExprationDate)==null?void 0:F.toLowerCase().includes(g.toLowerCase()))||((V=o.type)==null?void 0:V.toLowerCase().includes(g.toLowerCase()))||((M=o.regisNumber)==null?void 0:M.toLowerCase().includes(g.toLowerCase()))||((N=o.capacity)==null?void 0:N.toString().includes(g))||(((i=j.find(x=>x.value===o.status))==null?void 0:i.label)||"").toLowerCase().includes(g.toLowerCase())});m(C),C.length===0?E("No vehicles found"):E(null)}})()},[g,c]);const T=s=>{switch(s){case"available":return"green";case"in_use":return"red";case"maintenance":return"orange";case"inspection":return"yellow";case"forRegistration":return"grey";default:return"black"}},j=[{value:"available",label:"Available"},{value:"in_use",label:"In Use"},{value:"maintenance",label:"Maintenance"},{value:"inactive",label:"Inactive"},{value:"inspection",label:"Inspection"},{value:"forRegistration",label:"For Registration"}];if(D.length===0)return e.jsx(B,{color:"danger",className:"text-center justify-content-center",children:"No vehicles found to restore"});const h=s=>{if(!s)return{text:"No expiration date",badge:"secondary"};const C=new Date;C.setHours(0,0,0,0);const o=new Date(s);o.setHours(0,0,0,0);const u=o.getTime()-C.getTime(),l=Math.ceil(u/(1e3*60*60*24));if(l<0){const d=Math.abs(l);return{text:`Expired ${d} ${d===1?"day":"days"} ago`,badge:"danger"}}return l===0?{text:"Expires Today",badge:"danger"}:l<=14?{text:`Expires in ${l} ${l===1?"day":"days"}`,badge:"warning"}:{text:"Registered",badge:"success"}};return e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"mt-3",children:e.jsxs(P,{className:"w-50 mb-3",children:[e.jsx(y,{type:"text",placeholder:"Search vehicles",id:"searchRestoredVehicles",value:g,onChange:s=>L(s.target.value),className:"w-50 me-2 "}),e.jsx(de,{children:e.jsx($,{icon:ne})})]})}),b&&e.jsx(B,{color:"danger",children:b}),e.jsx(ue,{children:D.map(s=>e.jsxs(me,{children:[e.jsxs(ge,{className:"d-flex justify-content-between",children:[e.jsx(k,{children:e.jsxs("ul",{children:[e.jsxs("li",{children:["Registration Number: ",e.jsx("strong",{children:s.regisNumber})]}),e.jsxs("li",{children:["Registration expiration Date:"," ",e.jsx("strong",{children:s.regisExprationDate?e.jsxs(e.Fragment,{children:[new Date(s.regisExprationDate).toISOString().split("T")[0]," ",e.jsx(le,{color:h(s.regisExprationDate).badge,children:h(s.regisExprationDate).text})]}):"No expiration date"})]})]})}),e.jsxs(k,{className:"d-flex justify-content-end",children:[e.jsx($,{icon:ie,color:T(s.status),className:"m-2 float-end"}),e.jsx("small",{className:"m-2 float-end",children:j.find(C=>C.value===s.status).label})]})]}),e.jsxs(xe,{children:[e.jsxs(S,{children:["Year: ",s.year]}),e.jsxs(S,{children:["Type: ",s.type]}),e.jsxs(S,{children:["Capacity: ",s.capacity]}),e.jsxs(S,{children:["Status: ",s.status]}),e.jsx(k,{className:"d-flex justify-content-end mt-3",children:e.jsx(we,{restoredVehicle:s._id,onRestoreVehicle:I})})]})]},s._id))})]})},We=()=>{const c=re(),I="admin",{showSuccess:g,showError:L}=U(),[D,m]=n.useState([]),[b,E]=n.useState(!0),[T,j]=n.useState(null),[h,s]=n.useState(null),[C,o]=n.useState(!1),[u,l]=n.useState([]);n.useEffect(()=>{d()},[]),n.useEffect(()=>{const i=()=>{const a=new Date;a.setHours(0,0,0,0),m(r=>r.map(t=>{const p=new Date(t.regisExprationDate);return p.setHours(0,0,0,0),p<=a&&t.status!=="forRegistration"?{...t,status:"forRegistration"}:t}))};i();const x=setInterval(i,24*60*60*1e3);return()=>clearInterval(x)},[]);const d=async()=>{var i,x;E(!0);try{const[a,r]=await Promise.all([_.get("api/v1/vehicle"),_.get("api/v1/vehicle/restored")]);m(a.data.data),l(r.data.data)}catch(a){L(((x=(i=a.response)==null?void 0:i.data)==null?void 0:x.message)||"Error fetching data"),j(a.message)}finally{E(!1)}},f=i=>{s(i),o(!0)},F=async()=>{var i,x;try{await _.patch(`api/v1/vehicle/${h}`),m(a=>a.filter(r=>r._id!==h)),g("Vehicle deleted successfully"),o(!1),d()}catch(a){L(((x=(i=a.response)==null?void 0:i.data)==null?void 0:x.message)||"Error deleting vehicle")}},V=i=>{m(x=>[...x,i])},M=i=>{l(x=>x.map(a=>a._id===i._id?i:a)),d()},N=i=>{m(x=>x.map(a=>a._id===i._id?i:a),d())};return b?e.jsx("div",{className:"text-center",children:e.jsx(Y,{color:"primary"})}):e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"text-center",children:"Vehicle Management"}),e.jsx(k,{className:"m-3",children:e.jsx(Se,{onAddVehicle:V})}),e.jsxs(Ne,{activeItemKey:"Vehicle List",children:[e.jsxs(ve,{variant:"tabs",children:[e.jsx(ee,{itemKey:"Vehicle List",children:"Vehicle List"}),e.jsx(ee,{itemKey:"Restore Vehicles",children:"Restore Vehicles"})]}),e.jsxs(ye,{children:[e.jsx(ae,{itemKey:"Vehicle List",children:e.jsxs(se,{children:[e.jsx(S,{children:"Vehicle List"}),e.jsx(te,{className:"md-3",children:e.jsx(Te,{vehicle:D,error:T,onDeleteVehicle:f,onUpdateVehicle:N,loading:b})})]})}),e.jsx(ae,{itemKey:"Restore Vehicles",children:c.includes(I)?e.jsxs(se,{children:[e.jsx(S,{children:"Restore Vehicles"}),e.jsx(te,{className:"md-3",children:e.jsx(Le,{restoredVehicle:u,onRestoreVehicle:M})})]}):e.jsx(B,{color:"danger",className:"text-center justify-content-center m-5",children:"You are not authorized to view this tab"})})]})]}),e.jsxs(O,{visible:C,onClose:()=>o(!1),alignment:"center",children:[e.jsx(Q,{children:"Confirm Delete"}),e.jsx(J,{children:"Are you sure you want to delete this vehicle?"}),e.jsxs(W,{children:[e.jsx(q,{color:"danger",variant:"outline",onClick:F,children:"Delete"}),e.jsx(q,{color:"secondary",variant:"outline",onClick:()=>o(!1),children:"Cancel"})]})]})]})};export{We as default};
