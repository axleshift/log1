import{r,_ as se,u as re,R as l,a as N,c as T,P as n,C as be,d as ve,E as Ce,l as U,j as e,k as M,B as xe,A as je}from"./index-DROWpYL_.js";import{F as R,h as ye,i as ke,k as Se,l as Ie,m as Ne}from"./index-CMSYnzFr.js";import{a as F}from"./CButton-B9J2LueU.js";import{C as oe,a as le,b as ce,c as ie,d as de}from"./CModalTitle-BTa5ve_X.js";import{a as V,C as ue}from"./CForm-BCO_fxSv.js";import{a as te,b as fe,C as H}from"./CFormInput-Bk8len5H.js";import{C as we}from"./CFormSelect-CUJJWTLn.js";import{C as q}from"./CContainer-CdWzMoCP.js";import{C as Ee,a as Le}from"./CInputGroupText-DF8EFEoQ.js";import{C as Pe,a as Fe,b as Te,c as De}from"./CAccordionHeader-CipZyu_X.js";import{u as Ae,C as $}from"./DefaultLayout-B1sY_SSj.js";import{g as Me,e as Re}from"./getRTLPlacement-8YkzSSXz.js";import{C as Ve}from"./CCard-DQFhcyJv.js";import{C as $e}from"./CCardBody-CRiEzVZv.js";import"./index.esm-DzHzV93o.js";import"./1-CyQxF0Py.js";import"./cil-user-Ddrdy7PS.js";import"./getTransitionDurationFromElement-Cpu4p4hx.js";var G=r.forwardRef(function(t,w){var v=t.className,i=t.button,p=t.feedback,y=t.feedbackInvalid,x=t.feedbackValid,h=t.floatingLabel,c=t.tooltipFeedback,C=t.hitArea,d=t.id,I=t.indeterminate,k=t.inline,f=t.invalid,g=t.label,L=t.reverse,j=t.type,b=j===void 0?"checkbox":j,u=t.valid,a=se(t,["className","button","feedback","feedbackInvalid","feedbackValid","floatingLabel","tooltipFeedback","hitArea","id","indeterminate","inline","invalid","label","reverse","type","valid"]),s=r.useRef(null),o=re(w,s);r.useEffect(function(){s.current&&I&&(s.current.indeterminate=I)},[I,s.current]);var m=function(){return l.createElement("input",N({type:b,className:T(i?"btn-check":"form-check-input",{"is-invalid":f,"is-valid":u,"me-2":C}),id:d},a,{ref:o}))},E=function(){return l.createElement(fe,{describedby:a["aria-describedby"],feedback:p,feedbackInvalid:y,feedbackValid:x,floatingLabel:h,invalid:f,tooltipFeedback:c,valid:u})},S=function(){var D;return l.createElement(te,N({customClassName:T(i?T("btn",i.variant?"btn-".concat(i.variant,"-").concat(i.color):"btn-".concat(i.color),(D={},D["btn-".concat(i.size)]=i.size,D),"".concat(i.shape)):"form-check-label")},d&&{htmlFor:d}),g)},P=function(){return i?l.createElement(l.Fragment,null,l.createElement(m,null),g&&l.createElement(S,null),l.createElement(E,null)):g?C?l.createElement(l.Fragment,null,l.createElement(m,null),l.createElement(te,N({customClassName:T("form-check-label stretched-link",v)},d&&{htmlFor:d}),g),l.createElement(E,null)):l.createElement("div",{className:T("form-check",{"form-check-inline":k,"form-check-reverse":L,"is-invalid":f,"is-valid":u},v)},l.createElement(m,null),l.createElement(S,null),l.createElement(E,null)):l.createElement(m,null)};return l.createElement(P,null)});G.propTypes=N({button:n.object,className:n.string,hitArea:n.oneOf(["full"]),id:n.string,indeterminate:n.bool,inline:n.bool,label:n.oneOfType([n.string,n.node]),reverse:n.bool,type:n.oneOf(["checkbox","radio"])},fe.propTypes);G.displayName="CFormCheck";var Q=r.forwardRef(function(t,w){var v=t.children,i=t.animation,p=i===void 0?!0:i,y=t.className,x=t.container,h=t.content,c=t.delay,C=c===void 0?0:c,d=t.fallbackPlacements,I=d===void 0?["top","right","bottom","left"]:d,k=t.offset,f=k===void 0?[0,8]:k,g=t.onHide,L=t.onShow,j=t.placement,b=j===void 0?"top":j,u=t.popperConfig,a=t.title,s=t.trigger,o=s===void 0?"click":s,m=t.visible,E=se(t,["children","animation","className","container","content","delay","fallbackPlacements","offset","onHide","onShow","placement","popperConfig","title","trigger","visible"]),S=r.useRef(null),P=r.useRef(null),D=re(w,S),J="popover".concat(r.useId()),K=r.useState(!1),z=K[0],W=K[1],X=r.useState(m),A=X[0],Y=X[1],Z=Ae(),pe=Z.initPopper,he=Z.destroyPopper,_=typeof C=="number"?{show:C,hide:C}:C,ee={modifiers:[{name:"arrow",options:{element:".popover-arrow"}},{name:"flip",options:{fallbackPlacements:I}},{name:"offset",options:{offset:f}}],placement:Me(b,P.current)},ge=N(N({},ee),typeof u=="function"?u(ee):u);r.useEffect(function(){if(m){O();return}B()},[m]),r.useEffect(function(){if(z&&P.current&&S.current){pe(P.current,S.current,ge),setTimeout(function(){Y(!0)},_.show);return}!z&&P.current&&S.current&&he()},[z]),r.useEffect(function(){!A&&P.current&&S.current&&Re(function(){W(!1)},S.current)},[A]);var O=function(){W(!0),L&&L()},B=function(){setTimeout(function(){Y(!1),g&&g()},_.hide)};return l.createElement(l.Fragment,null,l.cloneElement(v,N(N(N(N(N({},A&&{"aria-describedby":J}),{ref:P}),(o==="click"||o.includes("click"))&&{onClick:function(){return A?B():O()}}),(o==="focus"||o.includes("focus"))&&{onFocus:function(){return O()},onBlur:function(){return B()}}),(o==="hover"||o.includes("hover"))&&{onMouseEnter:function(){return O()},onMouseLeave:function(){return B()}})),l.createElement(be,{container:x,portal:!0},z&&l.createElement("div",N({className:T("popover","bs-popover-auto",{fade:p,show:A},y),id:J,ref:D,role:"tooltip"},E),l.createElement("div",{className:"popover-arrow"}),l.createElement("div",{className:"popover-header"},a),l.createElement("div",{className:"popover-body"},h))))});Q.propTypes={animation:n.bool,children:n.node,className:n.string,container:n.any,content:n.oneOfType([n.string,n.node]),delay:n.oneOfType([n.number,n.shape({show:n.number.isRequired,hide:n.number.isRequired})]),fallbackPlacements:Ce,offset:n.any,onHide:n.func,onShow:n.func,placement:n.oneOf(["auto","top","right","bottom","left"]),popperConfig:n.oneOfType([n.func,n.object]),title:n.oneOfType([n.string,n.node]),trigger:ve,visible:n.bool};Q.displayName="CPopover";const ze=()=>{const t=sessionStorage.getItem("accessToken"),v=U.create({baseURL:"http://localhost:5057",withCredentials:!0,headers:{"Content-Type":"application/json",...t&&{Authorization:`Bearer ${t}`}}}),i=new Date().toISOString().split("T")[0],p={inspector:"",vehicleId:"",status:"Pending",scheduledDate:i},[y,x]=r.useState(!1),[h,c]=r.useState(!1),[C,d]=r.useState(null),[I,k]=r.useState([]),[f,g]=r.useState(p),[L,j]=r.useState(!1),b=async()=>{try{const a=await v.get("/api/v1/vehicle/inspection");a.status===200?(k(a.data.data),x(!1)):d(a.data.message)}catch(a){d(a.message)}};r.useEffect(()=>{b()},[]);const u=async a=>{x(!0),a.currentTarget.checkValidity()===!1&&(a.preventDefault(),a.stopPropagation()),j(!0);try{const o=await v.post("/api/v1/maintenance/inspection",f);console.log(o),o.data.success?(g(p),c(!1)):d(o.data.message)}catch(o){d(o.response.data.message)}finally{x(!1)}};return e.jsxs(e.Fragment,{children:[y?e.jsx(M,{color:"primary",size:"sm"}):e.jsxs(F,{color:"primary",className:"mb-3",variant:"outline",onClick:()=>c(!h),children:[e.jsx(R,{icon:ye})," Add Inspection"]}),e.jsxs(oe,{visible:h,onClose:()=>c(!1),children:[e.jsx(le,{children:e.jsx(ce,{children:"Add Inspection"})}),C&&e.jsx(V,{color:"danger",className:"m-3",children:C}),e.jsx(ie,{children:e.jsxs(ue,{noValidate:!0,validated:L,children:[e.jsx(H,{className:"mb-3",type:"text",floatingLabel:"Inspector",name:"inspector",placeholder:"Inspector",required:!0,value:f.inspector,onChange:a=>g({...f,inspector:a.target.value})}),e.jsxs(we,{className:"mb-3","aria-label":"Select Vehicle",name:"vehicleId",required:!0,value:f.vehicleId,onChange:a=>g({...f,vehicleId:a.target.value}),children:[e.jsx("option",{value:"",children:"Select Vehicle"}),I.map(a=>e.jsxs("option",{value:a._id,children:[a.brand," - ",a.model," - ",a.regisNumber]},a._id))]}),e.jsx(H,{className:"mb-3",type:"date",name:"scheduledDate",placeholder:"Scheduled Date",required:!0,min:i,value:f.scheduledDate,onChange:a=>g({...f,scheduledDate:a.target.value})}),e.jsxs(de,{children:[y?e.jsx(M,{color:"secondary",size:"sm"}):e.jsx(F,{color:"secondary",variant:"outline",onClick:()=>{c(!1),g(p),d(null),j(!1)},children:"Cancel"}),y?e.jsx(M,{color:"primary",size:"sm"}):e.jsx(F,{color:"primary",variant:"outline",onClick:u,children:"Add Inspection"})]})]})})]})]})};sessionStorage.getItem("accessToken");const Oe=t=>{const{showError:w,showSuccess:v}=xe(),[i,p]=r.useState(!1),[y,x]=r.useState(null),h=async()=>{p(!0);const c=await je.delete(`/api/v1/maintenance/inspection/${t.item._id}`);c.data.success?(v(c.data.message),p(!1),x(null)):(p(!1),x(c.data.message),w(c.data.message))};return e.jsx(e.Fragment,{children:e.jsx(F,{color:"danger",variant:"outline",disabled:i,onClick:h,className:"me-2",children:i?e.jsx(M,{size:"sm"}):e.jsx(R,{icon:ke})})})},ae=sessionStorage.getItem("accessToken"),Be="http://localhost:5057",He=U.create({baseURL:Be,withCredentials:!0,headers:{"Content-Type":"application/json",...ae&&{Authorization:`Bearer ${ae}`}}}),me=({item:t,visible:w,onClose:v,onUpdate:i})=>{const[p,y]=r.useState(!1),[x,h]=r.useState(null),[c,C]=r.useState(null),[d,I]=r.useState(!1),[k,f]=r.useState({visualInspection:{physical:{cracks:!1,corrosion:!1,wear:!1,damage:!1},operational:{noise:!1,leaks:!1,misalignment:!1,looseFasteners:!1},safety:{guards:!1,emergencyStop:!1,lockoutTagout:!1,fireSafety:!1},mechanical:{bearings:{play:!1,overheating:!1,metalShavings:!1},belts:{tension:!1,wear:!1,damage:!1},motors:{noise:!1,overheating:!1,looseConnections:!1}},electrical:{wiring:{insulation:!1,termination:!1,overheating:!1},controlPanels:{functionality:!1,labeling:!1,damage:!1}},fluidSystems:{lubrication:{oilLevel:!1,lubrication:!1,cleanliness:!1},hydraulicFluid:{level:!1,condition:!1,filter:!1}},documents:{registration:!1,insurance:!1}},notes:""});r.useEffect(()=>{const b=()=>{if(t!=null&&t.scheduledDate){const a=new Date,s=new Date(t.scheduledDate);I(a>=s)}};b();const u=setInterval(b,6e4);return()=>clearInterval(u)},[t]),r.useEffect(()=>{t&&t.visualInspection&&f({visualInspection:t.visualInspection})},[t]);const g=b=>{if(!d){h("Cannot update inspection before scheduled date");return}const{name:u,checked:a}=b.target;f(s=>{const o={...s},m=u.split(".");let E=o;for(let S=0;S<m.length-1;S++)E=E[m[S]];return E[m[m.length-1]]=a,o})},L=async()=>{var b,u;if(!(t!=null&&t._id)){h("Invalid item ID");return}try{y(!0),h(null),C(null),console.log("Sending data:",{inspectionId:t._id,checkList:k}),(await He.put(`/api/v1/maintenance/inspection/${t._id}`,k)).status===200&&(C("Maintenance checklist updated successfully"),i&&i(),setTimeout(()=>{v()},2e3))}catch(a){h(((u=(b=a.response)==null?void 0:b.data)==null?void 0:u.message)||"An error occurred while updating the checklist")}finally{y(!1)}},j=(b,u="")=>Object.entries(b).map(([a,s])=>{const o=u?`${u}.${a}`:a;return typeof s=="object"&&s!==null?e.jsxs("div",{className:"ms-3",children:[e.jsx("h6",{className:"text-capitalize",children:a}),j(s,o)]},o):e.jsx(G,{id:o,label:a.charAt(0).toUpperCase()+a.slice(1),name:o,checked:s,onChange:g,disabled:!d},o)});return e.jsxs(oe,{visible:w,onClose:v,children:[e.jsx(le,{children:e.jsx(ce,{children:"Maintenance Check List"})}),x&&e.jsx(V,{color:"danger",className:"m-3",children:x}),c&&e.jsx(V,{color:"success",className:"m-3",children:c}),!d&&e.jsxs(V,{color:"warning",className:"m-3",children:["This inspection cannot be updated until"," ",new Date(t==null?void 0:t.scheduledDate).toLocaleDateString()]}),e.jsx(ie,{children:e.jsx(ue,{children:j(k.visualInspection,"visualInspection")})}),e.jsxs(de,{children:[e.jsx(F,{color:"secondary",onClick:v,children:"Close"}),e.jsx(F,{color:"primary",onClick:L,disabled:p||!d,children:p?e.jsxs(e.Fragment,{children:[e.jsx(M,{size:"sm",className:"me-2"}),"Saving..."]}):"Save Changes"})]})]})};me.propTypes={item:n.shape({_id:n.string,visualInspection:n.object}),visible:n.bool.isRequired,onClose:n.func.isRequired,onUpdate:n.func};const ne=sessionStorage.getItem("accessToken"),qe="http://localhost:5057",Ue=U.create({baseURL:qe,withCredentials:!0,headers:{"Content-Type":"application/json",...ne&&{Authorization:`Bearer ${ne}`}}}),Ge=()=>{const[t,w]=r.useState(!1),[v,i]=r.useState(null),[p,y]=r.useState([]),[x,h]=r.useState(!0),[c,C]=r.useState(""),[d,I]=r.useState([]),[k,f]=r.useState(null),g=JSON.parse(sessionStorage.getItem("user")),L=["manager","admin"],j=async()=>{h(!0);try{const s=await Ue.get("/api/v1/maintenance/inspections");y(s.data.data),h(!1)}catch(s){console.error("Error fetching data:",s),h(!1)}},b=()=>{j()};r.useEffect(()=>{(async()=>{if(c==="")I(p);else{const o=p.filter(m=>m.vehicleId.toLowerCase().includes(c.toLowerCase())||m.vehicleId.regisNumber.toLowerCase().includes(c.toLowerCase())||m.scheduledDate.toLowerCase().includes(c.toLowerCase())||m.inspector.toLowerCase().includes(c.toLowerCase())||u.find(E=>E.value===m.status).label.toLowerCase().includes(c.toLowerCase()));I(o),o.length===0?f("No results found"):f(null)}})(),j()},[c,p]);const u=[{value:"Pending",label:"Pending"},{value:"Completed",label:"Completed"},{value:"Cancelled",label:"Cancelled"},{value:"In Progress",label:"In Progress"}],a=s=>{switch(s){case"Pending":return"yellow";case"Completed":return"green";case"In Progress":return"orange";case"Cancelled":return"red";default:return"black"}};return e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"mt-3",children:e.jsxs(Ee,{className:"w-50 mb-3",children:[e.jsx(H,{type:"text",placeholder:"Search vehicles",id:"search",value:c,onChange:s=>C(s.target.value),className:"w-50 me-2 "}),e.jsx(Le,{children:e.jsx(R,{icon:Se})})]})}),t&&e.jsx(me,{item:v,visible:t,onClose:()=>w(!1),onUpdate:b}),d.length>0?e.jsx(Pe,{className:"m-2",children:d.map(s=>e.jsxs(Fe,{children:[e.jsxs(Te,{children:[e.jsxs("p",{className:"w-100 m-1 ",children:["Registration Number:",e.jsx("strong",{className:"ms-2",children:s.vehicleId?`${s.vehicleId.regisNumber} - ${s.vehicleId.model}`:""})]}),e.jsx(R,{icon:Ie,color:a(s.status),className:"m-2 float-end"}),e.jsxs("small",{className:"m-2 float-end",children:[" ",u.find(o=>o.value===s.status).label]})]}),e.jsxs(De,{children:[e.jsxs($,{children:["Scheduled Date: ",new Date(s.scheduledDate).toLocaleDateString()]}),e.jsxs($,{children:["Name of Inspector: ",s.inspector]}),e.jsxs(q,{className:"d-flex justify-content-end mt-3",children:[e.jsx(Q,{content:"It is disable if the status is completed",placement:"right",trigger:["hover","focus"],children:e.jsx("span",{className:"d-inline-block",tabIndex:0,children:e.jsx(F,{color:"primary",className:"me-2",variant:"outline",disabled:s.status==="Completed",onClick:()=>{i(s),w(!0)},children:e.jsx(R,{icon:Ne})})})}),L.includes(g.role)&&e.jsx(Oe,{item:s})]})]})]},s._id))}):e.jsx($,{className:"justify-content-center",children:"0 results found"}),k&&e.jsx(V,{color:"danger",className:"text-center justify-content-center",children:k})]})},dt=()=>e.jsxs(e.Fragment,{children:[e.jsx($,{className:"text-center",children:"Maintenance Management"}),e.jsx(q,{className:"m-3",children:e.jsx(ze,{})}),e.jsxs(Ve,{children:[e.jsx($,{children:"Schedule List"}),e.jsx($e,{className:"md-3",children:e.jsx(Ge,{})})]})]});export{dt as default};
