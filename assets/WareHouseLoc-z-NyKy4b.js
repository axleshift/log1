import{r as a,_ as pe,u as ge,a as L,R as E,C as xe,c as je,P as g,d as Ce,D as ve,A as Q,j as e,k,m as _,B as be}from"./index-OS-NyFnD.js";import{F as z,n as ye,q as Ne,g as we,e as Se}from"./index-CPTnCzBI.js";import{a as W}from"./CButton-BwxQ32p8.js";import{C as re,a as oe,b as ne,c as ie,d as le}from"./CModalTitle-j_yCU1Vx.js";import{C as A}from"./CAlert-BUN3_jXB.js";import{C as ce}from"./CForm-MB4DKwRu.js";import{C as I}from"./CFormInput-D0wRZccJ.js";import{C as G}from"./CContainer-Dd87jvFf.js";import{C as Pe}from"./CInputGroup-C2DGmx3N.js";import{C as Le}from"./CInputGroupText-DjuVUOS1.js";import{C as ke}from"./CCard-Cv2hjL78.js";import{b as se,u as Te,C as de}from"./DefaultLayout-D3Rs_hW_.js";import{C as Ee}from"./CCardBody-D8owufz_.js";import{C as We,a as Ae,b as ae,c as H,d as Fe,e as O}from"./CTable-ypv1XUTW.js";import{g as Re}from"./getTransitionDurationFromElement-Cpu4p4hx.js";import{C as Ie,a as J}from"./CPaginationItem-6hp7qCqS.js";import"./index.esm-CCoMbGbm.js";import"./1-DlKV4AGn.js";import"./cil-user-Ddrdy7PS.js";var te=function(s){typeof s=="function"&&s()},Be=function(s){s.dispatchEvent(new Event("transitionend"))},Ve=function(s,d,v){if(v===void 0&&(v=!0),!v){te(s);return}var j=5,x=Re(d)+j,n=!1,m=function(r){var l=r.target;l===d&&(n=!0,d.removeEventListener("transitionend",m),te(s))};d.addEventListener("transitionend",m),setTimeout(function(){n||Be(d)},x)},De=function(s,d){switch(s){case"right":return se(d)?"left":"right";case"left":return se(d)?"right":"left";default:return s}},R=a.forwardRef(function(s,d){var v=s.children,j=s.animation,x=j===void 0?!0:j,n=s.className,m=s.container,r=s.content,l=s.delay,c=l===void 0?0:l,o=s.fallbackPlacements,u=o===void 0?["top","right","bottom","left"]:o,f=s.offset,y=f===void 0?[0,6]:f,C=s.onHide,N=s.onShow,w=s.placement,T=w===void 0?"top":w,h=s.popperConfig,S=s.trigger,p=S===void 0?["hover","focus"]:S,b=s.visible,t=pe(s,["children","animation","className","container","content","delay","fallbackPlacements","offset","onHide","onShow","placement","popperConfig","trigger","visible"]),i=a.useRef(null),P=a.useRef(null),q=ge(d,i),B="tooltip".concat(a.useId()),$=a.useState(!1),V=$[0],K=$[1],X=a.useState(b),F=X[0],Y=X[1],U=Te(),ue=U.initPopper,fe=U.destroyPopper,me=U.updatePopper,Z=typeof c=="number"?{show:c,hide:c}:c,ee={modifiers:[{name:"arrow",options:{element:".tooltip-arrow"}},{name:"flip",options:{fallbackPlacements:u}},{name:"offset",options:{offset:y}}],placement:De(T,P.current)},he=L(L({},ee),typeof h=="function"?h(ee):h);a.useEffect(function(){if(b){D();return}M()},[b]),a.useEffect(function(){if(V&&P.current&&i.current){ue(P.current,i.current,he),setTimeout(function(){Y(!0)},Z.show);return}!V&&P.current&&i.current&&fe()},[V]),a.useEffect(function(){!F&&P.current&&i.current&&Ve(function(){K(!1)},i.current)},[F]);var D=function(){K(!0),N&&N()},M=function(){setTimeout(function(){Y(!1),C&&C()},Z.hide)};return a.useEffect(function(){me()},[r]),E.createElement(E.Fragment,null,E.cloneElement(v,L(L(L(L(L({},F&&{"aria-describedby":B}),{ref:P}),(p==="click"||p.includes("click"))&&{onClick:function(){return F?M():D()}}),(p==="focus"||p.includes("focus"))&&{onFocus:function(){return D()},onBlur:function(){return M()}}),(p==="hover"||p.includes("hover"))&&{onMouseEnter:function(){return D()},onMouseLeave:function(){return M()}})),E.createElement(xe,{container:m,portal:!0},V&&E.createElement("div",L({className:je("tooltip","bs-tooltip-auto",{fade:x,show:F},n),id:B,ref:q,role:"tooltip"},t),E.createElement("div",{className:"tooltip-arrow"}),E.createElement("div",{className:"tooltip-inner"},r))))});R.propTypes={animation:g.bool,children:g.node,container:g.any,content:g.oneOfType([g.string,g.node]),delay:g.oneOfType([g.number,g.shape({show:g.number.isRequired,hide:g.number.isRequired})]),fallbackPlacements:ve,offset:g.any,onHide:g.func,onShow:g.func,placement:g.oneOf(["auto","top","right","bottom","left"]),popperConfig:g.oneOfType([g.func,g.object]),trigger:Ce,visible:g.bool};R.displayName="CTooltip";const Me=({onAddWarehouseLoc:s})=>{const{showSuccess:d,showError:v}=Q(),[j,x]=a.useState(!1),[n,m]=a.useState(!1),[r,l]=a.useState(!1),[c,o]=a.useState(null),[u,f]=a.useState(null),y={warehouseName:"",address:""},[C,N]=a.useState(y),w=h=>{const{id:S,value:p}=h.target;N(b=>({...b,[S]:p}))},T=async h=>{const p=h.currentTarget.checkValidity();if(p||(h.preventDefault(),h.stopPropagation()),x(p),p){const t=JSON.parse(sessionStorage.getItem("user")).email;if(!t){o("User email not found. Please log in again.");return}l(!0);try{const i=await _.post("api/v1/warehouseLoc/add",{...C,createdBy:t});i.data.success&&(d(i.data.message),s(i.data.data),setTimeout(()=>{l(!1),m(!1),o(null),N(y),x(!1)},2e3))}catch(i){o(i.response.data.message),v(i.response.data.message),setTimeout(()=>{o(null)},2e3)}l(!1)}};return e.jsx(e.Fragment,{children:r?e.jsx(k,{color:"primary",size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsxs(W,{color:"primary",variant:"outline",disabled:r,onClick:()=>m(!0),children:[r?e.jsx(k,{color:"secondary",size:"sm"}):e.jsx(z,{icon:ye})," ","Add Warehouse Location"]}),e.jsxs(re,{visible:n,onClose:()=>m(!1),children:[e.jsx(oe,{closeButton:!0,children:e.jsx(ne,{children:"Add Warehouse Location"})}),c&&e.jsx(A,{color:"danger",className:"m-3",children:c}),u&&e.jsx(A,{color:"success",className:"m-3",children:u}),e.jsx(ie,{children:e.jsxs(ce,{noValidate:!0,validated:j,children:[e.jsx(I,{type:"text",id:"warehouseName",className:"mb-3",placeholder:"Warehouse Name",floatingLabel:"Warehouse Name",onChange:w,value:C.warehouseName,autoComplete:"off",required:!0,feedbackInvalid:"Please enter a warehouse name",feedbackValid:"Looks good!"}),e.jsx(I,{type:"text",id:"address",className:"mb-3",placeholder:"Address",floatingLabel:"Address",onChange:w,value:C.address,autoComplete:"off",required:!0,feedbackInvalid:"Please enter an address",feedbackValid:"Looks good!"})]})}),e.jsxs(le,{children:[e.jsx(W,{color:"secondary",variant:"outline",disabled:r,onClick:()=>{m(!1),N(y),m(!1),o(null),x(!1)},children:r?e.jsx(k,{color:"secondary",size:"sm"}):"Cancel"}),e.jsx(W,{color:"primary",variant:"outline",disabled:r,onClick:T,children:r?e.jsx(k,{color:"primary",size:"sm"}):"Add"})]})]})]})})},He=({warehouseLoc:s,onDeleteWarehouseLoc:d})=>{const{showSuccess:v,showError:j}=Q(),[x,n]=a.useState(!1),[m,r]=a.useState(null),l=async()=>{n(!0);try{const c=await _.patch(`api/v1/warehouseLoc/delete/${s._id}`);c.data.success&&(v(c.data.message),d(s._id),n(!1),r(null))}catch(c){r(c),j(c.message)}finally{n(!1)}};return m?e.jsxs(A,{color:"danger",className:"text-center mt-5 w-75 mx-auto",children:["Error: ",m.message]}):e.jsx(e.Fragment,{children:e.jsx(W,{color:"danger",disabled:x,variant:"outline",onClick:l,className:"me-2",children:x?e.jsx(k,{size:"sm"}):e.jsx(z,{icon:Ne})})})},Oe=({warehouseLoc:s,onUpdateWarehouseLoc:d})=>{const{showSuccess:v,showErrors:j}=Q(),[x,n]=a.useState(!1),[m,r]=a.useState(!1),[l,c]=a.useState(!1),[o,u]=a.useState(null),[f,y]=a.useState(null),[C,N]=a.useState({warehouseName:s.warehouseName,address:s.address}),w=h=>{const{id:S,value:p}=h.target;N(b=>({...b,[S]:p}))},T=async h=>{const p=h.currentTarget.checkValidity();p||(h.preventDefault(),h.stopPropagation()),r(p);const t=JSON.parse(sessionStorage.getItem("user")).email;if(!t){u("User email not found. Please log in again.");return}c(!0);try{const i=await _.put(`api/v1/warehouseLoc/update/${s._id}`,{...C,createdBy:t});i.data.success&&(v(i.data.message),d(i.data.data),setTimeout(()=>{y(null),n(!1),u(null),r(!1)},2e3))}catch(i){u(i.response.data.message),j(i.response.data.message),setTimeout(()=>{u(null)},2e3)}c(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(W,{color:"primary",variant:"outline",disabled:l,onClick:()=>n(!0),className:"me-2",children:l?e.jsx(k,{size:"sm"}):e.jsx(z,{icon:we})}),e.jsxs(re,{visible:x,onClose:()=>n(!1),children:[e.jsx(oe,{closeButton:!0,children:e.jsx(ne,{children:"Update Warehouse Location"})}),o&&e.jsx(A,{color:"danger",className:"m-3",children:o}),f&&e.jsx(A,{color:"success",className:"m-3",children:f}),e.jsx(ie,{children:e.jsxs(ce,{noValidate:!0,validated:m,children:[e.jsx(I,{type:"text",id:"warehouseName",className:"mb-3",placeholder:"Warehouse Name",floatingLabel:"Warehouse Name",onChange:w,value:C.warehouseName,autoComplete:"off",required:!0,feedbackInvalid:"Please enter a warehouse name.",feedbackValid:"Looks good!"}),e.jsx(I,{type:"text",id:"address",className:"mb-3",placeholder:"Address",floatingLabel:"Address",onChange:w,value:C.address,autoComplete:"off",required:!0,feedbackInvalid:"Please enter an address.",feedbackValid:"Looks good!"})]})}),e.jsxs(le,{children:[e.jsx(W,{color:"secondary",variant:"outline",disabled:l,onClick:()=>{n(!1),u(null),r(!1)},children:l?e.jsx(k,{size:"sm",color:"secondary"}):"Cancel"}),e.jsx(W,{color:"primary",variant:"outline",disabled:l,onClick:T,children:l?e.jsx(k,{size:"sm",color:"success"}):"Update"})]})]})]})},_e=({warehouseLoc:s,loading:d,error:v,onDeleteWarehouseLoc:j,onUpdateWarehouseLoc:x})=>{const[n,m]=a.useState(""),[r,l]=a.useState([]),[c,o]=a.useState(1),[u,f]=a.useState(null),y=10,C=be(),N=["manager","admin"],w="admin";if(a.useEffect(()=>{l(s)},[s]),a.useEffect(()=>{if(n==="")l(s);else{const t=s.filter(i=>{const P=i.warehouseName.toLowerCase().includes(n.toLowerCase()),q=i.address.toLowerCase().includes(n.toLowerCase()),B=N.includes(C)&&i.createdBy.toLowerCase().includes(n.toLowerCase());return P||q||B});l(t),o(1),t.length===0?f("No results found"):f(null)}},[n,s]),s.length===0)return e.jsx(A,{color:"danger",className:"text-center mt-5 w-75 mx-auto justify-content-center",children:"No Warehouse Location Found"});const T=t=>{m(t.target.value)},h=c*y,S=h-y,p=r.slice(S,h),b=Math.ceil(r.length/y);return e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"m-3",children:e.jsxs(Pe,{className:"w-50 mb-3",children:[e.jsx(I,{type:"text",id:"search",value:n,onChange:T,placeholder:"Search Warehouse Location..."}),e.jsx(Le,{children:e.jsx(z,{icon:Se})})]})}),e.jsxs(ke,{children:[e.jsx(de,{children:"Warehouse Location List"}),e.jsxs(Ee,{className:"md-3",children:[e.jsxs(We,{bordered:!0,hover:!0,responsive:!0,className:"mx-auto ",children:[e.jsx(Ae,{className:"text-center",children:e.jsxs(ae,{children:[e.jsx(H,{className:"fixed-width bg-secondary",children:"Warehouse Name"}),e.jsx(H,{className:"fixed-width bg-secondary",children:"Address"}),w.includes(C)&&e.jsx(H,{className:"fixed-width bg-secondary",children:"Created By"}),e.jsx(H,{className:"fixed-width bg-secondary",children:"Actions"})]})}),e.jsx(Fe,{className:"text-center",children:p.map(t=>e.jsxs(ae,{children:[e.jsx(O,{className:"fixed-width",children:e.jsx(R,{content:t.warehouseName,children:e.jsx("span",{children:t.warehouseName})})}),e.jsx(O,{className:"fixed-width",children:e.jsx(R,{content:t.address,children:e.jsx("span",{children:t.address})})}),w.includes(C)&&e.jsx(O,{className:"fixed-width",color:"danger",children:e.jsx(R,{content:t.createdBy,children:e.jsx("span",{children:t.createdBy})})}),e.jsxs(O,{className:"fixed-width",children:[e.jsx(Oe,{warehouseLoc:t,onUpdateWarehouseLoc:x}),N.includes(C)&&e.jsx(He,{warehouseLoc:t,onDeleteWarehouseLoc:j})]})]},t._id))})]}),r.length>0&&e.jsxs(G,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs(G,{children:["Showing ",S+1," to"," ",Math.min(h,r.length)," of"," ",r.length," entries"]}),e.jsxs(Ie,{className:"mt-3",children:[e.jsx(J,{disabled:c===1,onClick:()=>o(t=>Math.max(t-1,1)),children:"Previous"}),[...Array(b).keys()].map(t=>e.jsx(J,{active:t+1===c,onClick:()=>o(t+1),children:t+1},t+1)),e.jsx(J,{disabled:c===b,onClick:()=>o(t=>Math.min(t+1,b)),children:"Next"})]})]}),u&&e.jsx(A,{color:"danger",className:"text-center mt-5 w-75 mx-auto justify-content-center",children:u})]})]})]})};sessionStorage.getItem("accessToken");const ls=()=>{const[s,d]=a.useState([]),[v,j]=a.useState(!1),[x,n]=a.useState(null),m=async()=>{var o,u;j(!0);try{const f=await _.get("api/v1/warehouseLoc/locations");f.status===200?d(f.data.data):n(f.data.message)}catch(f){n(((u=(o=f.response)==null?void 0:o.data)==null?void 0:u.message)||f.message)}finally{j(!1)}};a.useEffect(()=>{m()},[]);const r=o=>{d(u=>[...u,o])},l=o=>{d(u=>u.filter(f=>f._id!==o))},c=o=>{d(u=>u.map(f=>f._id===o._id?o:f))};return e.jsxs(e.Fragment,{children:[e.jsx(de,{children:"Warehouse location"}),e.jsx(Me,{onAddWarehouseLoc:r}),e.jsx(_e,{warehouseLoc:s,loading:v,error:x,onDeleteWarehouseLoc:l,onUpdateWarehouseLoc:c})]})};export{ls as default};
