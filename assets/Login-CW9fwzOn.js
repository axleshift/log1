import{A as P,r as o,l as F,j as e,m as H}from"./index-C28bKDUe.js";import{C as j}from"./index.esm-Ds6UC3-Q.js";import{C as Q}from"./CContainer-Br42uRHM.js";import{a as A,C as w}from"./CRow-C90_rVMx.js";import{C as R}from"./CCardGroup--qVap18P.js";import{C as U}from"./CCard-D_2Oc8UW.js";import{C as q}from"./CCardBody-1KuKfgdv.js";import{C as G}from"./CForm-Nuabsl3F.js";import{C as y}from"./CAlert-vUEOweML.js";import{C as v}from"./CInputGroup-KmYLa6Bf.js";import{C as T}from"./CInputGroupText-BIWJqpLe.js";import{c as O}from"./cil-user-Ddrdy7PS.js";import{C as S}from"./CFormInput-C8HnDnj6.js";import{c as z}from"./cil-lock-locked-DmxpJbVL.js";import{a as B}from"./CButton-CvhGff8H.js";const ae=()=>{const{showToast:D,showSuccess:d,showError:p}=P(),n={username:"",password:""},[i,l]=o.useState(n),[u,b]=o.useState(null),[h,C]=o.useState(!1),[x,m]=o.useState(""),N=F(),f=r=>{const{id:s,value:a}=r.target;l(c=>({...c,[s]:a}))};o.useEffect(()=>((()=>{const s=document.createElement("script");s.src="https://www.google.com/recaptcha/api.js?render=6LeWQQQrAAAAAFt2e1zO5uXtCfmMxF1ohU5VgUYf",s.async=!0,s.defer=!0,s.onload=()=>{console.log("reCAPTCHA v3 script loaded"),d("reCAPTCHA v3 script loaded")},s.onerror=()=>{console.error("Error loading reCAPTCHA v3 script"),p("Error loading reCAPTCHA v3 script")},document.head.appendChild(s)})(),()=>{const s=document.querySelector('script[src*="recaptcha"]');s&&s.remove()}),[]);const L=async()=>{try{return await window.grecaptcha.execute("6LeWQQQrAAAAAFt2e1zO5uXtCfmMxF1ohU5VgUYf",{action:"login"})}catch(r){throw console.error("reCAPTCHA execution error:",r),p("reCAPTCHA execution error",r),r}},k=async r=>{var a,c;r.preventDefault(),C(!0),m("");const s=await L();try{const t=await H.post("api/v1/user/login",{...i,recaptchaToken:s});if(t.data.success){const{accessToken:E,refreshToken:g,user:I}=t.data;if(!g)throw new Error("Refresh token not received from server");sessionStorage.setItem("accessToken",E),sessionStorage.setItem("refreshToken",g),sessionStorage.setItem("user",JSON.stringify(I)),d(t.data.message),l(n),setTimeout(()=>{N("/dashboard"),b(null)},2e3)}}catch(t){m(((c=(a=t.response)==null?void 0:a.data)==null?void 0:c.message)||t.message),l(n),setTimeout(()=>{m(null)},5e3)}finally{C(!1)}};return e.jsx("div",{className:"bg-body-tertiary min-vh-100 d-flex flex-row align-items-center",children:e.jsx(Q,{children:e.jsx(A,{className:"justify-content-center",children:e.jsx(w,{xs:12,sm:10,md:8,lg:6,xl:4,children:e.jsx(R,{children:e.jsx(U,{className:"p-4",children:e.jsx(q,{children:e.jsxs(G,{onSubmit:k,children:[e.jsx("h1",{className:"text-center mb-3",children:"Login"}),e.jsx("p",{className:"text-body-secondary text-center mb-4",children:"Sign In to your account"}),u&&e.jsx(y,{color:"success",className:"text-success mb-3",children:u}),x&&e.jsx(y,{color:"danger",className:"text-danger mb-3",children:x}),e.jsxs(v,{className:"mb-3",children:[e.jsx(T,{children:e.jsx(j,{icon:O})}),e.jsx(S,{type:"text",placeholder:"Username",autoComplete:"off",id:"username",required:!0,value:i.username,onChange:f})]}),e.jsxs(v,{className:"mb-4",children:[e.jsx(T,{children:e.jsx(j,{icon:z})}),e.jsx(S,{type:"password",placeholder:"Password",autoComplete:"off",id:"password",required:!0,value:i.password,onChange:f})]}),e.jsx("div",{ref:window.recaptchaContainer}),e.jsx(A,{children:e.jsx(w,{xs:6,children:e.jsx(B,{type:"submit",color:"primary",className:"px-4",disabled:h,children:h?"Logging in...":"Login"})})})]})})})})})})})})};export{ae as default};
