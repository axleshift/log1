import{r as s,_ as ae,R as l,a as w,c as D,P as a,e as he,w as ge,j as e,C as M}from"./index-ROFYVZSB.js";import{a as q}from"./index-DW_MHI2K.js";import{u as be,e as ve,F as T,f as Ce,a as xe,c as je,d as ye,C as V,g as ke}from"./DefaultLayout-CSaaRxM-.js";import{a as R}from"./CButton-B6XfsDmw.js";import{C as ne,a as se,b as re,c as le,d as oe}from"./CModalTitle-RcsBXXdb.js";import{C as U}from"./CAlert-K7kYRrvA.js";import{C as ce}from"./CForm-DG9jDYNX.js";import{a as te,b as ie,C as $}from"./CFormInput-GqhhVFAX.js";import{C as Ie}from"./CFormSelect-DD8o0WcZ.js";import{u as de}from"./CCloseButton-DZNfoUeS.js";import{C as B}from"./index.esm-BM_BWR5J.js";import{C as Se,a as Ne}from"./CInputGroupText-MlH_-xN7.js";import{C as we,a as Le,b as Ee,c as Pe}from"./CAccordionHeader-C2MQPAho.js";import{g as Fe,e as Re}from"./getRTLPlacement-BxsIe2Ad.js";import{C as De}from"./CCard-CY27pPNB.js";import{C as Ae}from"./CCardBody-D_8Vsxmt.js";import"./cil-user-Ddrdy7PS.js";import"./getTransitionDurationFromElement-Cpu4p4hx.js";var G=s.forwardRef(function(t,j){var p=t.className,i=t.button,y=t.feedback,S=t.feedbackInvalid,x=t.feedbackValid,h=t.floatingLabel,k=t.tooltipFeedback,u=t.hitArea,c=t.id,L=t.indeterminate,b=t.inline,v=t.invalid,C=t.label,N=t.reverse,E=t.type,P=E===void 0?"checkbox":E,r=t.valid,g=ae(t,["className","button","feedback","feedbackInvalid","feedbackValid","floatingLabel","tooltipFeedback","hitArea","id","indeterminate","inline","invalid","label","reverse","type","valid"]),o=s.useRef(null),d=de(j,o);s.useEffect(function(){o.current&&L&&(o.current.indeterminate=L)},[L,o.current]);var n=function(){return l.createElement("input",w({type:P,className:D(i?"btn-check":"form-check-input",{"is-invalid":v,"is-valid":r,"me-2":u}),id:c},g,{ref:d}))},m=function(){return l.createElement(ie,{describedby:g["aria-describedby"],feedback:y,feedbackInvalid:S,feedbackValid:x,floatingLabel:h,invalid:v,tooltipFeedback:k,valid:r})},f=function(){var F;return l.createElement(te,w({customClassName:D(i?D("btn",i.variant?"btn-".concat(i.variant,"-").concat(i.color):"btn-".concat(i.color),(F={},F["btn-".concat(i.size)]=i.size,F),"".concat(i.shape)):"form-check-label")},c&&{htmlFor:c}),C)},I=function(){return i?l.createElement(l.Fragment,null,l.createElement(n,null),C&&l.createElement(f,null),l.createElement(m,null)):C?u?l.createElement(l.Fragment,null,l.createElement(n,null),l.createElement(te,w({customClassName:D("form-check-label stretched-link",p)},c&&{htmlFor:c}),C),l.createElement(m,null)):l.createElement("div",{className:D("form-check",{"form-check-inline":b,"form-check-reverse":N,"is-invalid":v,"is-valid":r},p)},l.createElement(n,null),l.createElement(f,null),l.createElement(m,null)):l.createElement(n,null)};return l.createElement(I,null)});G.propTypes=w({button:a.object,className:a.string,hitArea:a.oneOf(["full"]),id:a.string,indeterminate:a.bool,inline:a.bool,label:a.oneOfType([a.string,a.node]),reverse:a.bool,type:a.oneOf(["checkbox","radio"])},ie.propTypes);G.displayName="CFormCheck";var _=s.forwardRef(function(t,j){var p=t.children,i=t.animation,y=i===void 0?!0:i,S=t.className,x=t.container,h=t.content,k=t.delay,u=k===void 0?0:k,c=t.fallbackPlacements,L=c===void 0?["top","right","bottom","left"]:c,b=t.offset,v=b===void 0?[0,8]:b,C=t.onHide,N=t.onShow,E=t.placement,P=E===void 0?"top":E,r=t.popperConfig,g=t.title,o=t.trigger,d=o===void 0?"click":o,n=t.visible,m=ae(t,["children","animation","className","container","content","delay","fallbackPlacements","offset","onHide","onShow","placement","popperConfig","title","trigger","visible"]),f=s.useRef(null),I=s.useRef(null),F=de(j,f),Q="popover".concat(s.useId()),J=s.useState(!1),O=J[0],K=J[1],W=s.useState(n),A=W[0],X=W[1],Y=be(),fe=Y.initPopper,me=Y.destroyPopper,Z=typeof u=="number"?{show:u,hide:u}:u,ee={modifiers:[{name:"arrow",options:{element:".popover-arrow"}},{name:"flip",options:{fallbackPlacements:L}},{name:"offset",options:{offset:v}}],placement:Fe(P,I.current)},pe=w(w({},ee),typeof r=="function"?r(ee):r);s.useEffect(function(){if(n){z();return}H()},[n]),s.useEffect(function(){if(O&&I.current&&f.current){fe(I.current,f.current,pe),setTimeout(function(){X(!0)},Z.show);return}!O&&I.current&&f.current&&me()},[O]),s.useEffect(function(){!A&&I.current&&f.current&&Re(function(){K(!1)},f.current)},[A]);var z=function(){K(!0),N&&N()},H=function(){setTimeout(function(){X(!1),C&&C()},Z.hide)};return l.createElement(l.Fragment,null,l.cloneElement(p,w(w(w(w(w({},A&&{"aria-describedby":Q}),{ref:I}),(d==="click"||d.includes("click"))&&{onClick:function(){return A?H():z()}}),(d==="focus"||d.includes("focus"))&&{onFocus:function(){return z()},onBlur:function(){return H()}}),(d==="hover"||d.includes("hover"))&&{onMouseEnter:function(){return z()},onMouseLeave:function(){return H()}})),l.createElement(ve,{container:x,portal:!0},O&&l.createElement("div",w({className:D("popover","bs-popover-auto",{fade:y,show:A},S),id:Q,ref:F,role:"tooltip"},m),l.createElement("div",{className:"popover-arrow"}),l.createElement("div",{className:"popover-header"},g),l.createElement("div",{className:"popover-body"},h))))});_.propTypes={animation:a.bool,children:a.node,className:a.string,container:a.any,content:a.oneOfType([a.string,a.node]),delay:a.oneOfType([a.number,a.shape({show:a.number.isRequired,hide:a.number.isRequired})]),fallbackPlacements:ge,offset:a.any,onHide:a.func,onShow:a.func,placement:a.oneOf(["auto","top","right","bottom","left"]),popperConfig:a.oneOfType([a.func,a.object]),title:a.oneOfType([a.string,a.node]),trigger:he,visible:a.bool};_.displayName="CPopover";const Me=()=>{const j=q.create({baseURL:"http://localhost:5057",withCredentials:!0}),p=new Date().toISOString().split("T")[0],i={inspector:"",vehicleId:"",status:"Pending",scheduledDate:p},[y,S]=s.useState(!1),[x,h]=s.useState(!1),[k,u]=s.useState(null),[c,L]=s.useState([]),[b,v]=s.useState(i),[C,N]=s.useState(!1),E=async()=>{try{const r=await j.get("/api/v1/vehicle/inspection");r.status===200?(L(r.data.data),S(!1)):u(r.data.message)}catch(r){u(r.message)}};s.useEffect(()=>{E()},[]);const P=async r=>{S(!0),r.currentTarget.checkValidity()===!1&&(r.preventDefault(),r.stopPropagation()),N(!0);try{const o=await j.post("/api/v1/maintenance/inspection",b);console.log(o),o.data.success?(v(i),h(!1)):u(o.data.message)}catch(o){u(o.response.data.message)}finally{S(!1)}};return e.jsxs(e.Fragment,{children:[y?e.jsx(M,{color:"primary",size:"sm"}):e.jsxs(R,{color:"primary",className:"mb-3",variant:"outline",onClick:()=>h(!x),children:[e.jsx(T,{icon:Ce})," Add Inspection"]}),e.jsxs(ne,{visible:x,onClose:()=>h(!1),children:[e.jsx(se,{children:e.jsx(re,{children:"Add Inspection"})}),k&&e.jsx(U,{color:"danger",className:"m-3",children:k}),e.jsx(le,{children:e.jsxs(ce,{noValidate:!0,validated:C,children:[e.jsx($,{className:"mb-3",type:"text",floatingLabel:"Inspector",name:"inspector",placeholder:"Inspector",required:!0,value:b.inspector,onChange:r=>v({...b,inspector:r.target.value})}),e.jsxs(Ie,{className:"mb-3","aria-label":"Select Vehicle",name:"vehicleId",required:!0,value:b.vehicleId,onChange:r=>v({...b,vehicleId:r.target.value}),children:[e.jsx("option",{value:"",children:"Select Vehicle"}),c.map(r=>e.jsxs("option",{value:r._id,children:[r.brand," - ",r.model," - ",r.regisNumber]},r._id))]}),e.jsx($,{className:"mb-3",type:"date",name:"scheduledDate",placeholder:"Scheduled Date",required:!0,min:p,value:b.scheduledDate,onChange:r=>v({...b,scheduledDate:r.target.value})}),e.jsxs(oe,{children:[y?e.jsx(M,{color:"secondary",size:"sm"}):e.jsx(R,{color:"secondary",variant:"outline",onClick:()=>{h(!1),v(i),u(null),N(!1)},children:"Cancel"}),y?e.jsx(M,{color:"primary",size:"sm"}):e.jsx(R,{color:"primary",variant:"outline",onClick:P,children:"Add Inspection"})]})]})})]})]})},Te=t=>{const[j,p]=s.useState(!1),[i,y]=s.useState(null),x=q.create({baseURL:"http://localhost:5057"}),h=async()=>{p(!0);const k=await x.delete(`/api/v1/maintenance/inspection/${t.item._id}`);k.status===200?(alert("Maintenance Inspection deleted successfully"),p(!1),y(null)):(p(!1),y(k.data.message))};return e.jsx(e.Fragment,{children:e.jsx(R,{color:"danger",variant:"outline",disabled:j,onClick:h,className:"me-2",children:j?e.jsx(M,{size:"sm"}):e.jsx(T,{icon:xe})})})},ue=({item:t,visible:j,onClose:p,onUpdate:i})=>{const[y,S]=s.useState(!1),[x,h]=s.useState(null),[k,u]=s.useState(null),[c,L]=s.useState(!1),v=q.create({baseURL:"http://localhost:5057",withCredentials:!0}),[C,N]=s.useState({visualInspection:{physical:{cracks:!1,corrosion:!1,wear:!1,damage:!1},operational:{noise:!1,leaks:!1,misalignment:!1,looseFasteners:!1},safety:{guards:!1,emergencyStop:!1,lockoutTagout:!1,fireSafety:!1},mechanical:{bearings:{play:!1,overheating:!1,metalShavings:!1},belts:{tension:!1,wear:!1,damage:!1},motors:{noise:!1,overheating:!1,looseConnections:!1}},electrical:{wiring:{insulation:!1,termination:!1,overheating:!1},controlPanels:{functionality:!1,labeling:!1,damage:!1}},fluidSystems:{lubrication:{oilLevel:!1,lubrication:!1,cleanliness:!1},hydraulicFluid:{level:!1,condition:!1,filter:!1}},documents:{registration:!1,insurance:!1}},notes:""});s.useEffect(()=>{const g=()=>{if(t!=null&&t.scheduledDate){const d=new Date,n=new Date(t.scheduledDate);L(d>=n)}};g();const o=setInterval(g,6e4);return()=>clearInterval(o)},[t]),s.useEffect(()=>{t&&t.visualInspection&&N({visualInspection:t.visualInspection})},[t]);const E=g=>{if(!c){h("Cannot update inspection before scheduled date");return}const{name:o,checked:d}=g.target;N(n=>{const m={...n},f=o.split(".");let I=m;for(let F=0;F<f.length-1;F++)I=I[f[F]];return I[f[f.length-1]]=d,m})},P=async()=>{var g,o;if(!(t!=null&&t._id)){h("Invalid item ID");return}try{S(!0),h(null),u(null),console.log("Sending data:",{inspectionId:t._id,checkList:C}),(await v.put(`/api/v1/maintenance/inspection/${t._id}`,C)).status===200&&(u("Maintenance checklist updated successfully"),i&&i(),setTimeout(()=>{p()},2e3))}catch(d){h(((o=(g=d.response)==null?void 0:g.data)==null?void 0:o.message)||"An error occurred while updating the checklist")}finally{S(!1)}},r=(g,o="")=>Object.entries(g).map(([d,n])=>{const m=o?`${o}.${d}`:d;return typeof n=="object"&&n!==null?e.jsxs("div",{className:"ms-3",children:[e.jsx("h6",{className:"text-capitalize",children:d}),r(n,m)]},m):e.jsx(G,{id:m,label:d.charAt(0).toUpperCase()+d.slice(1),name:m,checked:n,onChange:E,disabled:!c},m)});return e.jsxs(ne,{visible:j,onClose:p,children:[e.jsx(se,{children:e.jsx(re,{children:"Maintenance Check List"})}),x&&e.jsx(U,{color:"danger",className:"m-3",children:x}),k&&e.jsx(U,{color:"success",className:"m-3",children:k}),!c&&e.jsxs(U,{color:"warning",className:"m-3",children:["This inspection cannot be updated until"," ",new Date(t==null?void 0:t.scheduledDate).toLocaleDateString()]}),e.jsx(le,{children:e.jsx(ce,{children:r(C.visualInspection,"visualInspection")})}),e.jsxs(oe,{children:[e.jsx(R,{color:"secondary",onClick:p,children:"Close"}),e.jsx(R,{color:"primary",onClick:P,disabled:y||!c,children:y?e.jsxs(e.Fragment,{children:[e.jsx(M,{size:"sm",className:"me-2"}),"Saving..."]}):"Save Changes"})]})]})};ue.propTypes={item:a.shape({_id:a.string,visualInspection:a.object}),visible:a.bool.isRequired,onClose:a.func.isRequired,onUpdate:a.func};const Ve=()=>{const[t,j]=s.useState(!1),[p,i]=s.useState(null),S=q.create({baseURL:"http://localhost:5057"}),[x,h]=s.useState([]),[k,u]=s.useState(!0),[c,L]=s.useState(""),[b,v]=s.useState([]),[C,N]=s.useState(null),E=JSON.parse(sessionStorage.getItem("user")),P=["manager","admin"],r=async()=>{u(!0);try{const n=await S.get("/api/v1/maintenance/inspections");h(n.data.data),u(!1)}catch(n){console.error("Error fetching data:",n),u(!1)}},g=()=>{r()};s.useEffect(()=>{(async()=>{if(c==="")v(x);else{const m=x.filter(f=>f.vehicleId.toLowerCase().includes(c.toLowerCase())||f.vehicleId.regisNumber.toLowerCase().includes(c.toLowerCase())||f.scheduledDate.toLowerCase().includes(c.toLowerCase())||f.inspector.toLowerCase().includes(c.toLowerCase())||o.find(I=>I.value===f.status).label.toLowerCase().includes(c.toLowerCase()));v(m),m.length===0?N("No results found"):N(null)}})(),r()},[c,x]);const o=[{value:"Pending",label:"Pending"},{value:"Completed",label:"Completed"},{value:"Cancelled",label:"Cancelled"},{value:"In Progress",label:"In Progress"}],d=n=>{switch(n){case"Pending":return"yellow";case"Completed":return"green";case"In Progress":return"orange";case"Cancelled":return"red";default:return"black"}};return e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"mt-3",children:e.jsxs(Se,{className:"w-50 mb-3",children:[e.jsx($,{type:"text",placeholder:"Search vehicles",id:"search",value:c,onChange:n=>L(n.target.value),className:"w-50 me-2 "}),e.jsx(Ne,{children:e.jsx(T,{icon:je})})]})}),t&&e.jsx(ue,{item:p,visible:t,onClose:()=>j(!1),onUpdate:g}),b.length>0?e.jsx(we,{className:"m-2",children:b.map(n=>e.jsxs(Le,{children:[e.jsxs(Ee,{children:[e.jsxs("p",{className:"w-100 m-1 ",children:["Registration Number:",e.jsx("strong",{className:"ms-2",children:n.vehicleId?`${n.vehicleId.regisNumber} - ${n.vehicleId.model}`:""})]}),e.jsx(T,{icon:ye,color:d(n.status),className:"m-2 float-end"}),e.jsxs("small",{className:"m-2 float-end",children:[" ",o.find(m=>m.value===n.status).label]})]}),e.jsxs(Pe,{children:[e.jsxs(V,{children:["Scheduled Date: ",new Date(n.scheduledDate).toLocaleDateString()]}),e.jsxs(V,{children:["Name of Inspector: ",n.inspector]}),e.jsxs(B,{className:"d-flex justify-content-end mt-3",children:[e.jsx(_,{content:"It is disable if the status is completed",placement:"right",trigger:["hover","focus"],children:e.jsx("span",{className:"d-inline-block",tabIndex:0,children:e.jsx(R,{color:"primary",className:"me-2",variant:"outline",disabled:n.status==="Completed",onClick:()=>{i(n),j(!0)},children:e.jsx(T,{icon:ke})})})}),P.includes(E.data.user.role)&&e.jsx(Te,{item:n})]})]})]},n._id))}):e.jsx(V,{className:"justify-content-center",children:"0 results found"}),C&&e.jsx(U,{color:"danger",className:"text-center justify-content-center",children:C})]})},at=()=>e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"text-center",children:"Maintenance Management"}),e.jsx(B,{className:"m-3",children:e.jsx(Me,{})}),e.jsxs(De,{children:[e.jsx(V,{children:"Schedule List"}),e.jsx(Ae,{className:"md-3",children:e.jsx(Ve,{})})]})]});export{at as default};
