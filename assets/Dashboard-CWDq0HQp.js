import{r as a,_ as be,u as je,R as S,a as ee,c as te,P as m,j as e,k as re,m as q,l as Ce}from"./index-Cc-aJQDw.js";import{F as V,h as ye,a as ae,i as Me,j as Fe,k as Pe,l as Ve,m as _e}from"./index-3CAUoC7a.js";import{C as H}from"./CAlert-Bqq-CPOi.js";import{a as P,C as x}from"./CRow-BBO6KCJ9.js";import{C as B}from"./CCard-Do6IOp3C.js";import{C as $}from"./CCardHeader-C7NLDeGc.js";import{C as W}from"./CCardBody-Wl5G9IdW.js";import{C as Ne}from"./CInputGroup-QE7o7Iar.js";import{C as z}from"./CFormInput-s-0o6BnU.js";import{a as Se}from"./CButton-CBiNuK6-.js";import{C as Oe,a as Ue,b as ge,c as X,d as He,e as Q}from"./CTable-Drxq7RLw.js";import{C as Be,a as Z}from"./CPaginationItem-7t9Y70fJ.js";import{i as pe}from"./DefaultLayout-BU3bdEL3.js";import{C as $e,W as We}from"./WidgetsDropdown-Bro7H225.js";import{C as Ge}from"./CFormSelect-D6UjzW92.js";import"./CContainer-D-9r2DL9.js";import"./index.esm-Q_WZOXrc.js";import"./1-BEtrZC9p.js";import"./cil-user-Ddrdy7PS.js";var we=a.createContext({}),se=a.forwardRef(function(i,f){var I=i.children,w=i.activeIndex,c=w===void 0?0:w,E=i.className,D=i.controls,v=i.dark,C=i.indicators,T=i.interval,b=T===void 0?5e3:T,y=i.onSlid,g=i.onSlide,p=i.pause,N=p===void 0?"hover":p,k=i.touch,R=k===void 0?!0:k,n=i.transition,d=i.wrap,l=d===void 0?!0:d,h=be(i,["children","activeIndex","className","controls","dark","indicators","interval","onSlid","onSlide","pause","touch","transition","wrap"]),j=a.useRef(null),t=je(f,j),r=a.useRef({}).current,o=a.useState(c),s=o[0],L=o[1],M=a.useState(!1),A=M[0],O=M[1],_=a.useState(),ie=_[0],Ee=_[1],le=a.useState("next"),J=le[0],K=le[1],oe=a.useState(0),G=oe[0],De=oe[1],ce=a.useState(null),ke=ce[0],de=ce[1],ue=a.useState(),me=ue[0],he=ue[1];a.useEffect(function(){De(a.Children.toArray(I).length)}),a.useEffect(function(){me&&Y()},[me]),a.useEffect(function(){!A&&Y(),!A&&y&&y(s,J),A&&g&&g(s,J)},[A]),a.useEffect(function(){return window.addEventListener("scroll",xe),function(){window.removeEventListener("scroll",xe)}});var Y=function(){fe(),!(!l&&s===G-1)&&typeof b=="number"&&(r.timeout=setTimeout(function(){return Le()},typeof ie=="number"?ie:b))},fe=function(){return N&&r.timeout&&clearTimeout(r.timeout)},Le=function(){if(!document.hidden&&j.current&&pe(j.current)){if(A)return;U("next")}},U=function(u){A||(K(u),u==="next"?s===G-1?L(0):L(s+1):L(s===0?G-1:s-1))},Ie=function(u){if(s!==u){if(s<u){K("next"),L(u);return}s>u&&(K("prev"),L(u))}},xe=function(){!document.hidden&&j.current&&pe(j.current)?he(!0):he(!1)},Te=function(u){var F=ke;if(F!==null){var Re=u.touches[0].clientX,ve=F-Re;ve>5&&U("next"),ve<-5&&U("prev"),de(null)}},Ae=function(u){var F=u.touches[0].clientX;de(F)};return S.createElement("div",ee({className:te("carousel slide",{"carousel-fade":n==="crossfade"},E)},v&&{"data-coreui-theme":"dark"},{onMouseEnter:fe,onMouseLeave:Y},R&&{onTouchStart:Ae,onTouchMove:Te},h,{ref:t}),S.createElement(we.Provider,{value:{setAnimating:O,setCustomInterval:Ee}},C&&S.createElement("div",{className:"carousel-indicators"},Array.from({length:G},function(u,F){return F}).map(function(u){return S.createElement("button",ee({key:"indicator".concat(u),onClick:function(){!A&&Ie(u)},className:te({active:s===u}),"data-coreui-target":""},s===u&&{"aria-current":!0},{"aria-label":"Slide ".concat(u+1)}))})),S.createElement("div",{className:"carousel-inner"},a.Children.map(I,function(u,F){if(S.isValidElement(u))return S.cloneElement(u,{active:s===F,direction:J,key:F})})),D&&S.createElement(S.Fragment,null,S.createElement("button",{className:"carousel-control-prev",onClick:function(){return U("prev")}},S.createElement("span",{className:"carousel-control-prev-icon","aria-label":"prev"})),S.createElement("button",{className:"carousel-control-next",onClick:function(){return U("next")}},S.createElement("span",{className:"carousel-control-next-icon","aria-label":"next"})))))});se.propTypes={activeIndex:m.number,children:m.node,className:m.string,controls:m.bool,dark:m.bool,indicators:m.bool,interval:m.oneOfType([m.bool,m.number]),onSlid:m.func,onSlide:m.func,pause:m.oneOf([!1,"hover"]),touch:m.bool,transition:m.oneOf(["slide","crossfade"]),wrap:m.bool};se.displayName="CCarousel";var ne=a.forwardRef(function(i,f){var I=i.children,w=i.className,c=i.active,E=i.direction,D=i.interval,v=D===void 0?!1:D,C=be(i,["children","className","active","direction","interval"]),T=a.useContext(we),b=T.setAnimating,y=T.setCustomInterval,g=a.useRef(null),p=je(f,g),N=a.useRef(),k=a.useState(),R=k[0],n=k[1],d=a.useState(),l=d[0],h=d[1],j=a.useState(c&&"active"),t=j[0],r=j[1],o=a.useState(0),s=o[0],L=o[1];return a.useEffect(function(){c&&(y(v),s!==0&&h("carousel-item-".concat(E))),N.current&&!c&&r("active"),(c||N.current)&&setTimeout(function(){var M;s!==0&&((M=g.current)===null||M===void 0||M.offsetHeight,n("carousel-item-".concat(E==="next"?"start":"end")))},0),N.current=c,s===0&&L(s+1)},[c]),a.useEffect(function(){var M,A;return(M=g.current)===null||M===void 0||M.addEventListener("transitionstart",function(){c&&b(!0)}),(A=g.current)===null||A===void 0||A.addEventListener("transitionend",function(){c&&b(!1),n(""),h(""),c&&r("active"),c||r("")}),function(){var O,_;(O=g.current)===null||O===void 0||O.removeEventListener("transitionstart",function(){c&&b(!0)}),(_=g.current)===null||_===void 0||_.removeEventListener("transitionend",function(){c&&b(!1),n(""),h(""),c&&r("active"),c||r("")})}}),S.createElement("div",ee({className:te("carousel-item",t,R,l,w),ref:p},C),I)});ne.propTypes={active:m.bool,children:m.node,className:m.string,direction:m.string,interval:m.oneOfType([m.bool,m.number])};ne.displayName="CCarouselItem";const Xe=()=>{const[i,f]=a.useState([]),[I,w]=a.useState(!0),[c,E]=a.useState(null),[D,v]=a.useState([]),[C,T]=a.useState(1),[b]=a.useState(5),[y,g]=a.useState(""),[p,N]=a.useState({total:0,available:0,inUse:0,maintenance:0,forRegistration:0});a.useEffect(()=>{(async()=>{try{w(!0);const r=await q.get("/api/v1/vehicle");f(r.data.data);const o=r.data.data.reduce((s,L)=>{switch(s.total++,L.status){case"available":s.available++;break;case"in_use":s.inUse++;break;case"maintenance":s.maintenance++;break;case"forRegistration":s.forRegistration++;break;default:break}return s},{total:0,available:0,inUse:0,maintenance:0,forRegistration:0});N(o)}catch(r){E(r.message),console.error("Error fetching dashboard data:",r)}finally{w(!1)}})()},[]),a.useEffect(()=>{if(T(1),y==="")v(i);else{const t=i.filter(r=>{var s;const o=y.toLowerCase();return r.regisNumber.toLowerCase().includes(o)||r.brand.toLowerCase().includes(o)||r.model.toLowerCase().includes(o)||((s=j.find(L=>L.value===r.status))==null?void 0:s.label.toLowerCase().includes(o))});v(t)}},[y,i]);const k=C*b,R=k-b,n=D.slice(R,k),d=Math.ceil(D.length/b),l=t=>{T(t)},h=t=>{switch(t){case"available":return"success";case"in_use":return"danger";case"maintenance":return"warning";case"forRegistration":default:return"secondary"}},j=[{value:"available",label:"Available"},{value:"in_use",label:"In Use"},{value:"maintenance",label:"Maintenance"},{value:"inactive",label:"Inactive"},{value:"inspection",label:"Inspection"},{value:"forRegistration",label:"For Registration"}];return I?e.jsx(re,{color:"primary",children:"Loading vehicle data..."}):c?e.jsxs(H,{color:"danger",children:["Error: ",c]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{children:e.jsx(x,{children:e.jsxs(B,{className:"mb-4",children:[e.jsx($,{children:e.jsx("h4",{children:"Vehicle Overview"})}),e.jsx(W,{children:e.jsxs(P,{className:"d-flex align-items-center flex-wrap gap-5",children:[e.jsx(x,{md:2,children:e.jsxs("div",{className:"border-start border-start-4 border-start-success p-3",children:[e.jsx("h6",{children:"Available Vehicles"}),e.jsx("h4",{children:p.available})]})}),e.jsx(x,{md:2,children:e.jsxs("div",{className:"border-start border-start-4 border-start-danger p-3",children:[e.jsx("h6",{children:"In Use"}),e.jsx("h4",{children:p.inUse})]})}),e.jsx(x,{md:2,children:e.jsxs("div",{className:"border-start border-start-4 border-start-warning p-3",children:[e.jsx("h6",{children:"Under Maintenance"}),e.jsx("h4",{children:p.maintenance})]})}),e.jsx(x,{md:2,children:e.jsxs("div",{className:"border-start border-start-4 border-start-secondary p-3",children:[e.jsx("h6",{children:"For Registration"}),e.jsx("h4",{children:p.forRegistration})]})}),e.jsx(x,{md:2,children:e.jsxs("div",{className:"border-start border-start-4 border-start-info p-3",children:[e.jsx("h6",{children:"Total Fleet"}),e.jsx("h4",{children:p.total})]})})]})})]})})}),e.jsx(P,{children:e.jsx(x,{children:e.jsxs(B,{className:"mb-4",children:[e.jsx($,{children:e.jsxs(P,{className:"align-items-center ",children:[e.jsx(x,{children:e.jsx("h4",{children:"Vehicle List"})}),e.jsx(x,{xs:"auto",children:e.jsxs(Ne,{className:"mb-3",children:[e.jsx(z,{placeholder:"Search vehicles...",value:y,id:"searchTerm2",onChange:t=>g(t.target.value)}),e.jsx(Se,{color:"primary",variant:"outline",children:e.jsx(V,{icon:ye})})]})})]})}),e.jsxs(W,{children:[e.jsxs(Oe,{hover:!0,responsive:!0,children:[e.jsx(Ue,{children:e.jsxs(ge,{children:[e.jsx(X,{children:"Plate Number"}),e.jsx(X,{children:"Brand"}),e.jsx(X,{children:"Model"}),e.jsx(X,{children:"Status"})]})}),e.jsx(He,{children:n.map(t=>{var r;return e.jsxs(ge,{children:[e.jsx(Q,{children:t.regisNumber}),e.jsx(Q,{children:t.brand}),e.jsx(Q,{children:t.model}),e.jsx(Q,{children:e.jsxs(ae,{color:h(t.status),children:[" ",((r=j.find(o=>o.value===t.status))==null?void 0:r.label)||t.status]})})]},t._id)})})]}),D.length===0?e.jsx("div",{className:"text-center p-3",children:e.jsx(H,{color:"info",children:"No vehicles found matching your search criteria."})}):e.jsxs(Be,{align:"center","aria-label":"Page navigation",children:[e.jsx(Z,{disabled:C===1,onClick:()=>l(C-1),children:"Previous"}),[...Array(d)].map((t,r)=>e.jsx(Z,{active:C===r+1,onClick:()=>l(r+1),children:r+1},r+1)),e.jsx(Z,{disabled:C===d,onClick:()=>l(C+1),children:"Next"})]})]})]})})})]})},Qe=()=>{const i=Ce(),[f,I]=a.useState([]),[w,c]=a.useState(!0),[E,D]=a.useState(null),[v,C]=a.useState(""),[T,b]=a.useState({total:0,scheduled:0,inProgress:0,completed:0}),y=3;a.useEffect(()=>{(async()=>{try{c(!0);const d=await q.get("/api/v1/maintenance/all");I(d.data.data);const l=d.data.data.reduce((h,j)=>{switch(h.total++,j.status){case"Scheduled":h.scheduled++;break;case"In Progress":h.inProgress++;break;case"Completed":h.completed++;break;default:break}return h},{total:0,scheduled:0,inProgress:0,completed:0});b(l)}catch(d){D(d.message),console.error("Error fetching maintenance data:",d)}finally{c(!1)}})()},[]);const g=n=>{i("/fleetManagement/MaintenanceManagement",{state:{selectedMaintenanceId:n}})},p=f.filter(n=>{var l;const d=v.toLowerCase();return((l=n.vehicle)==null?void 0:l.regisNumber.toLowerCase().includes(d))||n.maintenanceType.toLowerCase().includes(d)||n.status.toLowerCase().includes(d)||n.priority.toLowerCase().includes(d)}),N=n=>{switch(n){case"Completed":return"success";case"In Progress":return"warning";case"Scheduled":return"info";default:return"primary"}},k=n=>{switch(n){case"High":return"danger";case"Medium":return"warning";case"Low":return"info";default:return"secondary"}},R=[];for(let n=0;n<p.length;n+=y)R.push(p.slice(n,n+y));return w?e.jsx(re,{color:"primary",children:"Loading maintenance data..."}):E?e.jsxs(H,{color:"danger",children:["Error: ",E]}):e.jsx(e.Fragment,{children:e.jsx(P,{children:e.jsx(x,{children:e.jsxs(B,{className:"mb-4",children:[e.jsx($,{children:e.jsxs(P,{className:"align-items-center",children:[e.jsx(x,{children:e.jsx("h4",{children:"Maintenance List"})}),e.jsx(x,{xs:"auto",children:e.jsxs(Ne,{className:"mb-3",children:[e.jsx(z,{placeholder:"Search maintenance...",value:v,id:"searchTerm",onChange:n=>C(n.target.value)}),e.jsx(Se,{color:"primary",variant:"outline",children:e.jsx(V,{icon:ye})})]})})]})}),e.jsx(W,{children:p.length===0?e.jsx(H,{color:"info",children:"No maintenance records found matching your search criteria."}):e.jsx(se,{controls:!0,indicators:!0,dark:!0,children:R.map((n,d)=>e.jsx(ne,{children:e.jsx(P,{children:n.map(l=>{var h;return e.jsx(x,{md:4,children:e.jsxs(B,{className:`mb-4 h-100 border-${N(l.status)} maintenance-card`,onClick:()=>g(l._id),style:{cursor:"pointer"},children:[e.jsx($,{className:`bg-${N(l.status)}`,children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx(V,{icon:Me})," ",(h=l.vehicle)==null?void 0:h.regisNumber]}),e.jsx(ae,{color:k(l.priority),children:l.priority})]})}),e.jsxs(W,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx(V,{icon:Fe})," ",e.jsx("strong",{children:"Type:"})," ",l.maintenanceType]}),e.jsxs("div",{className:"mb-3",children:[e.jsx(V,{icon:Pe})," ",e.jsx("strong",{children:"Start:"})," ",new Date(l.startDate).toLocaleDateString()]}),e.jsxs("div",{className:"mb-3",children:[e.jsx(V,{icon:Ve})," ",e.jsx("strong",{children:"Expected End:"})," ",new Date(l.expectedEndDate).toLocaleDateString()]}),e.jsxs("div",{children:[e.jsx(V,{icon:_e})," ",e.jsx("strong",{children:"Status:"})," ",e.jsx(ae,{color:N(l.status),children:l.status})]})]})]})},l._id)})})},d))})})]})})})})},qe=()=>{const i=Ce(),[f,I]=a.useState([]),[w,c]=a.useState(new Date(new Date().setMonth(new Date().getMonth()-1)).toISOString().split("T")[0]),[E,D]=a.useState(new Date().toISOString().split("T")[0]),[v,C]=a.useState(""),[T,b]=a.useState([]),[y,g]=a.useState(!0),[p,N]=a.useState(!1);a.useEffect(()=>{R(),k()},[w,E,v]);const k=async()=>{try{const t=await q.get("/api/v1/vehicle");b(t.data.data||[])}catch(t){console.error("Error fetching vehicles:",t)}},R=async()=>{try{g(!0);const t={startDate:w,endDate:E,...v&&{vehicleId:v}},r=await q.get("/api/v1/fuelLogs/fuel-logs/analytics",{params:t});I(r.data.data||[])}catch(t){console.error("Error fetching analytics:",t),I([])}finally{g(!1)}},n=t=>new Date(t).toLocaleDateString(),d=t=>{if(!(t!=null&&t.vehicleDetails))return"Unknown Vehicle";const{brand:r="",model:o="",regisNumber:s=""}=t.vehicleDetails;return`${r} ${o}${s?` (${s})`:""}`},l=()=>{if(!f||f.length===0)return null;if(v&&f.length===1){const t=f[0];if(!(t!=null&&t.fuelLogs))return null;const r=[...t.fuelLogs].sort((o,s)=>new Date(o.date)-new Date(s.date));return{labels:r.map(o=>n(o.date)),datasets:[{label:"Fuel Consumption (L)",data:r.map(o=>o.fuelQuantity||0),borderColor:"#321fdb",backgroundColor:"rgba(50, 31, 219, 0.1)",fill:!0,tension:.4},{label:"Cost",data:r.map(o=>o.totalCost||0),borderColor:"#2eb85c",backgroundColor:"rgba(46, 184, 92, 0.1)",fill:!0,tension:.4,yAxisID:"cost"},{label:"Efficiency (L/100km)",data:r.map(o=>parseFloat(o.litersPer100km)||0),borderColor:"#f9b115",backgroundColor:"rgba(249, 177, 21, 0.1)",fill:!0,tension:.4,yAxisID:"efficiency"}]}}else return{labels:f.map(t=>d(t)),datasets:[{label:"Total Fuel Consumption (L)",data:f.map(t=>t.totalFuelConsumption||0),borderColor:"#321fdb",backgroundColor:"rgba(50, 31, 219, 0.1)",fill:!0,tension:.4},{label:"Total Cost ",data:f.map(t=>t.totalCost||0),borderColor:"#2eb85c",backgroundColor:"rgba(46, 184, 92, 0.1)",fill:!0,tension:.4,yAxisID:"cost"},{label:"Average Efficiency (L/100km)",data:f.map(t=>t.averageEfficiency||0),borderColor:"#f9b115",backgroundColor:"rgba(249, 177, 21, 0.1)",fill:!0,tension:.4,yAxisID:"efficiency"}]}},h={responsive:!0,interaction:{mode:"index",intersect:!1},plugins:{legend:{position:"top"},title:{display:!0,text:v?"Vehicle Performance Over Time":"Vehicles Comparison"}},scales:{y:{type:"linear",display:!0,position:"left",title:{display:!0,text:"Fuel Consumption (L)"}},cost:{type:"linear",display:!0,position:"right",title:{display:!0,text:"Cost "},grid:{drawOnChartArea:!1}},efficiency:{type:"linear",display:!0,position:"right",title:{display:!0,text:"Efficiency (L/100km)"},grid:{drawOnChartArea:!1}}},maintainAspectRatio:!1},j=()=>{i("/fleetManagement/FuelManagement")};return e.jsx(P,{children:e.jsx(x,{xs:12,children:e.jsxs(B,{className:"mb-4",children:[e.jsxs($,{children:[e.jsxs("h4",{onClick:j,onMouseEnter:()=>N(!0),onMouseLeave:()=>N(!1),style:{cursor:"pointer",color:p?"grey":"inherit"},children:[" ","Fuel Analytics Dashboard"]}),e.jsxs(P,{className:"mt-3",children:[e.jsx(x,{md:4,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",htmlFor:"startDate",children:"Start Date"}),e.jsx(z,{type:"date",id:"startDate",value:w,onChange:t=>c(t.target.value)})]})}),e.jsx(x,{md:4,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",htmlFor:"endDate",children:"End Date"}),e.jsx(z,{type:"date",id:"endDate",value:E,onChange:t=>D(t.target.value)})]})}),e.jsx(x,{md:4,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",htmlFor:"vehicleId",children:"Vehicle"}),e.jsxs(Ge,{value:v,id:"vehicleId",onChange:t=>C(t.target.value),children:[e.jsx("option",{value:"",children:"All Vehicles"}),T.map(t=>e.jsxs("option",{value:t._id,children:[t.brand," ",t.model," - ",t.regisNumber]},t._id))]})]})})]})]}),e.jsx(W,{children:y?e.jsx("div",{className:"text-center",children:e.jsx(re,{})}):e.jsx("div",{style:{height:"400px"},children:f.length>0?e.jsx($e,{type:"line",style:{height:"400px"},data:l(),options:h}):e.jsx(H,{color:"danger",className:"text-center",children:"No data available"})})})]})})})},ft=()=>e.jsxs(e.Fragment,{children:[e.jsx(We,{className:"mb-4"}),e.jsx(Xe,{className:"mb-4"}),e.jsx(qe,{className:"mb-4"}),e.jsx(Qe,{className:"mb-4"})]});export{ft as default};
