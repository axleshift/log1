import{r as a,_ as U,R as k,a as q,c as W,P as p,j as e,C as H}from"./index-ROFYVZSB.js";import{h as xe,F as $,a as pe,i as ye,j as Z,C as F,f as be,k as je}from"./DefaultLayout-CSaaRxM-.js";import{a as P}from"./index-DW_MHI2K.js";import{C as A}from"./CAlert-K7kYRrvA.js";import{a as R}from"./CButton-B6XfsDmw.js";import{C as ee,a as te,b as ae,c as se,d as re}from"./CModalTitle-RcsBXXdb.js";import{C as ne}from"./CForm-DG9jDYNX.js";import{c as oe,C as M}from"./CFormInput-GqhhVFAX.js";import{C as ie}from"./CFormSelect-DD8o0WcZ.js";import{C as J}from"./index.esm-BM_BWR5J.js";import{C as ce,a as le}from"./CInputGroupText-MlH_-xN7.js";import{C as ve,a as ge,b as Ne,c as Ce}from"./CAccordionHeader-C2MQPAho.js";import{C as de,a as me,b as O,c as T,d as ue,e as L}from"./CTable-QL4Mn77d.js";import{C as Ie,a as B}from"./CPaginationItem-BjNS21Fc.js";import{u as he,T as we}from"./CCloseButton-DZNfoUeS.js";import{g as Se}from"./getTransitionDurationFromElement-Cpu4p4hx.js";import{C as Ae}from"./CCard-CY27pPNB.js";import"./cil-user-Ddrdy7PS.js";var Q=a.forwardRef(function(t,x){var n=t.children,m=t.className,o=t.feedback,c=t.feedbackInvalid,u=t.feedbackValid,b=t.floatingClassName,f=t.floatingLabel,i=t.id,l=t.invalid,d=t.label,C=t.plainText,g=t.text,j=t.tooltipFeedback,y=t.valid,v=U(t,["children","className","feedback","feedbackInvalid","feedbackValid","floatingClassName","floatingLabel","id","invalid","label","plainText","text","tooltipFeedback","valid"]);return k.createElement(oe,{describedby:v["aria-describedby"],feedback:o,feedbackInvalid:c,feedbackValid:u,floatingClassName:b,floatingLabel:f,id:i,invalid:l,label:d,text:g,tooltipFeedback:j,valid:y},k.createElement("textarea",q({className:W(C?"form-control-plaintext":"form-control",{"is-invalid":l,"is-valid":y},m),id:i},v,{ref:x}),n))});Q.propTypes=q({className:p.string,id:p.string,plainText:p.bool},oe.propTypes);Q.displayName="CFormTextarea";var G=a.createContext({}),_=a.forwardRef(function(t,x){var n=t.children,m=t.activeItemKey,o=t.className,c=t.onChange,u=a.useId(),b=a.useState(m),f=b[0],i=b[1];return a.useEffect(function(){f&&c&&c(f)},[f]),k.createElement(G.Provider,{value:{_activeItemKey:f,setActiveItemKey:i,id:u}},k.createElement("div",{className:W("tabs",o),ref:x},n))});_.propTypes={activeItemKey:p.oneOfType([p.number,p.string]).isRequired,children:p.node,className:p.string,onChange:p.func};_.displayName="CTabs";var D=a.forwardRef(function(t,x){var n=t.children,m=t.className,o=t.itemKey,c=U(t,["children","className","itemKey"]),u=a.useContext(G),b=u._activeItemKey,f=u.setActiveItemKey,i=u.id,l=function(){return o===b};return k.createElement("button",q({className:W("nav-link",{active:l()},m),id:"".concat(i).concat(o,"-tab"),onClick:function(){return f(o)},onFocus:function(){return f(o)},role:"tab",tabIndex:l()?0:-1,type:"button","aria-controls":"".concat(i).concat(o,"-tab-pane"),"aria-selected":l(),ref:x},c),n)});D.propTypes={children:p.node,className:p.string,disabled:p.bool,itemKey:p.oneOfType([p.number,p.string]).isRequired};D.displayName="CTab";var K=a.forwardRef(function(t,x){var n=t.children,m=t.className,o=t.itemKey,c=t.onHide,u=t.onShow,b=t.transition,f=b===void 0?!0:b,i=t.visible,l=U(t,["children","className","itemKey","onHide","onShow","transition","visible"]),d=a.useContext(G),C=d._activeItemKey,g=d.id,j=a.useRef(),y=he(x,j),v=a.useState(i||C===o),N=v[0],h=v[1];return a.useEffect(function(){i!==void 0&&h(i)},[i]),a.useEffect(function(){h(C===o)},[C]),k.createElement(we,{in:N,nodeRef:j,onEnter:u,onExit:c,timeout:j.current?Se(j.current):0},function(r){return k.createElement("div",q({className:W("tab-pane",{active:N,fade:f,show:r==="entered"},m),id:"".concat(g).concat(o,"-tab-pane"),role:"tabpanel","aria-labelledby":"".concat(g).concat(o,"-tab"),tabIndex:0,ref:y},l),n)})});K.propTypes={children:p.node,className:p.string,itemKey:p.oneOfType([p.number,p.string]).isRequired,onHide:p.func,onShow:p.func,transition:p.bool,visible:p.bool};K.displayName="CTabPanel";var X=a.forwardRef(function(t,x){var n,m=t.children,o=t.className,c=t.layout,u=t.variant,b=U(t,["children","className","layout","variant"]),f=a.useRef(null),i=he(x,f),l=function(d){if(f.current!==null&&(d.key==="ArrowDown"||d.key==="ArrowUp"||d.key==="ArrowLeft"||d.key==="ArrowRight"||d.key==="Home"||d.key==="End")){d.preventDefault();var C=d.target,g=Array.from(f.current.querySelectorAll(".nav-link:not(.disabled):not(:disabled)")),j=void 0;d.key==="Home"||d.key==="End"?j=d.key==="End"?g.at(-1):g[0]:j=xe(g,C,d.key==="ArrowDown"||d.key==="ArrowRight",!0),j&&j.focus({preventScroll:!0})}};return k.createElement("div",q({className:W("nav",(n={},n["nav-".concat(c)]=c,n["nav-".concat(u)]=u,n),o),role:"tablist",onKeyDown:l,ref:i},b),m)});X.propTypes={children:p.node,className:p.string,layout:p.oneOf(["fill","justified"]),variant:p.oneOf(["pills","tabs","underline","underline-border"])};X.displayName="CTabList";const ke="http://localhost:5057",Te=P.create({baseURL:ke}),Le=({warehousing:t,onDeleteItem:x})=>{const[n,m]=a.useState(null),[o,c]=a.useState(!1),u=async()=>{c(!0);const b=await Te.delete(`/api/v1/warehouse/delete/${t._id}`);b.status===200?(alert("Item deleted successfully"),x(t._id),c(!1),m(null)):(c(!1),m(b.data.message))};return n?e.jsxs(A,{color:"danger",className:"text-center mt-5 w-75 mx-auto",children:["Error: ",n.message]}):e.jsx(e.Fragment,{children:e.jsx(R,{color:"danger",variant:"outline",onClick:u,className:"me-2",children:o?e.jsx(H,{size:"sm"}):e.jsx($,{icon:pe})})})},Re="http://localhost:5057",Y=P.create({baseURL:Re}),Pe=({warehousing:t,onUpdateItem:x})=>{const[n,m]=a.useState(null),[o,c]=a.useState(!1),[u,b]=a.useState(null),[f,i]=a.useState(!1),[l,d]=a.useState([]),C=new Date().toISOString().split("T")[0];JSON.parse(sessionStorage.getItem("user"));const[g,j]=a.useState({from:t.from,items:t.items,dateArrival:C,warehouse:t.warehouse,status:t.status});a.useEffect(()=>{(async()=>{try{const h=await Y.get("/api/v1/warehouseLoc/locations");d(h.data.data)}catch(h){m(h.response.data.message)}})()},[]);const y=N=>{const{id:h,value:r}=N.target;j(s=>{if(["length","width","height"].includes(h)){const I=r===""?"":Math.max(1,Number(r));return{...s,[h]:I}}if(h==="items"){const I=JSON.parse(r);return{...s,items:I}}return{...s,[h]:r}})},v=async N=>{N.preventDefault();const h=sessionStorage.getItem("email");if(!h){m("User email not found. Please log in again.");return}c(!0);try{const r=await Y.put(`/api/v1/warehouse/update/${t._id}`,{...g,byReceived:h});if(r.status===200){const s=r.data.data,I=l.find(w=>w._id===s.warehouse);s.warehouse=I,b(r.data.message),x(r.data.data),setTimeout(()=>{b(null),i(!1)},2e3)}}catch(r){m(r.response.data.message),setTimeout(()=>{m(null)},2e3)}c(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(R,{color:"primary",variant:"outline",className:"me-2",onClick:()=>i(!0),children:o?e.jsx(H,{size:"sm"}):e.jsx($,{icon:ye})}),e.jsxs(ee,{visible:f,onClose:()=>i(!1),children:[e.jsx(te,{children:e.jsx(ae,{children:"Recieved Items"})}),n&&e.jsx(A,{color:"danger",children:n}),u&&e.jsx(A,{color:"success",children:u}),e.jsx(se,{children:e.jsxs(ne,{children:[e.jsx(M,{type:"text",placeholder:"From",className:"mb-3",floatingLabel:"From",id:"from",onChange:y,value:g.from,required:!0,readOnly:!0}),e.jsx(Q,{placeholder:"Items List",className:"mb-3 justify-content-center h-50",floatingLabel:"Items List",id:"items",rows:5,value:Array.isArray(g.items)?g.items.map((N,h)=>`${h+1}. ${N.itemName} (Quantity: ${N.quantity})`).join(`
`):g.items,readOnly:!0}),e.jsxs(ie,{placeholder:"Warehouse",className:"mb-3",floatingLabel:"Warehouse",id:"warehouse",onChange:y,value:g.warehouse._id,required:!0,children:[e.jsx("option",{value:null,children:"Select Warehouse"}),l.map(N=>e.jsx("option",{value:N._id,children:N.warehouseName},N._id))]})]})}),e.jsxs(re,{children:[e.jsx(R,{color:"secondary",variant:"outline",onClick:()=>i(!1),children:"Close"}),e.jsx(R,{color:"primary",variant:"outline",onClick:v,children:"Update Item"})]})]})]})},Ee="http://localhost:5057";P.create({baseURL:Ee});const Fe=({warehousing:t,loading:x,error:n,onDeleteItem:m,onUpdateItem:o})=>{const[c,u]=a.useState([]),[b,f]=a.useState(null),[i,l]=a.useState(""),d=JSON.parse(sessionStorage.getItem("user")),C=["manager","admin"];a.useEffect(()=>{const y=setTimeout(()=>{try{if(!i.trim()){u(t),f(null);return}const v=i.toLowerCase().trim(),N=t.filter(h=>h.PoNumber&&h.PoNumber.toLowerCase().includes(v)||h.from&&h.from.toLowerCase().includes(v)||h.dateArrival&&g(h.dateArrival).includes(v)?!0:Array.isArray(h.items)?h.items.some(r=>r.itemName&&r.itemName.toLowerCase().includes(v)||r.quantity&&r.quantity.toString().includes(v)):!1);u(N),f(N.length===0?"No items found":null)}catch(v){console.error("Search error:",v),f("An error occurred while searching")}},300);return()=>clearTimeout(y)},[i,t]);const g=y=>new Date(y).toLocaleDateString(),j=y=>{l(y.target.value)};return x?e.jsx(H,{color:"primary",className:"mt-5 w-15 mx-auto justify-content-center"}):t.length===0?e.jsx(A,{color:"warning",className:"text-center mt-5 w-75 mx-auto",children:"No data available"}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"mt-3",children:e.jsxs(ce,{className:"w-50 mb-3",children:[e.jsx(M,{type:"text",placeholder:"Search Items...",value:i,id:"searchItem",onChange:j}),e.jsx(le,{children:e.jsx($,{icon:Z})})]})}),n&&e.jsx(A,{color:"danger",className:"text-center mt-5 w-75 mx-auto",children:n}),b&&e.jsx(A,{color:"danger",className:"text-center mt-5 w-75 mx-auto",children:b}),e.jsx(ve,{className:"m-2 ",children:c.map(y=>e.jsxs(ge,{children:[e.jsx(Ne,{children:e.jsxs("ul",{className:"list-unstyled p-0 m-0 w-100",children:[e.jsxs("li",{children:["From: ",e.jsx("strong",{children:y.from})]}),e.jsxs("li",{children:["Purcahse Order: ",e.jsx("strong",{children:y.PoNumber})]})]})}),e.jsxs(Ce,{children:[y.items.map((v,N)=>e.jsx("div",{children:e.jsx(F,{children:`Item name: ${v.itemName} Quantity: (${v.quantity})`})},N)),e.jsxs(F,{children:["Date receive: ",new Date(y.dateArrival).toLocaleDateString()]}),e.jsxs(F,{children:["Received By: ",y.byReceived]}),e.jsxs(F,{children:["Warehouse: ",y.warehouse?y.warehouse.warehouseName:"Unknown"]}),e.jsxs(J,{className:"d-flex justify-content-end mt-3",children:[e.jsx(Pe,{warehousing:y,onUpdateItem:o}),C.includes(d.data.user.role)&&e.jsx(Le,{warehousing:y,onDeleteItem:m})]})]})]},y._id))})]})},De="http://localhost:5057",z=P.create({baseURL:De}),Ke=({onAddItem:t,mockDataReiceving:x,item:n={}})=>{const[m,o]=a.useState("Add Item"),[c,u]=a.useState(!1),[b,f]=a.useState(!1),[i,l]=a.useState(""),[d,C]=a.useState([]),g=new Date().toISOString().split("T")[0],[j,y]=a.useState({from:n.from,items:n.items,PoNumber:n.PoNumber,dateArrival:g,category:"",warehouse:"",byReceived:""}),v=r=>{const{id:s,value:I}=r.target;y(w=>({...w,[s]:I}))},N=async r=>{try{return(await z.get(`/api/v1/warehouse/checkPoNumber/${r}`)).data.exists}catch(s){return console.error(s),!1}};a.useEffect(()=>{(async()=>{await N(n.PoNumber)&&o("Already Added")})()},[n.PoNumber]),a.useEffect(()=>{(async()=>{try{const s=await z.get("/api/v1/warehouseLoc/locations");C(s.data.data)}catch(s){l(s.response.data.message)}})()},[]),n.items&&n.items.map((r,s)=>`${s+1}. Item Name: (${r.itemName})    Quantity: (${r.quantity})`).join(`
`);const h=async r=>{var I,w;r.preventDefault();const s=sessionStorage.getItem("email");if(!s){l("User email not found. Please log in again.");return}try{const S=await z.post("/api/v1/warehouse/addItem",{...j,byReceived:s});if(S.status===201){const E=S.data.data,V=d.find(fe=>fe._id===E.warehouse);E.warehouse=V,u(S.data.message),t(E),o("Already Added"),setTimeout(()=>{f(!1),u("")},1500)}else l(S.data.message||"An unexpected error occurred")}catch(S){l(((w=(I=S.response)==null?void 0:I.data)==null?void 0:w.message)||S.message)}};return e.jsxs(e.Fragment,{children:[e.jsx(R,{color:"primary",variant:"outline",onClick:()=>f(!0),disabled:m==="Already Added",children:m==="Already Added"?e.jsx("span",{className:"me-1",children:"Already Added"}):e.jsx($,{icon:be})}),e.jsxs(ee,{visible:b,onClose:()=>f(!1),children:[e.jsx(te,{children:e.jsx(ae,{children:"Add Item"})}),i&&e.jsx(A,{color:"danger",children:i}),c&&e.jsx(A,{color:"success",children:c}),e.jsx(se,{children:e.jsxs(ne,{children:[e.jsx(M,{type:"text",placeholder:"From",className:"mb-3",floatingLabel:"From",id:"from",onChange:v,value:j.from,required:!0,readOnly:!0}),e.jsx(Q,{placeholder:"Items List",className:"mb-3 justify-content-center h-50",floatingLabel:"Items List",id:"items",rows:5,value:Array.isArray(j.items)?j.items.map((r,s)=>`${s+1}. ${r.itemName} (Quantity: ${r.quantity})`).join(`
`):j.items,readOnly:!0}),e.jsxs(ie,{placeholder:"Warehouse",className:"mb-3",floatingLabel:"Warehouse",id:"warehouse",onChange:v,value:j.warehouse,required:!0,children:[e.jsx("option",{value:"",children:"Select Warehouse"}),d.map(r=>e.jsx("option",{value:r._id,children:r.warehouseName},r._id))]})]})}),e.jsxs(re,{children:[e.jsx(R,{color:"secondary",variant:"outline",onClick:()=>f(!1),children:"Close"}),e.jsx(R,{color:"primary",variant:"outline",onClick:h,children:"Add Item"})]})]})]})},qe="http://localhost:5057";P.create({baseURL:qe});const We=({onAddItem:t})=>{const[x,n]=a.useState([]),[m,o]=a.useState(1),[c,u]=a.useState(null),[b,f]=a.useState(!0),[i,l]=a.useState(""),[d,C]=a.useState([]),g=10,[j,y]=a.useState([{id:1,PoNumber:"123456",from:"Supplier A",items:[{itemName:"Item 1",quantity:10},{itemName:"Item 2",quantity:5}]},{id:2,PoNumber:"563424",from:"Supplier B",items:[{itemName:"Item 1",quantity:8},{itemName:"Item 4",quantity:12},{itemName:"Item 5",quantity:12}]},{id:3,PoNumber:"56323224",from:"Supplier C",items:[{itemName:"Item 6",quantity:8},{itemName:"Item 7",quantity:12},{itemName:"Item 8",quantity:12},{itemName:"Item 9",quantity:12}]},{id:4,PoNumber:"56342234",from:"Supplier D",items:[{itemName:"Item 10",quantity:8},{itemName:"Item 11",quantity:8}]}]);if(a.useEffect(()=>{n(j),f(!1)},[]),a.useEffect(()=>{if(i==="")C(x);else{const s=x.filter(I=>{const w=I.PoNumber.toLowerCase().includes(i.toLowerCase()),S=I.from.toLowerCase().includes(i.toLowerCase()),E=I.items.some(V=>V.itemName.toLowerCase().includes(i.toLowerCase()));return w||S||E});C(s),o(1),s.length===0?u("No matching records found."):u(null)}},[i,x]),b)return e.jsx(H,{color:"primary",className:"mt-5 w-15 mx-auto justify-content-center"});const v=m*g,N=v-g;x.slice(N,v);const h=Math.ceil(x.length/g),r=s=>{l(s.target.value)};return e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"mt-3",children:e.jsxs(ce,{className:"w-50 mb-3",children:[e.jsx(M,{type:"text",placeholder:"Search by PO Number, Supplier, or Item Name",value:i,id:"searchInput",onChange:r}),e.jsx(le,{children:e.jsx($,{icon:Z})})]})}),e.jsxs(de,{hover:!0,responsive:!0,size:"sm",className:"text-center",children:[e.jsx(me,{children:e.jsxs(O,{children:[e.jsx(T,{children:"PO Number"}),e.jsx(T,{children:"From"}),e.jsx(T,{children:"Item Name"}),e.jsx(T,{children:"Quantity"}),e.jsx(T,{children:"Actions"})]})}),e.jsx(ue,{children:d.map((s,I)=>e.jsxs(O,{children:[e.jsx(L,{className:"text-center",children:s.PoNumber}),e.jsx(L,{children:s.from}),e.jsx(L,{children:s.items.map(w=>e.jsx("div",{children:w.itemName},w.itemName))}),e.jsx(L,{children:s.items.map(w=>e.jsx("div",{children:w.quantity},w.itemName))}),e.jsx(L,{children:e.jsx(Ke,{onAddItem:t,mockDataReiceving:j,item:s})})]},I))})]}),c&&e.jsx(A,{color:"danger",className:"text-center mt-5 w-75 mx-auto justify-content-center",children:c}),e.jsxs(Ie,{align:"center",children:[e.jsx(B,{disabled:m===1,onClick:()=>o(s=>Math.max(s-1,1)),children:"Previous"}),[...Array(h).keys()].map(s=>e.jsx(B,{active:s+1===m,onClick:()=>o(s+1),children:s+1},s+1)),e.jsx(B,{disabled:m===h,onClick:()=>o(s=>Math.min(s+1,h)),children:"Next"})]})]})},$e="http://localhost:5057",Oe=P.create({baseURL:$e}),Ue=()=>{const[t,x]=a.useState([]),[n,m]=a.useState(null);return a.useEffect(()=>{(async()=>{try{const c=await Oe.get("/api/v1/warehouse/items/all");console.log("Response data:",c.data);const u=c.data.data;console.log("data in all items",u),x(u)}catch(c){m(c.message)}})()},[]),n?e.jsxs("div",{children:["Error: ",n]}):e.jsxs("div",{children:[e.jsx("h1",{children:"Items Table"}),e.jsxs(de,{children:[e.jsx(me,{children:e.jsxs(O,{children:[e.jsx(T,{scope:"col",children:"Item Name"}),e.jsx(T,{scope:"col",children:"Quantity"})]})}),e.jsx(ue,{children:t&&t.map((o,c)=>e.jsxs(O,{children:[e.jsx(L,{children:o.itemName}),e.jsx(L,{children:o.quantity})]},c))})]})]})},He="http://localhost:5057",Me=P.create({baseURL:He}),ct=()=>{const[t,x]=a.useState([]),[n,m]=a.useState(!1),[o,c]=a.useState(null),u=async()=>{m(!0);try{const l=await Me.get("/api/v1/warehouse/items");l.status===200&&x(l.data.data)}catch(l){c(l.response.data.message)}finally{m(!1)}};a.useEffect(()=>{u()},[]);const b=l=>{x(d=>[...d,l])},f=l=>{x(d=>d.filter(C=>C._id!==l))},i=l=>{x(d=>d.map(C=>C._id===l._id?l:C))};return e.jsx(e.Fragment,{children:e.jsxs(_,{activeItemKey:"Warehouse Items Details",children:[e.jsxs(X,{variant:"tabs",children:[e.jsx(D,{itemKey:"Warehouse Items Details",children:"Warehouse Items Details"}),e.jsx(D,{itemKey:"For Reiceve",children:"For Reiceve"}),e.jsx(D,{itemKey:"Items",children:"Items"})]}),e.jsxs(je,{children:[e.jsx(K,{className:"p-3",itemKey:"Warehouse Items Details",children:e.jsx(Fe,{warehousing:t,loading:n,error:o,onDeleteItem:f,onUpdateItem:i})}),e.jsx(K,{className:"p-3",itemKey:"For Reiceve",children:e.jsxs(Ae,{children:[e.jsx(F,{children:"Item Reicevig"}),e.jsx(We,{onAddItem:b})]})}),e.jsx(K,{className:"p-3",itemKey:"Items",children:e.jsx(Ue,{})})]})]})})};export{ct as default};
