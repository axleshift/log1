import{r as s,_ as ee,R as o,a as E,c as D,P as t,e as me,w as pe,j as e,C as M}from"./index-B_xgiZND.js";import{a as q}from"./index-DW_MHI2K.js";import{u as he,e as be,F as T,f as ge,a as ve,c as Ce,d as xe,C as V,g as je}from"./DefaultLayout-DJqhCF6w.js";import{a as R}from"./CButton-Dmu7yp3G.js";import{C as ae,a as te,b as ne,c as se,d as re}from"./CModalTitle-DLCZrMTR.js";import{C as U}from"./CAlert-D7AY2vid.js";import{C as le}from"./CForm-Q4NE6lr7.js";import{a as Z,b as oe,C as $}from"./CFormInput-CxEswD9g.js";import{C as ye}from"./CFormSelect-DB8WT_qC.js";import{u as ce}from"./CCloseButton-Cv6f_OZH.js";import{C as B}from"./index.esm-CSCu4-FO.js";import{C as ke,a as Ie}from"./CInputGroupText-MCOOFdiC.js";import{C as Se,a as Ne,b as we,c as Le}from"./CAccordionHeader-KeT69GvL.js";import{g as Ee,e as Pe}from"./getRTLPlacement-B5NYn3wd.js";import{C as Fe,a as Re}from"./CCardBody-CJNqt8f3.js";import"./cil-user-Ddrdy7PS.js";var _=s.forwardRef(function(a,j){var h=a.className,d=a.button,y=a.feedback,I=a.feedbackInvalid,x=a.feedbackValid,b=a.floatingLabel,k=a.tooltipFeedback,u=a.hitArea,c=a.id,N=a.indeterminate,g=a.inline,v=a.invalid,C=a.label,S=a.reverse,w=a.type,P=w===void 0?"checkbox":w,r=a.valid,p=ee(a,["className","button","feedback","feedbackInvalid","feedbackValid","floatingLabel","tooltipFeedback","hitArea","id","indeterminate","inline","invalid","label","reverse","type","valid"]),l=s.useRef(null),f=ce(j,l);s.useEffect(function(){l.current&&N&&(l.current.indeterminate=N)},[N,l.current]);var n=function(){return o.createElement("input",E({type:P,className:D(d?"btn-check":"form-check-input",{"is-invalid":v,"is-valid":r,"me-2":u}),id:c},p,{ref:f}))},i=function(){return o.createElement(oe,{describedby:p["aria-describedby"],feedback:y,feedbackInvalid:I,feedbackValid:x,floatingLabel:b,invalid:v,tooltipFeedback:k,valid:r})},m=function(){var L;return o.createElement(Z,E({customClassName:D(d?D("btn",d.variant?"btn-".concat(d.variant,"-").concat(d.color):"btn-".concat(d.color),(L={},L["btn-".concat(d.size)]=d.size,L),"".concat(d.shape)):"form-check-label")},c&&{htmlFor:c}),C)},F=function(){return d?o.createElement(o.Fragment,null,o.createElement(n,null),C&&o.createElement(m,null),o.createElement(i,null)):C?u?o.createElement(o.Fragment,null,o.createElement(n,null),o.createElement(Z,E({customClassName:D("form-check-label stretched-link",h)},c&&{htmlFor:c}),C),o.createElement(i,null)):o.createElement("div",{className:D("form-check",{"form-check-inline":g,"form-check-reverse":S,"is-invalid":v,"is-valid":r},h)},o.createElement(n,null),o.createElement(m,null),o.createElement(i,null)):o.createElement(n,null)};return o.createElement(F,null)});_.propTypes=E({button:t.object,className:t.string,hitArea:t.oneOf(["full"]),id:t.string,indeterminate:t.bool,inline:t.bool,label:t.oneOfType([t.string,t.node]),reverse:t.bool,type:t.oneOf(["checkbox","radio"])},oe.propTypes);_.displayName="CFormCheck";var G=s.forwardRef(function(a,j){var h=a.children,d=a.animation,y=d===void 0?!0:d,I=a.className,x=a.container,b=a.content,k=a.delay,u=k===void 0?0:k,c=a.fallbackPlacements,N=c===void 0?["top","right","bottom","left"]:c,g=a.offset,v=g===void 0?[0,8]:g,C=a.onHide,S=a.onShow,w=a.placement,P=w===void 0?"top":w,r=a.title,p=a.trigger,l=p===void 0?"click":p,f=a.visible,n=ee(a,["children","animation","className","container","content","delay","fallbackPlacements","offset","onHide","onShow","placement","title","trigger","visible"]),i=s.useRef(null),m=s.useRef(null),F=ce(j,i),L="popover".concat(s.useId()),Q=s.useState(!1),O=Q[0],J=Q[1],K=s.useState(f),A=K[0],W=K[1],X=he(),de=X.initPopper,ue=X.destroyPopper,Y=typeof u=="number"?{show:u,hide:u}:u,fe={modifiers:[{name:"arrow",options:{element:".popover-arrow"}},{name:"flip",options:{fallbackPlacements:N}},{name:"offset",options:{offset:v}}],placement:Ee(P,m.current)};s.useEffect(function(){if(f){z();return}H()},[f]),s.useEffect(function(){if(O&&m.current&&i.current){de(m.current,i.current,fe),setTimeout(function(){W(!0)},Y.show);return}!O&&m.current&&i.current&&ue()},[O]),s.useEffect(function(){!A&&m.current&&i.current&&Pe(function(){J(!1)},i.current)},[A]);var z=function(){J(!0),S&&S()},H=function(){setTimeout(function(){W(!1),C&&C()},Y.hide)};return o.createElement(o.Fragment,null,o.cloneElement(h,E(E(E(E(E({},A&&{"aria-describedby":L}),{ref:m}),(l==="click"||l.includes("click"))&&{onClick:function(){return A?H():z()}}),(l==="focus"||l.includes("focus"))&&{onFocus:function(){return z()},onBlur:function(){return H()}}),(l==="hover"||l.includes("hover"))&&{onMouseEnter:function(){return z()},onMouseLeave:function(){return H()}})),o.createElement(be,{container:x,portal:!0},O&&o.createElement("div",E({className:D("popover","bs-popover-auto",{fade:y,show:A},I),id:L,ref:F,role:"tooltip"},n),o.createElement("div",{className:"popover-arrow"}),o.createElement("div",{className:"popover-header"},r),o.createElement("div",{className:"popover-body"},b))))});G.propTypes={animation:t.bool,children:t.node,className:t.string,container:t.any,content:t.oneOfType([t.string,t.node]),delay:t.oneOfType([t.number,t.shape({show:t.number.isRequired,hide:t.number.isRequired})]),fallbackPlacements:pe,offset:t.any,onHide:t.func,onShow:t.func,placement:t.oneOf(["auto","top","right","bottom","left"]),title:t.oneOfType([t.string,t.node]),trigger:me,visible:t.bool};G.displayName="CPopover";const De=()=>{const j=q.create({baseURL:"http://localhost:5057",withCredentials:!0}),h=new Date().toISOString().split("T")[0],d={inspector:"",vehicleId:"",status:"Pending",scheduledDate:h},[y,I]=s.useState(!1),[x,b]=s.useState(!1),[k,u]=s.useState(null),[c,N]=s.useState([]),[g,v]=s.useState(d),[C,S]=s.useState(!1),w=async()=>{try{const r=await j.get("/api/v1/vehicle/inspection");r.status===200?(N(r.data.data),I(!1)):u(r.data.message)}catch(r){u(r.message)}};s.useEffect(()=>{w()},[]);const P=async r=>{I(!0),r.currentTarget.checkValidity()===!1&&(r.preventDefault(),r.stopPropagation()),S(!0);try{const l=await j.post("/api/v1/maintenance/inspection",g);console.log(l),l.data.success?(v(d),b(!1)):u(l.data.message)}catch(l){u(l.response.data.message)}finally{I(!1)}};return e.jsxs(e.Fragment,{children:[y?e.jsx(M,{color:"primary",size:"sm"}):e.jsxs(R,{color:"primary",className:"mb-3",variant:"outline",onClick:()=>b(!x),children:[e.jsx(T,{icon:ge})," Add Inspection"]}),e.jsxs(ae,{visible:x,onClose:()=>b(!1),children:[e.jsx(te,{children:e.jsx(ne,{children:"Add Inspection"})}),k&&e.jsx(U,{color:"danger",className:"m-3",children:k}),e.jsx(se,{children:e.jsxs(le,{noValidate:!0,validated:C,children:[e.jsx($,{className:"mb-3",type:"text",floatingLabel:"Inspector",name:"inspector",placeholder:"Inspector",required:!0,value:g.inspector,onChange:r=>v({...g,inspector:r.target.value})}),e.jsxs(ye,{className:"mb-3","aria-label":"Select Vehicle",name:"vehicleId",required:!0,value:g.vehicleId,onChange:r=>v({...g,vehicleId:r.target.value}),children:[e.jsx("option",{value:"",children:"Select Vehicle"}),c.map(r=>e.jsxs("option",{value:r._id,children:[r.brand," - ",r.model," - ",r.regisNumber]},r._id))]}),e.jsx($,{className:"mb-3",type:"date",name:"scheduledDate",placeholder:"Scheduled Date",required:!0,min:h,value:g.scheduledDate,onChange:r=>v({...g,scheduledDate:r.target.value})}),e.jsxs(re,{children:[y?e.jsx(M,{color:"secondary",size:"sm"}):e.jsx(R,{color:"secondary",variant:"outline",onClick:()=>{b(!1),v(d),u(null),S(!1)},children:"Cancel"}),y?e.jsx(M,{color:"primary",size:"sm"}):e.jsx(R,{color:"primary",variant:"outline",onClick:P,children:"Add Inspection"})]})]})})]})]})},Ae=a=>{const[j,h]=s.useState(!1),[d,y]=s.useState(null),x=q.create({baseURL:"http://localhost:5057"}),b=async()=>{h(!0);const k=await x.delete(`/api/v1/maintenance/inspection/${a.item._id}`);k.status===200?(alert("Maintenance Inspection deleted successfully"),h(!1),y(null)):(h(!1),y(k.data.message))};return e.jsx(e.Fragment,{children:e.jsx(R,{color:"danger",variant:"outline",disabled:j,onClick:b,className:"me-2",children:j?e.jsx(M,{size:"sm"}):e.jsx(T,{icon:ve})})})},ie=({item:a,visible:j,onClose:h,onUpdate:d})=>{const[y,I]=s.useState(!1),[x,b]=s.useState(null),[k,u]=s.useState(null),[c,N]=s.useState(!1),v=q.create({baseURL:"http://localhost:5057",withCredentials:!0}),[C,S]=s.useState({visualInspection:{physical:{cracks:!1,corrosion:!1,wear:!1,damage:!1},operational:{noise:!1,leaks:!1,misalignment:!1,looseFasteners:!1},safety:{guards:!1,emergencyStop:!1,lockoutTagout:!1,fireSafety:!1},mechanical:{bearings:{play:!1,overheating:!1,metalShavings:!1},belts:{tension:!1,wear:!1,damage:!1},motors:{noise:!1,overheating:!1,looseConnections:!1}},electrical:{wiring:{insulation:!1,termination:!1,overheating:!1},controlPanels:{functionality:!1,labeling:!1,damage:!1}},fluidSystems:{lubrication:{oilLevel:!1,lubrication:!1,cleanliness:!1},hydraulicFluid:{level:!1,condition:!1,filter:!1}},documents:{registration:!1,insurance:!1}},notes:""});s.useEffect(()=>{const p=()=>{if(a!=null&&a.scheduledDate){const f=new Date,n=new Date(a.scheduledDate);N(f>=n)}};p();const l=setInterval(p,6e4);return()=>clearInterval(l)},[a]),s.useEffect(()=>{a&&a.visualInspection&&S({visualInspection:a.visualInspection})},[a]);const w=p=>{if(!c){b("Cannot update inspection before scheduled date");return}const{name:l,checked:f}=p.target;S(n=>{const i={...n},m=l.split(".");let F=i;for(let L=0;L<m.length-1;L++)F=F[m[L]];return F[m[m.length-1]]=f,i})},P=async()=>{var p,l;if(!(a!=null&&a._id)){b("Invalid item ID");return}try{I(!0),b(null),u(null),console.log("Sending data:",{inspectionId:a._id,checkList:C}),(await v.put(`/api/v1/maintenance/inspection/${a._id}`,C)).status===200&&(u("Maintenance checklist updated successfully"),d&&d(),setTimeout(()=>{h()},2e3))}catch(f){b(((l=(p=f.response)==null?void 0:p.data)==null?void 0:l.message)||"An error occurred while updating the checklist")}finally{I(!1)}},r=(p,l="")=>Object.entries(p).map(([f,n])=>{const i=l?`${l}.${f}`:f;return typeof n=="object"&&n!==null?e.jsxs("div",{className:"ms-3",children:[e.jsx("h6",{className:"text-capitalize",children:f}),r(n,i)]},i):e.jsx(_,{id:i,label:f.charAt(0).toUpperCase()+f.slice(1),name:i,checked:n,onChange:w,disabled:!c},i)});return e.jsxs(ae,{visible:j,onClose:h,children:[e.jsx(te,{children:e.jsx(ne,{children:"Maintenance Check List"})}),x&&e.jsx(U,{color:"danger",className:"m-3",children:x}),k&&e.jsx(U,{color:"success",className:"m-3",children:k}),!c&&e.jsxs(U,{color:"warning",className:"m-3",children:["This inspection cannot be updated until"," ",new Date(a==null?void 0:a.scheduledDate).toLocaleDateString()]}),e.jsx(se,{children:e.jsx(le,{children:r(C.visualInspection,"visualInspection")})}),e.jsxs(re,{children:[e.jsx(R,{color:"secondary",onClick:h,children:"Close"}),e.jsx(R,{color:"primary",onClick:P,disabled:y||!c,children:y?e.jsxs(e.Fragment,{children:[e.jsx(M,{size:"sm",className:"me-2"}),"Saving..."]}):"Save Changes"})]})]})};ie.propTypes={item:t.shape({_id:t.string,visualInspection:t.object}),visible:t.bool.isRequired,onClose:t.func.isRequired,onUpdate:t.func};const Me=()=>{const[a,j]=s.useState(!1),[h,d]=s.useState(null),I=q.create({baseURL:"http://localhost:5057"}),[x,b]=s.useState([]),[k,u]=s.useState(!0),[c,N]=s.useState(""),[g,v]=s.useState([]),[C,S]=s.useState(null),w=JSON.parse(sessionStorage.getItem("user")),P=["manager","admin"],r=async()=>{u(!0);try{const n=await I.get("/api/v1/maintenance/inspections");b(n.data.data),u(!1)}catch(n){console.error("Error fetching data:",n),u(!1)}},p=()=>{r()};s.useEffect(()=>{(async()=>{if(c==="")v(x);else{const i=x.filter(m=>m.vehicleId.toLowerCase().includes(c.toLowerCase())||m.vehicleId.regisNumber.toLowerCase().includes(c.toLowerCase())||m.scheduledDate.toLowerCase().includes(c.toLowerCase())||m.inspector.toLowerCase().includes(c.toLowerCase())||l.find(F=>F.value===m.status).label.toLowerCase().includes(c.toLowerCase()));v(i),i.length===0?S("No results found"):S(null)}})(),r()},[c,x]);const l=[{value:"Pending",label:"Pending"},{value:"Completed",label:"Completed"},{value:"Cancelled",label:"Cancelled"},{value:"In Progress",label:"In Progress"}],f=n=>{switch(n){case"Pending":return"yellow";case"Completed":return"green";case"In Progress":return"orange";case"Cancelled":return"red";default:return"black"}};return e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"mt-3",children:e.jsxs(ke,{className:"w-50 mb-3",children:[e.jsx($,{type:"text",placeholder:"Search vehicles",id:"search",value:c,onChange:n=>N(n.target.value),className:"w-50 me-2 "}),e.jsx(Ie,{children:e.jsx(T,{icon:Ce})})]})}),a&&e.jsx(ie,{item:h,visible:a,onClose:()=>j(!1),onUpdate:p}),g.length>0?e.jsx(Se,{className:"m-2",children:g.map(n=>e.jsxs(Ne,{children:[e.jsxs(we,{children:[e.jsxs("p",{className:"w-100 m-1 ",children:["Registration Number:",e.jsx("strong",{className:"ms-2",children:n.vehicleId?`${n.vehicleId.regisNumber} - ${n.vehicleId.model}`:""})]}),e.jsx(T,{icon:xe,color:f(n.status),className:"m-2 float-end"}),e.jsxs("small",{className:"m-2 float-end",children:[" ",l.find(i=>i.value===n.status).label]})]}),e.jsxs(Le,{children:[e.jsxs(V,{children:["Scheduled Date: ",new Date(n.scheduledDate).toLocaleDateString()]}),e.jsxs(V,{children:["Name of Inspector: ",n.inspector]}),e.jsxs(B,{className:"d-flex justify-content-end mt-3",children:[e.jsx(G,{content:"It is disable if the status is completed",placement:"right",trigger:["hover","focus"],children:e.jsx("span",{className:"d-inline-block",tabIndex:0,children:e.jsx(R,{color:"primary",className:"me-2",variant:"outline",disabled:n.status==="Completed",onClick:()=>{d(n),j(!0)},children:e.jsx(T,{icon:je})})})}),P.includes(w.data.user.role)&&e.jsx(Ae,{item:n})]})]})]},n._id))}):e.jsx(V,{className:"justify-content-center",children:"0 results found"}),C&&e.jsx(U,{color:"danger",className:"text-center justify-content-center",children:C})]})},Ye=()=>e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"text-center",children:"Maintenance Management"}),e.jsx(B,{className:"m-3",children:e.jsx(De,{})}),e.jsxs(Fe,{children:[e.jsx(V,{children:"Schedule List"}),e.jsx(Re,{className:"md-3",children:e.jsx(Me,{})})]})]});export{Ye as default};
