import{B as F,r as l,j as e,k as E,A as _,D as R}from"./index-D3sENHx8.js";import{F as P,h as Q,i as J,l as K,j as W,k as X}from"./index-BkVfsiqy.js";import{a as I}from"./CButton-BtLzD1nc.js";import{C as O,a as z,b as $,c as B,d as U}from"./CModalTitle-B-PsqkjO.js";import{C as k}from"./CAlert-7ALPkqIl.js";import{C as G}from"./CForm-aXXLYJpe.js";import{C as b}from"./CFormInput-ELlVuuy1.js";import{C as T}from"./CFormSelect-BY3m6lUT.js";import{C as M}from"./CContainer-JMjuzE-E.js";import{C as Y,a as Z}from"./CInputGroupText-lS-LDq2r.js";import{C as ee,a as se,b as ae,c as te}from"./CAccordionHeader-DtFbud76.js";import{C as V}from"./DefaultLayout-Cp499GQ2.js";import{C as le,a as q}from"./CPaginationItem-e85AesSY.js";import{C as re}from"./CCard-DonNi5aQ.js";import{C as ne}from"./CCardBody-CD1PubO1.js";import"./index.esm-CRTaRlLz.js";import"./1-Cs5G51RP.js";import"./cil-user-Ddrdy7PS.js";const oe=({onAddDriver:o})=>{const{showSuccess:w,showError:x}=F(),[d,j]=l.useState(!1),[f,v]=l.useState(null),[S,n]=l.useState(null),[C,p]=l.useState(!1),[D,y]=l.useState([]),[N,h]=l.useState(!1),i={idNum:Math.floor(Math.random()*1e6).toString(),driverName:"",email:"",phone:"",address:"",licenseNumber:"",status:"available",assignedVehicle:""},[a,u]=l.useState(i),c=r=>{const{id:t,value:g}=r.target;u(L=>({...L,[t]:g}))},m=async()=>{try{const r=await _.get("/api/v1/vehicle/available");y(r.data.data)}catch(r){console.error("Error fetching vehicles:",r)}};l.useEffect(()=>{m()},[]);const s=async r=>{r.currentTarget.checkValidity()===!1&&(r.preDefault(),r.stopPropagation()),h(!0),{...a},j(!0);try{const g=await _.post("/api/v1/driver",a);g.status===201&&(w(g.data.message),o(g.data.data),setTimeout(()=>{u(i),h(!1),p(!1),j(!1)},2e3))}catch(g){n(g.response.data.message),x(g.response.data.message),setTimeout(()=>{n(null)},3e3)}finally{j(!1)}};return e.jsx(e.Fragment,{children:d?e.jsx(E,{color:"primary",size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsxs(I,{color:"primary",disabled:d,variant:"outline",onClick:()=>p(!0),children:[d?e.jsx(E,{color:"primary",size:"sm"}):e.jsx(P,{icon:Q})," ","Add Driver"]}),e.jsxs(O,{visible:C,onClose:()=>p(!1),children:[e.jsx(z,{children:e.jsx($,{children:"Add Driver"})}),S&&e.jsx(k,{color:"danger",className:"m-3",children:S}),f&&e.jsx(k,{color:"success",className:"m-3",children:f}),e.jsx(B,{children:e.jsxs(G,{noValidate:!0,validated:N,children:[e.jsx(b,{className:"mb-3",floatingLabel:"ID Number",placeholder:"ID Number",type:"text",id:"idNum",label:"ID Number",value:a.idNum,disabled:!0}),e.jsx(b,{className:"mb-3",floatingLabel:"Name",placeholder:"Name",type:"text",id:"driverName",label:"Name",autoComplete:"off",required:!0,value:a.driverName,onChange:c}),e.jsx(b,{className:"mb-3",floatingLabel:"email",placeholder:"Model",type:"email",id:"email",label:"Email",autoComplete:"off",required:!0,value:a.email,onChange:c}),e.jsx(b,{type:"phone",className:"mb-3",floatingLabel:"phone",placeholder:"phone",id:"phone",label:"Phone",title:"Please enter a valid phone number",autoComplete:"off",value:a.phone,required:!0,onChange:c}),e.jsx(b,{className:"mb-3",floatingLabel:"Address",placeholder:"Address",type:"text",id:"address",label:"Address",autoComplete:"off",required:!0,value:a.address,onChange:c}),e.jsx(b,{className:"mb-3",floatingLabel:"License Number",placeholder:"License Number",type:"text",id:"licenseNumber",label:"License Number",autoComplete:"off",required:!0,value:a.licenseNumber,onChange:c}),e.jsxs(T,{className:"mb-3",floatingLabel:"Vehicle",label:"Vehicle",id:"assignedVehicle",required:!0,value:a.assignedVehicle,onChange:c,children:[e.jsx("option",{value:null,children:"Select Vehicle"}),D.map(r=>e.jsxs("option",{value:r._id,children:[r.brand," /",r.model," /",r.regisNumber]},r._id))]})]})}),e.jsxs(U,{children:[e.jsx(I,{color:"secondary",variant:"outline",disabled:d,onClick:()=>{p(!1),u(i),n(null),h(!1)},children:d?e.jsx(E,{color:"secondary",size:"sm"}):"Cancel"}),e.jsx(I,{color:"primary",variant:"outline",onClick:s,disabled:d,children:d?e.jsx(E,{color:"primary",size:"sm"}):"Add Driver"})]})]})]})})},ie=({driver:o,onUpdateDriver:w})=>{const{showSuccess:x,showError:d}=F(),[j,f]=l.useState(!1),[v,S]=l.useState(null),[n,C]=l.useState([]),[p,D]=l.useState(!1),[y,N]=l.useState(null),[h,A]=l.useState(!1),i={idNum:o.idNum,driverName:o.driverName,email:o.email,phone:o.phone,address:o.address,licenseNumber:o.licenseNumber,status:o.status,assignedVehicle:o.assignedVehicle},[a,u]=l.useState(i),c=t=>{const{id:g,value:L}=t.target;u(H=>({...H,[g]:L}))},m=async()=>{try{const t=await _.get("/api/v1/vehicle/available");C(t.data.data)}catch(t){d(t.message)}};l.useEffect(()=>{m()},[]);const s=async t=>{t.preventDefault(),t.currentTarget.checkValidity()===!1&&t.stopPropagation(),D(!0),A(!0),{...a};try{const L=await _.put(`/api/v1/driver/${o._id}`,a);L.data.success&&(x(L.data.message),w(L.data.data),setTimeout(()=>{f(!1),u(i)},2e3))}catch(L){N(L.response.data.message),d(L.response.data.message),setTimeout(()=>{N(null)},2e3)}finally{A(!1)}},r=[{value:"available",label:"Available"},{value:"on_duty",label:"On Duty"},{value:"off_duty",label:"Off Duty"}];return e.jsxs(e.Fragment,{children:[e.jsx(I,{color:"primary",variant:"outline",disabled:h,onClick:()=>f(!0),className:"me-2",children:h?e.jsx(E,{size:"sm"}):e.jsx(P,{icon:J})}),e.jsxs(O,{visible:j,onClose:()=>f(!1),children:[e.jsx(z,{children:e.jsx($,{children:"Update Driver"})}),y&&e.jsx(k,{color:"danger",className:"m-3",children:y}),v&&e.jsx(k,{color:"success",className:"m-3",children:v}),e.jsx(B,{children:e.jsx(G,{noValidate:!0,validated:p,children:e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"mb-3",floatingLabel:"ID Number",placeholder:"ID Number",type:"text",id:"idNum",label:"ID Number",value:a.idNum,disabled:!0}),e.jsx(b,{className:"mb-3",floatingLabel:"Name",placeholder:"Name",type:"text",id:"driverName",label:"Name",autoComplete:"off",required:!0,value:a.driverName,onChange:c}),e.jsx(b,{className:"mb-3",floatingLabel:"email",placeholder:"Model",type:"email",id:"email",label:"Email",autoComplete:"off",required:!0,value:a.email,onChange:c}),e.jsx(b,{type:"phone",className:"mb-3",floatingLabel:"phone",placeholder:"phone",id:"phone",label:"Phone",title:"Please enter a valid phone number",autoComplete:"off",value:a.phone,required:!0,onChange:c}),e.jsx(b,{className:"mb-3",floatingLabel:"Address",placeholder:"Address",type:"text",id:"address",label:"Address",autoComplete:"off",required:!0,value:a.address,onChange:c}),e.jsx(b,{className:"mb-3",floatingLabel:"License Number",placeholder:"License Number",type:"text",id:"licenseNumber",label:"License Number",autoComplete:"off",required:!0,value:a.licenseNumber,onChange:c}),e.jsx(T,{className:"mb-3",floatingLabel:"Status",placeholder:"Status",id:"status",label:"Status",autoComplete:"off",required:!0,value:a.status||"",onChange:c,children:r.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),a.status==="available"||a.status==="on_duty"&&e.jsxs(T,{className:"mb-3",floatingLabel:"Assigned Vehicle",label:"Assigned Vehicle",id:"assignedVehicle",value:a.assignedVehicle||"",onChange:c,children:[e.jsx("option",{value:"",children:"Select a vehicle"}),n.map(t=>e.jsxs("option",{value:t._id,children:[t.brand," / ",t.model," / ",t.regisNumber]},t._id))]})]})})}),e.jsxs(U,{children:[e.jsx(I,{color:"secondary",variant:"outline",disabled:h,onClick:()=>{f(!1),N(null),D(!1)},children:h?e.jsx(E,{color:"secondary",size:"sm"}):"Close"}),e.jsx(I,{color:"success",variant:"outline",disabled:h,onClick:s,children:h?e.jsx(E,{color:"success",size:"sm"}):"Save Changes"})]})]})]})},ce=({driver:o,onDeleteDriver:w})=>{const[x,d]=l.useState(!1),[j,f]=l.useState(null),{showError:v,showSuccess:S}=F(),n=async()=>{d(!0);try{const C=await _.delete(`/api/v1/driver/${o._id}`);C.status===200&&(S(C.data.message),w(o._id),d(!1),f(null))}catch(C){f(C),v(C.response.data.message)}finally{d(!1)}};return e.jsx(e.Fragment,{children:e.jsx(I,{color:"danger",variant:"outline",onClick:n,className:"me-2",disabled:x,children:x?e.jsx(E,{size:"sm"}):e.jsx(P,{icon:K})})})},de=({driver:o,loading:w,onDeleteDriver:x,onUpdateDriver:d})=>{const j=R(),f=["manager","admin"],[v,S]=l.useState(null),[n,C]=l.useState(""),[p,D]=l.useState([]),[y,N]=l.useState(1),[h]=l.useState(10),A=y*h,i=A-h,a=p.slice(i,A),u=Math.ceil(p.length/h);l.useEffect(()=>{(async()=>{if(N(1),n==="")D(o);else{const r=o.filter(t=>t.driverName.toLowerCase().includes(n.toLowerCase())||t.idNum.toString().includes(n)||t.email.toLowerCase().includes(n.toLowerCase())||t.phone.toString().includes(n)||t.address.toLowerCase().includes(n.toLowerCase())||t.licenseNumber.toString().includes(n)||m.find(g=>g.value===t.status).label.toLowerCase().includes(n.toLowerCase()));D(r),r.length===0?S("No results found"):S(null)}})()},[n,o]);const c=s=>{switch(s){case"available":return"green";case"on_duty":return"red";case"off_duty":return"orange";default:return"black"}},m=[{label:"Available",value:"available"},{label:"On Duty",value:"on_duty"},{label:"Off Duty",value:"off_duty"}];return o.length===0?e.jsx(k,{color:"danger",className:"justfy-content-center",children:"No drivers found"}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"mt-3",children:e.jsxs(Y,{className:"w-50 mb-3 ",children:[e.jsx(b,{type:"text",placeholder:"Search Drivers...",id:"search",value:n,onChange:s=>C(s.target.value),className:"w-50 me-2 "}),e.jsx(Z,{children:e.jsx(P,{icon:W})})]})}),e.jsx(ee,{className:"m-2",children:a.map(s=>e.jsxs(se,{children:[e.jsx(ae,{children:e.jsxs("p",{className:"w-100 m-1",children:["Driver Name: ",e.jsxs("strong",{children:[" ",s.driverName," "]}),e.jsx(P,{icon:X,color:c(s.status),className:"m-2 float-end"}),e.jsxs("small",{className:"m-2 float-end",children:[" ",m.find(r=>r.value===s.status).label]})]})}),e.jsxs(te,{children:[e.jsxs(V,{children:["ID: ",s.idNum]}),e.jsxs(V,{children:["Email: ",s.email]}),e.jsxs(V,{children:["Phone: ",s.phone]}),e.jsxs(V,{children:["Address: ",s.address]}),e.jsxs(V,{children:["License Number: ",s.licenseNumber]}),e.jsxs(V,{children:["Vehicle:"," ",s.assignedVehicle?`${s.assignedVehicle.regisNumber} - ${s.assignedVehicle.brand} ${s.assignedVehicle.model}`:"No vehicle assigned"]}),e.jsxs(V,{children:["Status: ",m.find(r=>r.value===s.status).label]}),e.jsxs(M,{className:"d-flex justify-content-end mt-3",children:[w?e.jsx(E,{color:"primary",size:"sm"}):e.jsx(ie,{driver:s,onUpdateDriver:d}),f.includes(j)&&e.jsx(ce,{driver:s,onDeleteDriver:x})]})]})]},s._id))}),p.length>0&&e.jsxs(M,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs(M,{children:["Showing ",i+1," to ",Math.min(A,p.length)," of"," ",p.length," entries"]}),e.jsxs(le,{className:"mt-3",children:[e.jsx(q,{disabled:y===1,onClick:()=>N(s=>Math.max(s-1,1)),children:"Previous"}),Array.from({length:u},(s,r)=>r+1).map(s=>e.jsx(q,{active:s===y,onClick:()=>N(s),children:s},s)),e.jsx(q,{disabled:y===u,onClick:()=>N(s=>Math.min(s+1,u)),children:"Next"})]})]}),v&&e.jsx(k,{color:"danger",className:"text-center justify-content-center",children:v})]})},Ve=()=>{const{showError:o}=F(),[w,x]=l.useState([]),[d,j]=l.useState(!1),[f,v]=l.useState(null),[S,n]=l.useState(!1),[C,p]=l.useState(null),D=async()=>{var i,a,u,c;j(!0);try{const m=await _.get("/api/v1/driver");m.status===200?(x(m.data.data),j(!1)):(v(m.data.message),o(m.data.message))}catch(m){v(((a=(i=m.response)==null?void 0:i.data)==null?void 0:a.message)||m.message),o(((c=(u=m.response)==null?void 0:u.data)==null?void 0:c.message)||m.message)}finally{j(!1)}};l.useEffect(()=>{D()},[]);const y=i=>{x(a=>[...a,i]),D()},N=i=>{p(i),n(!0)},h=i=>{x(a=>a.filter(u=>u._id!==i))},A=i=>{x(a=>a.map(u=>u._id===i._id?i:u))};return e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"text-center",children:"Driver Management"}),e.jsx(M,{className:"m-3",children:e.jsx(oe,{onAddDriver:y})}),e.jsxs(re,{children:[e.jsx(V,{children:"Drivers list"}),e.jsx(ne,{className:"md-3",children:e.jsx(de,{driver:w,loading:d,error:f,onDeleteDriver:N,onUpdateDriver:A})})]}),e.jsxs(O,{visible:S,onClose:()=>n(!1),alignment:"center",children:[e.jsx(z,{closeButton:!0,children:"Confirm Delete"}),e.jsx(B,{children:"Are you sure you want to delete this driver? This action cannot be undone."}),e.jsxs(U,{children:[e.jsx(I,{color:"secondary",onClick:()=>n(!1),children:"Cancel"}),e.jsx(I,{color:"danger",onClick:h,children:"Delete"})]})]})]})};export{Ve as default};
