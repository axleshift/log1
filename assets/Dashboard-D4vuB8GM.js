import{r as t,_ as be,u as je,R as N,a as ee,c as te,P as h,j as e,k as ae,m as q,l as Ce}from"./index-D-r3SwWE.js";import{F as _,h as ye,i as Pe,a as ve,j as Fe,k as Ve,l as _e,m as Re}from"./index-DkpIxDEf.js";import{C as H}from"./CAlert-_XTBEDmE.js";import{C as F,a as g}from"./CRow-CdsXrrUn.js";import{C as U}from"./CCard-DGVyD1PY.js";import{C as $}from"./CCardHeader-CugUrxSR.js";import{C as W}from"./CCardBody-DitVf1Qc.js";import{C as Ne}from"./CInputGroup-Dkl_-Pet.js";import{C as z}from"./CFormInput-CB7xe1Jz.js";import{a as Se}from"./CButton-BWcN8_B8.js";import{C as Oe,a as Be,b as pe,c as X,d as He,e as Q}from"./CTable-Dwy4wl14.js";import{C as Ue,a as Z}from"./CPaginationItem-oNFJkbcX.js";import{i as ge}from"./DefaultLayout-DGHJqxJH.js";import{C as $e,W as We}from"./WidgetsDropdown-DKz3RdOT.js";import{C as Ge}from"./CFormSelect-foydsQMf.js";import"./CContainer-Cn60p-_G.js";import"./index.esm-DvXRRzm4.js";import"./1-CvzzKQ8s.js";import"./cil-user-Ddrdy7PS.js";var we=t.createContext({}),re=t.forwardRef(function(i,x){var k=i.children,S=i.activeIndex,l=S===void 0?0:S,w=i.className,b=i.controls,v=i.dark,L=i.indicators,D=i.interval,E=D===void 0?5e3:D,C=i.onSlid,p=i.onSlide,y=i.pause,j=y===void 0?"hover":y,I=i.touch,A=I===void 0?!0:I,n=i.transition,c=i.wrap,o=c===void 0?!0:c,r=be(i,["children","activeIndex","className","controls","dark","indicators","interval","onSlid","onSlide","pause","touch","transition","wrap"]),s=t.useRef(null),a=je(x,s),d=t.useRef({}).current,f=t.useState(l),u=f[0],V=f[1],M=t.useState(!1),T=M[0],O=M[1],R=t.useState(),se=R[0],Ee=R[1],ie=t.useState("next"),J=ie[0],K=ie[1],oe=t.useState(0),G=oe[0],De=oe[1],le=t.useState(null),ke=le[0],ce=le[1],de=t.useState(),ue=de[0],me=de[1];t.useEffect(function(){De(t.Children.toArray(k).length)}),t.useEffect(function(){ue&&Y()},[ue]),t.useEffect(function(){!T&&Y(),!T&&C&&C(u,J),T&&p&&p(u,J)},[T]),t.useEffect(function(){return window.addEventListener("scroll",fe),function(){window.removeEventListener("scroll",fe)}});var Y=function(){he(),!(!o&&u===G-1)&&typeof E=="number"&&(d.timeout=setTimeout(function(){return Le()},typeof se=="number"?se:E))},he=function(){return j&&d.timeout&&clearTimeout(d.timeout)},Le=function(){if(!document.hidden&&s.current&&ge(s.current)){if(T)return;B("next")}},B=function(m){T||(K(m),m==="next"?u===G-1?V(0):V(u+1):V(u===0?G-1:u-1))},Ie=function(m){if(u!==m){if(u<m){K("next"),V(m);return}u>m&&(K("prev"),V(m))}},fe=function(){!document.hidden&&s.current&&ge(s.current)?me(!0):me(!1)},Te=function(m){var P=ke;if(P!==null){var Me=m.touches[0].clientX,xe=P-Me;xe>5&&B("next"),xe<-5&&B("prev"),ce(null)}},Ae=function(m){var P=m.touches[0].clientX;ce(P)};return N.createElement("div",ee({className:te("carousel slide",{"carousel-fade":n==="crossfade"},w)},v&&{"data-coreui-theme":"dark"},{onMouseEnter:he,onMouseLeave:Y},A&&{onTouchStart:Ae,onTouchMove:Te},r,{ref:a}),N.createElement(we.Provider,{value:{setAnimating:O,setCustomInterval:Ee}},L&&N.createElement("div",{className:"carousel-indicators"},Array.from({length:G},function(m,P){return P}).map(function(m){return N.createElement("button",ee({key:"indicator".concat(m),onClick:function(){!T&&Ie(m)},className:te({active:u===m}),"data-coreui-target":""},u===m&&{"aria-current":!0},{"aria-label":"Slide ".concat(m+1)}))})),N.createElement("div",{className:"carousel-inner"},t.Children.map(k,function(m,P){if(N.isValidElement(m))return N.cloneElement(m,{active:u===P,direction:J,key:P})})),b&&N.createElement(N.Fragment,null,N.createElement("button",{className:"carousel-control-prev",onClick:function(){return B("prev")}},N.createElement("span",{className:"carousel-control-prev-icon","aria-label":"prev"})),N.createElement("button",{className:"carousel-control-next",onClick:function(){return B("next")}},N.createElement("span",{className:"carousel-control-next-icon","aria-label":"next"})))))});re.propTypes={activeIndex:h.number,children:h.node,className:h.string,controls:h.bool,dark:h.bool,indicators:h.bool,interval:h.oneOfType([h.bool,h.number]),onSlid:h.func,onSlide:h.func,pause:h.oneOf([!1,"hover"]),touch:h.bool,transition:h.oneOf(["slide","crossfade"]),wrap:h.bool};re.displayName="CCarousel";var ne=t.forwardRef(function(i,x){var k=i.children,S=i.className,l=i.active,w=i.direction,b=i.interval,v=b===void 0?!1:b,L=be(i,["children","className","active","direction","interval"]),D=t.useContext(we),E=D.setAnimating,C=D.setCustomInterval,p=t.useRef(null),y=je(x,p),j=t.useRef(),I=t.useState(),A=I[0],n=I[1],c=t.useState(),o=c[0],r=c[1],s=t.useState(l&&"active"),a=s[0],d=s[1],f=t.useState(0),u=f[0],V=f[1];return t.useEffect(function(){l&&(C(v),u!==0&&r("carousel-item-".concat(w))),j.current&&!l&&d("active"),(l||j.current)&&setTimeout(function(){var M;u!==0&&((M=p.current)===null||M===void 0||M.offsetHeight,n("carousel-item-".concat(w==="next"?"start":"end")))},0),j.current=l,u===0&&V(u+1)},[l]),t.useEffect(function(){var M,T;return(M=p.current)===null||M===void 0||M.addEventListener("transitionstart",function(){l&&E(!0)}),(T=p.current)===null||T===void 0||T.addEventListener("transitionend",function(){l&&E(!1),n(""),r(""),l&&d("active"),l||d("")}),function(){var O,R;(O=p.current)===null||O===void 0||O.removeEventListener("transitionstart",function(){l&&E(!0)}),(R=p.current)===null||R===void 0||R.removeEventListener("transitionend",function(){l&&E(!1),n(""),r(""),l&&d("active"),l||d("")})}}),N.createElement("div",ee({className:te("carousel-item",a,A,o,S),ref:y},L),k)});ne.propTypes={active:h.bool,children:h.node,className:h.string,direction:h.string,interval:h.oneOfType([h.bool,h.number])};ne.displayName="CCarouselItem";const Xe=()=>{const[i,x]=t.useState([]),[k,S]=t.useState(!0),[l,w]=t.useState(null),[b,v]=t.useState(1),[L]=t.useState(5),[D,E]=t.useState(""),[C,p]=t.useState({total:0,available:0,inUse:0,maintenance:0});t.useEffect(()=>{(async()=>{try{S(!0);const s=await q.get("/api/v1/vehicle");x(s.data.data);const a=s.data.data.reduce((d,f)=>{switch(d.total++,f.status){case"available":d.available++;break;case"in_use":d.inUse++;break;case"maintenance":d.maintenance++;break;default:break}return d},{total:0,available:0,inUse:0,maintenance:0});p(a)}catch(s){w(s.message),console.error("Error fetching dashboard data:",s)}finally{S(!1)}})()},[]);const y=i.filter(r=>{const s=D.toLowerCase();return r.regisNumber.toLowerCase().includes(s)||r.brand.toLowerCase().includes(s)||r.model.toLowerCase().includes(s)||r.status.toLowerCase().includes(s)}),j=b*L,I=j-L,A=y.slice(I,j),n=Math.ceil(y.length/L),c=r=>{v(r)};t.useEffect(()=>{v(1)},[D]);const o=({status:r})=>{const s=a=>{switch(a){case"available":return"success";case"in_use":return"danger";case"maintenance":return"warning";default:return"secondary"}};return e.jsx("span",{className:`badge bg-${s(r)}`,children:r})};return k?e.jsx(ae,{color:"primary",children:"Loading vehicle data..."}):l?e.jsxs(H,{color:"danger",children:["Error: ",l]}):e.jsxs(e.Fragment,{children:[e.jsx(F,{children:e.jsx(g,{children:e.jsxs(U,{className:"mb-4",children:[e.jsx($,{children:e.jsx("h4",{children:"Vehicle Overview"})}),e.jsx(W,{children:e.jsxs(F,{children:[e.jsx(g,{md:3,children:e.jsxs("div",{className:"border-start border-start-4 border-start-success p-3",children:[e.jsx("h6",{children:"Available Vehicles"}),e.jsx("h4",{children:C.available})]})}),e.jsx(g,{md:3,children:e.jsxs("div",{className:"border-start border-start-4 border-start-danger p-3",children:[e.jsx("h6",{children:"In Use"}),e.jsx("h4",{children:C.inUse})]})}),e.jsx(g,{md:3,children:e.jsxs("div",{className:"border-start border-start-4 border-start-warning p-3",children:[e.jsx("h6",{children:"Under Maintenance"}),e.jsx("h4",{children:C.maintenance})]})}),e.jsx(g,{md:3,children:e.jsxs("div",{className:"border-start border-start-4 border-start-info p-3",children:[e.jsx("h6",{children:"Total Fleet"}),e.jsx("h4",{children:C.total})]})})]})})]})})}),e.jsx(F,{children:e.jsx(g,{children:e.jsxs(U,{className:"mb-4",children:[e.jsx($,{children:e.jsxs(F,{className:"align-items-center ",children:[e.jsx(g,{children:e.jsx("h4",{children:"Vehicle List"})}),e.jsx(g,{xs:"auto",children:e.jsxs(Ne,{className:"mb-3",children:[e.jsx(z,{placeholder:"Search vehicles...",value:D,id:"searchTerm2",onChange:r=>E(r.target.value)}),e.jsx(Se,{color:"primary",variant:"outline",children:e.jsx(_,{icon:ye})})]})})]})}),e.jsxs(W,{children:[e.jsxs(Oe,{hover:!0,responsive:!0,children:[e.jsx(Be,{children:e.jsxs(pe,{children:[e.jsx(X,{children:"Plate Number"}),e.jsx(X,{children:"Brand"}),e.jsx(X,{children:"Model"}),e.jsx(X,{children:"Status"})]})}),e.jsx(He,{children:A.map(r=>e.jsxs(pe,{children:[e.jsx(Q,{children:r.regisNumber}),e.jsx(Q,{children:r.brand}),e.jsx(Q,{children:r.model}),e.jsx(Q,{children:e.jsx(o,{status:r.status})})]},r._id))})]}),y.length===0?e.jsx("div",{className:"text-center p-3",children:e.jsx(H,{color:"info",children:"No vehicles found matching your search criteria."})}):e.jsxs(Ue,{align:"center","aria-label":"Page navigation",children:[e.jsx(Z,{disabled:b===1,onClick:()=>c(b-1),children:"Previous"}),[...Array(n)].map((r,s)=>e.jsx(Z,{active:b===s+1,onClick:()=>c(s+1),children:s+1},s+1)),e.jsx(Z,{disabled:b===n,onClick:()=>c(b+1),children:"Next"})]})]})]})})})]})},Qe=()=>{const i=Ce(),[x,k]=t.useState([]),[S,l]=t.useState(!0),[w,b]=t.useState(null),[v,L]=t.useState(""),[D,E]=t.useState({total:0,scheduled:0,inProgress:0,completed:0}),C=3;t.useEffect(()=>{(async()=>{try{l(!0);const c=await q.get("/api/v1/maintenance/all");k(c.data.data);const o=c.data.data.reduce((r,s)=>{switch(r.total++,s.status){case"Scheduled":r.scheduled++;break;case"In Progress":r.inProgress++;break;case"Completed":r.completed++;break;default:break}return r},{total:0,scheduled:0,inProgress:0,completed:0});E(o)}catch(c){b(c.message),console.error("Error fetching maintenance data:",c)}finally{l(!1)}})()},[]);const p=n=>{i("/fleetManagement/MaintenanceManagement",{state:{selectedMaintenanceId:n}})},y=x.filter(n=>{var o;const c=v.toLowerCase();return((o=n.vehicle)==null?void 0:o.regisNumber.toLowerCase().includes(c))||n.maintenanceType.toLowerCase().includes(c)||n.status.toLowerCase().includes(c)||n.priority.toLowerCase().includes(c)}),j=n=>{switch(n){case"Completed":return"success";case"In Progress":return"warning";case"Scheduled":return"info";default:return"primary"}},I=n=>{switch(n){case"High":return"danger";case"Medium":return"warning";case"Low":return"info";default:return"secondary"}},A=[];for(let n=0;n<y.length;n+=C)A.push(y.slice(n,n+C));return S?e.jsx(ae,{color:"primary",children:"Loading maintenance data..."}):w?e.jsxs(H,{color:"danger",children:["Error: ",w]}):e.jsx(e.Fragment,{children:e.jsx(F,{children:e.jsx(g,{children:e.jsxs(U,{className:"mb-4",children:[e.jsx($,{children:e.jsxs(F,{className:"align-items-center",children:[e.jsx(g,{children:e.jsx("h4",{children:"Maintenance List"})}),e.jsx(g,{xs:"auto",children:e.jsxs(Ne,{className:"mb-3",children:[e.jsx(z,{placeholder:"Search maintenance...",value:v,id:"searchTerm",onChange:n=>L(n.target.value)}),e.jsx(Se,{color:"primary",variant:"outline",children:e.jsx(_,{icon:ye})})]})})]})}),e.jsx(W,{children:y.length===0?e.jsx(H,{color:"info",children:"No maintenance records found matching your search criteria."}):e.jsx(re,{controls:!0,indicators:!0,dark:!0,children:A.map((n,c)=>e.jsx(ne,{children:e.jsx(F,{children:n.map(o=>{var r;return e.jsx(g,{md:4,children:e.jsxs(U,{className:`mb-4 h-100 border-${j(o.status)} maintenance-card`,onClick:()=>p(o._id),style:{cursor:"pointer"},children:[e.jsx($,{className:`bg-${j(o.status)}`,children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx(_,{icon:Pe})," ",(r=o.vehicle)==null?void 0:r.regisNumber]}),e.jsx(ve,{color:I(o.priority),children:o.priority})]})}),e.jsxs(W,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx(_,{icon:Fe})," ",e.jsx("strong",{children:"Type:"})," ",o.maintenanceType]}),e.jsxs("div",{className:"mb-3",children:[e.jsx(_,{icon:Ve})," ",e.jsx("strong",{children:"Start:"})," ",new Date(o.startDate).toLocaleDateString()]}),e.jsxs("div",{className:"mb-3",children:[e.jsx(_,{icon:_e})," ",e.jsx("strong",{children:"Expected End:"})," ",new Date(o.expectedEndDate).toLocaleDateString()]}),e.jsxs("div",{children:[e.jsx(_,{icon:Re})," ",e.jsx("strong",{children:"Status:"})," ",e.jsx(ve,{color:j(o.status),children:o.status})]})]})]})},o._id)})})},c))})})]})})})})},qe=()=>{const i=Ce(),[x,k]=t.useState([]),[S,l]=t.useState(new Date(new Date().setMonth(new Date().getMonth()-1)).toISOString().split("T")[0]),[w,b]=t.useState(new Date().toISOString().split("T")[0]),[v,L]=t.useState(""),[D,E]=t.useState([]),[C,p]=t.useState(!0),[y,j]=t.useState(!1);t.useEffect(()=>{A(),I()},[S,w,v]);const I=async()=>{try{const a=await q.get("/api/v1/vehicle");E(a.data.data||[])}catch(a){console.error("Error fetching vehicles:",a)}},A=async()=>{try{p(!0);const a={startDate:S,endDate:w,...v&&{vehicleId:v}},d=await q.get("/api/v1/fuelLogs/fuel-logs/analytics",{params:a});k(d.data.data||[])}catch(a){console.error("Error fetching analytics:",a),k([])}finally{p(!1)}},n=a=>new Date(a).toLocaleDateString(),c=a=>{if(!(a!=null&&a.vehicleDetails))return"Unknown Vehicle";const{brand:d="",model:f="",regisNumber:u=""}=a.vehicleDetails;return`${d} ${f}${u?` (${u})`:""}`},o=()=>{if(!x||x.length===0)return null;if(v&&x.length===1){const a=x[0];if(!(a!=null&&a.fuelLogs))return null;const d=[...a.fuelLogs].sort((f,u)=>new Date(f.date)-new Date(u.date));return{labels:d.map(f=>n(f.date)),datasets:[{label:"Fuel Consumption (L)",data:d.map(f=>f.fuelQuantity||0),borderColor:"#321fdb",backgroundColor:"rgba(50, 31, 219, 0.1)",fill:!0,tension:.4},{label:"Cost",data:d.map(f=>f.totalCost||0),borderColor:"#2eb85c",backgroundColor:"rgba(46, 184, 92, 0.1)",fill:!0,tension:.4,yAxisID:"cost"},{label:"Efficiency (L/100km)",data:d.map(f=>parseFloat(f.litersPer100km)||0),borderColor:"#f9b115",backgroundColor:"rgba(249, 177, 21, 0.1)",fill:!0,tension:.4,yAxisID:"efficiency"}]}}else return{labels:x.map(a=>c(a)),datasets:[{label:"Total Fuel Consumption (L)",data:x.map(a=>a.totalFuelConsumption||0),borderColor:"#321fdb",backgroundColor:"rgba(50, 31, 219, 0.1)",fill:!0,tension:.4},{label:"Total Cost ",data:x.map(a=>a.totalCost||0),borderColor:"#2eb85c",backgroundColor:"rgba(46, 184, 92, 0.1)",fill:!0,tension:.4,yAxisID:"cost"},{label:"Average Efficiency (L/100km)",data:x.map(a=>a.averageEfficiency||0),borderColor:"#f9b115",backgroundColor:"rgba(249, 177, 21, 0.1)",fill:!0,tension:.4,yAxisID:"efficiency"}]}},r={responsive:!0,interaction:{mode:"index",intersect:!1},plugins:{legend:{position:"top"},title:{display:!0,text:v?"Vehicle Performance Over Time":"Vehicles Comparison"}},scales:{y:{type:"linear",display:!0,position:"left",title:{display:!0,text:"Fuel Consumption (L)"}},cost:{type:"linear",display:!0,position:"right",title:{display:!0,text:"Cost "},grid:{drawOnChartArea:!1}},efficiency:{type:"linear",display:!0,position:"right",title:{display:!0,text:"Efficiency (L/100km)"},grid:{drawOnChartArea:!1}}},maintainAspectRatio:!1},s=()=>{i("/fleetManagement/FuelManagement")};return e.jsx(F,{children:e.jsx(g,{xs:12,children:e.jsxs(U,{className:"mb-4",children:[e.jsxs($,{children:[e.jsxs("h4",{onClick:s,onMouseEnter:()=>j(!0),onMouseLeave:()=>j(!1),style:{cursor:"pointer",color:y?"grey":"inherit"},children:[" ","Fuel Analytics Dashboard"]}),e.jsxs(F,{className:"mt-3",children:[e.jsx(g,{md:4,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",htmlFor:"startDate",children:"Start Date"}),e.jsx(z,{type:"date",id:"startDate",value:S,onChange:a=>l(a.target.value)})]})}),e.jsx(g,{md:4,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",htmlFor:"endDate",children:"End Date"}),e.jsx(z,{type:"date",id:"endDate",value:w,onChange:a=>b(a.target.value)})]})}),e.jsx(g,{md:4,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",htmlFor:"vehicleId",children:"Vehicle"}),e.jsxs(Ge,{value:v,id:"vehicleId",onChange:a=>L(a.target.value),children:[e.jsx("option",{value:"",children:"All Vehicles"}),D.map(a=>e.jsxs("option",{value:a._id,children:[a.brand," ",a.model," - ",a.regisNumber]},a._id))]})]})})]})]}),e.jsx(W,{children:C?e.jsx("div",{className:"text-center",children:e.jsx(ae,{})}):e.jsx("div",{style:{height:"400px"},children:x.length>0?e.jsx($e,{type:"line",style:{height:"400px"},data:o(),options:r}):e.jsx(H,{color:"danger",className:"text-center",children:"No data available"})})})]})})})},ft=()=>e.jsxs(e.Fragment,{children:[e.jsx(We,{className:"mb-4"}),e.jsx(Xe,{className:"mb-4"}),e.jsx(qe,{className:"mb-4"}),e.jsx(Qe,{className:"mb-4"})]});export{ft as default};
