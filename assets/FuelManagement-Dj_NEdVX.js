import{B as be,r as o,j as e,k as oe,A as H,D as Ie}from"./index-D3sENHx8.js";import{F as le,h as Te,e as we,n as ye,o as De,a as ve,p as Ee,g as Re,l as Me}from"./index-BkVfsiqy.js";import{a as R}from"./CButton-BtLzD1nc.js";import{C as ce,a as ue,b as Pe,c as me,d as pe}from"./CModalTitle-B-PsqkjO.js";import{C as ne}from"./CAlert-7ALPkqIl.js";import{C as Le}from"./CForm-aXXLYJpe.js";import{C as E,a as Qe}from"./CInputGroupText-lS-LDq2r.js";import{C as m,a as ke}from"./CFormInput-ELlVuuy1.js";import{C as fe}from"./CFormSelect-BY3m6lUT.js";import{C as ge}from"./1-Cs5G51RP.js";import{C as Fe}from"./CFormTextarea-BdUO6s7T.js";import{C as ie}from"./CContainer-JMjuzE-E.js";import{C as $e,a as _e,b as Ne,c as V,d as Oe,e as ee}from"./CTable-qilBEm_B.js";import{b as Ae,c as qe,d as Ue,C as Ge}from"./DefaultLayout-Cp499GQ2.js";import{C as ze,a as xe}from"./CPaginationItem-e85AesSY.js";import{C as Be}from"./CCard-DonNi5aQ.js";import{C as He}from"./CCardBody-CD1PubO1.js";import"./index.esm-CRTaRlLz.js";import"./cil-user-Ddrdy7PS.js";const We=({onAddFuelog:d})=>{var f,B;const{showSuccess:W,showError:F}=be(),[_,S]=o.useState(!1),[O,te]=o.useState(null),[A,q]=o.useState(!1),[J,p]=o.useState(!1),[ae,L]=o.useState(!1),[U,k]=o.useState(null),[X,G]=o.useState([]),[P,M]=o.useState([]),Y=new Date().toISOString().split("T")[0],Q={vehicleId:"",driverId:"",vehicleDetails:{brand:"",model:"",regisNumber:"",fuelType:""},driverDetails:{driverName:""},date:"",receiptNumber:"",fuelQuantity:"",fuelType:"",costPerLiter:"",totalCost:"",currentMileage:"",receiptImage:null,route:{start:"",end:"",distance:""},notes:"",litersPer100km:"",kmPerLiter:"",mpg:""},[l,i]=o.useState(Q);o.useEffect(()=>{(async()=>{try{S(!0);const[v,s]=await Promise.all([H.get("/api/v1/driver"),H.get("/api/v1/vehicle/in-use")]);G(v.data.data),M(s.data.data)}catch{F("Error fetching initial data")}finally{S(!1)}})()},[]);const u=h=>{const{id:v,value:s}=h.target;if(v.includes("route.")){const t=v.split(".")[1];i(a=>{const r={...a,route:{...a.route,[t]:s}};if(r.route.distance&&r.fuelQuantity){const n=parseFloat(r.route.distance),x=parseFloat(r.fuelQuantity);if(n>0&&x>0){const I=x/n*100;r.litersPer100km=I.toFixed(2);const Z=n/x;r.kmPerLiter=Z.toFixed(2);const K=x*.264172,se=n*.621371/K;r.mpg=se.toFixed(2)}}return r})}else if(v==="vehicleId"){const t=P.find(r=>r._id===s),a=X.find(r=>r._id===(t==null?void 0:t.assignedDriver));i(r=>({...r,vehicleId:s,driverId:(t==null?void 0:t.assignedDriver)||"",vehicleDetails:{brand:(t==null?void 0:t.brand)||"",model:(t==null?void 0:t.model)||"",regisNumber:(t==null?void 0:t.regisNumber)||"",fuelType:(t==null?void 0:t.fuelType)||""},driverDetails:{driverName:(a==null?void 0:a.driverName)||""},currentMileage:(t==null?void 0:t.currentMileage)||"",fuelType:(t==null?void 0:t.fuelType)||""}))}else i(v==="fuelQuantity"||v==="costPerLiter"?t=>{const a={...t,[v]:s},r=parseFloat(v==="fuelQuantity"?s:t.fuelQuantity),n=parseFloat(v==="costPerLiter"?s:t.costPerLiter);if(!isNaN(r)&&!isNaN(n)&&(a.totalCost=(r*n).toFixed(2)),v==="fuelQuantity"&&a.route.distance){const x=parseFloat(a.route.distance),I=parseFloat(s);if(x>0&&I>0){const Z=I/x*100;a.litersPer100km=Z.toFixed(2);const K=x/I;a.kmPerLiter=K.toFixed(2);const re=I*.264172,de=x*.621371/re;a.mpg=de.toFixed(2)}}return a}:t=>({...t,[v]:s}))},$=h=>{const v=h.target.files[0];if(v){i(t=>({...t,receiptImage:v}));const s=new FileReader;s.onloadend=()=>{k(s.result)},s.readAsDataURL(v)}},z=async h=>{if(h.preventDefault(),h.stopPropagation(),h.currentTarget.checkValidity()===!1){L(!0);return}S(!0);try{const s=new FormData;s.append("vehicleId",l.vehicleId),s.append("driverId",l.driverId),s.append("vehicleDetails[brand]",l.vehicleDetails.brand),s.append("vehicleDetails[model]",l.vehicleDetails.model),s.append("vehicleDetails[regisNumber]",l.vehicleDetails.regisNumber),s.append("vehicleDetails[fuelType]",l.vehicleDetails.fuelType),s.append("driverDetails[driverName]",l.driverDetails.driverName),s.append("date",l.date),s.append("receiptNumber",l.receiptNumber),s.append("fuelQuantity",l.fuelQuantity),s.append("fuelType",l.fuelType),s.append("costPerLiter",l.costPerLiter),s.append("totalCost",l.totalCost),s.append("currentMileage",l.currentMileage),s.append("notes",l.notes),s.append("litersPer100km",l.litersPer100km),s.append("kmPerLiter",l.kmPerLiter),s.append("mpg",l.mpg),s.append("route[start]",l.route.start),s.append("route[end]",l.route.end),s.append("route[distance]",l.route.distance),l.receiptImage&&s.append("receiptImage",l.receiptImage);const t=await H.post("/api/v1/fuelLogs/fuel-logs",s);t.data.success&&(d(t.data.data),W(t.data.message),q(t.data.message),setTimeout(()=>{q(!1),i(Q),k(null),p(!1)},2e3))}catch(s){F(s.response.data.message),te(s.response.data.message),setTimeout(()=>{te(null)},5e3)}finally{S(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs(R,{color:"primary",variant:"outline",disabled:_,onClick:()=>p(!0),children:[_?e.jsx(oe,{color:"primary",size:"sm"}):e.jsx(le,{icon:Te}),"Add Fuel Log"]}),e.jsxs(ce,{visible:J,onClose:()=>p(!1),size:"lg",children:[e.jsx(ue,{children:e.jsx(Pe,{children:"Add Fuel Log"})}),O&&e.jsx(ne,{color:"danger",className:"m-3",children:O}),A&&e.jsx(ne,{color:"success",className:"m-3",children:A}),e.jsx(me,{children:e.jsxs(Le,{noValidate:!0,validated:ae,children:[e.jsxs(E,{children:[e.jsx(m,{type:"date",className:"mb-3",floatingLabel:"date",label:"Receipt Number",id:"date",max:Y,value:l.date,onChange:u,required:!0}),e.jsxs(fe,{className:"mb-3",floatingLabel:"Vehicle",label:"Vehicle",id:"vehicleId",value:l.vehicleId,onChange:u,required:!0,children:[e.jsx("option",{value:"",children:"Select Vehicle"}),P==null?void 0:P.map(h=>e.jsx("option",{value:h._id,children:`${h.brand} / ${h.model} / ${h.regisNumber}`},h._id))]}),e.jsx(m,{className:"mb-3",floatingLabel:"Driver",label:"Driver",id:"driverId",value:((f=X.find(h=>h._id===l.driverId))==null?void 0:f.driverName)||"",onChange:u,disabled:!0}),e.jsxs(fe,{className:"mb-3",floatingLabel:"Fuel Type",label:"Fuel Type",id:"fuelType",required:!0,value:((B=P.find(h=>h._id===l.vehicleId))==null?void 0:B.fuelType)||"",onChange:u,disabled:!0,children:[e.jsx("option",{value:"",children:"Select Fuel Type"}),e.jsx("option",{value:"Gasoline",children:"Gasoline"}),e.jsx("option",{value:"Diesel",children:"Diesel"})]})]}),e.jsxs(E,{children:[e.jsx(m,{className:"mb-3",type:"text",floatingLabel:"Official Reciept",placeholder:"Official Reciept",id:"receiptNumber",value:l.receiptNumber,onChange:u,required:!0,autoComplete:"off"}),e.jsx(m,{className:"mb-3",type:"number",floatingLabel:"Fuel Quantity",placeholder:"Fuel Quantity",id:"fuelQuantity",value:l.fuelQuantity,onChange:u,required:!0,autoComplete:"off",min:"0",step:"0.01",feedbackInvalid:"Please enter a valid fuel quantity"}),e.jsx(m,{className:"mb-3",type:"number",floatingLabel:"Cost Per Liter",placeholder:"Cost Per Liter",id:"costPerLiter",value:l.costPerLiter,onChange:u,autoComplete:"off",feedbackInvalid:"Please enter a valid cost per liter"}),e.jsx(m,{className:"mb-3",type:"number",floatingLabel:"Total Cost",placeholder:"Total Cost",id:"totalCost",value:l.totalCost,onChange:u,autoComplete:"off",min:"0",step:"0.01",disabled:!0,feedbackInvalid:"Please enter a valid total cost"})]}),e.jsxs(E,{children:[e.jsx(m,{className:"mb-3",type:"number",floatingLabel:"Odometer Reading",placeholder:"Odometer Reading",id:"currentMileage",value:l.currentMileage,onChange:u,autoComplete:"off",feedbackInvalid:"Please enter a valid odometer reading"}),e.jsx(m,{className:"mb-3",type:"text",floatingLabel:"Start Location",placeholder:"Start Location",id:"route.start",value:l.route.start,onChange:u,autoComplete:"off",feedbackInvalid:"Please enter a valid start location"}),e.jsx(m,{className:"mb-3",type:"text",floatingLabel:"End Location",placeholder:"End Location",id:"route.end",value:l.route.end,onChange:u,autoComplete:"off",feedbackInvalid:"Please enter a valid end location"}),e.jsx(m,{className:"mb-3",type:"number",floatingLabel:"Distance/kilometers",placeholder:"Distance",id:"route.distance",value:l.route.distance,onChange:u,autoComplete:"off",feedbackInvalid:"Please enter a valid distance"})]}),e.jsxs(E,{className:"mb-3",children:[e.jsx(m,{type:"text",floatingLabel:"L/100km",placeholder:"Liters per 100km",id:"litersPer100km",value:l.litersPer100km,disabled:!0}),e.jsx(m,{type:"text",floatingLabel:"km/L",placeholder:"Kilometers per Liter",id:"kmPerLiter",value:l.kmPerLiter,disabled:!0}),e.jsx(m,{type:"text",floatingLabel:"MPG",placeholder:"Miles per Gallon",id:"mpg",value:l.mpg,disabled:!0})]}),e.jsx(ke,{htmlFor:"receipt",children:"Picture Of Receipts"}),e.jsx(E,{className:"mb-3",children:e.jsx(m,{type:"file",id:"receipt",accept:"images/*",onChange:$})}),U&&e.jsx("div",{className:"mb-3",children:e.jsx(ge,{src:U,rounded:!0,align:"center",alt:"Receipts",width:200,height:200})}),e.jsx(Fe,{className:"mb-3",type:"text",floatingLabel:"Notes",placeholder:"Notes",rows:3,id:"notes",value:l.notes,autoCapitalize:"on",autoComplete:"off",onChange:u,feedbackInvalid:"Please enter a valid notes"})]})}),e.jsxs(pe,{children:[e.jsx(R,{color:"secondary",onClick:()=>p(!1),children:"Close"}),e.jsx(R,{color:"primary",onClick:z,disabled:_,children:_?e.jsx(oe,{color:"primary",size:"sm"}):"Add"})]})]})]})},Je=({fuelLogs:d,vehicles:W,drivers:F,loading:_,error:S,onDeleteFuelLog:O,onUpdateFuelLog:te,onViewReceipt:A})=>{const[q,J]=o.useState(""),[p,ae]=o.useState("date"),[L,U]=o.useState("desc"),[k,X]=o.useState(""),[G,P]=o.useState(1),[M]=o.useState(10),[Y,Q]=o.useState(null),l=Ie(),i=["manager","admin"],u=t=>{p===t?U(L==="asc"?"desc":"asc"):(ae(t),U("asc"))},$=(t,a)=>{if(typeof t=="object"&&(t!=null&&t.brand)&&(t!=null&&t.model)&&(t!=null&&t.regisNumber))return`${t.brand} ${t.model} (${t.regisNumber})`;if(!t&&(a!=null&&a.vehicleDetails))return`${a.vehicleDetails.brand} ${a.vehicleDetails.model} (${a.vehicleDetails.regisNumber}) [Deleted]`;const r=W.find(n=>n._id===t);if(r)return`${r.brand} ${r.model} (${r.regisNumber})`;if(r.deleted===!0)return`${r.brand} ${r.model} (${r.regisNumber}) [Deleted]`},z=(t,a)=>{var n;if(typeof t=="object"&&(t!=null&&t.driverName))return t.driverName;if(!t&&((n=a==null?void 0:a.driverDetails)!=null&&n.driverName))return`${a.driverDetails.driverName} [Deleted]`;const r=F.find(x=>x._id===t);if(r!=null&&r.driverName)return r.driverName},f=d.filter(t=>{var Z,K,re,se;if(!t)return!1;const a=$(t.vehicleId,t).toLowerCase(),r=z(t.driverId,t).toLowerCase(),n=q.toLowerCase(),x=(((Z=t.receiptNumber)==null?void 0:Z.toLowerCase())||"").includes(n)||a.includes(n)||r.includes(n)||(t.date?new Date(t.date).toLocaleDateString().includes(n):!1)||(((K=t.fuelQuantity)==null?void 0:K.toString())||"").includes(n)||(((re=t.totalCost)==null?void 0:re.toString())||"").includes(n),I=k?(typeof t.vehicleId=="object"?(se=t.vehicleId)==null?void 0:se._id:t.vehicleId)===k:!0;return x&&I}).sort((t,a)=>{let r,n;switch(p){case"vehicle":r=$(t.vehicleId,t),n=$(a.vehicleId,a);break;case"driver":r=z(t.driverId,t),n=z(a.driverId,a);break;case"date":r=new Date(t.date||"").getTime(),n=new Date(a.date||"").getTime();break;case"fuelQuantity":case"costPerLiter":case"totalCost":r=parseFloat(t[p]||0),n=parseFloat(a[p]||0);break;default:r=t[p]||"",n=a[p]||""}return!r&&!n?0:r?n?L==="asc"?r>n?1:-1:r<n?1:-1:-1:1}),B=G*M,h=B-M,v=f.slice(h,B),s=Math.ceil(f.length/M);return o.useEffect(()=>{P(1)},[q,k]),o.useEffect(()=>{f.length===0?Q("No matching records found"):Q(null)},[f]),_?e.jsx(oe,{}):S?e.jsx(ne,{color:"danger",children:S}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"col-6 mt-3 mb-3",children:e.jsxs(E,{children:[e.jsx(m,{placeholder:"Search by receipt #, vehicle, driver, date...",value:q,onChange:t=>J(t.target.value),id:"search"}),e.jsx(Qe,{children:e.jsx(le,{icon:we})})]})}),e.jsxs($e,{hover:!0,responsive:!0,className:"text-center",children:[e.jsx(_e,{children:e.jsxs(Ne,{children:[e.jsxs(V,{onClick:()=>u("date"),style:{cursor:"pointer"},children:["Date"," ",p==="date"&&e.jsx(le,{icon:L==="asc"?ye:De})]}),e.jsxs(V,{onClick:()=>u("receiptNumber"),style:{cursor:"pointer"},children:["Receipt #"," ",p==="receiptNumber"&&e.jsx(le,{icon:L==="asc"?ye:De})]}),e.jsxs(V,{onClick:()=>u("vehicle"),style:{cursor:"pointer"},children:["Vehicle ",p==="vehicle"&&(L==="asc"?"↑":"↓")]}),e.jsxs(V,{onClick:()=>u("driver"),style:{cursor:"pointer"},children:["Driver ",p==="driver"&&(L==="asc"?"↑":"↓")]}),e.jsxs(V,{onClick:()=>u("fuelQuantity"),style:{cursor:"pointer"},children:["Quantity (L) ",p==="fuelQuantity"&&(L==="asc"?"↑":"↓")]}),e.jsxs(V,{onClick:()=>u("costPerLiter"),style:{cursor:"pointer"},children:["Cost/L ",p==="costPerLiter"&&(L==="asc"?"↑":"↓")]}),e.jsxs(V,{onClick:()=>u("totalCost"),style:{cursor:"pointer"},children:["Total Cost ",p==="totalCost"&&(L==="asc"?"↑":"↓")]}),e.jsx(V,{children:"Fuel Efficiency"}),e.jsx(V,{children:"Actions"})]})}),e.jsx(Oe,{className:"align-middle",children:v.map(t=>e.jsxs(Ne,{children:[e.jsx(ee,{children:new Date(t.date).toLocaleDateString()}),e.jsx(ee,{children:t.receiptNumber}),e.jsx(ee,{children:t.vehicleId?e.jsxs(e.Fragment,{children:[`${t.vehicleId.brand} ${t.vehicleId.model} (${t.vehicleId.regisNumber})`,t.vehicleId.deleted&&e.jsx(ve,{color:"danger",className:"ms-2",children:"Deleted"})]}):e.jsxs(e.Fragment,{children:[`${t.vehicleDetails.brand} ${t.vehicleDetails.model} (${t.vehicleDetails.regisNumber}) `,e.jsx(ve,{color:"danger",className:"ms-2",children:"Deleted"})]})}),e.jsx(ee,{children:t.driverId?t.driverId.driverName:e.jsxs(e.Fragment,{children:[t.driverDetails.driverName," ",e.jsx(ve,{color:"danger",className:"ms-2",children:"Deleted"})]})}),e.jsx(ee,{children:t.fuelQuantity}),e.jsx(ee,{children:t.costPerLiter}),e.jsx(ee,{children:t.totalCost}),e.jsxs(ee,{children:[e.jsxs(ie,{children:[t.litersPer100km," L/100km"]}),e.jsxs(ie,{children:[t.kmPerLiter," km/L"]}),e.jsxs(ie,{children:[t.mpg," MPG"]})]}),e.jsx(ee,{children:e.jsxs(Ae,{variant:"input-group",children:[e.jsx(qe,{color:"secondary",variant:"outline",children:"Actions"}),e.jsxs(Ue,{children:[e.jsxs(R,{color:"primary",variant:"ghost",className:"m-2",onClick:()=>A(t),children:[e.jsx(le,{icon:Ee})," View Receipt"]}),t.vehicleId.deleted!==!0&&e.jsxs(R,{color:"info",variant:"ghost",className:"m-2",onClick:()=>te(t),children:[e.jsx(le,{icon:Re})," Edit"]}),i.includes(l)&&e.jsxs(R,{color:"danger",variant:"ghost",className:"m-2",onClick:()=>O(t._id),children:[e.jsx(le,{icon:Me})," Delete"]})]})]})})]},t._id))})]}),f.length>0&&e.jsxs(ie,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs(ie,{children:["Showing ",h+1," to"," ",Math.min(B,f.length)," of"," ",f.length," entries"]}),e.jsxs(ze,{className:"mt-3",children:[e.jsx(xe,{disabled:G===1,onClick:()=>P(t=>Math.max(t-1,1)),children:"Previous"}),Array.from({length:s},(t,a)=>a+1).map(t=>e.jsx(xe,{active:t===G,onClick:()=>P(t),children:t},t)),e.jsx(xe,{disabled:G===s,onClick:()=>P(t=>Math.min(t+1,s)),children:"Next"})]})]}),Y&&e.jsx(ne,{color:"info",className:"text-center",children:Y})]})},Xe=({fuelLog:d,visible:W,onClose:F,onUpdate:_,vehicles:S,drivers:O})=>{var v,s,t,a,r,n,x,I,Z,K,re,se,de;const{showSuccess:te,showError:A}=be(),q="http://localhost:5057",[J,p]=o.useState(!1),[ae,L]=o.useState(null),[U,k]=o.useState(null),[X,G]=o.useState(null),[P,M]=o.useState([]),[Y,Q]=o.useState([]),l=new Date().toISOString().split("T")[0],[i,u]=o.useState({date:new Date(d.date).toISOString().split("T")[0],receiptNumber:d.receiptNumber,vehicleId:((v=d.vehicleId)==null?void 0:v._id)||d.vehicleId,driverId:((s=d.driverId)==null?void 0:s._id)||d.driverId,vehicleDetails:{brand:((t=d.vehicleId)==null?void 0:t.brand)||((a=d.vehicleDetails)==null?void 0:a.brand)||"",model:((r=d.vehicleId)==null?void 0:r.model)||((n=d.vehicleDetails)==null?void 0:n.model)||"",regisNumber:((x=d.vehicleId)==null?void 0:x.regisNumber)||((I=d.vehicleDetails)==null?void 0:I.regisNumber)||"",fuelType:((Z=d.vehicleId)==null?void 0:Z.fuelType)||((K=d.vehicleDetails)==null?void 0:K.fuelType)||""},driverDetails:{driverName:((re=d.driverId)==null?void 0:re.driverName)||((se=d.driverDetails)==null?void 0:se.driverName)||""},fuelQuantity:d.fuelQuantity,costPerLiter:d.costPerLiter,totalCost:d.totalCost,currentMileage:d.currentMileage||"",fuelType:d.fuelType||"",route:{start:d.route.start,end:d.route.end,distance:d.route.distance},litersPer100km:d.litersPer100km,kmPerLiter:d.kmPerLiter,mpg:d.mpg,notes:d.notes||""}),[$,z]=o.useState(!1);o.useEffect(()=>{d!=null&&d.receiptImage&&k(`${q}/uploads/receipts/${d.receiptImage}`)},[d]),o.useEffect(()=>{(async()=>{try{p(!0);const[g,j]=await Promise.all([H.get("/api/v1/driver"),H.get("/api/v1/vehicle/in-use")]);Q(g.data.data),M(j.data.data)}catch{A("Error fetching initial data")}finally{p(!1)}})()},[]);const f=D=>{const{id:g,value:j}=D.target;if(g.includes("route.")){const c=g.split(".")[1];u(C=>{const b={...C,route:{...C.route,[c]:j}};if(b.route.distance&&b.fuelQuantity){const y=parseFloat(b.route.distance),T=parseFloat(b.fuelQuantity);if(y>0&&T>0){const N=T/y*100;b.litersPer100km=N.toFixed(2);const w=y/T;b.kmPerLiter=w.toFixed(2);const he=T*.264172,Ce=y*.621371/he;b.mpg=Ce.toFixed(2)}}return b})}else if(g==="vehicleId"){const c=P.find(b=>b._id===j),C=O.find(b=>b._id===(c==null?void 0:c.assignedDriver));u(b=>({...b,vehicleId:j,driverId:(c==null?void 0:c.assignedDriver)||"",vehicleDetails:{brand:(c==null?void 0:c.brand)||"",model:(c==null?void 0:c.model)||"",regisNumber:(c==null?void 0:c.regisNumber)||"",fuelType:(c==null?void 0:c.fuelType)||""},driverDetails:{driverName:(C==null?void 0:C.driverName)||""},currentMileage:(c==null?void 0:c.currentMileage)||"",fuelType:(c==null?void 0:c.fuelType)||""}))}else u(g==="fuelQuantity"||g==="costPerLiter"?c=>{const C={...c,[g]:j},b=parseFloat(g==="fuelQuantity"?j:c.fuelQuantity),y=parseFloat(g==="costPerLiter"?j:c.costPerLiter);if(!isNaN(b)&&!isNaN(y)&&(C.totalCost=(b*y).toFixed(2)),g==="fuelQuantity"&&C.route.distance){const T=parseFloat(C.route.distance),N=parseFloat(j);if(T>0&&N>0){const w=N/T*100;C.litersPer100km=w.toFixed(2);const he=T/N;C.kmPerLiter=he.toFixed(2);const je=N*.264172,Se=T*.621371/je;C.mpg=Se.toFixed(2)}}return C}:c=>({...c,[g]:j}))},B=D=>{const g=D.target.files[0];if(g){u(c=>({...c,receiptImage:g}));const j=new FileReader;j.onloadend=()=>{k(j.result)},j.readAsDataURL(g)}},h=async D=>{var j,c,C,b;if(D.preventDefault(),!D.currentTarget.checkValidity()){D.stopPropagation(),z(!0);return}p(!0);try{const y=new FormData;Object.keys(i).forEach(N=>{N==="route"?Object.keys(i.route).forEach(w=>{y.append(`route[${w}]`,i.route[w])}):N==="vehicleDetails"?Object.keys(i.vehicleDetails).forEach(w=>{y.append(`vehicleDetails[${w}]`,i.vehicleDetails[w])}):N==="driverDetails"?Object.keys(i.driverDetails).forEach(w=>{y.append(`driverDetails[${w}]`,i.driverDetails[w])}):(N==="receiptImage"&&i[N],y.append(N,i[N]))});const T=await H.put(`/api/v1/fuelLogs/fuel-logs/${d._id}`,y);T.data.success&&(te(T.data.message),_({...T.data.data,vehicleId:{_id:i.vehicleId,brand:i.vehicleDetails.brand,model:i.vehicleDetails.model,regisNumber:i.vehicleDetails.regisNumber},driverId:{_id:i.driverId,driverName:i.driverDetails.driverName}}),F())}catch(y){A(((c=(j=y.response)==null?void 0:j.data)==null?void 0:c.message)||"Error updating fuel log"),G(((b=(C=y.response)==null?void 0:C.data)==null?void 0:b.message)||"Error updating fuel log")}finally{p(!1)}};return e.jsxs(ce,{visible:W,onClose:F,size:"lg",backdrop:"static",children:[e.jsx(ue,{children:e.jsx(Pe,{children:"Update Fuel Log"})}),X&&e.jsx(ne,{color:"danger",className:"m-3",children:X}),ae&&e.jsx(ne,{color:"success",className:"m-3",children:ae}),e.jsx(me,{children:e.jsxs(Le,{noValidate:!0,validated:$,children:[e.jsxs(E,{children:[e.jsx(m,{type:"date",className:"mb-3",floatingLabel:"Date",label:"Date",id:"date",max:l,value:i.date,onChange:f,required:!0}),e.jsxs(fe,{className:"mb-3",floatingLabel:"Vehicle",label:"Vehicle",id:"vehicleId",value:i.vehicleId||"",onChange:f,required:!0,disabled:!0,children:[P.map(D=>e.jsxs("option",{value:D._id,children:[D.brand," / ",D.model," / ",D.regisNumber]},D._id)),e.jsx("option",{value:"",children:`${i.vehicleDetails.brand} / ${i.vehicleDetails.model} / ${i.vehicleDetails.regisNumber} [DELETED]`})]})]}),e.jsxs(E,{children:[e.jsx(m,{className:"mb-3",type:"text",floatingLabel:"Driver Name",placeholder:"Driver Name",id:"driverName",value:((de=O.find(D=>D._id===i.driverId))==null?void 0:de.driverName)||`${i.driverDetails.driverName} [DELETED]`,onChange:f,disabled:!0}),e.jsxs(fe,{className:"mb-3",floatingLabel:"Fuel Type",label:"Fuel Type",id:"fuelType",required:!0,value:i.fuelType||"",onChange:f,disabled:!0,children:[e.jsx("option",{value:"",children:"Select Fuel Type"}),e.jsx("option",{value:"Gasoline",children:"Gasoline"}),e.jsx("option",{value:"Diesel",children:"Diesel"})]})]}),e.jsxs(E,{children:[e.jsx(m,{className:"mb-3",type:"text",floatingLabel:"Official Receipt",placeholder:"Official Receipt",id:"receiptNumber",value:i.receiptNumber,onChange:f,required:!0,autoComplete:"off"}),e.jsx(m,{className:"mb-3",type:"number",floatingLabel:"Fuel Quantity",placeholder:"Fuel Quantity",id:"fuelQuantity",value:i.fuelQuantity,onChange:f,required:!0,autoComplete:"off",min:"0",step:"0.01",feedbackInvalid:"Please enter a valid fuel quantity"}),e.jsx(m,{className:"mb-3",type:"number",floatingLabel:"Cost Per Liter",placeholder:"Cost Per Liter",id:"costPerLiter",value:i.costPerLiter,onChange:f,autoComplete:"off",feedbackInvalid:"Please enter a valid cost per liter"}),e.jsx(m,{className:"mb-3",type:"number",floatingLabel:"Total Cost",placeholder:"Total Cost",id:"totalCost",value:i.totalCost,onChange:f,autoComplete:"off",min:"0",step:"0.01",disabled:!0,feedbackInvalid:"Please enter a valid total cost"})]}),e.jsxs(E,{children:[e.jsx(m,{className:"mb-3",type:"number",floatingLabel:"Odometer Reading",placeholder:"Odometer Reading",id:"currentMileage",value:i.currentMileage,onChange:f,autoComplete:"off",feedbackInvalid:"Please enter a valid odometer reading"}),e.jsx(m,{className:"mb-3",type:"text",floatingLabel:"Start Location",placeholder:"Start Location",id:"route.start",value:i.route.start,onChange:f,autoComplete:"off",feedbackInvalid:"Please enter a valid start location"}),e.jsx(m,{className:"mb-3",type:"text",floatingLabel:"End Location",placeholder:"End Location",id:"route.end",value:i.route.end,onChange:f,autoComplete:"off",feedbackInvalid:"Please enter a valid end location"}),e.jsx(m,{className:"mb-3",type:"number",floatingLabel:"Distance/kilometers",placeholder:"Distance",id:"route.distance",value:i.route.distance,onChange:f,autoComplete:"off",min:"0",step:"0.01",feedbackInvalid:"Please enter a valid distance"})]}),e.jsxs(E,{className:"mb-3",children:[e.jsx(m,{type:"text",floatingLabel:"L/100km",placeholder:"Liters per 100km",id:"litersPer100km",value:i.litersPer100km,disabled:!0}),e.jsx(m,{type:"text",floatingLabel:"km/L",placeholder:"Kilometers per Liter",id:"kmPerLiter",value:i.kmPerLiter,disabled:!0}),e.jsx(m,{type:"text",floatingLabel:"MPG",placeholder:"Miles per Gallon",id:"mpg",value:i.mpg,disabled:!0})]}),e.jsx(ke,{htmlFor:"receipt",children:"Picture Of Receipts"}),e.jsx(E,{className:"mb-3",children:e.jsx(m,{type:"file",id:"receipt",accept:"images/*",onChange:B})}),U&&e.jsx("div",{className:"mb-3",children:e.jsx(ge,{src:U,rounded:!0,align:"center",alt:"Receipts",width:200,height:200})}),e.jsx(Fe,{className:"mb-3",type:"text",floatingLabel:"Notes",placeholder:"Notes",rows:3,id:"notes",value:i.notes,autoCapitalize:"on",autoComplete:"off",onChange:f,feedbackInvalid:"Please enter a valid notes"})]})}),e.jsxs(pe,{children:[e.jsx(R,{color:"secondary",onClick:F,children:"Close"}),e.jsx(R,{color:"primary",onClick:h,disabled:J,children:J?e.jsx(oe,{color:"primary",size:"sm"}):"Update"})]})]})},ht=()=>{const d="http://localhost:5057",{showSuccess:W,showError:F}=be(),[_,S]=o.useState([]),[O,te]=o.useState([]),[A,q]=o.useState([]),[J,p]=o.useState(!1),[ae,L]=o.useState(null),[U,k]=o.useState(!1),[X,G]=o.useState(null),[P,M]=o.useState(!1),[Y,Q]=o.useState(null),[l,i]=o.useState(!1),[u,$]=o.useState(null),z=async()=>{var a,r;p(!0);try{const[n,x,I]=await Promise.all([H.get("/api/v1/fuelLogs/fuel-logs"),H.get("/api/v1/vehicle/in-use"),H.get("/api/v1/driver")]);S(n.data.data),te(x.data.data),q(I.data.data),W("Data fetched successfully")}catch(n){F(((r=(a=n.response)==null?void 0:a.data)==null?void 0:r.message)||"Error fetching data"),L(n.message)}finally{p(!1)}},f=a=>{G(a),k(!0)},B=async()=>{var a,r;try{await H.delete(`/api/v1/fuelLogs/fuel-logs/${X}`),S(n=>n.filter(x=>x._id!==X)),W("Fuel log deleted successfully"),k(!1)}catch(n){F(((r=(a=n.response)==null?void 0:a.data)==null?void 0:r.message)||"Error deleting fuel log")}},h=a=>{$(a),i(!0)},v=a=>{S(r=>r.map(n=>n._id===a._id?a:n)),i(!1),$(null)},s=a=>{if(a.receiptImage){const r=`${d}/uploads/receipts/${a.receiptImage}`;Q(r),M(!0),W("Receipt image loaded successfully")}else F("No receipt image available")};if(o.useEffect(()=>{z()},[]),J)return e.jsx(oe,{color:"primary",size:"sm",children:"Loading..."});const t=a=>{S(r=>[...r,a]),z()};return e.jsx(e.Fragment,{children:e.jsxs(ie,{children:[e.jsx(Ge,{children:"Fuel Management"}),e.jsx(Be,{children:e.jsxs(He,{children:[e.jsx(ie,{className:"mb-3",children:e.jsx(We,{onAddFuelog:t})}),e.jsx(Je,{fuelLogs:_,vehicles:O,drivers:A,loading:J,error:ae,onDeleteFuelLog:f,onUpdateFuelLog:h,onViewReceipt:s})]})}),l&&e.jsx(Xe,{fuelLog:u,visible:l,onClose:()=>{i(!1),$(null)},onUpdate:v,vehicles:O,drivers:A}),e.jsxs(ce,{visible:U,onClose:()=>k(!1),alignment:"center",children:[e.jsx(ue,{closeButton:!0,children:"Confirm Delete"}),e.jsx(me,{children:"Are you sure you want to delete this fuel log? This action cannot be undone."}),e.jsxs(pe,{children:[e.jsx(R,{color:"secondary",variant:"outline",onClick:()=>k(!1),children:"Cancel"}),e.jsx(R,{color:"danger",variant:"outline",onClick:B,children:"Delete"})]})]}),e.jsxs(ce,{visible:P,onClose:()=>{M(!1),Q(null)},size:"lg",alignment:"center",children:[e.jsx(ue,{closeButton:!0,children:"Receipt Image"}),e.jsx(me,{className:"text-center",children:Y&&e.jsx(ge,{src:Y,alt:"Receipt",style:{maxWidth:"100%",maxHeight:"70vh",objectFit:"contain"},onError:a=>{F("Error loading image"),a.target.src="placeholder-image-url.jpg"}})}),e.jsxs(pe,{children:[e.jsx(R,{color:"secondary",variant:"outline",onClick:()=>{M(!1),Q(null)},children:"Close"}),e.jsx("a",{href:Y,target:"_blank",rel:"noopener noreferrer",children:e.jsx(R,{color:"primary",variant:"outline",children:"Open in New Tab"})})]})]})]})})};export{ht as default};
