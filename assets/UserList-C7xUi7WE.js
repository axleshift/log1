import{r as o,_ as oe,R as ne,a as le,c as ie,P as _,j as e,k as X,n as $,m as ce}from"./index-B1VXg6al.js";import{F as G,j as de,k as me,a as ue,l as he}from"./index-CfVRHtsN.js";import{C as pe,a as J}from"./1-CW9aPW_P.js";import{C as fe,a as xe,b as je,c as Ce}from"./CModalHeader-BQ81moGM.js";import{C as ve}from"./CModalTitle-Bt7i42kw.js";import{C as M}from"./CAlert-2xoRTT4O.js";import{C as ge}from"./CForm-B0TAuuWR.js";import{C as N,a as we}from"./CFormInput-CJf-vfrQ.js";import{C as be}from"./CFormSelect-BsBCk_hB.js";import{a as f}from"./CButton-PSsn9c4Q.js";import"./index.esm-DP8SdLSE.js";import{C as F}from"./CContainer-DzS4YxvB.js";import{C as ye}from"./CInputGroup-BSA7BYJv.js";import{C as Se}from"./CInputGroupText-BqWDbdy_.js";import{C as Ne}from"./CCard-Cc_7KkO4.js";import{C as Pe}from"./CCardHeader-dwE_9KZs.js";import{C as Ae}from"./CCardBody-B5AGrX8P.js";import{C as Ee,a as Ue,b as K,c as y,d as Le,e as S}from"./CTable-SFtuaI8P.js";import{C as Fe,a as O}from"./CPaginationItem-DevxR1Q8.js";var q=o.forwardRef(function(a,P){var l,x=a.children,t=a.className,i=a.size,j=a.vertical,m=oe(a,["children","className","size","vertical"]);return ne.createElement("div",le({className:ie(j?"btn-group-vertical":"btn-group",(l={},l["btn-group-".concat(i)]=i,l),t)},m,{ref:P}),x)});q.propTypes={children:_.node,className:_.string,size:_.oneOf(["sm","lg"]),vertical:_.bool};q.displayName="CButtonGroup";const ke=({user:a,visible:P,onClose:l,onUpdate:x})=>{const[t,i]=o.useState({username:"",email:"",password:"",confirmPassword:"",role:"",photo:""}),[j,m]=o.useState(!1),[C,v]=o.useState(null),[g,R]=o.useState(null),[A,c]=o.useState(null),E="http://localhost:5057/";o.useEffect(()=>{if(a)if(i({username:a.username||"",email:a.email||"",password:"",confirmPassword:"",role:a.role||"",photo:null}),a.photo){const d=a.photo.startsWith("http")?a.photo:`${E}uploads/profiles/${a.photo}`;c(d)}else c(null)},[a,E]);const U=async d=>{var u,h;d.preventDefault(),m(!0),v(null);try{if((t.password||t.confirmPassword)&&t.password!==t.confirmPassword)throw new Error("Passwords do not match");if(!a||!a._id){console.error("No user ID available");return}const n=new FormData;n.append("username",t.username),n.append("email",t.email),n.append("role",t.role),t.password&&n.append("password",t.password),t.photo&&n.append("photo",t.photo);const L=await $.put(`api/v1/user/update-user/${a._id}`,n);L.data.success&&(R("User updated successfully"),x(L.data.data),setTimeout(()=>{l()},2e3))}catch(n){console.error("Error updating user:",n),v(((h=(u=n.response)==null?void 0:u.data)==null?void 0:h.message)||n.message||"Failed to update user")}finally{m(!1)}},w=d=>{const{id:u,value:h}=d.target;i(n=>({...n,[u]:h}))},k=d=>{const u=d.target.files[0];if(u){i(n=>({...n,photo:u}));const h=new FileReader;h.onloadend=()=>{c(h.result)},h.readAsDataURL(u)}};return e.jsxs(fe,{visible:P,onClose:l,children:[e.jsx(xe,{children:e.jsxs(ve,{children:["Edit User: ",a==null?void 0:a.username]})}),e.jsxs(je,{children:[C&&e.jsx(M,{color:"danger",children:C}),g&&e.jsx(M,{color:"success",children:g}),e.jsxs(ge,{onSubmit:U,children:[e.jsx(N,{id:"username",value:t.username,onChange:w,className:"mb-3",placeholder:"Enter username",autoComplete:"off",floatingLabel:"Username",required:!0}),e.jsx(N,{type:"email",id:"email",value:t.email,onChange:w,className:"mb-3",placeholder:"Enter email",autoComplete:"off",floatingLabel:"Email",required:!0}),e.jsx(we,{htmlFor:"password",children:"New Password (leave blank to keep current)"}),e.jsx(N,{type:"password",id:"password",value:t.password,onChange:w,className:"mb-3",autoComplete:"off",placeholder:"New Password",floatingLabel:"New Password"}),e.jsx(N,{type:"password",id:"confirmPassword",value:t.confirmPassword,onChange:w,className:"mb-3",autoComplete:"off",placeholder:"Confirm Password",floatingLabel:"Confirm Password"}),e.jsxs(be,{id:"role",label:"Role",value:t.role,onChange:w,className:"mb-3",required:!0,children:[e.jsx("option",{value:"",children:"Select Role"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"manager",children:"Manager"}),e.jsx("option",{value:"inspector",children:"Inspector"}),e.jsx("option",{value:"driver",children:"Driver"})]}),e.jsx(N,{type:"file",id:"photo",label:"Profile Photo",onChange:k,accept:"image/*",className:"mb-3"}),A&&e.jsx("div",{className:"mb-3",children:e.jsx(pe,{src:A||J,alt:"Preview",align:"center",rounded:!0,width:200,height:200,crossOrigin:"anonymous",onError:d=>{d.target.onerror=null,d.target.src=J}})})]})]}),e.jsxs(Ce,{children:[e.jsx(f,{color:"secondary",onClick:l,children:"Cancel"}),e.jsx(f,{color:"primary",onClick:U,disabled:j,children:j?e.jsx(X,{size:"sm"}):"Save Changes"})]})]})},Ye=({onUpdateUser:a})=>{const P=ce(),[l,x]=o.useState([]),[t,i]=o.useState(!0),[j,m]=o.useState([]),[C,v]=o.useState(1),[g,R]=o.useState(""),[A,c]=o.useState(null),[E,U]=o.useState(null),[w,k]=o.useState(!1),[d,u]=o.useState(!1),[h,n]=o.useState(null),[L,Q]=o.useState(null),[T,B]=o.useState("all"),z=10,Y=s=>{switch(T){case"active":return s.filter(r=>r.isActive);case"inactive":return s.filter(r=>!r.isActive);default:return s}},Z=async()=>{i(!0);try{const r=(await $.get("api/v1/user/all-user")).data.data;x(r),m(r)}catch(s){console.error("Error fetching users:",s),c("Error fetching users")}finally{i(!1)}};o.useEffect(()=>{Z()},[]),o.useEffect(()=>{if(g==="")m(l);else{const s=l.filter(r=>{const p=g.toLowerCase(),b=r.isActive?"active":"inactive",D=r.isActive?"deactivate":"activate";return r.username.toLowerCase().includes(p)||r.email.toLowerCase().includes(p)||r.role.toLowerCase().includes(p)||b.includes(p)||D.includes(p)||r.createdAt.toLowerCase().includes(p)});m(s),v(1),s.length===0?c("No matching users found"):c(null)}},[g,l]);const ee=async s=>{var r,p;i(!0);try{const b=await $.post(`api/v1/user/in-active-user/${s}`);if(b.data.success){const D=l.map(I=>I._id===s?{...I,isActive:!I.isActive}:I);x(D),m(D),U(b.data.message)}else c(b.data.message);setTimeout(()=>{U(null),c(null)},3e3)}catch(b){c(((p=(r=b.response)==null?void 0:r.data)==null?void 0:p.message)||"Failed to update user status"),setTimeout(()=>c(null),3e3)}finally{i(!1)}},se=s=>{Q(s),k(!0)},ae=s=>{x(l.map(r=>r._id===s._id?s:r)),m(j.map(r=>r._id===s._id?s:r))};if(t)return e.jsx(X,{className:"m-5 d-flex justify-content-center"});const V=Y(j),W=C*z,te=W-z,re=V.slice(te,W),H=Math.ceil(V.length/z);return e.jsx(e.Fragment,{children:e.jsxs(F,{className:" justify-content-center align-items-center",children:[e.jsx(F,{className:"m-3 d-flex justify-content-center align-items-center",children:e.jsx("h1",{children:"Accounts"})}),e.jsx(F,{className:"m-3 d-flex justify-content-between",children:e.jsx(f,{color:"primary",className:"m-3 ",disabled:t,onClick:()=>P("/dashboard"),children:t?"Loading...":e.jsx(G,{icon:de})})}),e.jsxs(F,{className:"m-3",children:[A&&e.jsx(M,{color:"danger",className:"mb-3",children:A}),E&&e.jsx(M,{color:"success",className:"mb-3",children:E}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs(ye,{className:"w-50",children:[e.jsx(N,{type:"text",value:g,id:"search",onChange:s=>R(s.target.value),placeholder:"Search users..."}),e.jsx(Se,{children:e.jsx(G,{icon:me})})]}),e.jsxs(q,{children:[e.jsx(f,{color:T==="all"?"primary":"secondary",onClick:()=>B("all"),children:"All"}),e.jsx(f,{color:T==="active"?"primary":"secondary",onClick:()=>B("active"),children:"Active"}),e.jsx(f,{color:T==="inactive"?"primary":"secondary",onClick:()=>B("inactive"),children:"Inactive"})]})]}),e.jsx("div",{className:"text-muted small mb-3",children:"Search by: username, email, role, status (active/inactive), or action (activate/deactivate)"}),e.jsxs(Ne,{children:[e.jsx(Pe,{children:e.jsx("h4",{children:"User List"})}),e.jsxs(Ae,{children:[e.jsxs(Ee,{hover:!0,responsive:!0,className:"text-center",children:[e.jsx(Ue,{children:e.jsxs(K,{children:[e.jsx(y,{children:"Username"}),e.jsx(y,{children:"Email"}),e.jsx(y,{children:"Role"}),e.jsx(y,{children:"Created Date"}),e.jsx(y,{children:"Status"}),e.jsx(y,{children:"Date of Login"}),e.jsx(y,{children:"Actions"})]})}),e.jsx(Le,{children:re.filter(s=>s.role!=="admin").map(s=>e.jsxs(K,{children:[e.jsx(S,{children:s.username}),e.jsx(S,{children:s.email}),e.jsx(S,{children:s.role}),e.jsx(S,{children:s.createdAt.slice(0,10)}),e.jsx(S,{children:e.jsx(ue,{color:s.isActive?"success":"danger",children:s.isActive?"Active":"Deactivated"})}),e.jsx(S,{children:s.lastLoginTime||"-"}),e.jsx(S,{children:e.jsxs(F,{className:" d-flex justify-content-center align-items-center",children:[e.jsx(f,{variant:"outline",className:"me-2",color:s.isActive?"danger":"success",onClick:()=>ee(s._id),children:s.isActive?"Deactivate":"Activate"}),e.jsx(f,{variant:"outline",className:"me-2",color:"primary",onClick:()=>se(s),children:e.jsx(G,{icon:he})})]})})]},s._id))})]}),L&&e.jsx(ke,{user:L,visible:w,onClose:()=>{k(!1),Q(null)},onUpdate:ae}),e.jsxs(Fe,{align:"center",children:[e.jsx(O,{disabled:C===1,onClick:()=>v(s=>Math.max(s-1,1)),children:"Previous"}),[...Array(H).keys()].map(s=>e.jsx(O,{active:s+1===C,onClick:()=>v(s+1),children:s+1},s+1)),e.jsx(O,{disabled:C===H,onClick:()=>v(s=>Math.min(s+1,H)),children:"Next"})]})]})]})]})]})})};export{Ye as default};
