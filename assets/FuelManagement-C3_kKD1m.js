import{r as n,j as e,C as H,x as O,P as U}from"./index-BBIMnnMV.js";import{F as W,i as ne,o as de,h as ce,j as ue}from"./index-C-_fnxyY.js";import{a as I}from"./CButton-DcUeYwRB.js";import{C as J,a as X,b as me,c as Y,d as Z}from"./CModalTitle-DtgNHbJH.js";import{a as G,C as ie}from"./CForm-4wTq2PMF.js";import{C as w}from"./CInputGroup-C4DggF7x.js";import{C as K}from"./CFormSelect-I3s7gtf6.js";import{C as x,a as y}from"./CFormInput-B0DmtdlT.js";import{C as ee}from"./1-Dx7AxVLE.js";import{C as pe}from"./CFormTextarea-Co0_EiIF.js";import{C as he,a as fe,b as re,c as $,d as xe,e as A}from"./CTable-tl39q5To.js";import{b as je,c as ge,d as ve,C as Ce}from"./DefaultLayout-BS5x7Mkr.js";import{C as ae}from"./CContainer-CQHYg2o8.js";import{C as be}from"./CCard-C2b0pFH9.js";import{C as ye}from"./CCardBody-BO_AM7tW.js";import"./CCloseButton-DZx3Wsna.js";import"./index.esm-BvO_OHLg.js";import"./cil-user-Ddrdy7PS.js";const Ne=({onAddFuelog:p})=>{var l,o;const[S,F]=n.useState(!1),[_,L]=n.useState(null),[T,M]=n.useState(!1),[z,D]=n.useState(!1),[E,C]=n.useState(!1),[f,g]=n.useState(null),[q,P]=n.useState([]),[v,V]=n.useState([]),Q={vehicleId:"",driverId:"",receiptNumber:"",fuelQuantity:"",fuelType:"",costPerLiter:"",totalCost:"",odometerReading:"",receiptImage:null,route:{start:"",end:"",distance:""},notes:"",litersPer100km:"",kmPerLiter:"",mpg:""},[s,d]=n.useState(Q);n.useEffect(()=>{(async()=>{try{F(!0);const[u,a]=await Promise.all([O.get("/api/v1/driver"),O.get("/api/v1/vehicle/in-use")]);P(u.data.data),V(a.data.data)}catch(u){console.error("Error fetching initial data:",u),L(u.message)}finally{F(!1)}})()},[]);const i=r=>{const{id:u,value:a}=r.target;if(u.includes("route.")){const h=u.split(".")[1];d(b=>{const j={...b,route:{...b.route,[h]:a}};if(j.route.distance&&j.fuelQuantity){const R=parseFloat(j.route.distance),m=parseFloat(j.fuelQuantity);if(R>0&&m>0){const N=m/R*100;j.litersPer100km=N.toFixed(2);const k=R/m;j.kmPerLiter=k.toFixed(2);const B=m*.264172,se=R*.621371/B;j.mpg=se.toFixed(2)}}return j})}else if(u==="vehicleId"){const h=v.find(j=>j._id===a),b=q.find(j=>j._id===(h==null?void 0:h.assignedDriver));d(j=>({...j,vehicleId:a,driverId:(h==null?void 0:h.assignedDriver)||"",fuelType:(h==null?void 0:h.fuelType)||"",driverName:(b==null?void 0:b.name)||""}))}else d(u==="fuelQuantity"||u==="costPerLiter"?h=>{const b={...h,[u]:a},j=parseFloat(u==="fuelQuantity"?a:h.fuelQuantity),R=parseFloat(u==="costPerLiter"?a:h.costPerLiter);if(!isNaN(j)&&!isNaN(R)&&(b.totalCost=(j*R).toFixed(2)),u==="fuelQuantity"&&b.route.distance){const m=parseFloat(b.route.distance),N=parseFloat(a);if(m>0&&N>0){const k=N/m*100;b.litersPer100km=k.toFixed(2);const B=m/N;b.kmPerLiter=B.toFixed(2);const te=N*.264172,oe=m*.621371/te;b.mpg=oe.toFixed(2)}}return b}:h=>({...h,[u]:a}))},c=r=>{const u=r.target.files[0];if(u){d(h=>({...h,receiptImage:u}));const a=new FileReader;a.onloadend=()=>{g(a.result)},a.readAsDataURL(u)}},t=async r=>{if(r.preventDefault(),r.stopPropagation(),r.currentTarget.checkValidity()===!1){C(!0);return}F(!0);try{const a=new FormData;a.append("vehicleId",s.vehicleId),a.append("driverId",s.driverId),a.append("receiptNumber",s.receiptNumber),a.append("fuelQuantity",s.fuelQuantity),a.append("fuelType",s.fuelType),a.append("costPerLiter",s.costPerLiter),a.append("totalCost",s.totalCost),a.append("odometerReading",s.odometerReading),a.append("notes",s.notes),a.append("litersPer100km",s.litersPer100km),a.append("kmPerLiter",s.kmPerLiter),a.append("mpg",s.mpg),a.append("route[start]",s.route.start),a.append("route[end]",s.route.end),a.append("route[distance]",s.route.distance),s.receiptImage&&a.append("receiptImage",s.receiptImage);const h=await O.post("/api/v1/fuelLogs/fuel-logs",a);h.data.success&&(p(h.data.data),M(h.data.message),setTimeout(()=>{M(!1),d(Q),g(null),D(!1)},2e3))}catch(a){L(a.response.data.message),setTimeout(()=>{L(null)},5e3)}finally{F(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs(I,{color:"primary",variant:"outline",disabled:S,onClick:()=>D(!0),children:[S?e.jsx(H,{color:"primary",size:"sm"}):e.jsx(W,{icon:ne}),"Add Fuel Log"]}),e.jsxs(J,{visible:z,onClose:()=>D(!1),size:"lg",children:[e.jsx(X,{children:e.jsx(me,{children:"Add Fuel Log"})}),_&&e.jsx(G,{color:"danger",className:"m-3",children:_}),T&&e.jsx(G,{color:"success",className:"m-3",children:T}),e.jsx(Y,{children:e.jsxs(ie,{noValidate:!0,validated:E,children:[e.jsxs(w,{children:[e.jsxs(K,{className:"mb-3",floatingLabel:"Vehicle",label:"Vehicle",id:"vehicleId",value:s.vehicleId,onChange:i,required:!0,children:[e.jsx("option",{value:"",children:"Select Vehicle"}),v==null?void 0:v.map(r=>e.jsx("option",{value:r._id,children:`${r.brand} / ${r.model} / ${r.regisNumber}`},r._id))]}),e.jsx(x,{className:"mb-3",floatingLabel:"Driver",label:"Driver",id:"driverId",value:((l=q.find(r=>r._id===s.driverId))==null?void 0:l.driverName)||"",onChange:i,disabled:!0}),e.jsxs(K,{className:"mb-3",floatingLabel:"Fuel Type",label:"Fuel Type",id:"fuelType",required:!0,value:((o=v.find(r=>r._id===s.vehicleId))==null?void 0:o.fuelType)||"",onChange:i,disabled:!0,children:[e.jsx("option",{value:"",children:"Select Fuel Type"}),e.jsx("option",{value:"Gasoline",children:"Gasoline"}),e.jsx("option",{value:"Diesel",children:"Diesel"})]})]}),e.jsxs(w,{children:[e.jsx(x,{className:"mb-3",type:"text",floatingLabel:"Official Reciept",placeholder:"Official Reciept",id:"receiptNumber",value:s.receiptNumber,onChange:i,required:!0,autoComplete:"off"}),e.jsx(x,{className:"mb-3",type:"number",floatingLabel:"Fuel Quantity",placeholder:"Fuel Quantity",id:"fuelQuantity",value:s.fuelQuantity,onChange:i,required:!0,autoComplete:"off",min:"0",step:"0.01",feedbackInvalid:"Please enter a valid fuel quantity"}),e.jsx(x,{className:"mb-3",type:"number",floatingLabel:"Cost Per Liter",placeholder:"Cost Per Liter",id:"costPerLiter",value:s.costPerLiter,onChange:i,autoComplete:"off",feedbackInvalid:"Please enter a valid cost per liter"}),e.jsx(x,{className:"mb-3",type:"number",floatingLabel:"Total Cost",placeholder:"Total Cost",id:"totalCost",value:s.totalCost,onChange:i,autoComplete:"off",min:"0",step:"0.01",disabled:!0,feedbackInvalid:"Please enter a valid total cost"})]}),e.jsxs(w,{children:[e.jsx(x,{className:"mb-3",type:"number",floatingLabel:"Odometer Reading",placeholder:"Odometer Reading",id:"odometerReading",value:s.odometerReading,onChange:i,autoComplete:"off",feedbackInvalid:"Please enter a valid odometer reading"}),e.jsx(x,{className:"mb-3",type:"text",floatingLabel:"Start Location",placeholder:"Start Location",id:"route.start",value:s.route.start,onChange:i,autoComplete:"off",feedbackInvalid:"Please enter a valid start location"}),e.jsx(x,{className:"mb-3",type:"text",floatingLabel:"End Location",placeholder:"End Location",id:"route.end",value:s.route.end,onChange:i,autoComplete:"off",feedbackInvalid:"Please enter a valid end location"}),e.jsx(x,{className:"mb-3",type:"number",floatingLabel:"Distance/kilometers",placeholder:"Distance",id:"route.distance",value:s.route.distance,onChange:i,autoComplete:"off",feedbackInvalid:"Please enter a valid distance"})]}),e.jsxs(w,{className:"mb-3",children:[e.jsx(x,{type:"text",floatingLabel:"L/100km",placeholder:"Liters per 100km",id:"litersPer100km",value:s.litersPer100km,disabled:!0}),e.jsx(x,{type:"text",floatingLabel:"km/L",placeholder:"Kilometers per Liter",id:"kmPerLiter",value:s.kmPerLiter,disabled:!0}),e.jsx(x,{type:"text",floatingLabel:"MPG",placeholder:"Miles per Gallon",id:"mpg",value:s.mpg,disabled:!0})]}),e.jsx(y,{htmlFor:"receipt",children:"Picture Of Receipts"}),e.jsx(w,{className:"mb-3",children:e.jsx(x,{type:"file",id:"receipt",accept:"images/*",onChange:c})}),f&&e.jsx("div",{className:"mb-3",children:e.jsx(ee,{src:f,rounded:!0,align:"center",alt:"Receipts",width:200,height:200})}),e.jsx(pe,{className:"mb-3",type:"text",floatingLabel:"Notes",placeholder:"Notes",rows:3,id:"notes",value:s.notes,autoCapitalize:"on",autoComplete:"off",onChange:i,feedbackInvalid:"Please enter a valid notes"})]})}),e.jsxs(Z,{children:[e.jsx(I,{color:"secondary",onClick:()=>D(!1),children:"Close"}),e.jsx(I,{color:"primary",onClick:t,disabled:S,children:S?e.jsx(H,{color:"primary",size:"sm"}):"Add"})]})]})]})},le=({fuelLogs:p,vehicles:S,drivers:F,loading:_,error:L,onDeleteFuelLog:T,onUpdateFuelLog:M,onViewReceipt:z})=>{const[D,E]=n.useState(""),[C,f]=n.useState("date"),[g,q]=n.useState("desc"),[P,v]=n.useState(""),[V,Q]=n.useState(null),s=t=>{if(typeof t=="object"&&t.brand&&t.model&&t.regisNumber)return`${t.brand} ${t.model} (${t.regisNumber})`;const l=S.find(o=>o._id===t);return l?`${l.brand} ${l.model} (${l.regisNumber})`:"N/A"},d=t=>{if(typeof t=="object"&&t.driverName)return t.driverName;const l=F.find(o=>o._id===t);return(l==null?void 0:l.driverName)||"N/A"},i=t=>{C===t?q(g==="asc"?"desc":"asc"):(f(t),q("asc"))},c=p.filter(t=>{const l=s(t.vehicleId).toLowerCase(),o=d(t.driverId).toLowerCase(),r=D.toLowerCase(),u=t.receiptNumber.toLowerCase().includes(r)||l.includes(r)||o.includes(r),a=P?(typeof t.vehicleId=="object"?t.vehicleId._id:t.vehicleId)===P:!0;return u&&a}).sort((t,l)=>{let o,r;return C==="vehicle"?(o=s(t.vehicleId),r=s(l.vehicleId)):C==="driver"?(o=d(t.driverId),r=d(l.driverId)):(o=t[C],r=l[C]),g==="asc"?o>r?1:-1:o<r?1:-1});return n.useEffect(()=>{c.length===0?Q("No data found"):Q(null)},[c]),p.length===0?e.jsx(G,{color:"info",className:"text-center",children:"No fuel logs found."}):_?e.jsx(H,{size:"sm"}):L?e.jsxs("div",{className:"text-danger",children:["Error: ",L]}):e.jsxs(e.Fragment,{children:[e.jsxs(w,{className:"mb-3",children:[e.jsx(x,{placeholder:"Search by receipt #, vehicle, or driver...",value:D,onChange:t=>E(t.target.value),id:"search"}),e.jsxs(K,{id:"allVehicles",value:P,onChange:t=>v(t.target.value),children:[e.jsx("option",{value:"",children:"All Vehicles"}),S.map(t=>e.jsx("option",{value:t._id,children:`${t.brand} / ${t.model} / ${t.regisNumber}`},t._id))]})]}),e.jsxs(he,{hover:!0,responsive:!0,className:"text-center",children:[e.jsx(fe,{children:e.jsxs(re,{children:[e.jsxs($,{onClick:()=>i("date"),style:{cursor:"pointer"},children:["Date ",C==="date"&&(g==="asc"?"↑":"↓")]}),e.jsxs($,{onClick:()=>i("receiptNumber"),style:{cursor:"pointer"},children:["Receipt # ",C==="receiptNumber"&&(g==="asc"?"↑":"↓")]}),e.jsxs($,{onClick:()=>i("vehicle"),style:{cursor:"pointer"},children:["Vehicle ",C==="vehicle"&&(g==="asc"?"↑":"↓")]}),e.jsxs($,{onClick:()=>i("driver"),style:{cursor:"pointer"},children:["Driver ",C==="driver"&&(g==="asc"?"↑":"↓")]}),e.jsxs($,{onClick:()=>i("fuelQuantity"),style:{cursor:"pointer"},children:["Quantity (L) ",C==="fuelQuantity"&&(g==="asc"?"↑":"↓")]}),e.jsxs($,{onClick:()=>i("costPerLiter"),style:{cursor:"pointer"},children:["Cost/L ",C==="costPerLiter"&&(g==="asc"?"↑":"↓")]}),e.jsxs($,{onClick:()=>i("totalCost"),style:{cursor:"pointer"},children:["Total Cost ",C==="totalCost"&&(g==="asc"?"↑":"↓")]}),e.jsx($,{children:"Fuel Efficiency"}),e.jsx($,{children:"Actions"})]})}),e.jsx(xe,{children:c.map(t=>e.jsxs(re,{children:[e.jsx(A,{children:new Date(t.date).toLocaleDateString()}),e.jsx(A,{children:t.receiptNumber}),e.jsx(A,{children:s(t.vehicleId)}),e.jsx(A,{children:d(t.driverId)}),e.jsx(A,{children:t.fuelQuantity}),e.jsx(A,{children:t.costPerLiter}),e.jsx(A,{children:t.totalCost}),e.jsxs(A,{children:[e.jsxs("div",{children:[t.litersPer100km," L/100km"]}),e.jsxs("div",{children:[t.kmPerLiter," km/L"]}),e.jsxs("div",{children:[t.mpg," MPG"]})]}),e.jsx(A,{children:e.jsxs(je,{variant:"input-group",className:"align-items-center",children:[e.jsx(ge,{color:"secondary",variant:"outline",children:"Actions"}),e.jsxs(ve,{children:[e.jsxs(I,{color:"primary",variant:"ghost",className:"me-2",onClick:()=>z(t),children:[e.jsx(W,{icon:de})," View Receipt"]}),e.jsxs(I,{color:"info",variant:"ghost",className:"me-2",onClick:()=>M(t),children:[e.jsx(W,{icon:ce})," Edit"]}),e.jsxs(I,{color:"danger",variant:"ghost",onClick:()=>T(t._id),children:[e.jsx(W,{icon:ue})," Delete"]})]})]})})]},t._id))})]}),L&&e.jsx(G,{color:"danger",className:"text-center",children:L}),V&&e.jsx(G,{color:"info",className:"text-center",children:V})]})};le.propTypes={fuelLogs:U.array.isRequired,vehicles:U.array.isRequired,drivers:U.array.isRequired,loading:U.bool.isRequired,error:U.string,onDeleteFuelLog:U.func.isRequired,onUpdateFuelLog:U.func.isRequired,onViewReceipt:U.func.isRequired};const Fe=({fuelLog:p,visible:S,onClose:F,onUpdate:_,vehicles:L,drivers:T})=>{const M="http://localhost:5057",[z,D]=n.useState(!1),[E,C]=n.useState(null),[f,g]=n.useState({date:"",receiptNumber:"",vehicleId:"",driverId:"",fuelQuantity:"",costPerLiter:"",totalCost:"",odometerReading:"",route:{start:"",end:"",distance:""},litersPer100km:"",kmPerLiter:"",mpg:"",notes:"",receiptImage:null}),[q,P]=n.useState(!1);n.useEffect(()=>{p&&(g({date:new Date(p.date).toISOString().split("T")[0],receiptNumber:p.receiptNumber,vehicleId:p.vehicleId._id||p.vehicleId,driverId:p.driverId._id||p.driverId,fuelQuantity:p.fuelQuantity,costPerLiter:p.costPerLiter,totalCost:p.totalCost,odometerReading:p.odometerReading,route:{start:p.route.start,end:p.route.end,distance:p.route.distance},litersPer100km:p.litersPer100km,kmPerLiter:p.kmPerLiter,mpg:p.mpg,notes:p.notes||""}),p.receiptImage&&C(`${M}/uploads/receipts/${p.receiptImage}`))},[p]);const v=s=>{const{id:d,value:i}=s.target;if(d.includes("route.")){const c=d.split(".")[1];g(t=>{const l={...t,route:{...t.route,[c]:i}};if(l.route.distance&&l.fuelQuantity){const o=parseFloat(l.route.distance),r=parseFloat(l.fuelQuantity);if(o>0&&r>0){const u=r/o*100;l.litersPer100km=u.toFixed(2);const a=o/r;l.kmPerLiter=a.toFixed(2);const h=r*.264172,j=o*.621371/h;l.mpg=j.toFixed(2)}}return l})}else if(d==="vehicleId"){const c=vehicleOptions.find(l=>l._id===i),t=T.find(l=>l._id===(c==null?void 0:c.assignedDriver));g(l=>({...l,vehicleId:i,driverId:(c==null?void 0:c.assignedDriver)||"",fuelType:(c==null?void 0:c.fuelType)||"",driverName:(t==null?void 0:t.name)||""}))}else g(d==="fuelQuantity"||d==="costPerLiter"?c=>{const t={...c,[d]:i},l=parseFloat(d==="fuelQuantity"?i:c.fuelQuantity),o=parseFloat(d==="costPerLiter"?i:c.costPerLiter);if(!isNaN(l)&&!isNaN(o)&&(t.totalCost=(l*o).toFixed(2)),d==="fuelQuantity"&&t.route.distance){const r=parseFloat(t.route.distance),u=parseFloat(i);if(r>0&&u>0){const a=u/r*100;t.litersPer100km=a.toFixed(2);const h=r/u;t.kmPerLiter=h.toFixed(2);const b=u*.264172,R=r*.621371/b;t.mpg=R.toFixed(2)}}return t}:c=>({...c,[d]:i}))},V=s=>{const d=s.target.files[0];if(d){g(c=>({...c,receiptImage:d}));const i=new FileReader;i.onloadend=()=>{C(i.result)},i.readAsDataURL(d)}},Q=async s=>{var i,c;if(s.preventDefault(),!s.currentTarget.checkValidity()){s.stopPropagation(),P(!0);return}D(!0);try{const t=new FormData;Object.keys(f).forEach(o=>{o==="route"?Object.keys(f.route).forEach(r=>{t.append(`route[${r}]`,f.route[r])}):(o==="receiptImage"&&f[o],t.append(o,f[o]))});const l=await O.put(`/api/v1/fuelLogs/fuel-logs/${p._id}`,t);l.data.success&&(_(l.data.data),F())}catch(t){toast.error(((c=(i=t.response)==null?void 0:i.data)==null?void 0:c.message)||"Error updating fuel log")}finally{D(!1)}};return e.jsxs(J,{visible:S,onClose:F,size:"lg",backdrop:"static",children:[e.jsx(X,{closeButton:!0,children:"Update Fuel Log"}),e.jsx(Y,{children:e.jsxs(ie,{className:"row g-3 needs-validation",noValidate:!0,validated:q,onSubmit:Q,children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx(y,{htmlFor:"date",children:"Date"}),e.jsx(x,{type:"date",id:"date",value:f.date,onChange:v,required:!0})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx(y,{htmlFor:"receiptNumber",children:"Receipt Number"}),e.jsx(x,{type:"text",id:"receiptNumber",value:f.receiptNumber,onChange:v,required:!0})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx(y,{htmlFor:"vehicleId",children:"Vehicle"}),e.jsxs(K,{id:"vehicleId",value:f.vehicleId,onChange:v,required:!0,children:[e.jsx("option",{value:"",children:"Select Vehicle"}),L.map(s=>e.jsx("option",{value:s._id,children:`${s.brand} ${s.model} (${s.regisNumber})`},s._id))]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx(y,{htmlFor:"driverId",children:"Driver"}),e.jsxs(K,{id:"driverId",value:f.driverId,onChange:v,required:!0,children:[e.jsx("option",{value:"",children:"Select Driver"}),T.map(s=>e.jsx("option",{value:s._id,children:s.driverName},s._id))]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx(y,{htmlFor:"fuelQuantity",children:"Fuel Quantity (L)"}),e.jsx(x,{type:"number",id:"fuelQuantity",value:f.fuelQuantity,onChange:v,required:!0,min:"0",step:"0.01"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx(y,{htmlFor:"costPerLiter",children:"Cost per Liter"}),e.jsx(x,{type:"number",id:"costPerLiter",value:f.costPerLiter,onChange:v,required:!0,min:"0",step:"0.01"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx(y,{htmlFor:"totalCost",children:"Total Cost"}),e.jsx(w,{children:e.jsx(x,{type:"number",id:"totalCost",value:f.totalCost,disabled:!0})})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx(y,{htmlFor:"odometerReading",children:"Odometer Reading"}),e.jsx(w,{children:e.jsx(x,{type:"number",id:"odometerReading",value:f.odometerReading})})]}),e.jsxs("div",{className:"col-md-12",children:[e.jsx(y,{htmlFor:"route.start",children:"Route Information"}),e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsx(y,{htmlFor:"route.start",children:"Start Location"}),e.jsx(x,{type:"text",id:"route.start",placeholder:"Start Location",value:f.route.start,onChange:v,required:!0})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx(y,{htmlFor:"route.end",children:"End Location"}),e.jsx(x,{type:"text",id:"route.end",placeholder:"End Location",value:f.route.end,onChange:v,required:!0})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx(y,{htmlFor:"route.distance",children:"Distance (km)"}),e.jsx(x,{type:"number",id:"route.distance",placeholder:"Distance (km)",value:f.route.distance,onChange:v,required:!0,min:"0",step:"0.1"})]})]})]}),e.jsx("div",{className:"col-md-12",children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsx(y,{htmlFor:"litersPer100km",children:"Liters per 100 km"}),e.jsx(w,{children:e.jsx(x,{type:"number",id:"litersPer100km",value:f.litersPer100km,disabled:!0})})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx(y,{htmlFor:"kmPerLiter",children:"Km per Liter"}),e.jsx(w,{children:e.jsx(x,{type:"number",id:"kmPerLiter",value:f.kmPerLiter,disabled:!0})})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx(y,{htmlFor:"mpg",children:"MPG"}),e.jsx(w,{children:e.jsx(x,{type:"number",id:"mpg",value:f.mpg,disabled:!0})})]})]})}),e.jsxs("div",{className:"col-md-12",children:[e.jsx(y,{htmlFor:"receiptImage",children:"Receipt Image"}),e.jsx(x,{type:"file",id:"receiptImage",onChange:V,accept:"image/*"})]}),E&&e.jsx("div",{className:"col-md-12 text-center",children:e.jsx(ee,{id:"receipt-preview",name:"receipt-preview",src:E,alt:"Receipt Preview",rounded:!0,align:"center",width:200,height:200})}),e.jsxs("div",{className:"col-md-12",children:[e.jsx(y,{htmlFor:"notes",children:"Notes"}),e.jsx(x,{type:"text",id:"notes",value:f.notes,onChange:v})]})]})}),e.jsxs(Z,{children:[e.jsx(I,{color:"secondary",onClick:F,children:"Cancel"}),e.jsx(I,{color:"primary",onClick:Q,disabled:z,children:z?e.jsx(H,{size:"sm"}):"Update"})]})]})},Oe=()=>{const p="http://localhost:5057",[S,F]=n.useState([]),[_,L]=n.useState([]),[T,M]=n.useState([]),[z,D]=n.useState(null),[E,C]=n.useState(!1),[f,g]=n.useState(null),[q,P]=n.useState(!1),[v,V]=n.useState(null),[Q,s]=n.useState(!1),[d,i]=n.useState(null),[c,t]=n.useState(!1),[l,o]=n.useState(null),r=async()=>{C(!0);try{const[m,N,k]=await Promise.all([O.get("/api/v1/fuelLogs/fuel-logs"),O.get("/api/v1/vehicle/in-use"),O.get("/api/v1/driver")]);F(m.data.data),L(N.data.data),M(k.data.data)}catch(m){g(m.message)}finally{C(!1)}},u=m=>{V(m),P(!0)},a=async()=>{var m,N;try{await O.delete(`/api/v1/fuelLogs/fuel-logs/${v}`),F(k=>k.filter(B=>B._id!==v)),P(!1)}catch(k){toast.error(((N=(m=k.response)==null?void 0:m.data)==null?void 0:N.message)||"Error deleting fuel log")}},h=m=>{o(m),t(!0)},b=m=>{F(N=>N.map(k=>k._id===m._id?m:k)),t(!1),o(null)},j=m=>{if(m.receiptImage){const N=`${p}/uploads/receipts/${m.receiptImage}`;i(N),s(!0)}else toast.info("No receipt image available")};if(n.useEffect(()=>{r()},[]),E)return e.jsx(H,{color:"primary",size:"sm",children:"Loading..."});const R=m=>{F(N=>[...N,m])};return e.jsx(e.Fragment,{children:e.jsxs(ae,{children:[e.jsx(Ce,{children:"Fuel Management"}),e.jsx(be,{children:e.jsxs(ye,{children:[e.jsx(ae,{className:"mb-3",children:e.jsx(Ne,{onAddFuelog:R})}),e.jsx(le,{fuelLogs:S,vehicles:_,drivers:T,loading:E,error:f,onDeleteFuelLog:u,onUpdateFuelLog:h,onViewReceipt:j})]})}),c&&e.jsx(Fe,{fuelLog:l,visible:c,onClose:()=>{t(!1),o(null)},onUpdate:b,vehicles:_,drivers:T}),e.jsxs(J,{visible:q,onClose:()=>P(!1),alignment:"center",children:[e.jsx(X,{closeButton:!0,children:"Confirm Delete"}),e.jsx(Y,{children:"Are you sure you want to delete this fuel log? This action cannot be undone."}),e.jsxs(Z,{children:[e.jsx(I,{color:"secondary",onClick:()=>P(!1),children:"Cancel"}),e.jsx(I,{color:"danger",onClick:a,children:"Delete"})]})]}),e.jsxs(J,{visible:Q,onClose:()=>{s(!1),i(null)},size:"lg",alignment:"center",children:[e.jsx(X,{closeButton:!0,children:"Receipt Image"}),e.jsx(Y,{className:"text-center",children:d&&e.jsx(ee,{src:d,alt:"Receipt",style:{maxWidth:"100%",maxHeight:"70vh",objectFit:"contain"},onError:m=>{toast.error("Error loading image"),m.target.src="placeholder-image-url.jpg"}})}),e.jsxs(Z,{children:[e.jsx(I,{color:"secondary",onClick:()=>{s(!1),i(null)},children:"Close"}),e.jsx(I,{color:"primary",onClick:()=>window.open(d,"_blank"),children:"Open in New Tab"})]})]})]})})};export{Oe as default};
