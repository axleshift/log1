import{w as I,r as c,j as e,C as S}from"./index-nNgQDi3y.js";import{F as w,d as U,e as _,g as $,h as G,i as H}from"./index-DA9UjPMh.js";import{C as V}from"./CButton-B31Ato4o.js";import{C as q,a as P,b as R,c as Y,d as E}from"./CModalTitle-DC27g7Q8.js";import{C as k}from"./CAlert-Da4UQtJl.js";import{C as z}from"./CForm-C8WwGFvM.js";import{C as m}from"./CFormInput-C49UErcb.js";import{C as F}from"./CFormSelect-CJsiCtlq.js";import{C as D}from"./CContainer-XXKGP3D5.js";import{C as Q,a as J}from"./CInputGroupText-I3x9P6oS.js";import{C as O,a as K,b as W,c as X}from"./CAccordionHeader-N1vMBNDk.js";import{C as f}from"./DefaultLayout-C_MU3311.js";import{C as Z}from"./CCard-C11t10-G.js";import{C as ee}from"./CCardBody-D9zCfA2H.js";import"./CLink-B-ouRo4I.js";import"./CCloseButton-U_0zd53e.js";import"./index.esm-BuKqvEan.js";import"./cil-user-Ddrdy7PS.js";const ae=({onAddVehicle:n})=>{const b=sessionStorage.getItem("accessToken"),N=I.create({baseURL:"http://localhost:5057",withCredentials:!0,headers:{"Content-Type":"application/json",...b&&{Authorization:`Bearer ${b}`}}}),[v,p]=c.useState(!1),[u,y]=c.useState(!1),[h,g]=c.useState(null),[i,l]=c.useState(null),[d,T]=c.useState(!1),x={idNum:Math.floor(Math.random()*1e6).toString(),brand:"",model:"",year:"",regisNumber:"",type:"",capacity:"",fuelType:"",currentMileage:"",status:"available"},[a,t]=c.useState(x),r=[{label:"Van",value:"van"},{label:"Pickup Truck",value:"pickup"},{label:"Box Truck",value:"box"},{label:"Straight Truck",value:"straight"},{label:"Semi-Trailer Trucks",value:"semi"},{label:"Refrigerated Trucks",value:"refrigerated"},{label:"Tanker Trucks",value:"tanker"},{label:"Flatbed Trucks",value:"flatbed"}],L=[{label:"Diesel",value:"diesel"},{label:"Gasoline",value:"gasoline"}],A=async o=>{o.currentTarget.checkValidity()===!1&&(o.preDefault(),o.stopPropagation()),p(!0),T(!0);try{const C=await N.post("/api/v1/vehicle",a);C.data.success&&(l("Vehicle added successfully"),n(C.data.data),setTimeout(()=>{l(null),t(x),T(!1),p(!1)},2e3))}catch(C){g(C.response.data.message),setTimeout(()=>{g(null)},2e3)}T(!1)};return e.jsx(e.Fragment,{children:d?e.jsx(S,{color:"primary",size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsxs(V,{color:"primary",variant:"outline",onClick:()=>y(!0),children:[e.jsx(w,{icon:U})," Add Vehicle"]}),e.jsxs(q,{visible:u,onClose:()=>y(!1),children:[e.jsx(P,{closeButton:!0,children:e.jsx(R,{children:"Add Vehicle"})}),h&&e.jsx(k,{color:"danger",className:"m-3",children:h}),i&&e.jsx(k,{color:"success",className:"m-3",children:i}),e.jsx(Y,{children:e.jsxs(z,{noValidate:!0,validated:v,children:[e.jsx(m,{className:"mb-3",floatingLabel:"ID Number",placeholder:"ID Number",type:"text",id:"idNum",label:"ID Number",value:a.idNum,disabled:!0}),e.jsx(m,{className:"mb-3",floatingLabel:"Brand",placeholder:"Brand",type:"text",id:"brand",label:"Brand",autoComplete:"off",required:!0,value:a.brand,onChange:o=>t({...a,brand:o.target.value})}),e.jsx(m,{className:"mb-3",floatingLabel:"Model",placeholder:"Model",type:"text",id:"model",label:"Model",autoComplete:"off",required:!0,value:a.model,onChange:o=>t({...a,model:o.target.value})}),e.jsx(m,{type:"number",className:"mb-3",floatingLabel:"Year",placeholder:"Year",id:"year",autoComplete:"off",value:a.year,required:!0,min:"1990",max:new Date().getFullYear(),onChange:o=>{const s=o.target.value;t({...a,year:s})},onBlur:o=>{const s=parseInt(o.target.value);(s<1990||s>new Date().getFullYear()||isNaN(s))&&(alert("Please enter a year between 1990 and "+new Date().getFullYear()),t({...a,year:1990}))}}),e.jsx(m,{className:"mb-3",floatingLabel:"Registration Number",placeholder:"Registration Number",type:"text",id:"regisNumber",label:"Registration Number",autoComplete:"off",required:!0,value:a.regisNumber,onChange:o=>t({...a,regisNumber:o.target.value})}),e.jsx(F,{className:"mb-3",floatingLabel:"Vehicle Type",placeholder:"Vehicle Type",id:"type",value:a.type,required:!0,onChange:o=>t({...a,type:o.target.value}),options:[{label:"Select Vehicle Type",value:""},...r]}),e.jsx(m,{className:"mb-2",type:"number",floatingLabel:"Capacity",placeholder:"Capacity",id:"capacity",label:"Capacity",autoComplete:"off",required:!0,min:"0",value:a.capacity,onChange:o=>t({...a,capacity:o.target.value})}),e.jsx(F,{className:"mb-3",floatingLabel:"Fuel Type",placeholder:"Fuel Type",id:"fuelType",value:a.fuelType,required:!0,onChange:o=>t({...a,fuelType:o.target.value}),options:[{label:"Select Fuel Type",value:""},...L]}),e.jsx(m,{className:"mb-3",floatingLabel:"Current Mileage",placeholder:"Current Mileage",type:"number",id:"mileage",label:"Current Mileage",autoComplete:"off",required:!0,value:a.currentMileage,min:"0",onChange:o=>t({...a,currentMileage:o.target.value})})]})}),e.jsxs(E,{children:[e.jsx(V,{color:"secondary",variant:"outline",disabled:d,onClick:()=>{y(!1),t(x),p(!1),g(null)},children:d?e.jsx(S,{color:"secondary",size:"sm"}):"Cancel"}),e.jsx(V,{color:"primary",variant:"outline",disabled:d,onClick:A,children:d?e.jsx(S,{color:"primary",size:"sm"}):"Save"})]})]})]})})},te=({vehicle:n,onDeleteVehicle:b})=>{const j=sessionStorage.getItem("accessToken"),v=I.create({baseURL:"http://localhost:5057",withCredentials:!0,headers:{"Content-Type":"application/json",...j&&{Authorization:`Bearer ${j}`}}}),[p,u]=c.useState(!1),[y,h]=c.useState(null),g=async()=>{u(!0);try{(await v.delete(`/api/v1/vehicle/${n._id}`)).status===200&&(alert("Vehicle deleted successfully"),u(!1),b(n._id),u(!1),h(null))}catch(i){h(i)}finally{u(!1)}};return e.jsx(e.Fragment,{children:e.jsx(V,{color:"danger",variant:"outline",disabled:p,onClick:g,children:p?e.jsx(S,{size:"sm"}):e.jsx(w,{icon:_})})})},le=({vehicle:n,onUpdateVehicle:b})=>{const j=sessionStorage.getItem("accessToken"),v=I.create({baseURL:"http://localhost:5057",withCredentials:!0,headers:{"Content-Type":"application/json",...j&&{Authorization:`Bearer ${j}`}}}),[p,u]=c.useState(!1),[y,h]=c.useState(null),[g,i]=c.useState(null),[l,d]=c.useState(!1),[T,x]=c.useState(!1),a={idNum:n.idNum,brand:n.brand,model:n.model,year:n.year,regisNumber:n.regisNumber,type:n.type,capacity:n.capacity,fuelType:n.fuelType,currentMileage:n.currentMileage},[t,r]=c.useState(a),L=[{label:"Van",value:"van"},{label:"Pickup Truck",value:"pickup"},{label:"Box Truck",value:"box"},{label:"Straight Truck",value:"straight"},{label:"Semi-Trailer Trucks",value:"semi"},{label:"Refrigerated Trucks",value:"refrigerated"},{label:"Tanker Trucks",value:"tanker"},{label:"Flatbed Trucks",value:"flatbed"}],A=[{label:"Diesel",value:"diesel"},{label:"Gasoline",value:"gasoline"}],o=async s=>{d(!0),s.currentTarget.checkValidity()===!1&&s.stopPropagation(),x(!0);try{const M=await v.put(`/api/v1/vehicle/${n._id}`,t);M.data.success&&(h("Vehicle updated successfully"),b(M.data.data),setTimeout(()=>{r(a),h(null),d(!1),x(!1),u(!1)},2e3))}catch(M){i(M.response.data.message),setTimeout(()=>{i(null)},2e3)}finally{d(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(V,{color:"primary",variant:"outline",disabled:l,onClick:()=>u(!0),className:"me-2",children:l?e.jsx(S,{size:"sm"}):e.jsx(w,{icon:$})}),e.jsxs(q,{visible:p,onClose:()=>u(!1),children:[e.jsx(P,{closeButton:!0,children:e.jsx(R,{children:"Update Vehicle"})}),g&&e.jsx(k,{color:"danger",className:"m-3",children:g}),y&&e.jsx(k,{color:"success",className:"m-3",children:y}),e.jsx(Y,{children:e.jsxs(z,{noValidate:!0,validated:T,children:[e.jsx(m,{className:"mb-3",floatingLabel:"ID Number",placeholder:"ID Number",type:"text",id:"idNum",label:"ID Number",value:t.idNum,disabled:!0}),e.jsx(m,{className:"mb-3",floatingLabel:"Brand",placeholder:"Brand",type:"text",id:"brand",label:"Brand",required:!0,value:t.brand,onChange:s=>r({...t,brand:s.target.value})}),e.jsx(m,{className:"mb-3",floatingLabel:"Model",placeholder:"Model",type:"text",id:"model",label:"Model",required:!0,value:t.model,onChange:s=>r({...t,model:s.target.value})}),e.jsx(m,{type:"number",className:"mb-3",floatingLabel:"Year",placeholder:"Year",id:"year",value:t.year,required:!0,min:"1990",max:new Date().getFullYear(),onChange:s=>{const C=s.target.value;r({...t,year:C})},onBlur:s=>{const C=parseInt(s.target.value);(C<1990||C>new Date().getFullYear()||isNaN(C))&&(alert("Please enter a year between 1990 and "+new Date().getFullYear()),r({...t,year:1990}))}}),e.jsx(m,{className:"mb-3",floatingLabel:"Registration Number",placeholder:"Registration Number",type:"text",id:"regisNumber",label:"Registration Number",required:!0,value:t.regisNumber,onChange:s=>r({...t,regisNumber:s.target.value})}),e.jsx(F,{className:"mb-3",floatingLabel:"Vehicle Type",placeholder:"Vehicle Type",id:"type",value:t.type,required:!0,onChange:s=>r({...t,type:s.target.value}),options:[{label:"Select Vehicle Type",value:""},...L]}),e.jsx(m,{className:"mb-2",type:"number",floatingLabel:"Capacity",placeholder:"Capacity",id:"capacity",label:"Capacity",required:!0,min:"0",value:t.capacity,onChange:s=>r({...t,capacity:s.target.value})}),e.jsx(F,{className:"mb-3",floatingLabel:"Fuel Type",placeholder:"Fuel Type",id:"fuelType",label:"Fuel Type",value:t.fuelType,required:!0,onChange:s=>r({...t,fuelType:s.target.value}),options:[{label:"Select Fuel Type",value:""},...A]}),e.jsx(m,{className:"mb-3",floatingLabel:"Current Mileage",placeholder:"Current Mileage",type:"number",id:"mileage",label:"Current Mileage",required:!0,min:"0",value:t.currentMileage,onChange:s=>r({...t,currentMileage:s.target.value})})]})}),e.jsxs(E,{children:[e.jsx(V,{color:"secondary",variant:"outline",disabled:l,onClick:()=>{u(!1),i(null),r(n),x(!1)},children:l?e.jsx(S,{size:"sm",color:"secondary"}):"Cancel"}),e.jsx(V,{color:"success",variant:"outline",disabled:l,onClick:o,children:l?e.jsx(S,{size:"sm",color:"success"}):"Save Changes"})]})]})]})},se=({vehicle:n,loading:b,error:j,onDeleteVehicle:N,onUpdateVehicle:v})=>{const[p,u]=c.useState([]),y=JSON.parse(sessionStorage.getItem("user")),h=["manager","admin"],[g,i]=c.useState(null),[l,d]=c.useState("");c.useEffect(()=>{u(n)},[n]),c.useEffect(()=>{(()=>{if(l==="")u(n);else{const t=n.filter(r=>r.idNum.toString().includes(l)||r.brand.toLowerCase().includes(l.toLowerCase())||r.model.toLowerCase().includes(l.toLowerCase())||r.year.toString().includes(l)||r.type.toLowerCase().includes(l.toLowerCase())||r.regisNumber.toLowerCase().includes(l.toLowerCase())||r.capacity.toString().includes(l)||x.find(L=>L.value===r.status).label.toLowerCase().includes(l.toLowerCase()));u(t),t.length===0?i("No vehicles found"):i(null)}})()},[l,n]);const T=a=>{switch(a){case"available":return"green";case"in_use":return"red";case"maintenance":return"orange";case"inspection":return"yellow";default:return"black"}},x=[{value:"available",label:"Available"},{value:"in_use",label:"In Use"},{value:"maintenance",label:"Maintenance"},{value:"inactive",label:"Inactive"},{value:"inspection",label:"Inspection"}];return n.length===0?e.jsx(k,{color:"danger",className:"text-center justify-content-center",children:"No vehicles found"}):e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"mt-3",children:e.jsxs(Q,{className:"w-50 mb-3",children:[e.jsx(m,{type:"text",placeholder:"Search vehicles",id:"search",value:l,onChange:a=>d(a.target.value),className:"w-50 me-2 "}),e.jsx(J,{children:e.jsx(w,{icon:G})})]})}),e.jsx(O,{className:"m-2",children:p.map((a,t)=>e.jsxs(K,{children:[e.jsx(W,{children:e.jsxs("p",{className:"w-100 m-1 ",children:["Registration Number:",e.jsx("strong",{className:"ms-2",children:a.regisNumber}),e.jsx(w,{icon:H,color:T(a.status),className:"m-2 float-end"}),e.jsx("small",{className:"m-2 float-end",children:x.find(r=>r.value===a.status).label})]})}),e.jsxs(X,{children:[e.jsxs(f,{children:["ID: ",a.idNum]}),e.jsxs(f,{children:["Brand: ",a.brand]}),e.jsxs(f,{children:["Model: ",a.model]}),e.jsxs(f,{children:["Year: ",a.year]}),e.jsxs(f,{children:["Type: ",a.type]}),e.jsxs(f,{children:["Capacity: ",a.capacity]}),e.jsxs(f,{children:["Status: ",x.find(r=>r.value===a.status).label]}),e.jsxs(f,{children:["Driver:"," ",a.assignedDriver?`${a.assignedDriver.driverName} - ${a.assignedDriver.licenseNumber}`:"Not assigned"]}),e.jsxs(f,{children:["Fuel Type: ",a.fuelType]}),e.jsxs(f,{children:["Current Mileage: ",a.currentMileage]}),e.jsxs(D,{className:"d-flex justify-content-end mt-3",children:[e.jsx(le,{vehicle:a,onUpdateVehicle:v}),h.includes(y.role)&&e.jsx(te,{vehicle:a,onDeleteVehicle:N})]})]})]},a._id||t))}),g&&e.jsx(k,{color:"danger",className:"text-center justify-content-center",children:g})]})},B=sessionStorage.getItem("accessToken"),re="http://localhost:5057",ne=I.create({baseURL:re,withCredentials:!0,headers:{"Content-Type":"application/json",...B&&{Authorization:`Bearer ${B}`}}}),Se=()=>{const[n,b]=c.useState([]),[j,N]=c.useState(!0),[v,p]=c.useState(null),u=async()=>{N(!0);try{const i=await ne.get("/api/v1/vehicle");i.status===200?(b(i.data.data),N(!1)):p(i.data.message)}catch(i){p(i.message)}finally{N(!1)}};c.useEffect(()=>{u()},[]);const y=i=>{b(l=>[...l,i])},h=i=>{b(l=>l.filter(d=>d.id!==i))},g=i=>{b(l=>l.map(d=>d._id===i._id?i:d))};return e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"text-center",children:"Vehicle Management"}),e.jsx(D,{className:"m-3",children:e.jsx(ae,{onAddVehicle:y})}),e.jsxs(Z,{children:[e.jsx(f,{children:"Vehicle List"}),e.jsx(ee,{className:"md-3",children:e.jsx(se,{vehicle:n,error:v,onDeleteVehicle:h,onUpdateVehicle:g,loading:j})})]})]})};export{Se as default};
