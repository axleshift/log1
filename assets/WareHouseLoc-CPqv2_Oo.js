import{r as a,_ as ge,u as xe,a as L,R as E,C as je,c as Ce,P as g,d as ve,H as ye,B as G,j as e,k,A as J,D as be,l as Ne}from"./index-Bc2K96tO.js";import{F as O,h as we,i as Se,g as Pe,e as Le}from"./index-olk9qfux.js";import{a as W}from"./CButton-D-wkpvg_.js";import{C as oe,a as ne,b as ie,c as le,d as ce}from"./CModalTitle-CYT1PmOJ.js";import{a as A,C as de}from"./CForm-DA7r1XNm.js";import{C as I}from"./CFormInput-BXtcFWEM.js";import{C as q}from"./CContainer-B4DkVIj_.js";import{C as ke,a as Te}from"./CInputGroupText-BLYMjW-3.js";import{C as Ee}from"./CCard-CNhcqwdS.js";import{i as se,u as We,C as ue}from"./DefaultLayout-CqUQdgw1.js";import{C as Ae}from"./CCardBody-DtDVpwoA.js";import{C as Fe,a as Re,b as ae,c as H,d as Ie,e as z}from"./CTable-oOl17bBH.js";import{g as Be}from"./getTransitionDurationFromElement-Cpu4p4hx.js";import{C as Ve,a as $}from"./CPaginationItem-BtLwSeRv.js";import"./index.esm-BlQWzZKV.js";import"./1-E4vOtbDS.js";import"./cil-user-Ddrdy7PS.js";var te=function(s){typeof s=="function"&&s()},De=function(s){s.dispatchEvent(new Event("transitionend"))},Me=function(s,d,v){if(v===void 0&&(v=!0),!v){te(s);return}var j=5,x=Be(d)+j,n=!1,m=function(r){var l=r.target;l===d&&(n=!0,d.removeEventListener("transitionend",m),te(s))};d.addEventListener("transitionend",m),setTimeout(function(){n||De(d)},x)},He=function(s,d){switch(s){case"right":return se(d)?"left":"right";case"left":return se(d)?"right":"left";default:return s}},R=a.forwardRef(function(s,d){var v=s.children,j=s.animation,x=j===void 0?!0:j,n=s.className,m=s.container,r=s.content,l=s.delay,c=l===void 0?0:l,o=s.fallbackPlacements,u=o===void 0?["top","right","bottom","left"]:o,f=s.offset,b=f===void 0?[0,6]:f,C=s.onHide,N=s.onShow,w=s.placement,T=w===void 0?"top":w,h=s.popperConfig,S=s.trigger,p=S===void 0?["hover","focus"]:S,y=s.visible,t=ge(s,["children","animation","className","container","content","delay","fallbackPlacements","offset","onHide","onShow","placement","popperConfig","trigger","visible"]),i=a.useRef(null),P=a.useRef(null),_=xe(d,i),B="tooltip".concat(a.useId()),Q=a.useState(!1),V=Q[0],K=Q[1],X=a.useState(y),F=X[0],Y=X[1],U=We(),fe=U.initPopper,me=U.destroyPopper,he=U.updatePopper,Z=typeof c=="number"?{show:c,hide:c}:c,ee={modifiers:[{name:"arrow",options:{element:".tooltip-arrow"}},{name:"flip",options:{fallbackPlacements:u}},{name:"offset",options:{offset:b}}],placement:He(T,P.current)},pe=L(L({},ee),typeof h=="function"?h(ee):h);a.useEffect(function(){if(y){D();return}M()},[y]),a.useEffect(function(){if(V&&P.current&&i.current){fe(P.current,i.current,pe),setTimeout(function(){Y(!0)},Z.show);return}!V&&P.current&&i.current&&me()},[V]),a.useEffect(function(){!F&&P.current&&i.current&&Me(function(){K(!1)},i.current)},[F]);var D=function(){K(!0),N&&N()},M=function(){setTimeout(function(){Y(!1),C&&C()},Z.hide)};return a.useEffect(function(){he()},[r]),E.createElement(E.Fragment,null,E.cloneElement(v,L(L(L(L(L({},F&&{"aria-describedby":B}),{ref:P}),(p==="click"||p.includes("click"))&&{onClick:function(){return F?M():D()}}),(p==="focus"||p.includes("focus"))&&{onFocus:function(){return D()},onBlur:function(){return M()}}),(p==="hover"||p.includes("hover"))&&{onMouseEnter:function(){return D()},onMouseLeave:function(){return M()}})),E.createElement(je,{container:m,portal:!0},V&&E.createElement("div",L({className:Ce("tooltip","bs-tooltip-auto",{fade:x,show:F},n),id:B,ref:_,role:"tooltip"},t),E.createElement("div",{className:"tooltip-arrow"}),E.createElement("div",{className:"tooltip-inner"},r))))});R.propTypes={animation:g.bool,children:g.node,container:g.any,content:g.oneOfType([g.string,g.node]),delay:g.oneOfType([g.number,g.shape({show:g.number.isRequired,hide:g.number.isRequired})]),fallbackPlacements:ye,offset:g.any,onHide:g.func,onShow:g.func,placement:g.oneOf(["auto","top","right","bottom","left"]),popperConfig:g.oneOfType([g.func,g.object]),trigger:ve,visible:g.bool};R.displayName="CTooltip";const ze=({onAddWarehouseLoc:s})=>{const{showSuccess:d,showError:v}=G(),[j,x]=a.useState(!1),[n,m]=a.useState(!1),[r,l]=a.useState(!1),[c,o]=a.useState(null),[u,f]=a.useState(null),b={warehouseName:"",address:""},[C,N]=a.useState(b),w=h=>{const{id:S,value:p}=h.target;N(y=>({...y,[S]:p}))},T=async h=>{const p=h.currentTarget.checkValidity();if(p||(h.preventDefault(),h.stopPropagation()),x(p),p){const t=JSON.parse(sessionStorage.getItem("user")).email;if(!t){o("User email not found. Please log in again.");return}l(!0);try{const i=await J.post("/api/v1/warehouseLoc/add",{...C,createdBy:t});i.data.success&&(d(i.data.message),s(i.data.data),setTimeout(()=>{l(!1),m(!1),o(null),N(b),x(!1)},2e3))}catch(i){o(i.response.data.message),v(i.response.data.message),setTimeout(()=>{o(null)},2e3)}l(!1)}};return e.jsx(e.Fragment,{children:r?e.jsx(k,{color:"primary",size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsxs(W,{color:"primary",variant:"outline",disabled:r,onClick:()=>m(!0),children:[r?e.jsx(k,{color:"secondary",size:"sm"}):e.jsx(O,{icon:we})," ","Add Warehouse Location"]}),e.jsxs(oe,{visible:n,onClose:()=>m(!1),children:[e.jsx(ne,{closeButton:!0,children:e.jsx(ie,{children:"Add Warehouse Location"})}),c&&e.jsx(A,{color:"danger",className:"m-3",children:c}),u&&e.jsx(A,{color:"success",className:"m-3",children:u}),e.jsx(le,{children:e.jsxs(de,{noValidate:!0,validated:j,children:[e.jsx(I,{type:"text",id:"warehouseName",className:"mb-3",placeholder:"Warehouse Name",floatingLabel:"Warehouse Name",onChange:w,value:C.warehouseName,autoComplete:"off",required:!0,feedbackInvalid:"Please enter a warehouse name",feedbackValid:"Looks good!"}),e.jsx(I,{type:"text",id:"address",className:"mb-3",placeholder:"Address",floatingLabel:"Address",onChange:w,value:C.address,autoComplete:"off",required:!0,feedbackInvalid:"Please enter an address",feedbackValid:"Looks good!"})]})}),e.jsxs(ce,{children:[e.jsx(W,{color:"secondary",variant:"outline",disabled:r,onClick:()=>{m(!1),N(b),m(!1),o(null),x(!1)},children:r?e.jsx(k,{color:"secondary",size:"sm"}):"Cancel"}),e.jsx(W,{color:"primary",variant:"outline",disabled:r,onClick:T,children:r?e.jsx(k,{color:"primary",size:"sm"}):"Add"})]})]})]})})},Oe=({warehouseLoc:s,onDeleteWarehouseLoc:d})=>{const{showSuccess:v,showError:j}=G(),[x,n]=a.useState(!1),[m,r]=a.useState(null),l=async()=>{n(!0);try{const c=await J.patch(`/api/v1/warehouseLoc/delete/${s._id}`);c.data.success&&(v(c.data.message),d(s._id),n(!1),r(null))}catch(c){r(c),j(c.message)}finally{n(!1)}};return m?e.jsxs(A,{color:"danger",className:"text-center mt-5 w-75 mx-auto",children:["Error: ",m.message]}):e.jsx(e.Fragment,{children:e.jsx(W,{color:"danger",disabled:x,variant:"outline",onClick:l,className:"me-2",children:x?e.jsx(k,{size:"sm"}):e.jsx(O,{icon:Se})})})},_e=({warehouseLoc:s,onUpdateWarehouseLoc:d})=>{const{showSuccess:v,showErrors:j}=G(),[x,n]=a.useState(!1),[m,r]=a.useState(!1),[l,c]=a.useState(!1),[o,u]=a.useState(null),[f,b]=a.useState(null),[C,N]=a.useState({warehouseName:s.warehouseName,address:s.address}),w=h=>{const{id:S,value:p}=h.target;N(y=>({...y,[S]:p}))},T=async h=>{const p=h.currentTarget.checkValidity();p||(h.preventDefault(),h.stopPropagation()),r(p);const t=JSON.parse(sessionStorage.getItem("user")).email;if(!t){u("User email not found. Please log in again.");return}c(!0);try{const i=await J.put(`/api/v1/warehouseLoc/update/${s._id}`,{...C,createdBy:t});i.data.success&&(v(i.data.message),d(i.data.data),setTimeout(()=>{b(null),n(!1),u(null),r(!1)},2e3))}catch(i){u(i.response.data.message),j(i.response.data.message),setTimeout(()=>{u(null)},2e3)}c(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(W,{color:"primary",variant:"outline",disabled:l,onClick:()=>n(!0),className:"me-2",children:l?e.jsx(k,{size:"sm"}):e.jsx(O,{icon:Pe})}),e.jsxs(oe,{visible:x,onClose:()=>n(!1),children:[e.jsx(ne,{closeButton:!0,children:e.jsx(ie,{children:"Update Warehouse Location"})}),o&&e.jsx(A,{color:"danger",className:"m-3",children:o}),f&&e.jsx(A,{color:"success",className:"m-3",children:f}),e.jsx(le,{children:e.jsxs(de,{noValidate:!0,validated:m,children:[e.jsx(I,{type:"text",id:"warehouseName",className:"mb-3",placeholder:"Warehouse Name",floatingLabel:"Warehouse Name",onChange:w,value:C.warehouseName,autoComplete:"off",required:!0,feedbackInvalid:"Please enter a warehouse name.",feedbackValid:"Looks good!"}),e.jsx(I,{type:"text",id:"address",className:"mb-3",placeholder:"Address",floatingLabel:"Address",onChange:w,value:C.address,autoComplete:"off",required:!0,feedbackInvalid:"Please enter an address.",feedbackValid:"Looks good!"})]})}),e.jsxs(ce,{children:[e.jsx(W,{color:"secondary",variant:"outline",disabled:l,onClick:()=>{n(!1),u(null),r(!1)},children:l?e.jsx(k,{size:"sm",color:"secondary"}):"Cancel"}),e.jsx(W,{color:"primary",variant:"outline",disabled:l,onClick:T,children:l?e.jsx(k,{size:"sm",color:"success"}):"Update"})]})]})]})},Ue=({warehouseLoc:s,loading:d,error:v,onDeleteWarehouseLoc:j,onUpdateWarehouseLoc:x})=>{const[n,m]=a.useState(""),[r,l]=a.useState([]),[c,o]=a.useState(1),[u,f]=a.useState(null),b=10,C=be(),N=["manager","admin"],w="admin";if(a.useEffect(()=>{l(s)},[s]),a.useEffect(()=>{if(n==="")l(s);else{const t=s.filter(i=>{const P=i.warehouseName.toLowerCase().includes(n.toLowerCase()),_=i.address.toLowerCase().includes(n.toLowerCase()),B=N.includes(C)&&i.createdBy.toLowerCase().includes(n.toLowerCase());return P||_||B});l(t),o(1),t.length===0?f("No results found"):f(null)}},[n,s]),s.length===0)return e.jsx(A,{color:"danger",className:"text-center mt-5 w-75 mx-auto justify-content-center",children:"No Warehouse Location Found"});const T=t=>{m(t.target.value)},h=c*b,S=h-b,p=r.slice(S,h),y=Math.ceil(r.length/b);return e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"m-3",children:e.jsxs(ke,{className:"w-50 mb-3",children:[e.jsx(I,{type:"text",id:"search",value:n,onChange:T,placeholder:"Search Warehouse Location..."}),e.jsx(Te,{children:e.jsx(O,{icon:Le})})]})}),e.jsxs(Ee,{children:[e.jsx(ue,{children:"Warehouse Location List"}),e.jsxs(Ae,{className:"md-3",children:[e.jsxs(Fe,{bordered:!0,hover:!0,responsive:!0,className:"mx-auto ",children:[e.jsx(Re,{className:"text-center  ",children:e.jsxs(ae,{children:[e.jsx(H,{className:"fixed-width bg-secondary",children:"Warehouse Name"}),e.jsx(H,{className:"fixed-width bg-secondary",children:"Address"}),w.includes(C)&&e.jsx(H,{className:"fixed-width bg-secondary",children:"Created By"}),e.jsx(H,{className:"fixed-width bg-secondary",children:"Actions"})]})}),e.jsx(Ie,{className:"text-center",children:p.map(t=>e.jsxs(ae,{children:[e.jsx(z,{className:"fixed-width",children:e.jsx(R,{content:t.warehouseName,children:e.jsx("span",{children:t.warehouseName})})}),e.jsx(z,{className:"fixed-width",children:e.jsx(R,{content:t.address,children:e.jsx("span",{children:t.address})})}),w.includes(C)&&e.jsx(z,{className:"fixed-width",color:"danger",children:e.jsx(R,{content:t.createdBy,children:e.jsx("span",{children:t.createdBy})})}),e.jsxs(z,{className:"fixed-width",children:[e.jsx(_e,{warehouseLoc:t,onUpdateWarehouseLoc:x}),N.includes(C)&&e.jsx(Oe,{warehouseLoc:t,onDeleteWarehouseLoc:j})]})]},t._id))})]}),r.length>0&&e.jsxs(q,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs(q,{children:["Showing ",S+1," to"," ",Math.min(h,r.length)," of"," ",r.length," entries"]}),e.jsxs(Ve,{className:"mt-3",children:[e.jsx($,{disabled:c===1,onClick:()=>o(t=>Math.max(t-1,1)),children:"Previous"}),[...Array(y).keys()].map(t=>e.jsx($,{active:t+1===c,onClick:()=>o(t+1),children:t+1},t+1)),e.jsx($,{disabled:c===y,onClick:()=>o(t=>Math.min(t+1,y)),children:"Next"})]})]}),u&&e.jsx(A,{color:"danger",className:"text-center mt-5 w-75 mx-auto justify-content-center",children:u})]})]})]})},re=sessionStorage.getItem("accessToken"),qe="http://localhost:5057",$e=Ne.create({baseURL:qe,withCredentials:!0,headers:{"Content-Type":"application/json",...re&&{Authorization:`Bearer ${re}`}}}),ds=()=>{const[s,d]=a.useState([]),[v,j]=a.useState(!1),[x,n]=a.useState(null),m=async()=>{var o,u;j(!0);try{const f=await $e.get("/api/v1/warehouseLoc/locations");f.status===200?d(f.data.data):n(f.data.message)}catch(f){n(((u=(o=f.response)==null?void 0:o.data)==null?void 0:u.message)||f.message)}finally{j(!1)}};a.useEffect(()=>{m()},[]);const r=o=>{d(u=>[...u,o])},l=o=>{d(u=>u.filter(f=>f._id!==o))},c=o=>{d(u=>u.map(f=>f._id===o._id?o:f))};return e.jsxs(e.Fragment,{children:[e.jsx(ue,{children:"Warehouse location"}),e.jsx(ze,{onAddWarehouseLoc:r}),e.jsx(Ue,{warehouseLoc:s,loading:v,error:x,onDeleteWarehouseLoc:l,onUpdateWarehouseLoc:c})]})};export{ds as default};
