import{r as i,_ as xe,u as we,R as k,a as Q,c as Y,P as N,b as Ie,B as le,j as e,k as ve,A as _,D as ke,F as Ne}from"./index-D3sENHx8.js";import{F as Z,h as Ae,q as Fe,i as qe,j as Ve,k as Re,a as Be,r as ze,l as Oe}from"./index-BkVfsiqy.js";import{C as He,a as E}from"./CButton-BtLzD1nc.js";import{C as ce,a as ne,b as de,c as he,d as ue}from"./CModalTitle-B-PsqkjO.js";import{C as ie}from"./CAlert-7ALPkqIl.js";import{C as Se}from"./CForm-aXXLYJpe.js";import{C as G,a as Qe}from"./CInputGroupText-lS-LDq2r.js";import{C as K}from"./CFormSelect-BY3m6lUT.js";import{a as ye,b as Ee,C as R}from"./CFormInput-ELlVuuy1.js";import{C as pe}from"./CCard-DonNi5aQ.js";import{C as fe}from"./CCardHeader-BGMlBaib.js";import{C as se}from"./CCardBody-CD1PubO1.js";import{C as De,a as Pe,b as oe,c as ee,d as Le,e as te}from"./CTable-qilBEm_B.js";import{C as H}from"./CContainer-JMjuzE-E.js";import{C as O,a as $e}from"./DefaultLayout-Cp499GQ2.js";import{C as Te}from"./CFormTextarea-BdUO6s7T.js";import{C as Ge,a as _e,b as Ue,c as Ke}from"./CAccordionHeader-DtFbud76.js";import{C as Je,a as me}from"./CPaginationItem-e85AesSY.js";import{C as We,a as Xe,b as Ye,c as Ze}from"./CTabList-kHCoT2v8.js";import"./index.esm-CRTaRlLz.js";import"./1-Cs5G51RP.js";import"./cil-user-Ddrdy7PS.js";import"./getTransitionDurationFromElement-Cpu4p4hx.js";var ge=i.forwardRef(function(r,t){var h=r.className,m=r.button,L=r.feedback,w=r.feedbackInvalid,x=r.feedbackValid,T=r.floatingLabel,g=r.tooltipFeedback,b=r.hitArea,u=r.id,I=r.indeterminate,v=r.inline,o=r.invalid,f=r.label,D=r.reverse,V=r.type,z=V===void 0?"checkbox":V,A=r.valid,y=xe(r,["className","button","feedback","feedbackInvalid","feedbackValid","floatingLabel","tooltipFeedback","hitArea","id","indeterminate","inline","invalid","label","reverse","type","valid"]),n=i.useRef(null),p=we(t,n);i.useEffect(function(){n.current&&I&&(n.current.indeterminate=I)},[I,n.current]);var j=function(){return k.createElement("input",Q({type:z,className:Y(m?"btn-check":"form-check-input",{"is-invalid":o,"is-valid":A,"me-2":b}),id:u},y,{ref:p}))},B=function(){return k.createElement(Ee,{describedby:y["aria-describedby"],feedback:L,feedbackInvalid:w,feedbackValid:x,floatingLabel:T,invalid:o,tooltipFeedback:g,valid:A})},U=function(){var C;return k.createElement(ye,Q({customClassName:Y(m?Y("btn",m.variant?"btn-".concat(m.variant,"-").concat(m.color):"btn-".concat(m.color),(C={},C["btn-".concat(m.size)]=m.size,C),"".concat(m.shape)):"form-check-label")},u&&{htmlFor:u}),f)},$=function(){return m?k.createElement(k.Fragment,null,k.createElement(j,null),f&&k.createElement(U,null),k.createElement(B,null)):f?b?k.createElement(k.Fragment,null,k.createElement(j,null),k.createElement(ye,Q({customClassName:Y("form-check-label stretched-link",h)},u&&{htmlFor:u}),f),k.createElement(B,null)):k.createElement("div",{className:Y("form-check",{"form-check-inline":v,"form-check-reverse":D,"is-invalid":o,"is-valid":A},h)},k.createElement(j,null),k.createElement(U,null),k.createElement(B,null)):k.createElement(j,null)};return k.createElement($,null)});ge.propTypes=Q({button:N.object,className:N.string,hitArea:N.oneOf(["full"]),id:N.string,indeterminate:N.bool,inline:N.bool,label:N.oneOfType([N.string,N.node]),reverse:N.bool,type:N.oneOf(["checkbox","radio"])},Ee.propTypes);ge.displayName="CFormCheck";var je=i.forwardRef(function(r,t){var h,m=r.children,L=r.as,w=L===void 0?"ul":L,x=r.className,T=r.flush,g=r.layout,b=xe(r,["children","as","className","flush","layout"]);return k.createElement(w,Q({className:Y("list-group",(h={"list-group-flush":T},h["list-group-".concat(g)]=g,h),x)},b,{ref:t}),m)});je.propTypes={as:N.elementType,children:N.node,className:N.string,flush:N.bool,layout:N.oneOf(["horizontal","horizontal-sm","horizontal-md","horizontal-lg","horizontal-xl","horizontal-xxl"])};je.displayName="CListGroup";var Ce=i.forwardRef(function(r,t){var h,m=r.children,L=r.active,w=r.as,x=w===void 0?"li":w,T=r.className,g=r.disabled,b=r.color,u=xe(r,["children","active","as","className","disabled","color"]),I=x==="a"||x==="button"?He:x;return u=Q(Q(Q(Q({},(x==="a"||x==="button")&&{active:L,disabled:g,as:x,ref:t}),L&&{"aria-current":!0}),g&&{"aria-disabled":!0}),u),k.createElement(I,Q({className:Y("list-group-item",(h={},h["list-group-item-".concat(b)]=b,h["list-group-item-action"]=x==="a"||x==="button",h.active=L,h.disabled=g,h),T)},u),m)});Ce.propTypes={active:N.bool,as:N.elementType,children:N.node,className:N.string,color:Ie,disabled:N.bool};Ce.displayName="CListGroupItem";const et=({onAddMaintenance:r})=>{const{showError:t,showSuccess:h}=le(),[m,L]=i.useState(!1),[w,x]=i.useState(null),[T,g]=i.useState(!1),[b,u]=i.useState(!1),I={vehicle:"",maintenanceType:"",startDate:"",expectedEndDate:"",description:"",priority:"",category:"",checklist:[{task:"",completed:!1}],parts:[]},[v,o]=i.useState(I),[f,D]=i.useState([]),[V,z]=i.useState({partName:"",quantity:""}),A=new Date().toISOString().split("T")[0],y=l=>{const{id:d,value:M}=l.target;o(s=>({...s,[d]:M}))},n=l=>{const{id:d,value:M}=l.target;z(s=>({...s,[d.split(".")[1]]:M}))},p=()=>{o(l=>({...l,parts:[...l.parts,{...V}]})),z({partName:"",quantity:""})};i.useEffect(()=>{(async()=>{try{const d=await _.get("/api/v1/vehicle/all");d.data.success&&D(d.data.data)}catch(d){x(d),t(d.message)}})()},[]);const j=()=>{o(l=>({...l,checklist:[...l.checklist,{task:"",completed:!1}]}))},B=l=>{o(d=>({...d,parts:d.parts.filter((M,s)=>s!==l)}))},U=l=>{o(d=>({...d,checklist:d.checklist.filter((M,s)=>s!==l)}))},$=(l,d)=>{o(M=>({...M,checklist:M.checklist.map((s,c)=>c===l?{...s,task:d}:s)}))},C=[{label:"High",value:"High"},{label:"Medium",value:"Medium"},{label:"Low",value:"Low"},{label:"Critical",value:"Critical"}],J=[{label:"Engine",value:"Engine"},{label:"Transmission",value:"Transmission"},{label:"Brakes",value:"Brakes"},{label:"Electrical",value:"Electrical"},{label:"Tiers",value:"Tiers"},{label:"Other",value:"Other"}],ae=[{label:"Preventive",value:"PMS"},{label:"Corrective",value:"Corrective"},{label:"Emergency",value:"Emergency"}],re=async l=>{var M,s,c,S;if(l.currentTarget.checkValidity()===!1)l.stopPropagation(),l.preDefault();else try{const a=await _.post("/api/v1/maintenance/create",v);a.data.success&&(h(a.data.message),r(a.data.data),g(!1))}catch(a){t(((s=(M=a.response)==null?void 0:M.data)==null?void 0:s.message)||a.message),x(((S=(c=a.response)==null?void 0:c.data)==null?void 0:S.message)||a.message),setTimeout(()=>{x(null)},2e3)}u(!0)};return e.jsxs(e.Fragment,{children:[e.jsxs(E,{color:"primary",className:"mb-3",variant:"outline",onClick:()=>g(!0),children:[e.jsx(Z,{icon:Ae})," Add Maintenance"]}),e.jsxs(ce,{visible:T,onClose:()=>g(!1),size:"lg",children:[e.jsx(ne,{closeButton:!0,children:e.jsx(de,{children:"Add Maintenance"})}),w&&e.jsx(ie,{color:"danger",children:w}),e.jsx(he,{children:e.jsxs(Se,{className:"row g-3 needs-validation",noValidate:!0,validated:b,children:[e.jsxs(G,{children:[e.jsxs(K,{id:"vehicle",value:v.vehicle,onChange:y,floatingLabel:"Vehicle",placeholder:"Select Vehicle",required:!0,feedbackInvalid:"Please provide a valid vehicle.",children:[e.jsx("option",{value:"",children:"Select Vehicle"}),f.map(l=>e.jsxs("option",{value:l._id,children:[l.brand," / ",l.model," / ",l.regisNumber]},l._id))]}),e.jsx(K,{id:"maintenanceType",value:v.maintenanceType,onChange:y,floatingLabel:"Maintenance Type",placeholder:"Select Maintenance Type",required:!0,options:[{label:"Select Maintenance Type",value:""},...ae],feedbackInvalid:"Please provide a valid maintenance type."}),e.jsx(R,{id:"description",type:"text",floatingLabel:"Description",placeholder:"Description",required:!0,value:v.description,onChange:y,feedbackInvalid:"Please provide a valid description."})]}),e.jsxs(G,{children:[e.jsx(R,{id:"startDate",type:"date",floatingLabel:"Start Date",placeholder:"Start Date",required:!0,min:A,value:v.startDate,onChange:y,feedbackInvalid:"Please provide a valid start date."}),e.jsx(R,{id:"expectedEndDate",type:"date",floatingLabel:"Expected End Date",placeholder:"Expected End Date",required:!0,min:A,value:v.expectedEndDate,onChange:y,feedbackInvalid:"Please provide a valid expected end date."}),e.jsxs(K,{id:"priority",value:v.priority,onChange:y,floatingLabel:"Priority",placeholder:"Select Priority",required:!0,feedbackInvalid:"Please provide a valid priority.",children:[e.jsx("option",{value:"",children:"Select Priority"}),C.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))]}),e.jsxs(K,{id:"category",value:v.category,onChange:y,floatingLabel:"Category",placeholder:"Select Category",required:!0,feedbackInvalid:"Please provide a valid category.",children:[e.jsx("option",{value:"",children:"Select Category"}),J.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))]})]}),e.jsxs(pe,{className:"mb-3",children:[e.jsx(fe,{children:"Add Parts"}),e.jsxs(se,{children:[e.jsxs(G,{className:"mb-3",children:[e.jsx(R,{id:"parts.partName",type:"text",floatingLabel:"Part Name",placeholder:"Part Name",value:V.partName,onChange:n}),e.jsx(R,{id:"parts.quantity",type:"number",floatingLabel:"Quantity",placeholder:"Quantity",value:V.quantity,onChange:n}),e.jsx(E,{color:"primary",onClick:p,children:"Add Part"})]}),v.parts.length>0&&e.jsxs(De,{className:"",children:[e.jsx(Pe,{className:"text-center",children:e.jsxs(oe,{children:[e.jsx(ee,{children:"Part Name"}),e.jsx(ee,{children:"Part Quantity"}),e.jsx(ee,{children:"Remove Part"})]})}),e.jsx(Le,{className:"text-center",children:v.parts.map((l,d)=>e.jsxs(oe,{children:[e.jsx(te,{children:l.partName}),e.jsx(te,{children:l.quantity}),e.jsx(te,{children:e.jsx(E,{color:"danger",size:"sm",onClick:()=>B(d),children:"Remove"})})]},d))})]})]})]}),e.jsxs(H,{children:[e.jsx(O,{children:"Checklist Items"}),e.jsx(E,{color:"primary",variant:"outline",className:"m-2",onClick:j,children:"Add Checklist Item"}),v.checklist.map((l,d)=>e.jsxs(G,{className:"mb-2",children:[e.jsx(R,{value:l.task,id:"itemCheckList",onChange:M=>$(d,M.target.value),placeholder:"Enter checklist item",required:!0}),e.jsx(E,{color:"danger",variant:"outline",onClick:()=>U(d),children:"Remove"})]},d))]}),e.jsx(Te,{id:"notes",floatingLabel:"Notes",placeholder:"Notes",value:v.notes,onChange:y,autoComplete:"off",style:{minHeight:"150px",width:"100%",resize:"vertical"},text:" leave empty if no notes.",feedbackInvalid:"Please provide a valid notes."})]})}),e.jsxs(ue,{children:[e.jsx(E,{color:"secondary",variant:"outline",onClick:()=>g(!1),children:"Close"}),e.jsx(E,{color:"primary",variant:"outline",onClick:re,children:m?e.jsx(ve,{size:"sm"}):"Add Maintenance"})]})]})]})},tt=({onCompleted:r,maintenance:t})=>{var g;const{showSuccess:h,showError:m}=le(),L=ke(),w=["admin","chief mechanic"];if(!t||!t.checklist)return null;const x=()=>{const b=new Date,u=new Date(t.startDate);return b<u},T=async b=>{var u,I;try{const v=Ne(),o=await _.patch(`/api/v1/maintenance/complete/${b}`,{completedBy:v});o.data.success&&(h(o.data.message),r(o.data.data))}catch(v){const o=((I=(u=v.response)==null?void 0:u.data)==null?void 0:I.message)||"Error completing maintenance";m(o),console.error("Error completing maintenance:",v)}};return e.jsx(e.Fragment,{children:w.includes(L)&&e.jsxs(e.Fragment,{children:[e.jsx(E,{color:"success",variant:"outline",onClick:()=>T(t._id),disabled:!((g=t.checklist)!=null&&g.every(b=>b.completed))||x(),title:x()?"Maintenance cannot be completed before its start date":"",children:"Complete Maintenance"}),x()&&e.jsxs("div",{className:"text-danger mt-2",children:["This maintenance cannot be completed before"," ",new Date(t.startDate).toLocaleDateString()]})]})})},at=({onUpdateMaintenance:r,maintenance:t,disabled:h})=>{var M;const{showError:m,showSuccess:L}=le(),[w,x]=i.useState(!1),[T,g]=i.useState(null),[b,u]=i.useState(!1),[I,v]=i.useState(!1),o={vehicle:((M=t==null?void 0:t.vehicle)==null?void 0:M._id)||"",maintenanceType:(t==null?void 0:t.maintenanceType)||"",startDate:t!=null&&t.startDate?t.startDate.split("T")[0]:"",expectedEndDate:t!=null&&t.expectedEndDate?t.expectedEndDate.split("T")[0]:"",description:(t==null?void 0:t.description)||"",priority:(t==null?void 0:t.priority)||"",category:(t==null?void 0:t.category)||"",checklist:(t==null?void 0:t.checklist)||[],parts:(t==null?void 0:t.parts)||[],notes:(t==null?void 0:t.notes)||""},[f,D]=i.useState(o),[V,z]=i.useState([]),[A,y]=i.useState({partName:"",quantity:""}),n=new Date().toISOString().split("T")[0],p=s=>{const{id:c,value:S}=s.target;D(a=>({...a,[c]:S}))},j=s=>{const{id:c,value:S}=s.target,a=c.split(".")[1];y(P=>({...P,[a]:a==="quantity"?S===""?"":Number(S):S}))},B=()=>{if(!A.partName||!A.quantity){m("Please fill in both part name and quantity");return}D(s=>({...s,parts:[...s.parts,{...A}]})),y({partName:"",quantity:""})};i.useEffect(()=>{var s;t&&D({vehicle:((s=t==null?void 0:t.vehicle)==null?void 0:s._id)||"",maintenanceType:(t==null?void 0:t.maintenanceType)||"",startDate:t!=null&&t.startDate?t.startDate.split("T")[0]:"",expectedEndDate:t!=null&&t.expectedEndDate?t.expectedEndDate.split("T")[0]:"",description:(t==null?void 0:t.description)||"",priority:(t==null?void 0:t.priority)||"",category:(t==null?void 0:t.category)||"",checklist:(t==null?void 0:t.checklist)||[],parts:(t==null?void 0:t.parts)||[],notes:(t==null?void 0:t.notes)||""})},[t]),i.useEffect(()=>{(async()=>{try{const c=await _.get("/api/v1/vehicle/all");c.data.success&&z(c.data.data)}catch(c){g(c),m(c.message)}})()},[]);const U=()=>{D(s=>({...s,checklist:[...s.checklist,{task:"",completed:!1}]}))},$=s=>{D(c=>({...c,parts:c.parts.filter((S,a)=>a!==s)}))},C=s=>{D(c=>({...c,checklist:c.checklist.filter((S,a)=>a!==s)}))},J=(s,c)=>{D(S=>({...S,checklist:S.checklist.map((a,P)=>P===s?{...a,task:c}:a)}))},ae=[{label:"High",value:"High"},{label:"Medium",value:"Medium"},{label:"Low",value:"Low"},{label:"Critical",value:"Critical"}],re=[{label:"Engine",value:"Engine"},{label:"Transmission",value:"Transmission"},{label:"Brakes",value:"Brakes"},{label:"Electrical",value:"Electrical"},{label:"Tiers",value:"Tiers"},{label:"Other",value:"Other"}],l=[{label:"Preventive",value:"PMS"},{label:"Corrective",value:"Corrective"},{label:"Emergency",value:"Emergency"}],d=async s=>{var S,a,P,F;s.preventDefault();const c=s.currentTarget;if(v(!0),c.checkValidity()===!1){s.stopPropagation();return}x(!0);try{const q=await _.put(`/api/v1/maintenance/update/${t._id}`,f);q.data.success&&(L(q.data.message),r(q.data.data),u(!1))}catch(q){m(((a=(S=q.response)==null?void 0:S.data)==null?void 0:a.message)||q.message),g(((F=(P=q.response)==null?void 0:P.data)==null?void 0:F.message)||q.message),setTimeout(()=>{g(null)},2e3)}finally{x(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(E,{color:"primary",className:"me-1 unset",variant:"outline",onClick:()=>u(!0),disabled:h,children:h?e.jsx(Z,{icon:Fe}):e.jsx(Z,{icon:qe})}),e.jsxs(ce,{visible:b,onClose:()=>u(!1),size:"lg",children:[e.jsx(ne,{closeButton:!0,children:e.jsx(de,{children:"Update Maintenance"})}),T&&e.jsx(ie,{color:"danger",children:T}),e.jsx(he,{children:e.jsxs(Se,{className:"row g-3 needs-validation",noValidate:!0,validated:I,children:[e.jsxs(G,{children:[e.jsxs(K,{id:"vehicle",value:f.vehicle||"",onChange:p,floatingLabel:"Vehicle",placeholder:"Select Vehicle",required:!0,feedbackInvalid:"Please provide a valid vehicle.",children:[e.jsx("option",{value:"",children:"Select Vehicle"}),V.map(s=>e.jsxs("option",{value:s._id,children:[s.brand," / ",s.model," / ",s.regisNumber]},s._id))]}),e.jsx(K,{id:"maintenanceType",value:f.maintenanceType||"",onChange:p,floatingLabel:"Maintenance Type",placeholder:"Select Maintenance Type",required:!0,options:[{label:"Select Maintenance Type",value:""},...l],feedbackInvalid:"Please provide a valid maintenance type."}),e.jsx(R,{id:"description",type:"text",floatingLabel:"Description",placeholder:"Description",required:!0,value:f.description,onChange:p,feedbackInvalid:"Please provide a valid description."})]}),e.jsxs(G,{children:[e.jsx(R,{id:"startDate",type:"date",floatingLabel:"Start Date",placeholder:"Start Date",required:!0,min:n,value:f.startDate,onChange:p,feedbackInvalid:"Please provide a valid start date."}),e.jsx(R,{id:"expectedEndDate",type:"date",floatingLabel:"Expected End Date",placeholder:"Expected End Date",required:!0,min:n,value:f.expectedEndDate,onChange:p,feedbackInvalid:"Please provide a valid expected end date."}),e.jsxs(K,{id:"priority",value:f.priority||"",onChange:p,floatingLabel:"Priority",placeholder:"Select Priority",required:!0,feedbackInvalid:"Please provide a valid priority.",children:[e.jsx("option",{value:"",children:"Select Priority"}),ae.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),e.jsxs(K,{id:"category",value:f.category,onChange:p,floatingLabel:"Category",placeholder:"Select Category",required:!0,feedbackInvalid:"Please provide a valid category.",children:[e.jsx("option",{value:"",children:"Select Category"}),re.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]})]}),e.jsxs(pe,{className:"mb-3",children:[e.jsx(fe,{children:"Add Parts"}),e.jsxs(se,{children:[e.jsxs(G,{className:"mb-3",children:[e.jsx(R,{id:"parts.partName",type:"text",floatingLabel:"Part Name",placeholder:"Part Name",value:A.partName||"",onChange:j}),e.jsx(R,{id:"parts.quantity",type:"number",floatingLabel:"Quantity",placeholder:"Quantity",value:A.quantity||"",onChange:j}),e.jsx(E,{color:"primary",onClick:B,children:"Add Part"})]}),f.parts.length>0&&e.jsxs(De,{className:"",children:[e.jsx(Pe,{className:"text-center",children:e.jsxs(oe,{children:[e.jsx(ee,{children:"Part Name"}),e.jsx(ee,{children:"Part Quantity"}),e.jsx(ee,{children:"Remove Part"})]})}),e.jsx(Le,{className:"text-center",children:f.parts.map((s,c)=>e.jsxs(oe,{children:[e.jsx(te,{children:s.partName}),e.jsx(te,{children:s.quantity}),e.jsx(te,{children:e.jsx(E,{color:"danger",size:"sm",onClick:()=>$(c),children:"Remove"})})]},c))})]})]})]}),e.jsxs(H,{children:[e.jsx(O,{children:"Checklist Items"}),e.jsx(E,{color:"primary",variant:"outline",className:"m-2",onClick:U,children:"Add Checklist Item"}),f.checklist.map((s,c)=>e.jsxs(G,{className:"mb-2",children:[e.jsx(R,{value:s.task,id:"itemCheckList",onChange:S=>J(c,S.target.value),placeholder:"Enter checklist item",required:!0}),e.jsx(E,{color:"danger",variant:"outline",onClick:()=>C(c),children:"Remove"})]},c))]}),e.jsx(Te,{id:"notes",floatingLabel:"Notes",placeholder:"Notes",value:f.notes,onChange:p,autoComplete:"off",style:{minHeight:"150px",width:"100%",resize:"vertical"},text:" leave empty if no notes.",feedbackInvalid:"Please provide a valid notes."})]})}),e.jsxs(ue,{children:[e.jsx(E,{color:"secondary",variant:"outline",onClick:()=>u(!1),children:"Close"}),e.jsx(E,{color:"primary",variant:"outline",onClick:d,children:w?e.jsx(ve,{size:"sm"}):"Update Maintenance"})]})]})]})},st=({onDeleteMaintenance:r,onUpdateMaintenance:t,maintenance:h,onCompleted:m,vehicles:L,loading:w,error:x})=>{const T=ke(),{showError:g,showSuccess:b}=le(),u=["admin","chief mechanic"],[I,v]=i.useState(null),[o,f]=i.useState(""),[D,V]=i.useState([]),[z,A]=i.useState(!1),[y,n]=i.useState(1),[p]=i.useState(10),j=y*p,B=j-p,U=D.slice(B,j),$=Math.ceil(D.length/p),[C,J]=i.useState({checklist:[]}),[ae,re]=i.useState(!0);i.useEffect(()=>{V(h)},[h]);const l=a=>{J(a),A(!0)},d=()=>{J(null),A(!1)},M=async(a,P)=>{var F,q;try{const W=Ne(),X=await _.patch(`/api/v1/maintenance/${a}/checklist/${P}`,{completedBy:W});X.data.success&&(V(Me=>Me.map(be=>be._id===a?X.data.data:be)),(C==null?void 0:C._id)===a&&J(X.data.data),b(X.data.message))}catch(W){console.error("Error updating checklist:",W),g(((q=(F=W.response)==null?void 0:F.data)==null?void 0:q.message)||"Error updating checklist item")}},s=a=>a?`${a.brand||""} ${a.model||""} ${a.regisNumber||""}`.trim():"N/A";i.useEffect(()=>{(()=>{if(n(1),o==="")V(h);else{const P=h.filter(F=>{var q,W,X;return((q=F.vehicle)==null?void 0:q.regisNumber.toLowerCase().includes(o.toLowerCase()))||((W=F.vehicle)==null?void 0:W.brand.toLowerCase().includes(o.toLowerCase()))||((X=F.vehicle)==null?void 0:X.model.toLowerCase().includes(o.toLowerCase()))||F.maintenanceType.toLowerCase().includes(o.toLowerCase())||F.priority.toLowerCase().includes(o.toLowerCase())||F.status.toLowerCase().includes(o.toLowerCase())});V(P),P.length===0?v("No vehicles found"):v(null)}})()},[o,h]);const c=a=>{switch(a){case"Completed":return"green";case"Scheduled":return"orange";case"In Progress":return"yellow";default:return"black"}},S=[{value:"Completed",label:"Completed"},{value:"Scheduled",label:"Scheduled"},{value:"In Progress",label:"In Progress"}];return e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"mt-3",children:e.jsxs(G,{className:"mb-3",children:[e.jsx(R,{type:"text",placeholder:"Search",id:"search",value:o,onChange:a=>f(a.target.value)}),e.jsx(Qe,{children:e.jsx(Z,{icon:Ve})})]})}),e.jsx(Ge,{className:"m-2",children:U.map((a,P)=>e.jsxs(_e,{children:[e.jsxs(Ue,{className:"d-flex justify-content-between",children:[e.jsx(H,{children:e.jsxs("ul",{className:"list-unstyled",children:[e.jsxs("li",{children:["Vehicle: ",e.jsx("strong",{children:s(a.vehicle)})]}),e.jsxs("li",{children:["Priority: ",e.jsx("strong",{children:a.priority||"N/A"})]})]})}),e.jsxs(H,{className:"d-flex justify-content-end",children:[e.jsx(Z,{icon:Re,color:c(a.status),className:"m-2 float-end"}),e.jsx("small",{className:"m2 float-end",children:S.find(F=>F.value===a.status).label})]})]}),e.jsxs(Ke,{children:[e.jsxs(O,{children:["Maintenance Type: ",a.maintenanceType||"N/A"]}),e.jsxs(O,{children:["Start Date:"," ",a.startDate?new Date(a.startDate).toLocaleDateString():"N/A"]}),e.jsxs(O,{children:["Expected Date:"," ",a.expectedEndDate?new Date(a.expectedEndDate).toLocaleDateString():"N/A"]}),e.jsxs(O,{children:["Description: ",a.description||"N/A"]}),e.jsxs(O,{children:["Category: ",a.category||"N/A"]}),e.jsxs(O,{children:["Notes: ",a.notes||"N/A"]}),e.jsxs(O,{children:["Completed By: ",a.completedBy||"N/A"]}),e.jsxs(pe,{className:"mt-3",children:[e.jsx(fe,{children:e.jsx("strong",{children:"Parts Required"})}),e.jsx(se,{children:a.parts&&a.parts.length>0?e.jsx(e.Fragment,{children:e.jsx(je,{children:a.parts.map((F,q)=>e.jsxs(Ce,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("div",{children:e.jsx("strong",{children:F.partName})}),e.jsx("div",{className:"d-flex gap-3",children:e.jsxs(Be,{color:"primary",children:["Qty: ",F.quantity]})})]},q))})}):e.jsx(ie,{color:"info",children:"No parts listed for this maintenance"})})]}),e.jsxs(H,{className:"d-flex justify-content-end mt-3",children:[u.includes(T)&&e.jsx(at,{maintenance:a,onUpdateMaintenance:t,vehicles:L,disabled:a.status==="Completed"}),e.jsx(E,{color:"primary",className:"m-1",variant:"outline",onClick:()=>l(a),children:e.jsx(Z,{icon:ze})}),e.jsx(E,{color:"danger",className:"m-1",variant:"outline",onClick:()=>r(a._id),children:e.jsx(Z,{icon:Oe})})]})]})]},a._id||P))}),D.length>0&&e.jsxs(H,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs(H,{children:["Showing ",B+1," to ",Math.min(j,D.length)," ","of ",D.length," entries"]}),e.jsxs(Je,{className:"mt-3",children:[e.jsx(me,{disabled:y===1,onClick:()=>n(a=>Math.max(a-1,1)),children:"Previous"}),Array.from({length:$},(a,P)=>P+1).map(a=>e.jsx(me,{active:a===y,onClick:()=>n(a),children:a},a)),e.jsx(me,{disabled:y===$,onClick:()=>n(a=>Math.min(a+1,$)),children:"Next"})]})]}),I&&e.jsx(ie,{color:"danger",children:I}),e.jsxs(ce,{visible:z,onClose:d,size:"lg",children:[e.jsx(ne,{children:e.jsxs(de,{children:["Maintenance Checklist - ",s(C==null?void 0:C.vehicle)]})}),e.jsx(he,{children:C!=null&&C.checklist&&C.checklist.length>0?e.jsx("div",{className:"checklist-container",children:e.jsx("ul",{className:"list-group",children:C.checklist.map((a,P)=>e.jsxs("li",{className:"list-group-item d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx(ge,{type:"checkbox",id:`checkBoxList-${P}`,checked:a.completed,onChange:()=>M(C._id,P),disabled:!u.includes(T),className:"me-2"})," ",a.task]}),a.completed&&e.jsxs("small",{className:"text-muted",children:["Completed by: ",a.completedBy," at"," ",new Date(a.completedAt).toLocaleString()]})]},P))})}):e.jsx("p",{className:"text-center",children:"No checklist items available"})}),e.jsxs(ue,{children:[C&&e.jsx(tt,{maintenance:C,isLoading:ae,onCompleted:m,disabled:!u.includes(T)}),e.jsx(E,{color:"secondary",onClick:d,children:"Close"})]})]})]})},Dt=()=>{const[r,t]=i.useState([]),[h,m]=i.useState([]),[L,w]=i.useState(!0),[x,T]=i.useState(null),{showError:g,showSuccess:b}=le(),[u,I]=i.useState(null),[v,o]=i.useState(!1),f=async()=>{var n,p;w(!0);try{const[j,B]=await Promise.all([_.get("/api/v1/maintenance/all"),_.get("/api/v1/vehicle")]);t(j.data.data),m(B.data.date)}catch(j){T(j.message),g(((p=(n=j.response)==null?void 0:n.data)==null?void 0:p.message)||"Error fetching data")}finally{w(!1)}};if(i.useEffect(()=>{f()},[]),L)return e.jsx(ve,{color:"primary",size:"sm",children:"Loading..."});const D=n=>{I(n),o(!0)},V=async()=>{try{await _.delete(`/api/v1/maintenance/delete/${u}`),t(n=>n.filter(p=>p._id!==u)),b("Maintenance deleted successfully"),o(!1)}catch(n){g(n.response.data.message)}finally{o(!1)}},z=n=>{t(p=>[...p,n]),f()},A=n=>{t(p=>p.map(j=>j._id===n._id?n:j)),f()},y=n=>{t(p=>p.map(j=>j._id===n._id?n:j)),f()};return e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsx(O,{children:"Maintenance Management"}),e.jsx(pe,{children:e.jsxs(se,{children:[e.jsx(H,{children:e.jsx(et,{onAddMaintenance:z})}),e.jsxs(We,{activeItemKey:"Maintenance List",children:[e.jsx(Xe,{variant:"tabs",children:e.jsx(Ye,{itemKey:"Maintenance List",children:"Maintenance List"})}),e.jsx($e,{children:e.jsx(Ze,{itemKey:"Maintenance List",children:e.jsx(se,{className:"md-3",children:e.jsx(st,{vehicles:h,maintenance:r,onCompleted:A,error:x,onDeleteMaintenance:D,onUpdateMaintenance:y,loading:L})})})})]})]})})]}),e.jsxs(ce,{visible:v,onClose:()=>o(!1),alignment:"center",children:[e.jsx(ne,{children:e.jsx(de,{children:"Delete Maintenance"})}),e.jsx(he,{children:"Are you sure you want to delete this maintenance?"}),e.jsxs(ue,{children:[e.jsx(E,{color:"secondary",variant:"outline",onClick:()=>o(!1),children:"Cancel"}),e.jsx(E,{color:"danger",variant:"outline",onClick:V,children:"Delete"})]})]})]})};export{Dt as default};
