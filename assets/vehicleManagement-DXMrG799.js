import{B as _,r as n,j as e,k as E,A as Y,D as O}from"./index-Bc2K96tO.js";import{F as q,h as Q,i as J,j as K,k as W,a as X,l as Z}from"./index-olk9qfux.js";import{a as L}from"./CButton-D-wkpvg_.js";import{C as $,a as z,b as P,c as G,d as U}from"./CModalTitle-CYT1PmOJ.js";import{a as M,C as H}from"./CForm-DA7r1XNm.js";import{C as k,a as ee}from"./CInputGroupText-BLYMjW-3.js";import{C as m}from"./CFormInput-BXtcFWEM.js";import{C as B}from"./CFormSelect-BgO_oiyP.js";import{C as I}from"./CContainer-B4DkVIj_.js";import{C as ae,a as se,b as te,c as re}from"./CAccordionHeader-MYZ43-qv.js";import{C as y}from"./DefaultLayout-CqUQdgw1.js";import{C as le}from"./CCard-CNhcqwdS.js";import{C as ne}from"./CCardBody-DtDVpwoA.js";import"./index.esm-BlQWzZKV.js";import"./1-E4vOtbDS.js";import"./cil-user-Ddrdy7PS.js";const ie=({onAddVehicle:t})=>{const{showSuccess:C,showError:v}=_(),[N,b]=n.useState(!1),[p,d]=n.useState(!1),[T,f]=n.useState(null),[u,l]=n.useState(null),[s,h]=n.useState(!1),S={idNum:Math.floor(Math.random()*1e6).toString(),brand:"",model:"",year:"",regisExprationDate:"",regisNumber:"",capacity:"",fuelType:"",currentMileage:"",status:"available"},[o,a]=n.useState(S),c=j=>{const{id:g,value:i}=j.target;a(x=>({...x,[g]:i}))},r=[{label:"Van",value:"van"},{label:"Pickup Truck",value:"pickup"},{label:"Box Truck",value:"box"},{label:"Straight Truck",value:"straight"},{label:"Semi-Trailer Trucks",value:"semi"},{label:"Refrigerated Trucks",value:"refrigerated"},{label:"Tanker Trucks",value:"tanker"},{label:"Flatbed Trucks",value:"flatbed"}],F=[{label:"Diesel",value:"Diesel"},{label:"Gasoline",value:"Gasoline"}],R=async j=>{j.currentTarget.checkValidity()===!1&&(j.preDefault(),j.stopPropagation()),b(!0),h(!0);try{const i=await Y.post("/api/v1/vehicle",o);i.data.success&&(C(i.data.message),t(i.data.data),setTimeout(()=>{a(S),h(!1),b(!1),d(!1)},2e3))}catch(i){f(i.response.data.message),v(i.response.data.message),setTimeout(()=>{f(null)},2e3)}h(!1)},V=new Date().getFullYear(),D=1990,w=new Date().toISOString().split("T")[0];return e.jsx(e.Fragment,{children:s?e.jsx(E,{color:"primary",size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsxs(L,{color:"primary",variant:"outline",onClick:()=>d(!0),children:[e.jsx(q,{icon:Q})," Add Vehicle"]}),e.jsxs($,{visible:p,onClose:()=>d(!1),size:"lg",children:[e.jsx(z,{closeButton:!0,children:e.jsx(P,{children:"Add Vehicle"})}),T&&e.jsx(M,{color:"danger",className:"m-3",children:T}),u&&e.jsx(M,{color:"success",className:"m-3",children:u}),e.jsx(G,{children:e.jsxs(H,{noValidate:!0,validated:N,children:[e.jsxs(k,{children:[e.jsx(m,{className:"mb-3",floatingLabel:"ID Number",placeholder:"ID Number",type:"text",id:"idNum",label:"ID Number",value:o.idNum,disabled:!0}),e.jsx(m,{className:"mb-3",floatingLabel:"Brand",placeholder:"Brand",type:"text",id:"brand",label:"Brand",autoComplete:"off",required:!0,value:o.brand,onChange:c}),e.jsx(m,{className:"mb-3",floatingLabel:"Model",placeholder:"Model",type:"text",id:"model",label:"Model",autoComplete:"off",required:!0,value:o.model,onChange:c})]}),e.jsxs(k,{children:[e.jsx(m,{type:"number",className:"mb-3",floatingLabel:"Year",placeholder:"Year",id:"year",value:o.year,required:!0,min:D,max:V,onChange:c,onBlur:j=>{const g=parseInt(j.target.value);g>=D&&g<=V&&!isNaN(g)||(alert(`Please enter a year between ${D} and ${V}`),a({...o,year:D}))}}),e.jsx(m,{className:"mb-3",floatingLabel:"Registration Number",placeholder:"Registration Number",type:"text",id:"regisNumber",label:"Registration Number",autoComplete:"off",required:!0,value:o.regisNumber,onChange:c}),e.jsx(m,{className:"mb-3",floatingLabel:"Registration Expiration Date",placeholder:"Registration Expiration Date",type:"date",id:"regisExprationDate",label:"Registration Expiration Date",autoComplete:"off",required:!0,min:w,value:o.regisExprationDate,onChange:c})]}),e.jsxs(k,{children:[e.jsx(B,{className:"mb-3",floatingLabel:"Vehicle Type",placeholder:"Vehicle Type",id:"type",value:o.type,required:!0,onChange:c,options:[{label:"Select Vehicle Type",value:""},...r]}),e.jsx(m,{className:"mb-2",type:"number",floatingLabel:"Capacity",placeholder:"Capacity",id:"capacity",label:"Capacity",autoComplete:"off",required:!0,min:"0",value:o.capacity,onChange:c}),e.jsx(B,{className:"mb-3",floatingLabel:"Fuel Type",placeholder:"Fuel Type",id:"fuelType",value:o.fuelType,required:!0,onChange:c,options:[{label:"Select Fuel Type",value:""},...F]})]}),e.jsx(m,{className:"mb-3",floatingLabel:"Current Mileage",placeholder:"Current Mileage",type:"number",id:"currentMileage",label:"Current Mileage",autoComplete:"off",required:!0,value:o.currentMileage,min:"0",max:"100000000000",onChange:c})]})}),e.jsxs(U,{children:[e.jsx(L,{color:"secondary",variant:"outline",disabled:s,onClick:()=>{d(!1),a(S),b(!1),f(null)},children:s?e.jsx(E,{color:"secondary",size:"sm"}):"Cancel"}),e.jsx(L,{color:"primary",variant:"outline",disabled:s,onClick:R,children:s?e.jsx(E,{color:"primary",size:"sm"}):"Save"})]})]})]})})},oe=({vehicle:t,onDeleteVehicle:C})=>{const{showSuccess:v,showErrors:N}=_(),[b,p]=n.useState(!1),[d,T]=n.useState(null),f=async()=>{p(!0);try{const u=await Y.delete(`/api/v1/vehicle/${t._id}`);u.data.success&&(v(u.data.message),p(!1),C(t._id),p(!1),T(null))}catch(u){T(u),N(u.response.data.message)}finally{p(!1)}};return d?e.jsxs(M,{color:"danger",className:"text-center mt-5 w-75 mx-auto",children:["Error: ",d.message]}):e.jsx(e.Fragment,{children:e.jsx(L,{color:"danger",variant:"outline",disabled:b,onClick:f,className:"me-2",children:b?e.jsx(E,{size:"sm"}):e.jsx(q,{icon:J})})})},ce=({vehicle:t,onUpdateVehicle:C})=>{const{showSuccess:v,showError:N}=_(),[b,p]=n.useState(!1),[d,T]=n.useState(null),[f,u]=n.useState(null),[l,s]=n.useState(!1),[h,S]=n.useState(!1),o={idNum:t.idNum,brand:t.brand,model:t.model,year:t.year,regisExprationDate:t.regisExprationDate,regisNumber:t.regisNumber,capacity:t.capacity,fuelType:t.fuelType,currentMileage:t.currentMileage},[a,c]=n.useState(o),r=g=>{const{id:i,value:x}=g.target;c(A=>({...A,[i]:x}))},F=[{label:"Van",value:"van"},{label:"Pickup Truck",value:"pickup"},{label:"Box Truck",value:"box"},{label:"Straight Truck",value:"straight"},{label:"Semi-Trailer Trucks",value:"semi"},{label:"Refrigerated Trucks",value:"refrigerated"},{label:"Tanker Trucks",value:"tanker"},{label:"Flatbed Trucks",value:"flatbed"}],R=[{label:"Diesel",value:"Diesel"},{label:"Gasoline",value:"Gasoline"}],V=async g=>{s(!0),g.currentTarget.checkValidity()===!1&&g.stopPropagation(),S(!0);try{const x=await Y.put(`/api/v1/vehicle/${t._id}`,a);x.data.success&&(v(x.data.message),C(x.data.data),setTimeout(()=>{s(!1),S(!1),p(!1)},2e3))}catch(x){N(x.response.data.message),u(x.response.data.message),setTimeout(()=>{u(null)},2e3)}finally{s(!1)}},D=new Date().getFullYear(),w=1990,j=new Date().toISOString().split("T")[0];return e.jsxs(e.Fragment,{children:[e.jsx(L,{color:"primary",variant:"outline",disabled:l,onClick:()=>p(!0),className:"me-2",children:l?e.jsx(E,{size:"sm"}):e.jsx(q,{icon:K})}),e.jsxs($,{visible:b,onClose:()=>p(!1),size:"lg",children:[e.jsx(z,{closeButton:!0,children:e.jsx(P,{children:"Update Vehicle"})}),f&&e.jsx(M,{color:"danger",className:"m-3",children:f}),d&&e.jsx(M,{color:"success",className:"m-3",children:d}),e.jsx(G,{children:e.jsxs(H,{noValidate:!0,validated:h,children:[e.jsxs(k,{children:[e.jsx(m,{className:"mb-3",floatingLabel:"ID Number",placeholder:"ID Number",type:"text",id:"idNum",label:"ID Number",value:a.idNum,disabled:!0}),e.jsx(m,{className:"mb-3",floatingLabel:"Brand",placeholder:"Brand",type:"text",id:"brand",label:"Brand",required:!0,value:a.brand,onChange:r}),e.jsx(m,{className:"mb-3",floatingLabel:"Model",placeholder:"Model",type:"text",id:"model",label:"Model",required:!0,value:a.model,onChange:r})]}),e.jsxs(k,{children:[e.jsx(m,{type:"number",className:"mb-3",floatingLabel:"Year",placeholder:"Year",id:"year",value:a.year,required:!0,min:w,max:D,onChange:r,onBlur:g=>{const i=parseInt(g.target.value);i>=w&&i<=D&&!isNaN(i)||(alert(`Please enter a year between ${w} and ${D}`),c({...a,year:w}))}}),e.jsx(m,{className:"mb-3",floatingLabel:"Registration Number",placeholder:"Registration Number",type:"text",id:"regisNumber",label:"Registration Number",required:!0,value:a.regisNumber,onChange:r}),e.jsx(m,{className:"mb-3",floatingLabel:"Registration Expiration Date",placeholder:"Registration Expiration Date",type:"date",id:"regisExprationDate",label:"Registration Expiration Date",autoComplete:"off",required:!0,min:j,value:a.regisExprationDate.split("T")[0],onChange:r})]}),e.jsxs(k,{children:[e.jsx(B,{className:"mb-3",floatingLabel:"Vehicle Type",placeholder:"Vehicle Type",id:"type",value:a.fuelType,required:!0,onChange:r,options:[...F]}),e.jsx(m,{className:"mb-2",type:"number",floatingLabel:"Capacity",placeholder:"Capacity",id:"capacity",label:"Capacity",required:!0,min:"0",value:a.capacity,onChange:r}),e.jsx(B,{className:"mb-3",floatingLabel:"Fuel Type",placeholder:"Fuel Type",id:"fuelType",label:"Fuel Type",value:a.fuelType,required:!0,onChange:r,options:[,...R]})]}),e.jsx(m,{className:"mb-3",floatingLabel:"Current Mileage",placeholder:"Current Mileage",type:"number",id:"currentMileage",label:"Current Mileage",required:!0,min:"0",max:"100000000000",value:a.currentMileage,onChange:r})]})}),e.jsxs(U,{children:[e.jsx(L,{color:"secondary",variant:"outline",disabled:l,onClick:()=>{p(!1),u(null),c(t),S(!1)},children:l?e.jsx(E,{size:"sm",color:"secondary"}):"Cancel"}),e.jsx(L,{color:"success",variant:"outline",disabled:l,onClick:V,children:l?e.jsx(E,{size:"sm",color:"success"}):"Save Changes"})]})]})]})},de=({vehicle:t,error:C,loading:v,onDeleteVehicle:N,onUpdateVehicle:b})=>{const[p,d]=n.useState([]),T=O(),f=["manager","admin"],[u,l]=n.useState(null),[s,h]=n.useState("");n.useEffect(()=>{d(t)},[t]),n.useEffect(()=>{(()=>{if(s==="")d(t);else{const c=t.filter(r=>{var F,R,V,D,w,j,g,i,x;return((F=r.idNum)==null?void 0:F.toString().includes(s))||((R=r.brand)==null?void 0:R.toLowerCase().includes(s.toLowerCase()))||((V=r.model)==null?void 0:V.toLowerCase().includes(s.toLowerCase()))||((D=r.year)==null?void 0:D.toString().includes(s))||((w=r.regisExprationDate)==null?void 0:w.toLowerCase().includes(s.toLowerCase()))||((j=r.type)==null?void 0:j.toLowerCase().includes(s.toLowerCase()))||((g=r.regisNumber)==null?void 0:g.toLowerCase().includes(s.toLowerCase()))||((i=r.capacity)==null?void 0:i.toString().includes(s))||(((x=o.find(A=>A.value===r.status))==null?void 0:x.label)||"").toLowerCase().includes(s.toLowerCase())});d(c),c.length===0?l("No vehicles found"):l(null)}})()},[s,t]);const S=a=>{switch(a){case"available":return"green";case"in_use":return"red";case"maintenance":return"orange";case"inspection":return"yellow";case"forRegistration":return"grey";default:return"black"}},o=[{value:"available",label:"Available"},{value:"in_use",label:"In Use"},{value:"maintenance",label:"Maintenance"},{value:"inactive",label:"Inactive"},{value:"inspection",label:"Inspection"},{value:"forRegistration",label:"For Registration"}];return t.length===0?e.jsx(M,{color:"danger",className:"text-center justify-content-center",children:"No vehicles found"}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"mt-3",children:e.jsxs(k,{className:"w-50 mb-3",children:[e.jsx(m,{type:"text",placeholder:"Search vehicles",id:"search",value:s,onChange:a=>h(a.target.value),className:"w-50 me-2 "}),e.jsx(ee,{children:e.jsx(q,{icon:W})})]})}),e.jsx(ae,{className:"m-2",children:p.map((a,c)=>e.jsxs(se,{children:[e.jsxs(te,{className:"d-flex justify-content-between",children:[e.jsx(I,{children:e.jsxs("ul",{children:[e.jsxs("li",{children:["Registration Number: ",e.jsx("strong",{children:a.regisNumber})]}),e.jsxs("li",{children:["Driver:"," ",e.jsx("strong",{children:a.assignedDriver?`${a.assignedDriver.driverName} - ${a.assignedDriver.licenseNumber}`:"Not assigned"})]}),e.jsxs("li",{children:["Registration expiration Date:"," ",e.jsx("strong",{children:a.regisExprationDate?e.jsxs(e.Fragment,{children:[new Date(a.regisExprationDate).toISOString().split("T")[0]," ",e.jsx(X,{color:new Date(a.regisExprationDate).toDateString()===new Date().toDateString()?"danger":new Date(a.regisExprationDate)<=new Date(new Date().getTime()+14*24*60*60*1e3)&&new Date(a.regisExprationDate)>new Date?"warning":"success",children:new Date(a.regisExprationDate).toDateString()===new Date().toDateString()?"Expires Today":new Date(a.regisExprationDate)<=new Date(new Date().getTime()+14*24*60*60*1e3)&&new Date(a.regisExprationDate)>new Date?"Expires in 2 weeks":"Registered"})]}):"No expiration date"})]})]})}),e.jsxs(I,{className:"d-flex justify-content-end",children:[e.jsx(q,{icon:Z,color:S(a.status),className:"m-2 float-end"}),e.jsx("small",{className:"m-2 float-end",children:o.find(r=>r.value===a.status).label})]})]}),e.jsxs(re,{children:[e.jsxs(y,{children:["ID: ",a.idNum]}),e.jsxs(y,{children:["Brand: ",a.brand]}),e.jsxs(y,{children:["Model: ",a.model]}),e.jsxs(y,{children:["Year: ",a.year]}),e.jsxs(y,{children:["Type: ",a.type]}),e.jsxs(y,{children:["Capacity: ",a.capacity]}),e.jsxs(y,{children:["Status: ",o.find(r=>r.value===a.status).label]}),e.jsxs(y,{children:["Driver:"," ",a.assignedDriver?`${a.assignedDriver.driverName} - ${a.assignedDriver.licenseNumber}`:"Not assigned"]}),e.jsxs(y,{children:["Fuel Type: ",a.fuelType]}),e.jsxs(y,{children:["Current Mileage: ",a.currentMileage]}),e.jsxs(I,{className:"d-flex justify-content-end mt-3",children:[e.jsx(ce,{vehicle:a,onUpdateVehicle:b}),f.includes(T)&&e.jsx(oe,{vehicle:a,onDeleteVehicle:N})]})]})]},a._id||c))}),u&&e.jsx(M,{color:"danger",className:"text-center justify-content-center",children:u})]})},ve=()=>{const[t,C]=n.useState([]),[v,N]=n.useState(!0),[b,p]=n.useState(null),d=async()=>{N(!0);try{const l=await Y.get("/api/v1/vehicle");l.status===200?(C(l.data.data),N(!1)):p(l.data.message)}catch(l){p(l.message)}finally{N(!1)}};n.useEffect(()=>{d()},[]);const T=l=>{C(s=>[...s,l])},f=l=>{C(s=>s.filter(h=>h._id!==l))},u=l=>{C(s=>s.map(h=>h._id===l._id?l:h),d())};return e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"text-center",children:"Vehicle Management"}),e.jsx(I,{className:"m-3",children:e.jsx(ie,{onAddVehicle:T})}),e.jsxs(le,{children:[e.jsx(y,{children:"Vehicle List"}),e.jsx(ne,{className:"md-3",children:e.jsx(de,{vehicle:t,error:b,onDeleteVehicle:f,onUpdateVehicle:u,loading:v})})]})]})};export{ve as default};
