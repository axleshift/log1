import{r as n,_ as ge,u as Fe,R as N,a as _,c as ee,P as S,b as qe,A as ne,j as e,k as je,m as K,B as Ee,E as Pe}from"./index-OS-NyFnD.js";import{F as te,n as Ve,v as Re,o as Be,h as ze,p as Oe,a as $e,w as He,q as Qe}from"./index-CPTnCzBI.js";import{C as Ge,a as E}from"./CButton-BwxQ32p8.js";import{C as he,a as ue,b as me,c as pe,d as ve}from"./CModalTitle-j_yCU1Vx.js";import{C as oe}from"./CAlert-BUN3_jXB.js";import{C as De}from"./CForm-MB4DKwRu.js";import{C as U}from"./CInputGroup-C2DGmx3N.js";import{C as J}from"./CFormSelect-DTvWQJhD.js";import{a as Se,b as Le,C as B}from"./CFormInput-D0wRZccJ.js";import{C as xe}from"./CCard-Cv2hjL78.js";import{C as Ce}from"./CCardHeader-BT2oH9PN.js";import{C as ie}from"./CCardBody-D8owufz_.js";import{C as Te,a as we,b as de,c as ae,d as Me,e as se}from"./CTable-ypv1XUTW.js";import{C as G}from"./CContainer-Dd87jvFf.js";import{C as Q,a as _e}from"./DefaultLayout-D3Rs_hW_.js";import{C as Ie}from"./CFormTextarea-UKKp2Wtv.js";import{C as Ue}from"./CInputGroupText-DjuVUOS1.js";import{C as Ke,a as Je,b as We,c as Xe}from"./CAccordionHeader-CReYz6km.js";import{C as Ye,a as fe}from"./CPaginationItem-6hp7qCqS.js";import{C as Ze,a as et,b as tt,c as at}from"./CTabList-CeAKI6nv.js";import"./index.esm-CCoMbGbm.js";import"./1-DlKV4AGn.js";import"./cil-user-Ddrdy7PS.js";import"./getTransitionDurationFromElement-Cpu4p4hx.js";var be=n.forwardRef(function(i,t){var h=i.className,v=i.button,T=i.feedback,I=i.feedbackInvalid,x=i.feedbackValid,P=i.floatingLabel,u=i.tooltipFeedback,y=i.hitArea,m=i.id,w=i.indeterminate,f=i.inline,p=i.invalid,c=i.label,q=i.reverse,A=i.type,R=A===void 0?"checkbox":A,F=i.valid,D=ge(i,["className","button","feedback","feedbackInvalid","feedbackValid","floatingLabel","tooltipFeedback","hitArea","id","indeterminate","inline","invalid","label","reverse","type","valid"]),M=n.useRef(null),o=Fe(t,M);n.useEffect(function(){M.current&&w&&(M.current.indeterminate=w)},[w,M.current]);var g=function(){return N.createElement("input",_({type:R,className:ee(v?"btn-check":"form-check-input",{"is-invalid":p,"is-valid":F,"me-2":y}),id:m},D,{ref:o}))},C=function(){return N.createElement(Le,{describedby:D["aria-describedby"],feedback:T,feedbackInvalid:I,feedbackValid:x,floatingLabel:P,invalid:p,tooltipFeedback:u,valid:F})},z=function(){var O;return N.createElement(Se,_({customClassName:ee(v?ee("btn",v.variant?"btn-".concat(v.variant,"-").concat(v.color):"btn-".concat(v.color),(O={},O["btn-".concat(v.size)]=v.size,O),"".concat(v.shape)):"form-check-label")},m&&{htmlFor:m}),c)},W=function(){return v?N.createElement(N.Fragment,null,N.createElement(g,null),c&&N.createElement(z,null),N.createElement(C,null)):c?y?N.createElement(N.Fragment,null,N.createElement(g,null),N.createElement(Se,_({customClassName:ee("form-check-label stretched-link",h)},m&&{htmlFor:m}),c),N.createElement(C,null)):N.createElement("div",{className:ee("form-check",{"form-check-inline":f,"form-check-reverse":q,"is-invalid":p,"is-valid":F},h)},N.createElement(g,null),N.createElement(z,null),N.createElement(C,null)):N.createElement(g,null)};return N.createElement(W,null)});be.propTypes=_({button:S.object,className:S.string,hitArea:S.oneOf(["full"]),id:S.string,indeterminate:S.bool,inline:S.bool,label:S.oneOfType([S.string,S.node]),reverse:S.bool,type:S.oneOf(["checkbox","radio"])},Le.propTypes);be.displayName="CFormCheck";var ye=n.forwardRef(function(i,t){var h,v=i.children,T=i.as,I=T===void 0?"ul":T,x=i.className,P=i.flush,u=i.layout,y=ge(i,["children","as","className","flush","layout"]);return N.createElement(I,_({className:ee("list-group",(h={"list-group-flush":P},h["list-group-".concat(u)]=u,h),x)},y,{ref:t}),v)});ye.propTypes={as:S.elementType,children:S.node,className:S.string,flush:S.bool,layout:S.oneOf(["horizontal","horizontal-sm","horizontal-md","horizontal-lg","horizontal-xl","horizontal-xxl"])};ye.displayName="CListGroup";var ke=n.forwardRef(function(i,t){var h,v=i.children,T=i.active,I=i.as,x=I===void 0?"li":I,P=i.className,u=i.disabled,y=i.color,m=ge(i,["children","active","as","className","disabled","color"]),w=x==="a"||x==="button"?Ge:x;return m=_(_(_(_({},(x==="a"||x==="button")&&{active:T,disabled:u,as:x,ref:t}),T&&{"aria-current":!0}),u&&{"aria-disabled":!0}),m),N.createElement(w,_({className:ee("list-group-item",(h={},h["list-group-item-".concat(y)]=y,h["list-group-item-action"]=x==="a"||x==="button",h.active=T,h.disabled=u,h),P)},m),v)});ke.propTypes={active:S.bool,as:S.elementType,children:S.node,className:S.string,color:qe,disabled:S.bool};ke.displayName="CListGroupItem";const st=({onAddMaintenance:i})=>{const{showError:t,showSuccess:h}=ne(),[v,T]=n.useState(!1),[I,x]=n.useState(null),[P,u]=n.useState(!1),[y,m]=n.useState(!1),w={vehicle:"",maintenanceType:"",startDate:"",expectedEndDate:"",description:"",priority:"",category:"",checklist:[{task:"",completed:!1}],parts:[]},[f,p]=n.useState(w),[c,q]=n.useState([]),[A,R]=n.useState({partName:"",quantity:""}),F=new Date().toISOString().split("T")[0],D=l=>{const{id:d,value:s}=l.target;p(r=>({...r,[d]:s}))},M=l=>{const{id:d,value:s}=l.target;R(r=>({...r,[d.split(".")[1]]:s}))},o=()=>{p(l=>({...l,parts:[...l.parts,{...A}]})),R({partName:"",quantity:""})};n.useEffect(()=>{(async()=>{try{const d=await K.get("api/v1/vehicle/all");d.data.success&&q(d.data.data)}catch(d){x(d),t(d.message)}})()},[]);const g=()=>{p(l=>({...l,checklist:[...l.checklist,{task:"",completed:!1}]}))},C=l=>{p(d=>({...d,parts:d.parts.filter((s,r)=>r!==l)}))},z=l=>{p(d=>({...d,checklist:d.checklist.filter((s,r)=>r!==l)}))},W=(l,d)=>{p(s=>({...s,checklist:s.checklist.map((r,j)=>j===l?{...r,task:d}:r)}))},O=[{label:"High",value:"High"},{label:"Medium",value:"Medium"},{label:"Low",value:"Low"},{label:"Critical",value:"Critical"}],le=[{label:"Engine",value:"Engine"},{label:"Transmission",value:"Transmission"},{label:"Brakes",value:"Brakes"},{label:"Electrical",value:"Electrical"},{label:"Tiers",value:"Tiers"},{label:"Other",value:"Other"}],re=[{label:"Preventive",value:"PMS"},{label:"Corrective",value:"Corrective"},{label:"Emergency",value:"Emergency"}],L=async l=>{var s,r,j,k;if(l.currentTarget.checkValidity()===!1)l.stopPropagation(),l.preDefault();else try{const b=await K.post("api/v1/maintenance/create",f);b.data.success&&(h(b.data.message),i(b.data.data),u(!1))}catch(b){t(((r=(s=b.response)==null?void 0:s.data)==null?void 0:r.message)||b.message),x(((k=(j=b.response)==null?void 0:j.data)==null?void 0:k.message)||b.message),setTimeout(()=>{x(null)},2e3)}m(!0)};return e.jsxs(e.Fragment,{children:[e.jsxs(E,{color:"primary",className:"mb-3",variant:"outline",onClick:()=>u(!0),children:[e.jsx(te,{icon:Ve})," Add Maintenance"]}),e.jsxs(he,{visible:P,onClose:()=>u(!1),size:"lg",children:[e.jsx(ue,{closeButton:!0,children:e.jsx(me,{children:"Add Maintenance"})}),I&&e.jsx(oe,{color:"danger",children:I}),e.jsx(pe,{children:e.jsxs(De,{className:"row g-3 needs-validation",noValidate:!0,validated:y,children:[e.jsxs(U,{children:[e.jsxs(J,{id:"vehicle",value:f.vehicle,onChange:D,floatingLabel:"Vehicle",placeholder:"Select Vehicle",required:!0,feedbackInvalid:"Please provide a valid vehicle.",children:[e.jsx("option",{value:"",children:"Select Vehicle"}),c.map(l=>e.jsxs("option",{value:l._id,children:[l.brand," / ",l.model," / ",l.regisNumber]},l._id))]}),e.jsx(J,{id:"maintenanceType",value:f.maintenanceType,onChange:D,floatingLabel:"Maintenance Type",placeholder:"Select Maintenance Type",required:!0,options:[{label:"Select Maintenance Type",value:""},...re],feedbackInvalid:"Please provide a valid maintenance type."}),e.jsx(B,{id:"description",type:"text",floatingLabel:"Description",placeholder:"Description",required:!0,value:f.description,onChange:D,feedbackInvalid:"Please provide a valid description."})]}),e.jsxs(U,{children:[e.jsx(B,{id:"startDate",type:"date",floatingLabel:"Start Date",placeholder:"Start Date",required:!0,min:F,value:f.startDate,onChange:D,feedbackInvalid:"Please provide a valid start date."}),e.jsx(B,{id:"expectedEndDate",type:"date",floatingLabel:"Expected End Date",placeholder:"Expected End Date",required:!0,min:F,value:f.expectedEndDate,onChange:D,feedbackInvalid:"Please provide a valid expected end date."}),e.jsxs(J,{id:"priority",value:f.priority,onChange:D,floatingLabel:"Priority",placeholder:"Select Priority",required:!0,feedbackInvalid:"Please provide a valid priority.",children:[e.jsx("option",{value:"",children:"Select Priority"}),O.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))]}),e.jsxs(J,{id:"category",value:f.category,onChange:D,floatingLabel:"Category",placeholder:"Select Category",required:!0,feedbackInvalid:"Please provide a valid category.",children:[e.jsx("option",{value:"",children:"Select Category"}),le.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))]})]}),e.jsxs(xe,{className:"mb-3",children:[e.jsx(Ce,{children:"Add Parts"}),e.jsxs(ie,{children:[e.jsxs(U,{className:"mb-3",children:[e.jsx(B,{id:"parts.partName",type:"text",floatingLabel:"Part Name",placeholder:"Part Name",value:A.partName,onChange:M}),e.jsx(B,{id:"parts.quantity",type:"number",floatingLabel:"Quantity",placeholder:"Quantity",value:A.quantity,onChange:M}),e.jsx(E,{color:"primary",onClick:o,children:"Add Part"})]}),f.parts.length>0&&e.jsxs(Te,{className:"",children:[e.jsx(we,{className:"text-center",children:e.jsxs(de,{children:[e.jsx(ae,{children:"Part Name"}),e.jsx(ae,{children:"Part Quantity"}),e.jsx(ae,{children:"Remove Part"})]})}),e.jsx(Me,{className:"text-center",children:f.parts.map((l,d)=>e.jsxs(de,{children:[e.jsx(se,{children:l.partName}),e.jsx(se,{children:l.quantity}),e.jsx(se,{children:e.jsx(E,{color:"danger",size:"sm",onClick:()=>C(d),children:"Remove"})})]},d))})]})]})]}),e.jsxs(G,{children:[e.jsx(Q,{children:"Checklist Items"}),e.jsx(E,{color:"primary",variant:"outline",className:"m-2",onClick:g,children:"Add Checklist Item"}),f.checklist.map((l,d)=>e.jsxs(U,{className:"mb-2",children:[e.jsx(B,{value:l.task,id:"itemCheckList",onChange:s=>W(d,s.target.value),placeholder:"Enter checklist item",required:!0}),e.jsx(E,{color:"danger",variant:"outline",onClick:()=>z(d),children:"Remove"})]},d))]}),e.jsx(Ie,{id:"notes",floatingLabel:"Notes",placeholder:"Notes",value:f.notes,onChange:D,autoComplete:"off",style:{minHeight:"150px",width:"100%",resize:"vertical"},text:" leave empty if no notes.",feedbackInvalid:"Please provide a valid notes."})]})}),e.jsxs(ve,{children:[e.jsx(E,{color:"secondary",variant:"outline",onClick:()=>u(!1),children:"Close"}),e.jsx(E,{color:"primary",variant:"outline",onClick:L,children:v?e.jsx(je,{size:"sm"}):"Add Maintenance"})]})]})]})},lt=({onCompleted:i,maintenance:t})=>{var u;const{showSuccess:h,showError:v}=ne(),T=Ee(),I=["admin","chief mechanic"];if(!t||!t.checklist)return null;const x=()=>{const y=new Date,m=new Date(t.startDate);return y<m},P=async y=>{var m,w;try{const f=Pe(),p=await K.patch(`api/v1/maintenance/complete/${y}`,{completedBy:f});p.data.success&&(h(p.data.message),i(p.data.data))}catch(f){const p=((w=(m=f.response)==null?void 0:m.data)==null?void 0:w.message)||"Error completing maintenance";v(p),console.error("Error completing maintenance:",f)}};return e.jsx(e.Fragment,{children:I.includes(T)&&e.jsxs(e.Fragment,{children:[e.jsx(E,{color:"success",variant:"outline",onClick:()=>P(t._id),disabled:!((u=t.checklist)!=null&&u.every(y=>y.completed))||x(),title:x()?"Maintenance cannot be completed before its start date":"",children:"Complete Maintenance"}),x()&&e.jsxs("div",{className:"text-danger mt-2",children:["This maintenance cannot be completed before"," ",new Date(t.startDate).toLocaleDateString()]})]})})},rt=({onUpdateMaintenance:i,maintenance:t,disabled:h})=>{const{showError:v,showSuccess:T}=ne(),[I,x]=n.useState(!1),[P,u]=n.useState(null),[y,m]=n.useState(!1),[w,f]=n.useState(!1),p={vehicle:t.vehicle||{},maintenanceType:(t==null?void 0:t.maintenanceType)||"",startDate:t!=null&&t.startDate?t.startDate.split("T")[0]:"",expectedEndDate:t!=null&&t.expectedEndDate?t.expectedEndDate.split("T")[0]:"",description:(t==null?void 0:t.description)||"",priority:(t==null?void 0:t.priority)||"",category:(t==null?void 0:t.category)||"",checklist:(t==null?void 0:t.checklist)||[],parts:(t==null?void 0:t.parts)||[],notes:(t==null?void 0:t.notes)||""},[c,q]=n.useState(p),[A,R]=n.useState([]),[F,D]=n.useState({partName:"",quantity:""}),M=new Date().toISOString().split("T")[0],o=s=>{const{id:r,value:j}=s.target;if(r==="vehicle"){const k=A.find(b=>b._id===j);q(b=>({...b,vehicle:k}))}else q(k=>({...k,[r]:j}))},g=s=>{const{id:r,value:j}=s.target,k=r.split(".")[1];D(b=>({...b,[k]:k==="quantity"?j===""?"":Number(j):j}))},C=()=>{if(!F.partName||!F.quantity){v("Please fill in both part name and quantity");return}q(s=>({...s,parts:[...s.parts,{...F}]})),D({partName:"",quantity:""})};n.useEffect(()=>{(async()=>{try{const r=await K.get("api/v1/vehicle/all");r.data.success&&R(r.data.data)}catch(r){u(r),v(r.message)}})()},[]);const z=()=>{q(s=>({...s,checklist:[...s.checklist,{task:"",completed:!1}]}))},W=s=>{q(r=>({...r,parts:r.parts.filter((j,k)=>k!==s)}))},O=s=>{q(r=>({...r,checklist:r.checklist.filter((j,k)=>k!==s)}))},le=(s,r)=>{q(j=>({...j,checklist:j.checklist.map((k,b)=>b===s?{...k,task:r}:k)}))},re=[{label:"High",value:"High"},{label:"Medium",value:"Medium"},{label:"Low",value:"Low"},{label:"Critical",value:"Critical"}],L=[{label:"Engine",value:"Engine"},{label:"Transmission",value:"Transmission"},{label:"Brakes",value:"Brakes"},{label:"Electrical",value:"Electrical"},{label:"Tiers",value:"Tiers"},{label:"Other",value:"Other"}],l=[{label:"Preventive",value:"PMS"},{label:"Corrective",value:"Corrective"},{label:"Emergency",value:"Emergency"}],d=async s=>{var j,k,b,ce;s.preventDefault();const r=s.currentTarget;if(f(!0),r.checkValidity()===!1){s.stopPropagation();return}x(!0);try{const H=await K.put(`api/v1/maintenance/update/${t._id}`,c);H.data.success&&(T(H.data.message),i(H.data.data),m(!1))}catch(H){v(((k=(j=H.response)==null?void 0:j.data)==null?void 0:k.message)||H.message),u(((ce=(b=H.response)==null?void 0:b.data)==null?void 0:ce.message)||H.message),setTimeout(()=>{u(null)},2e3)}finally{x(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(E,{color:"primary",className:"me-1 unset",variant:"outline",onClick:()=>m(!0),disabled:h,children:h?e.jsx(te,{icon:Re}):e.jsx(te,{icon:Be})}),e.jsxs(he,{visible:y,onClose:()=>m(!1),size:"lg",children:[e.jsx(ue,{closeButton:!0,children:e.jsx(me,{children:"Update Maintenance"})}),P&&e.jsx(oe,{color:"danger",children:P}),e.jsx(pe,{children:e.jsxs(De,{className:"row g-3 needs-validation",noValidate:!0,validated:w,children:[e.jsxs(U,{children:[e.jsx(J,{id:"vehicle",floatingLabel:"Vehicle",placeholder:"Select Vehicle",required:!0,value:c.vehicle?c.vehicle._id:"",onChange:o,feedbackInvalid:"Please provide a valid vehicle.",disabled:!0,children:e.jsx("option",{value:"",children:`${t.vehicle.brand} / ${t.vehicle.model} / ${t.vehicle.regisNumber}`})}),e.jsx(J,{id:"maintenanceType",value:c.maintenanceType||"",onChange:o,floatingLabel:"Maintenance Type",placeholder:"Select Maintenance Type",required:!0,options:[{label:"Select Maintenance Type",value:""},...l],feedbackInvalid:"Please provide a valid maintenance type."}),e.jsx(B,{id:"description",type:"text",floatingLabel:"Description",placeholder:"Description",required:!0,value:c.description,onChange:o,feedbackInvalid:"Please provide a valid description."})]}),e.jsxs(U,{children:[e.jsx(B,{id:"startDate",type:"date",floatingLabel:"Start Date",placeholder:"Start Date",required:!0,min:M,value:c.startDate,onChange:o,feedbackInvalid:"Please provide a valid start date."}),e.jsx(B,{id:"expectedEndDate",type:"date",floatingLabel:"Expected End Date",placeholder:"Expected End Date",required:!0,min:M,value:c.expectedEndDate,onChange:o,feedbackInvalid:"Please provide a valid expected end date."}),e.jsxs(J,{id:"priority",value:c.priority||"",onChange:o,floatingLabel:"Priority",placeholder:"Select Priority",required:!0,feedbackInvalid:"Please provide a valid priority.",children:[e.jsx("option",{value:"",children:"Select Priority"}),re.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),e.jsxs(J,{id:"category",value:c.category,onChange:o,floatingLabel:"Category",placeholder:"Select Category",required:!0,feedbackInvalid:"Please provide a valid category.",children:[e.jsx("option",{value:"",children:"Select Category"}),L.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]})]}),e.jsxs(xe,{className:"mb-3",children:[e.jsx(Ce,{children:"Add Parts"}),e.jsxs(ie,{children:[e.jsxs(U,{className:"mb-3",children:[e.jsx(B,{id:"parts.partName",type:"text",floatingLabel:"Part Name",placeholder:"Part Name",value:F.partName||"",onChange:g}),e.jsx(B,{id:"parts.quantity",type:"number",floatingLabel:"Quantity",placeholder:"Quantity",value:F.quantity||"",onChange:g}),e.jsx(E,{color:"primary",onClick:C,children:"Add Part"})]}),c.parts.length>0&&e.jsxs(Te,{className:"",children:[e.jsx(we,{className:"text-center",children:e.jsxs(de,{children:[e.jsx(ae,{children:"Part Name"}),e.jsx(ae,{children:"Part Quantity"}),e.jsx(ae,{children:"Remove Part"})]})}),e.jsx(Me,{className:"text-center",children:c.parts.map((s,r)=>e.jsxs(de,{children:[e.jsx(se,{children:s.partName}),e.jsx(se,{children:s.quantity}),e.jsx(se,{children:e.jsx(E,{color:"danger",size:"sm",onClick:()=>W(r),children:"Remove"})})]},r))})]})]})]}),e.jsxs(G,{children:[e.jsx(Q,{children:"Checklist Items"}),e.jsx(E,{color:"primary",variant:"outline",className:"m-2",onClick:z,children:"Add Checklist Item"}),c.checklist.map((s,r)=>e.jsxs(U,{className:"mb-2",children:[e.jsx(B,{value:s.task,id:"itemCheckList",onChange:j=>le(r,j.target.value),placeholder:"Enter checklist item",required:!0}),e.jsx(E,{color:"danger",variant:"outline",onClick:()=>O(r),children:"Remove"})]},r))]}),e.jsx(Ie,{id:"notes",floatingLabel:"Notes",placeholder:"Notes",value:c.notes,onChange:o,autoComplete:"off",style:{minHeight:"150px",width:"100%",resize:"vertical"},text:" leave empty if no notes.",feedbackInvalid:"Please provide a valid notes."})]})}),e.jsxs(ve,{children:[e.jsx(E,{color:"secondary",variant:"outline",onClick:()=>m(!1),children:"Close"}),e.jsx(E,{color:"primary",variant:"outline",onClick:d,children:I?e.jsx(je,{size:"sm"}):"Update Maintenance"})]})]})]})},it=({onDeleteMaintenance:i,onUpdateMaintenance:t,maintenance:h,onCompleted:v,vehicles:T,loading:I,error:x,selectedMaintenanceId:P})=>{const u=Ee(),{showError:y,showSuccess:m}=ne(),w=["admin","chief mechanic"],[f,p]=n.useState(null),[c,q]=n.useState(""),[A,R]=n.useState([]),[F,D]=n.useState(!1),[M,o]=n.useState(1),[g]=n.useState(10),C=M*g,z=C-g,W=A.slice(z,C),O=Math.ceil(A.length/g),[le,re]=n.useState(""),[L,l]=n.useState({checklist:[]}),[d,s]=n.useState(!0);n.useEffect(()=>{P&&(re(P.toString()),setTimeout(()=>{const a=document.getElementById(`maintenance-${P}`);a&&a.scrollIntoView({behavior:"smooth",block:"center"})},100))},[P]),n.useEffect(()=>{R(h)},[h]);const r=a=>{l(a),D(!0)},j=()=>{l(null),D(!1)},k=async(a,$)=>{var V,X;try{const Y=Pe(),Z=await K.patch(`api/v1/maintenance/${a}/checklist/${$}`,{completedBy:Y});Z.data.success&&(R(Ae=>Ae.map(Ne=>Ne._id===a?Z.data.data:Ne)),(L==null?void 0:L._id)===a&&l(Z.data.data),m(Z.data.message))}catch(Y){console.error("Error updating checklist:",Y),y(((X=(V=Y.response)==null?void 0:V.data)==null?void 0:X.message)||"Error updating checklist item")}},b=a=>a?`${a.brand||""} ${a.model||""} ${a.regisNumber||""}`.trim():"N/A";n.useEffect(()=>{(()=>{if(o(1),c==="")R(h);else{const $=h.filter(V=>{var X,Y,Z;return((X=V.vehicle)==null?void 0:X.regisNumber.toLowerCase().includes(c.toLowerCase()))||((Y=V.vehicle)==null?void 0:Y.brand.toLowerCase().includes(c.toLowerCase()))||((Z=V.vehicle)==null?void 0:Z.model.toLowerCase().includes(c.toLowerCase()))||V.maintenanceType.toLowerCase().includes(c.toLowerCase())||V.priority.toLowerCase().includes(c.toLowerCase())||V.status.toLowerCase().includes(c.toLowerCase())});R($),$.length===0?p("No vehicles found"):p(null)}})()},[c,h]);const ce=a=>{switch(a){case"Completed":return"green";case"Scheduled":return"orange";case"In Progress":return"yellow";default:return"black"}},H=[{value:"Completed",label:"Completed"},{value:"Scheduled",label:"Scheduled"},{value:"In Progress",label:"In Progress"}];return e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"mt-3",children:e.jsxs(U,{className:"mb-3",children:[e.jsx(B,{type:"text",placeholder:"Search",id:"search",value:c,onChange:a=>q(a.target.value)}),e.jsx(Ue,{children:e.jsx(te,{icon:ze})})]})}),e.jsx(Ke,{activeItemKey:le||void 0,className:"m-2",children:W.map((a,$)=>e.jsxs(Je,{itemKey:a._id.toString(),id:`maintenance-${a._id}`,children:[e.jsxs(We,{className:"d-flex justify-content-between",children:[e.jsx(G,{children:e.jsxs("ul",{className:"list-unstyled",children:[e.jsxs("li",{children:["Vehicle: ",e.jsx("strong",{children:b(a.vehicle)})]}),e.jsxs("li",{children:["Priority: ",e.jsx("strong",{children:a.priority||"N/A"})]})]})}),e.jsxs(G,{className:"d-flex justify-content-end",children:[e.jsx(te,{icon:Oe,color:ce(a.status),className:"m-2 float-end"}),e.jsx("small",{className:"m2 float-end",children:H.find(V=>V.value===a.status).label})]})]}),e.jsxs(Xe,{children:[e.jsxs(Q,{children:["Maintenance Type: ",a.maintenanceType||"N/A"]}),e.jsxs(Q,{children:["Start Date:"," ",a.startDate?new Date(a.startDate).toLocaleDateString():"N/A"]}),e.jsxs(Q,{children:["Expected Date:"," ",a.expectedEndDate?new Date(a.expectedEndDate).toLocaleDateString():"N/A"]}),e.jsxs(Q,{children:["Description: ",a.description||"N/A"]}),e.jsxs(Q,{children:["Category: ",a.category||"N/A"]}),e.jsxs(Q,{children:["Notes: ",a.notes||"N/A"]}),e.jsxs(Q,{children:["Completed By: ",a.completedBy||"N/A"]}),e.jsxs(xe,{className:"mt-3",children:[e.jsx(Ce,{children:e.jsx("strong",{children:"Parts Required"})}),e.jsx(ie,{children:a.parts&&a.parts.length>0?e.jsx(e.Fragment,{children:e.jsx(ye,{children:a.parts.map((V,X)=>e.jsxs(ke,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("div",{children:e.jsx("strong",{children:V.partName})}),e.jsx("div",{className:"d-flex gap-3",children:e.jsxs($e,{color:"primary",children:["Qty: ",V.quantity]})})]},X))})}):e.jsx(oe,{color:"info",children:"No parts listed for this maintenance"})})]}),e.jsxs(G,{className:"d-flex justify-content-end mt-3",children:[w.includes(u)&&e.jsx(rt,{maintenance:a,onUpdateMaintenance:t,vehicles:T,disabled:a.status==="Completed"}),e.jsx(E,{color:"primary",className:"m-1",variant:"outline",onClick:()=>r(a),children:e.jsx(te,{icon:He})}),e.jsx(E,{color:"danger",className:"m-1",variant:"outline",onClick:()=>i(a._id),children:e.jsx(te,{icon:Qe})})]})]})]},a._id))}),A.length>0&&e.jsxs(G,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs(G,{children:["Showing ",z+1," to ",Math.min(C,A.length)," ","of ",A.length," entries"]}),e.jsxs(Ye,{className:"mt-3",children:[e.jsx(fe,{disabled:M===1,onClick:()=>o(a=>Math.max(a-1,1)),children:"Previous"}),Array.from({length:O},(a,$)=>$+1).map(a=>e.jsx(fe,{active:a===M,onClick:()=>o(a),children:a},a)),e.jsx(fe,{disabled:M===O,onClick:()=>o(a=>Math.min(a+1,O)),children:"Next"})]})]}),f&&e.jsx(oe,{color:"danger",children:f}),e.jsxs(he,{visible:F,onClose:j,size:"lg",children:[e.jsx(ue,{children:e.jsxs(me,{children:["Maintenance Checklist - ",b(L==null?void 0:L.vehicle)]})}),e.jsx(pe,{children:L!=null&&L.checklist&&L.checklist.length>0?e.jsx("div",{className:"checklist-container",children:e.jsx("ul",{className:"list-group",children:L.checklist.map((a,$)=>e.jsxs("li",{className:"list-group-item d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx(be,{type:"checkbox",id:`checkBoxList-${$}`,checked:a.completed,onChange:()=>k(L._id,$),disabled:!w.includes(u)||L.status==="Completed",className:"me-2"})," ",a.task]}),a.completed&&e.jsxs("small",{className:"text-muted",children:["Completed by: ",a.completedBy," at"," ",new Date(a.completedAt).toLocaleString()]})]},$))})}):e.jsx("p",{className:"text-center",children:"No checklist items available"})}),e.jsxs(ve,{children:[L&&e.jsx(lt,{maintenance:L,isLoading:d,onCompleted:v,disabled:!w.includes(u)}),e.jsx(E,{color:"secondary",onClick:j,children:"Close"})]})]})]})},wt=()=>{var M;const[i,t]=n.useState([]),[h,v]=n.useState([]),[T,I]=n.useState(!0),[x,P]=n.useState(null),{showError:u,showSuccess:y}=ne(),[m,w]=n.useState(((M=location.state)==null?void 0:M.selectedMaintenanceId)||null),[f,p]=n.useState(!1),c=async()=>{var o,g;I(!0);try{const[C,z]=await Promise.all([K.get("/api/v1/maintenance/all"),K.get("/api/v1/vehicle")]);t(C.data.data),v(z.data.date)}catch(C){P(C.message),u(((g=(o=C.response)==null?void 0:o.data)==null?void 0:g.message)||"Error fetching data")}finally{I(!1)}};if(n.useEffect(()=>{c()},[]),T)return e.jsx(je,{color:"primary",size:"sm",children:"Loading..."});const q=o=>{w(o),p(!0)},A=async()=>{try{await K.delete(`/api/v1/maintenance/delete/${m}`),t(o=>o.filter(g=>g._id!==m)),y("Maintenance deleted successfully"),p(!1)}catch(o){u(o.response.data.message)}finally{p(!1)}},R=o=>{t(g=>[...g,o]),c()},F=o=>{t(g=>g.map(C=>C._id===o._id?o:C)),c()},D=o=>{t(g=>g.map(C=>C._id===o._id?o:C)),c()};return e.jsxs(e.Fragment,{children:[e.jsxs(G,{children:[e.jsx(Q,{children:"Maintenance Management"}),e.jsx(xe,{children:e.jsxs(ie,{children:[e.jsx(G,{children:e.jsx(st,{onAddMaintenance:R})}),e.jsxs(Ze,{activeItemKey:"Maintenance List",children:[e.jsx(et,{variant:"tabs",children:e.jsx(tt,{itemKey:"Maintenance List",children:"Maintenance List"})}),e.jsx(_e,{children:e.jsx(at,{itemKey:"Maintenance List",children:e.jsx(ie,{className:"md-3",children:e.jsx(it,{vehicles:h,maintenance:i,onCompleted:F,error:x,onDeleteMaintenance:q,onUpdateMaintenance:D,loading:T,selectedMaintenanceId:m})})})})]})]})})]}),e.jsxs(he,{visible:f,onClose:()=>p(!1),alignment:"center",children:[e.jsx(ue,{children:e.jsx(me,{children:"Delete Maintenance"})}),e.jsx(pe,{children:"Are you sure you want to delete this maintenance?"}),e.jsxs(ve,{children:[e.jsx(E,{color:"secondary",variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsx(E,{color:"danger",variant:"outline",onClick:A,children:"Delete"})]})]})]})};export{wt as default};
