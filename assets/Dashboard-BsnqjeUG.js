import{m as v,r as a,A as p,j as t,k as S}from"./index-BQNKW3Oi.js";import{C as O,W as R}from"./WidgetsDropdown-IfIZAHZR.js";import{C as j,a as m}from"./CRow-CfHzwP2N.js";import{C as T}from"./CCard-DLIXfnJP.js";import{C as $}from"./CCardHeader-BRSn3l6W.js";import{C as D}from"./CFormInput-DT3Aafzt.js";import{C as H}from"./CFormSelect-B66-L5-O.js";import{C as P}from"./CCardBody--fyyd1pn.js";import{C as L}from"./CAlert-m8lQ_dLd.js";import"./index.esm-abRcLFOT.js";import"./DefaultLayout-UGwOVka3.js";import"./CButton-CDTCjSee.js";import"./CContainer-Cx55YM07.js";import"./1-D9IfqWlz.js";import"./cil-user-Ddrdy7PS.js";import"./index-Bl5PiANI.js";const W=()=>{const b=v(),[s,f]=a.useState([]),[c,h]=a.useState(new Date(new Date().setMonth(new Date().getMonth()-1)).toISOString().split("T")[0]),[n,d]=a.useState(new Date().toISOString().split("T")[0]),[o,C]=a.useState(""),[i,g]=a.useState([]),[N,x]=a.useState(!0),[A,y]=a.useState(!1);a.useEffect(()=>{F(),E()},[c,n,o]);const E=async()=>{try{const e=await p.get("/api/v1/vehicle");g(e.data.data||[])}catch(e){console.error("Error fetching vehicles:",e)}},F=async()=>{try{x(!0);const e={startDate:c,endDate:n,...o&&{vehicleId:o}},l=await p.get("/api/v1/fuelLogs/fuel-logs/analytics",{params:e});f(l.data.data||[])}catch(e){console.error("Error fetching analytics:",e),f([])}finally{x(!1)}},w=e=>new Date(e).toLocaleDateString(),k=e=>{if(!(e!=null&&e.vehicleDetails))return"Unknown Vehicle";const{brand:l="",model:r="",regisNumber:u=""}=e.vehicleDetails;return`${l} ${r}${u?` (${u})`:""}`},I=()=>{if(!s||s.length===0)return null;if(o&&s.length===1){const e=s[0];if(!(e!=null&&e.fuelLogs))return null;const l=[...e.fuelLogs].sort((r,u)=>new Date(r.date)-new Date(u.date));return{labels:l.map(r=>w(r.date)),datasets:[{label:"Fuel Consumption (L)",data:l.map(r=>r.fuelQuantity||0),borderColor:"#321fdb",backgroundColor:"rgba(50, 31, 219, 0.1)",fill:!0,tension:.4},{label:"Cost",data:l.map(r=>r.totalCost||0),borderColor:"#2eb85c",backgroundColor:"rgba(46, 184, 92, 0.1)",fill:!0,tension:.4,yAxisID:"cost"},{label:"Efficiency (L/100km)",data:l.map(r=>parseFloat(r.litersPer100km)||0),borderColor:"#f9b115",backgroundColor:"rgba(249, 177, 21, 0.1)",fill:!0,tension:.4,yAxisID:"efficiency"}]}}else return{labels:s.map(e=>k(e)),datasets:[{label:"Total Fuel Consumption (L)",data:s.map(e=>e.totalFuelConsumption||0),borderColor:"#321fdb",backgroundColor:"rgba(50, 31, 219, 0.1)",fill:!0,tension:.4},{label:"Total Cost ",data:s.map(e=>e.totalCost||0),borderColor:"#2eb85c",backgroundColor:"rgba(46, 184, 92, 0.1)",fill:!0,tension:.4,yAxisID:"cost"},{label:"Average Efficiency (L/100km)",data:s.map(e=>e.averageEfficiency||0),borderColor:"#f9b115",backgroundColor:"rgba(249, 177, 21, 0.1)",fill:!0,tension:.4,yAxisID:"efficiency"}]}},V={responsive:!0,interaction:{mode:"index",intersect:!1},plugins:{legend:{position:"top"},title:{display:!0,text:o?"Vehicle Performance Over Time":"Vehicles Comparison"}},scales:{y:{type:"linear",display:!0,position:"left",title:{display:!0,text:"Fuel Consumption (L)"}},cost:{type:"linear",display:!0,position:"right",title:{display:!0,text:"Cost "},grid:{drawOnChartArea:!1}},efficiency:{type:"linear",display:!0,position:"right",title:{display:!0,text:"Efficiency (L/100km)"},grid:{drawOnChartArea:!1}}},maintainAspectRatio:!1},M=()=>{b("/fleetManagement/FuelManagement")};return t.jsx(j,{children:t.jsx(m,{xs:12,children:t.jsxs(T,{className:"mb-4",children:[t.jsxs($,{children:[t.jsxs("h4",{onClick:M,onMouseEnter:()=>y(!0),onMouseLeave:()=>y(!1),style:{cursor:"pointer",color:A?"grey":"inherit"},children:[" ","Fuel Analytics Dashboard"]}),t.jsxs(j,{className:"mt-3",children:[t.jsx(m,{md:4,children:t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"form-label",htmlFor:"startDate",children:"Start Date"}),t.jsx(D,{type:"date",id:"startDate",value:c,onChange:e=>h(e.target.value)})]})}),t.jsx(m,{md:4,children:t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"form-label",htmlFor:"endDate",children:"End Date"}),t.jsx(D,{type:"date",id:"endDate",value:n,onChange:e=>d(e.target.value)})]})}),t.jsx(m,{md:4,children:t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"form-label",htmlFor:"vehicleId",children:"Vehicle"}),t.jsxs(H,{value:o,id:"vehicleId",onChange:e=>C(e.target.value),children:[t.jsx("option",{value:"",children:"All Vehicles"}),i.map(e=>t.jsxs("option",{value:e._id,children:[e.brand," ",e.model," - ",e.regisNumber]},e._id))]})]})})]})]}),t.jsx(P,{children:N?t.jsx("div",{className:"text-center",children:t.jsx(S,{})}):t.jsx("div",{style:{height:"400px"},children:s.length>0?t.jsx(O,{type:"line",style:{height:"400px"},data:I(),options:V}):t.jsx(L,{color:"danger",className:"text-center",children:"No data available"})})})]})})})},re=()=>{v();const[b,s]=a.useState([]),[f,c]=a.useState([]),[h,n]=a.useState(!0),[d,o]=a.useState(null);return a.useEffect(()=>{(async()=>{try{n(!0);const[i,g]=await Promise.all([p.get("/api/v1/fuelLogs/fuel-logs"),p.get("/api/v1/vehicle/in-use")]);s(i.data.data),c(g.data.data)}catch(i){o(i.message),console.error("Error fetching dashboard data:",i)}finally{n(!1)}})()},[]),h?t.jsxs(S,{size:"sm",color:"primary",children:["AI analysing Fuel data logs"," "]}):d?t.jsxs(L,{color:"danger",children:["Error: ",d]}):t.jsxs(t.Fragment,{children:[t.jsx(R,{className:"mb-4"}),t.jsx(W,{})]})};export{re as default};
