import{r as a,A as je,j as e,k as U,n as ae,l as ge,m as fe,F as ne}from"./index-DZGJCuOe.js";import{F as G,k as ce,a as H,m as pe}from"./index-DIgmdPjR.js";import{C as T}from"./CAlert-i-kAMGLS.js";import{C as F}from"./CContainer-B22YzjYV.js";import{C as z}from"./CInputGroup-tUN_7Qvq.js";import{C as Y}from"./CFormInput-EZtn8AIz.js";import{C as J}from"./CInputGroupText-DNXsQkNt.js";import{C as ie,a as le,b as oe,c as de}from"./CAccordionHeader-Cfk_IHyc.js";import{C as he,a as ue,b as B,c as q,d as xe,e as O}from"./CTable-mcEyLhtI.js";import{C as X,a as E}from"./CPaginationItem-CvIbgu0h.js";import{C as Ne,a as ye,b as $,c as V}from"./CTabList-p-cg4h3o.js";import{a as Ce,C as re}from"./DefaultLayout-DHRMbFo0.js";import{C as te}from"./CCard-BTZAUdul.js";import"./CButton-BnfWto-e.js";import"./getTransitionDurationFromElement-Cpu4p4hx.js";import"./index.esm-3_8T6ype.js";import"./1-tsU9Z8VM.js";import"./cil-user-Ddrdy7PS.js";const ve=({warehousing:m,loading:_,error:w,onDeleteItem:L,onUpdateItem:D})=>{const[g,b]=a.useState([]),[S,N]=a.useState(null),[f,C]=a.useState("");je();const[p,v]=a.useState(1),[o]=a.useState(10),[n,d]=a.useState([]),A=Math.ceil(g.length/o),W=g.filter(r=>r.received===!0),k=p*o,t=k-o,x=W.slice(t,k);a.useEffect(()=>{try{if(f===""){b(m),N(null);return}const r=f.toLowerCase().trim(),h=m.filter(s=>{var c,j,i,u,I,P,M,R,Q;try{return((c=s.poNumber)==null?void 0:c.toLowerCase().includes(r))||((i=(j=s.vendor)==null?void 0:j.businessName)==null?void 0:i.toLowerCase().includes(r))||((I=(u=s.vendor)==null?void 0:u.businessAddress)==null?void 0:I.toLowerCase().includes(r))||((M=(P=s.vendor)==null?void 0:P.contactNumber)==null?void 0:M.includes(r))||s.orderDate&&new Date(s.orderDate).toLocaleDateString().includes(r)||s.dateOfReceived&&new Date(s.receiveDate).toLocaleDateString().includes(r)||((R=l(s.warehouseId))==null?void 0:R.toLowerCase().includes(r))||((Q=s.details)==null?void 0:Q.some(K=>{var Z,ee,se;return((Z=K.description)==null?void 0:Z.toLowerCase().includes(r))||((ee=K.quantity)==null?void 0:ee.toString().includes(r))||((se=K.unitPrice)==null?void 0:se.toString().includes(r))}))}catch(K){return console.error("Error filtering item:",K),!1}});b(h),v(1),h.length===0?N("No data found"):N(null)}catch(r){console.error("Error in search effect:",r),N("Error occurred while searching")}},[f,m]),a.useEffect(()=>{(async()=>{var h;try{const s=await ae.get("/api/v1/warehouseLoc/locations");s.data.data&&d(s.data.data)}catch(s){N((h=s==null?void 0:s.response)==null?void 0:h.data.message)}})()},[]);const l=r=>{if(!n.length)return"Loading...";const h=n.find(s=>s._id===r);return h?h.warehouseName:"Unknown Warehouse"},y=r=>{C(r.target.value)};return _?e.jsx(U,{color:"primary",className:"mt-5 w-15 mx-auto justify-content-center"}):m.length===0?e.jsx(T,{color:"warning",className:"text-center mt-5 w-75 mx-auto",children:"No data available"}):w?e.jsxs(T,{color:"danger",className:"text-center mt-5 w-75 mx-auto",children:["Error: ",w.message]}):e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"mt-3",children:e.jsxs(z,{className:"w-50 mb-3",children:[e.jsx(Y,{type:"text",placeholder:"Search by PO Number, Vendor, or Products...",value:f,id:"searchItem",onChange:y}),e.jsx(J,{children:e.jsx(G,{icon:ce})})]})}),_?e.jsx(U,{color:"primary",className:"mt-5 w-15 mx-auto justify-content-center"}):m.length===0?e.jsx(T,{color:"warning",className:"text-center mt-5 w-75 mx-auto",children:"No data available"}):e.jsxs(e.Fragment,{children:[S&&e.jsx(T,{color:"danger",className:"text-center mt-5 w-75 mx-auto",children:S}),e.jsx(ie,{className:"m-2",children:x.filter(r=>r.received).map(r=>e.jsxs(le,{children:[e.jsx(oe,{children:e.jsxs("div",{className:"d-flex justify-content-between w-100 align-items-center",children:[e.jsx("div",{children:e.jsxs("ul",{className:"list-unstyled",children:[e.jsxs("li",{children:["PO Number: ",e.jsx("strong",{children:r.poNumber})]}),e.jsxs("li",{children:["Warehuse Location:"," ",e.jsx("strong",{children:l(r.warehouse_id)})]})]})}),e.jsxs("div",{className:"text-medium-emphasis",children:["Order Date: ",new Date(r.orderDate).toLocaleDateString()]})]})}),e.jsxs(de,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{children:"Vendor Information"}),e.jsxs("div",{className:"ms-3",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Name:"})," ",r.vendor.businessName]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Address:"})," ",r.vendor.businessAddress]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Contact:"})," ",r.vendor.contactNumber]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{children:"Shipping Details"}),e.jsxs("div",{className:"ms-3",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Carrier:"})," ",r.carrier]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Expected Delivery Date:"})," ",new Date(r.receiveDate).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{children:"Products"}),e.jsxs(he,{responsive:!0,small:!0,className:"mt-2",children:[e.jsx(ue,{children:e.jsxs(B,{children:[e.jsx(q,{children:"Description"}),e.jsx(q,{children:"Quantity"})]})}),e.jsx(xe,{children:r.details.map((h,s)=>e.jsxs(B,{children:[e.jsx(O,{children:h.description}),e.jsx(O,{children:h.quantity})]},s))})]})]}),r.additionalNotes&&e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{children:"Additional Notes"}),e.jsx("div",{className:"ms-3",children:r.additionalNotes})]})]})]},r._id))}),x.length>0&&e.jsxs(F,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:["Showing ",W.length>0?t+1:0," to"," ",Math.min(k,W.length)," of ",W.length," received entries"]}),e.jsxs(X,{className:"mt-3",children:[e.jsx(E,{disabled:p===1,onClick:()=>v(r=>Math.max(r-1,1)),children:"Previous"}),Array.from({length:A},(r,h)=>h+1).map(r=>e.jsx(E,{active:r===p,onClick:()=>v(r),children:r},r)),e.jsx(E,{disabled:p===A,onClick:()=>v(r=>Math.min(r+1,A)),children:"Next"})]})]})]})]})},we=({items:m,loading:_,error:w})=>{const[L,D]=a.useState([]),[g,b]=a.useState(""),[S,N]=a.useState(null),f=10,[C,p]=a.useState(1),v=t=>{switch(t){case"Stocked":return"success";case"Out of Stock":return"danger";default:return"secondary"}};a.useEffect(()=>{D(m)},[m]),a.useEffect(()=>{if(g==="")D(m),N(null);else{const t=m.filter(x=>{const l=x.itemName.toLowerCase().includes(g.toLowerCase()),y=x.locations.some(r=>{const h=r.warehouse;return h.warehouseName.toLowerCase().includes(g.toLowerCase())||h.address.toLowerCase().includes(g.toLowerCase())});return l||y});D(t),p(1),t.length===0?N("No results found"):N(null)}},[g,m]);const o=t=>{b(t.target.value)},n=t=>{if(!t||!Array.isArray(t))return[];const x=new Map;return t.forEach(l=>{if(!(l!=null&&l.warehouse))return;const y=l.warehouse._id||"deleted";if(!x.has(y))x.set(y,{warehouse:{...l.warehouse,deleted:l.warehouse.deleted||!l.warehouse._id},quantity:l.quantity||0});else{const r=x.get(y);r.quantity+=l.quantity||0,x.set(y,r)}}),Array.from(x.values())};if(_)return e.jsx(U,{color:"primary",className:"text-center mt-5 w-75 mx-auto justify-content-center"});if(w)return e.jsxs(T,{color:"danger",className:"text-center mt-5 w-75 mx-auto justify-content-center",children:["Error: ",w]});const d=C*f,A=d-f,W=L.slice(A,d),k=Math.ceil(L.length/f);return e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"m-3",children:e.jsxs(z,{className:"w-50 mb-3",children:[e.jsx(Y,{type:"text",id:"search",value:g,onChange:o,placeholder:"Search by item name or warehouse..."}),e.jsx(J,{children:e.jsx(G,{icon:ce})})]})}),e.jsxs("strong",{className:"m-3 align-self-start",children:["Total Items: ",W.length]}),S?e.jsx(T,{color:"warning",children:S}):e.jsxs(he,{hover:!0,responsive:!0,striped:!0,className:"text-center",children:[e.jsx(ue,{children:e.jsxs(B,{children:[e.jsx(q,{scope:"col",children:"Item Name"}),e.jsx(q,{scope:"col",children:"Total Quantity"}),e.jsx(q,{scope:"col",children:"Warehouse Locations"}),e.jsx(q,{scope:"col",children:"Status"})]})}),e.jsx(xe,{children:W.map((t,x)=>e.jsxs(B,{children:[e.jsx(O,{children:t.itemName}),e.jsx(O,{children:e.jsx("strong",{children:t.quantity})}),e.jsx(O,{children:e.jsx(F,{className:"locations-list",children:n(t.locations).map((l,y)=>{const r=l.warehouse;return e.jsx(F,{className:"location-item",children:e.jsxs(F,{className:"location-details",children:[e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("span",{className:"warehouse-name",children:(r==null?void 0:r.warehouseName)||"Unknown Warehouse"}),e.jsx(H,{color:r!=null&&r.deleted?"danger":"success",className:"ms-2",children:r!=null&&r.deleted?"Deleted":"Active"})]}),e.jsx("span",{className:"warehouse-address",children:(r==null?void 0:r.address)||"No address available"}),e.jsxs("span",{className:"quantity-badge",children:["Qty: ",l.quantity]})]})},(r==null?void 0:r._id)||`deleted-${y}`)})})}),e.jsx(O,{children:e.jsx(H,{color:v(t.status||(t.quantity>0?"Stocked":"Out of Stock")),children:t.status||(t.quantity>0?"Stocked":"Out of Stock")})})]},t._id||x))})]}),L.length===0&&!S&&e.jsx(T,{color:"warning",className:"text-center mt-5 w-75 mx-auto",children:"No items found."}),e.jsxs(X,{align:"center",children:[e.jsx(E,{disabled:C===1,onClick:()=>p(t=>Math.max(t-1,1)),children:"Previous"}),[...Array(k).keys()].map(t=>e.jsx(E,{active:t+1===C,onClick:()=>p(t+1),children:t+1},t+1)),e.jsx(E,{disabled:C===k,onClick:()=>p(t=>Math.min(t+1,k)),children:"Next"})]})]})},be=`
  .locations-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .location-item {
    display: flex;
    flex-direction: column;
    padding: 8px;
    background-color: #f8f9fa;
    border-radius: 4px;
    width: fit-content;

  }

  .location-details {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 4px;
  }

  .warehouse-name {
    font-weight: 500;
    color: #495057;
  }

  .warehouse-address {
    color: #6c757d;
    font-size: 0.9em;
    font-style: italic;
  }

  .quantity-badge {
    background-color: #e9ecef;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 0.85em;
    color: #495057;
  }

`,me=document.createElement("style");me.innerText=be;document.head.appendChild(me);const Se=()=>{const{showError:m,showSuccess:_}=ge(),[w,L]=a.useState([]),[D,g]=a.useState(!0),[b,S]=a.useState(""),[N,f]=a.useState(null),[C,p]=a.useState(null),[v,o]=a.useState([]),[n,d]=a.useState(1),[A]=a.useState(10);fe();const W=async()=>{var s,c,j,i;g(!0);try{const u=await ne.get("https://backend-log2.axleshift.com/api/v1/shipment");if(u.status===200){const I=u.data.shipments||[];L(I),f(null)}}catch(u){f(((c=(s=u==null?void 0:u.response)==null?void 0:s.data)==null?void 0:c.message)||"Error fetching data"),m(((i=(j=u==null?void 0:u.response)==null?void 0:j.data)==null?void 0:i.message)||"Error fetching data")}finally{g(!1)}};a.useEffect(()=>{W()},[]),a.useEffect(()=>{(async()=>{var c,j;try{const i=await ae.get("/api/v1/warehouseLoc/locations");i.data.data&&o(i.data.data)}catch(i){p((c=i==null?void 0:i.response)==null?void 0:c.data.message),m(((j=i==null?void 0:i.response)==null?void 0:j.data.message)||"Error fetching warehouses")}})()},[]);const k=s=>{if(!v.length)return"Loading...";const c=v.find(j=>j._id===s);return c?e.jsx(H,{color:"success",children:c.warehouseName}):e.jsx(H,{color:"danger",children:"Not Yet Assigned"})},t=Array.isArray(w)?w.filter(s=>{var j,i,u,I,P;const c=b.toLowerCase();return((j=s==null?void 0:s.tracking_id)==null?void 0:j.toLowerCase().includes(c))||((u=(i=s==null?void 0:s.shipper)==null?void 0:i.shipper_company_name)==null?void 0:u.toLowerCase().includes(c))||((I=s==null?void 0:s.dispatch)==null?void 0:I.toLowerCase().includes(c))||((P=s==null?void 0:s.warehouse_id)==null?void 0:P.toString().includes(c))}):[],x=n*A,l=x-A,y=t.slice(l,x),r=Math.ceil(t.length/A),h=s=>{switch(s==null?void 0:s.toLowerCase()){case"pending":return"warning";case"completed":return"success";case"cancelled":return"danger";default:return"info"}};return D?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"60vh"},children:e.jsx(U,{color:"primary"})}):e.jsxs("div",{className:"container-fluid",children:[e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"row align-items-center",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs(z,{className:"mb-2 mt-2",children:[e.jsx(Y,{type:"text",id:"searchInput",placeholder:"Search by tracking ID, shipper, status, warehouse...",value:b,onChange:s=>S(s.target.value)}),e.jsx(J,{children:e.jsx(G,{icon:pe})})]})}),e.jsx("div",{className:"col-md-6",children:e.jsx("div",{className:"text-end",children:e.jsxs("span",{className:"text-muted",children:["Total Records:"," ",t.filter(s=>s.isInWarehouse&&s.dispatch!=="Completed").length]})})})]})}),t.length>0?e.jsxs(e.Fragment,{children:[e.jsx(ie,{flush:!0,children:y.filter(s=>s.isInWarehouse&&s.dispatch!=="Completed").map(s=>{var c,j,i,u,I,P,M,R,Q;return e.jsxs(le,{children:[e.jsx(oe,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center w-100",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Tracking ID:"})," ",s.tracking_id]}),e.jsxs("div",{className:"d-flex gap-3 me-3",children:[k(s.warehouse_id),e.jsx(H,{color:h(s.dispatch),children:s.dispatch||"N/A"})]})]})}),e.jsxs(de,{children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("h6",{className:"mb-3",children:"Shipper Details"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Company:"})," ",((c=s.shipper)==null?void 0:c.shipper_company_name)||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," ",((j=s.shipper)==null?void 0:j.shipper_company_address)||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Contact:"})," ",((i=s.shipper)==null?void 0:i.shipper_contact_name)||"N/A"]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("h6",{className:"mb-3",children:"Consignee Details"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Company:"})," ",((u=s.consignee)==null?void 0:u.consignee_company_name)||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," ",((I=s.consignee)==null?void 0:I.consignee_company_address)||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Contact:"})," ",((P=s.consignee)==null?void 0:P.consignee_contact_name)||"N/A"]})]})]}),e.jsx("div",{className:"row mt-3",children:e.jsxs("div",{className:"col-md-6",children:[e.jsx("h6",{className:"mb-3",children:"Vehicle Details"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Vehicle:"})," ",(M=s.vehicle)!=null&&M.name&&((R=s.vehicle)!=null&&R.plate_no)?`${s.vehicle.name} (${s.vehicle.plate_no})`:"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Driver:"})," ",((Q=s.vehicle)==null?void 0:Q.driver_name)||"N/A"]})]})})]})]},s.tracking_id||Math.random())})}),r>1&&e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-3",children:[e.jsx("div",{children:e.jsxs("span",{className:"text-muted",children:["Showing ",l+1," to"," ",Math.min(x,t.filter(s=>s.isInWarehouse&&s.dispatch!=="Completed").length)," ","of"," ",t.filter(s=>s.isInWarehouse&&s.dispatch!=="Completed").length," ","entries"]})}),e.jsxs(X,{"aria-label":"Page navigation",children:[e.jsx(E,{"aria-label":"Previous",disabled:n===1,onClick:()=>d(n-1),children:e.jsx("span",{"aria-hidden":"true",children:"Previous"})}),[...Array(r)].map((s,c)=>e.jsx(E,{active:n===c+1,onClick:()=>d(c+1),children:c+1},c+1)),e.jsx(E,{"aria-label":"Next",disabled:n===r,onClick:()=>d(n+1),children:e.jsx("span",{"aria-hidden":"true",children:"Next"})})]})]})]}):e.jsx(T,{color:"info",className:"text-center p-4",children:"No shipment records found"})]})},Ue=()=>{const[m,_]=a.useState([]),[w,L]=a.useState([]),[D,g]=a.useState(!1),[b,S]=a.useState(null),[N,f]=a.useState(0);a.useEffect(()=>{(async()=>{g(!0);try{const n=await ne.get("https://backend-log2.axleshift.com/api/v1/purchaseOrder");n.status===200&&_(n.data)}catch(n){S(n.message)}finally{g(!1)}})()},[N]);const C=()=>{f(o=>o+1)},p=o=>{_(n=>n.filter(d=>d._id!==o)),L(n=>n.filter(d=>d._id!==o)),C()},v=o=>{_(n=>n.map(d=>d._id===o._id?o:d)),L(n=>n.map(d=>d._id===o._id?o:d)),C()};return e.jsx(e.Fragment,{children:e.jsxs(Ne,{activeItemKey:"Warehouse Items Details",children:[e.jsxs(ye,{variant:"tabs",children:[e.jsx($,{itemKey:"Warehouse Items Details",children:"Warehouse Items Details"}),e.jsx($,{itemKey:"For Receiving",children:"For Receiving"}),e.jsx($,{itemKey:"Shipment",children:"Warehouse Shipment Items"})]}),e.jsxs(Ce,{children:[e.jsx(V,{className:"p-3",itemKey:"Warehouse Items Details",children:e.jsx(ve,{warehousing:m,loading:D,error:b,onDeleteItem:p,onUpdateItem:v,onRefresh:C})}),e.jsx(V,{className:"p-3",itemKey:"Items",children:e.jsxs(te,{children:[e.jsx(re,{children:"Items"}),e.jsx(we,{items:w,loading:D,error:b})]})}),e.jsx(V,{className:"p-3",itemKey:"Shipment",children:e.jsxs(te,{children:[e.jsx(re,{children:"Shipment"}),e.jsx(Se,{})]})})]})]})})};export{Ue as default};
