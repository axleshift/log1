import{r as o,_ as se,R as ae,a as te,c as re,P as _,j as e,k as V,m as H,l as oe}from"./index-Cc-aJQDw.js";import{F as B,d as ne,e as le,a as ie,g as ce}from"./index-3CAUoC7a.js";import{C as de,a as q}from"./1-BEtrZC9p.js";import{C as me,a as ue,b as he,c as pe,d as fe}from"./CModalTitle-C_0Lcqlz.js";import{C as M}from"./CAlert-Bqq-CPOi.js";import{C as xe}from"./CForm-DQDeyZKm.js";import{C as A,a as je}from"./CFormInput-s-0o6BnU.js";import{C as Ce}from"./CFormSelect-D6UjzW92.js";import{a as f}from"./CButton-CBiNuK6-.js";import{C as F}from"./CContainer-D-9r2DL9.js";import{C as ve}from"./CInputGroup-QE7o7Iar.js";import{C as ge}from"./CInputGroupText-Bk-FLxLX.js";import{C as we}from"./CCard-Do6IOp3C.js";import{C as be}from"./CCardHeader-C7NLDeGc.js";import{C as ye}from"./CCardBody-Wl5G9IdW.js";import{C as Ne,a as Se,b as Q,c as S,d as Pe,e as P}from"./CTable-Drxq7RLw.js";import{C as Ae,a as z}from"./CPaginationItem-7t9Y70fJ.js";var G=o.forwardRef(function(a,y){var l,x=a.children,t=a.className,d=a.size,j=a.vertical,h=se(a,["children","className","size","vertical"]);return ae.createElement("div",te({className:re(j?"btn-group-vertical":"btn-group",(l={},l["btn-group-".concat(d)]=d,l),t)},h,{ref:y}),x)});G.propTypes={children:_.node,className:_.string,size:_.oneOf(["sm","lg"]),vertical:_.bool};G.displayName="CButtonGroup";const Ee=({user:a,visible:y,onClose:l,onUpdate:x})=>{const[t,d]=o.useState({username:"",email:"",password:"",confirmPassword:"",role:"",photo:""}),[j,h]=o.useState(!1),[C,v]=o.useState(null),[g,R]=o.useState(null),[E,m]=o.useState(null),U="http://localhost:5057/";o.useEffect(()=>{if(a)if(d({username:a.username||"",email:a.email||"",password:"",confirmPassword:"",role:a.role||"",photo:null}),a.photo){const i=a.photo.startsWith("http")?a.photo:`${U}uploads/profiles/${a.photo}`;m(i)}else m(null)},[a,U]);const L=async i=>{var u,c;i.preventDefault(),h(!0),v(null);try{if((t.password||t.confirmPassword)&&t.password!==t.confirmPassword)throw new Error("Passwords do not match");if(!a||!a._id){console.error("No user ID available");return}const n=new FormData;n.append("username",t.username),n.append("email",t.email),n.append("role",t.role),t.password&&n.append("password",t.password),t.photo&&n.append("photo",t.photo);const N=await H.put(`api/v1/user/update-user/${a._id}`,n);N.data.success&&(R("User updated successfully"),x(N.data.data),setTimeout(()=>{l()},2e3))}catch(n){console.error("Error updating user:",n),v(((c=(u=n.response)==null?void 0:u.data)==null?void 0:c.message)||n.message||"Failed to update user")}finally{h(!1)}},w=i=>{const{id:u,value:c}=i.target;d(n=>({...n,[u]:c}))},k=i=>{const u=i.target.files[0];if(u){d(n=>({...n,photo:u}));const c=new FileReader;c.onloadend=()=>{m(c.result)},c.readAsDataURL(u)}};return e.jsxs(me,{visible:y,onClose:l,children:[e.jsx(ue,{children:e.jsxs(he,{children:["Edit User: ",a==null?void 0:a.username]})}),e.jsxs(pe,{children:[C&&e.jsx(M,{color:"danger",children:C}),g&&e.jsx(M,{color:"success",children:g}),e.jsxs(xe,{onSubmit:L,children:[e.jsx(A,{id:"username",value:t.username,onChange:w,className:"mb-3",placeholder:"Enter username",autoComplete:"off",floatingLabel:"Username",required:!0}),e.jsx(A,{type:"email",id:"email",value:t.email,onChange:w,className:"mb-3",placeholder:"Enter email",autoComplete:"off",floatingLabel:"Email",required:!0}),e.jsx(je,{htmlFor:"password",children:"New Password (leave blank to keep current)"}),e.jsx(A,{type:"password",id:"password",value:t.password,onChange:w,className:"mb-3",autoComplete:"off",placeholder:"New Password",floatingLabel:"New Password"}),e.jsx(A,{type:"password",id:"confirmPassword",value:t.confirmPassword,onChange:w,className:"mb-3",autoComplete:"off",placeholder:"Confirm Password",floatingLabel:"Confirm Password"}),e.jsxs(Ce,{id:"role",label:"Role",value:t.role,onChange:w,className:"mb-3",required:!0,children:[e.jsx("option",{value:"",children:"Select Role"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"manager",children:"Manager"}),e.jsx("option",{value:"inspector",children:"Inspector"}),e.jsx("option",{value:"driver",children:"Driver"})]}),e.jsx(A,{type:"file",id:"photo",label:"Profile Photo",onChange:k,accept:"image/*",className:"mb-3"}),E&&e.jsx("div",{className:"mb-3",children:e.jsx(de,{src:E||q,alt:"Preview",align:"center",rounded:!0,width:200,height:200,crossOrigin:"anonymous",onError:i=>{i.target.onerror=null,i.target.src=q}})})]})]}),e.jsxs(fe,{children:[e.jsx(f,{color:"secondary",onClick:l,children:"Cancel"}),e.jsx(f,{color:"primary",onClick:L,disabled:j,children:j?e.jsx(V,{size:"sm"}):"Save Changes"})]})]})},Qe=({onUpdateUser:a})=>{const y=oe(),[l,x]=o.useState([]),[t,d]=o.useState(!0),[j,h]=o.useState([]),[C,v]=o.useState(1),[g,R]=o.useState(""),[E,m]=o.useState(null),[U,L]=o.useState(null),[w,k]=o.useState(!1),[i,u]=o.useState(null),[c,n]=o.useState("all"),N=10,W=s=>{switch(c){case"active":return s.filter(r=>r.isActive);case"inactive":return s.filter(r=>!r.isActive);default:return s}},J=async()=>{d(!0);try{const r=(await H.get("api/v1/user/all-user")).data.data;x(r),h(r)}catch(s){console.error("Error fetching users:",s),m("Error fetching users")}finally{d(!1)}};o.useEffect(()=>{J()},[]),o.useEffect(()=>{if(g==="")h(l);else{const s=l.filter(r=>{const p=g.toLowerCase(),b=r.isActive?"active":"inactive",T=r.isActive?"deactivate":"activate";return r.username.toLowerCase().includes(p)||r.email.toLowerCase().includes(p)||r.role.toLowerCase().includes(p)||b.includes(p)||T.includes(p)||r.createdAt.toLowerCase().includes(p)});h(s),v(1),s.length===0?m("No matching users found"):m(null)}},[g,l]);const K=async s=>{var r,p;d(!0);try{const b=await H.post(`api/v1/user/in-active-user/${s}`);if(b.data.success){const T=l.map(I=>I._id===s?{...I,isActive:!I.isActive}:I);x(T),h(T),L(b.data.message)}else m(b.data.message);setTimeout(()=>{L(null),m(null)},3e3)}catch(b){m(((p=(r=b.response)==null?void 0:r.data)==null?void 0:p.message)||"Failed to update user status"),setTimeout(()=>m(null),3e3)}finally{d(!1)}},X=s=>{u(s),k(!0)},Y=s=>{x(l.map(r=>r._id===s._id?s:r)),h(j.map(r=>r._id===s._id?s:r))};if(t)return e.jsx(V,{className:"m-5 d-flex justify-content-center"});const O=W(j),$=C*N,Z=$-N,ee=O.slice(Z,$),D=Math.ceil(O.length/N);return e.jsx(e.Fragment,{children:e.jsxs(F,{className:" justify-content-center align-items-center",children:[e.jsx(F,{className:"m-3 d-flex justify-content-center align-items-center",children:e.jsx("h1",{children:"Accounts"})}),e.jsxs(F,{className:"m-3 d-flex justify-content-between",children:[e.jsx(f,{color:"primary",className:"m-3 ",disabled:t,onClick:()=>y("/dashboard"),children:t?"Loading...":e.jsx(B,{icon:ne})}),e.jsx(f,{color:"primary",className:"m-3",onClick:()=>y("/register"),children:"Add User"})]}),e.jsxs(F,{className:"m-3",children:[E&&e.jsx(M,{color:"danger",className:"mb-3",children:E}),U&&e.jsx(M,{color:"success",className:"mb-3",children:U}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs(ve,{className:"w-50",children:[e.jsx(A,{type:"text",value:g,id:"search",onChange:s=>R(s.target.value),placeholder:"Search users..."}),e.jsx(ge,{children:e.jsx(B,{icon:le})})]}),e.jsxs(G,{children:[e.jsx(f,{color:c==="all"?"primary":"secondary",onClick:()=>n("all"),children:"All"}),e.jsx(f,{color:c==="active"?"primary":"secondary",onClick:()=>n("active"),children:"Active"}),e.jsx(f,{color:c==="inactive"?"primary":"secondary",onClick:()=>n("inactive"),children:"Inactive"})]})]}),e.jsx("div",{className:"text-muted small mb-3",children:"Search by: username, email, role, status (active/inactive), or action (activate/deactivate)"}),e.jsxs(we,{children:[e.jsx(be,{children:e.jsx("h4",{children:"User List"})}),e.jsxs(ye,{children:[e.jsxs(Ne,{hover:!0,responsive:!0,className:"text-center",children:[e.jsx(Se,{children:e.jsxs(Q,{children:[e.jsx(S,{children:"Username"}),e.jsx(S,{children:"Email"}),e.jsx(S,{children:"Role"}),e.jsx(S,{children:"Created Date"}),e.jsx(S,{children:"Status"}),e.jsx(S,{children:"Actions"})]})}),e.jsx(Pe,{children:ee.map(s=>e.jsxs(Q,{children:[e.jsx(P,{children:s.username}),e.jsx(P,{children:s.email}),e.jsx(P,{children:s.role}),e.jsx(P,{children:s.createdAt.slice(0,10)}),e.jsx(P,{children:e.jsx(ie,{color:s.isActive?"success":"danger",children:s.isActive?"Active":"Inactive"})}),e.jsx(P,{children:e.jsxs(F,{className:" d-flex justify-content-center align-items-center",children:[e.jsx(f,{variant:"outline",className:"me-2",color:s.isActive?"danger":"success",onClick:()=>K(s._id),children:s.isActive?"Deactivate":"Activate"}),e.jsx(f,{variant:"outline",className:"me-2",color:"primary",onClick:()=>X(s),children:e.jsx(B,{icon:ce})})]})})]},s._id))})]}),i&&e.jsx(Ee,{user:i,visible:w,onClose:()=>{k(!1),u(null)},onUpdate:Y}),e.jsxs(Ae,{align:"center",children:[e.jsx(z,{disabled:C===1,onClick:()=>v(s=>Math.max(s-1,1)),children:"Previous"}),[...Array(D).keys()].map(s=>e.jsx(z,{active:s+1===C,onClick:()=>v(s+1),children:s+1},s+1)),e.jsx(z,{disabled:C===D,onClick:()=>v(s=>Math.min(s+1,D)),children:"Next"})]})]})]})]})]})})};export{Qe as default};
