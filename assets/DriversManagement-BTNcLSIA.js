import{l as q,r as a,j as e,k as E,n as _,A as $}from"./index-CFcIk_Fu.js";import{s as J,F,t as K,v as W,m as X,u as Z}from"./index-BhdsVw06.js";import{a as B}from"./CButton-C8dgaMHW.js";import{C as z,a as O,b as H,c as U}from"./CModalHeader-DorSD4ML.js";import{C as G}from"./CModalTitle-BHr3EPmu.js";import{C as T}from"./CAlert-t3ONy55x.js";import{C as Q}from"./CForm-Dj9t_ZOA.js";import{C}from"./CFormInput-oH-iUcHm.js";import{C as P}from"./CFormSelect-B4qaXM9Q.js";import{C as k}from"./CContainer-sKY5HQig.js";import{C as ee}from"./CInputGroup-Chlf8IK4.js";import{C as se}from"./CInputGroupText-D00CmJ70.js";import{C as ae,a as le,b as te,c as ne}from"./CAccordionHeader-D4c08nk2.js";import{C as w}from"./DefaultLayout-CwiDqjRK.js";import{C as re,a as R}from"./CPaginationItem-KZLfLiIk.js";import{C as oe}from"./CCard-BpOZLiSx.js";import{C as ie}from"./CCardBody-C2OLpo3l.js";import"./index.esm-2iDepAxB.js";import"./1-D4ML5F7P.js";import"./cil-user-Ddrdy7PS.js";const ce=({onAddDriver:i})=>{const{showSuccess:V,showError:y}=q(),[m,g]=a.useState(!1),[p,N]=a.useState(null),[L,c]=a.useState(null),[I,o]=a.useState(!1),[A,x]=a.useState([]),[j,h]=a.useState(!1),S={idNum:Math.floor(Math.random()*1e6).toString(),driverName:"",email:"",phone:"",address:"",licenseNumber:"",licenseRestriction:"",status:"available",assignedVehicle:""},[t,d]=a.useState(S),n=r=>{const{id:l,value:f}=r.target;d(v=>({...v,[l]:f}))},b=async()=>{try{const r=await _.get("api/v1/vehicle/available");x(r.data.data)}catch(r){console.error("Error fetching vehicles:",r)}};a.useEffect(()=>{b()},[]);const s=async r=>{r.currentTarget.checkValidity()===!1&&(r.preDefault(),r.stopPropagation()),h(!0),{...t},g(!0);try{const f=await _.post("api/v1/driver",t);f.status===201&&(V(f.data.message),i(f.data.data),setTimeout(()=>{d(S),h(!1),o(!1),g(!1)},2e3))}catch(f){c(f.response.data.message),y(f.response.data.message),setTimeout(()=>{c(null)},3e3)}finally{g(!1)}},u=[{value:"A",label:"A"},{value:"A1",label:"A1"},{value:"B",label:"B"},{value:"B1",label:"B1"},{value:"B2",label:"B2"},{value:"C",label:"C"},{value:"D",label:"D"},{value:"E",label:"E"},{value:"BE",label:"BE"}],D=({icon:r})=>{const[l,f]=a.useState(!1);return e.jsx(F,{icon:r,bounce:l,onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1)})};return e.jsx(e.Fragment,{children:m?e.jsx(E,{color:"primary",size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsxs(B,{color:"primary",disabled:m,variant:"outline",onClick:()=>o(!0),children:[m?e.jsx(E,{color:"primary",size:"sm"}):e.jsx(D,{icon:J})," Add Driver"]}),e.jsxs(z,{visible:I,onClose:()=>o(!1),children:[e.jsx(O,{children:e.jsx(G,{children:"Add Driver"})}),L&&e.jsx(T,{color:"danger",className:"m-3",children:L}),p&&e.jsx(T,{color:"success",className:"m-3",children:p}),e.jsx(H,{children:e.jsxs(Q,{noValidate:!0,validated:j,children:[e.jsx(C,{className:"mb-3",floatingLabel:"ID Number",placeholder:"ID Number",type:"text",id:"idNum",label:"ID Number",value:t.idNum,disabled:!0}),e.jsx(C,{className:"mb-3",floatingLabel:"Name",placeholder:"Name",type:"text",id:"driverName",label:"Name",autoComplete:"off",required:!0,value:t.driverName,onChange:n}),e.jsx(C,{className:"mb-3",floatingLabel:"email",placeholder:"Model",type:"email",id:"email",label:"Email",autoComplete:"off",required:!0,value:t.email,onChange:n}),e.jsx(C,{type:"phone",className:"mb-3",floatingLabel:"phone",placeholder:"phone",id:"phone",label:"Phone",title:"Please enter a valid phone number",autoComplete:"off",value:t.phone,required:!0,onChange:n}),e.jsx(C,{className:"mb-3",floatingLabel:"Address",placeholder:"Address",type:"text",id:"address",label:"Address",autoComplete:"off",required:!0,value:t.address,onChange:n}),e.jsx(C,{className:"mb-3",floatingLabel:"License Number",placeholder:"License Number",type:"text",id:"licenseNumber",label:"License Number",autoComplete:"off",required:!0,value:t.licenseNumber,onChange:n}),e.jsxs(P,{className:"mb-3",floatingLabel:"License Type",label:"License Type",id:"licenseRestriction",required:!0,value:t.licenseRestriction,onChange:n,children:[e.jsx("option",{value:null,children:"Select License Type"}),u.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))]}),e.jsxs(P,{className:"mb-3",floatingLabel:"Vehicle",label:"Vehicle",id:"assignedVehicle",required:!0,value:t.assignedVehicle,onChange:n,children:[e.jsx("option",{value:null,children:"Select Vehicle"}),A.map(r=>e.jsxs("option",{value:r._id,children:[r.brand," /",r.model," /",r.regisNumber]},r._id))]})]})}),e.jsxs(U,{children:[e.jsx(B,{color:"secondary",variant:"outline",disabled:m,onClick:()=>{o(!1),d(S),c(null),h(!1)},children:m?e.jsx(E,{color:"secondary",size:"sm"}):"Cancel"}),e.jsx(B,{color:"primary",variant:"outline",onClick:s,disabled:m,children:m?e.jsx(E,{color:"primary",size:"sm"}):"Add Driver"})]})]})]})})},de=({driver:i,onUpdateDriver:V})=>{const{showSuccess:y,showError:m}=q(),[g,p]=a.useState(!1),[N,L]=a.useState(null),[c,I]=a.useState([]),[o,A]=a.useState(!1),[x,j]=a.useState(null),[h,M]=a.useState(!1),S={idNum:i.idNum,driverName:i.driverName,email:i.email,phone:i.phone,address:i.address,licenseNumber:i.licenseNumber,licenseRestriction:i.licenseRestriction,status:i.status,assignedVehicle:i.assignedVehicle},[t,d]=a.useState(S),n=l=>{const{id:f,value:v}=l.target;d(Y=>({...Y,[f]:v}))},b=async()=>{try{const l=await _.get("api/v1/vehicle/available");I(l.data.data)}catch(l){m(l.message)}};a.useEffect(()=>{b()},[]);const s=async l=>{l.preventDefault(),l.currentTarget.checkValidity()===!1&&l.stopPropagation(),A(!0),M(!0),{...t};try{const v=await _.put(`/api/v1/driver/${i._id}`,t);v.data.success&&(y(v.data.message),V(v.data.data),setTimeout(()=>{p(!1),d(S)},2e3))}catch(v){j(v.response.data.message),m(v.response.data.message),setTimeout(()=>{j(null)},2e3)}finally{M(!1)}},u=[{value:"A",label:"A"},{value:"A1",label:"A1"},{value:"B",label:"B"},{value:"B1",label:"B1"},{value:"B2",label:"B2"},{value:"C",label:"C"},{value:"D",label:"D"},{value:"E",label:"E"},{value:"BE",label:"BE"}],D=[{value:"available",label:"Available"},{value:"on_duty",label:"On Duty"},{value:"off_duty",label:"Off Duty"}],r=({icon:l})=>{const[f,v]=a.useState(!1);return e.jsx(F,{icon:l,bounce:f,onMouseEnter:()=>v(!0),onMouseLeave:()=>v(!1)})};return e.jsxs(e.Fragment,{children:[e.jsxs(B,{color:"primary",variant:"outline",disabled:h,onClick:()=>p(!0),className:"me-2",children:[h?e.jsx(E,{size:"sm"}):e.jsx(r,{icon:K})," Update"]}),e.jsxs(z,{visible:g,onClose:()=>p(!1),children:[e.jsx(O,{children:e.jsx(G,{children:"Update Driver"})}),x&&e.jsx(T,{color:"danger",className:"m-3",children:x}),N&&e.jsx(T,{color:"success",className:"m-3",children:N}),e.jsx(H,{children:e.jsx(Q,{noValidate:!0,validated:o,children:e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"mb-3",floatingLabel:"ID Number",placeholder:"ID Number",type:"text",id:"idNum",label:"ID Number",value:t.idNum,disabled:!0}),e.jsx(C,{className:"mb-3",floatingLabel:"Name",placeholder:"Name",type:"text",id:"driverName",label:"Name",autoComplete:"off",required:!0,value:t.driverName,onChange:n}),e.jsx(C,{className:"mb-3",floatingLabel:"email",placeholder:"Model",type:"email",id:"email",label:"Email",autoComplete:"off",required:!0,value:t.email,onChange:n}),e.jsx(C,{type:"phone",className:"mb-3",floatingLabel:"phone",placeholder:"phone",id:"phone",label:"Phone",title:"Please enter a valid phone number",autoComplete:"off",value:t.phone,required:!0,onChange:n}),e.jsx(C,{className:"mb-3",floatingLabel:"Address",placeholder:"Address",type:"text",id:"address",label:"Address",autoComplete:"off",required:!0,value:t.address,onChange:n}),e.jsx(C,{className:"mb-3",floatingLabel:"License Number",placeholder:"License Number",type:"text",id:"licenseNumber",label:"License Number",autoComplete:"off",required:!0,value:t.licenseNumber,onChange:n}),e.jsxs(P,{className:"mb-3",floatingLabel:"License Type",label:"License Type",id:"licenseRestriction",required:!0,value:t.licenseRestriction,onChange:n,children:[e.jsx("option",{value:null,children:"Select License Type"}),u.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))]}),e.jsx(P,{className:"mb-3",floatingLabel:"Status",placeholder:"Status",id:"status",label:"Status",autoComplete:"off",required:!0,value:t.status||"",onChange:n,children:D.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))}),t.status==="available"||t.status==="on_duty"&&e.jsxs(P,{className:"mb-3",floatingLabel:"Assigned Vehicle",label:"Assigned Vehicle",id:"assignedVehicle",value:t.assignedVehicle||"",onChange:n,children:[e.jsx("option",{value:"",children:"Select a vehicle"}),c.map(l=>e.jsxs("option",{value:l._id,children:[l.brand," / ",l.model," / ",l.regisNumber]},l._id))]})]})})}),e.jsxs(U,{children:[e.jsx(B,{color:"secondary",variant:"outline",disabled:h,onClick:()=>{p(!1),j(null),A(!1)},children:h?e.jsx(E,{color:"secondary",size:"sm"}):"Close"}),e.jsx(B,{color:"success",variant:"outline",disabled:h,onClick:s,children:h?e.jsx(E,{color:"success",size:"sm"}):"Save Changes"})]})]})]})},ue=({driver:i,onDeleteDriver:V})=>{const[y,m]=a.useState(!1),[g,p]=a.useState(null),{showError:N,showSuccess:L}=q(),c=async()=>{m(!0);try{const o=await _.delete(`api/v1/driver/${i._id}`);o.status===200&&(L(o.data.message),V(i._id),m(!1),p(null))}catch(o){p(o),N(o.response.data.message)}finally{m(!1)}},I=({icon:o})=>{const[A,x]=a.useState(!1);return e.jsx(F,{icon:o,bounce:A,onMouseEnter:()=>x(!0),onMouseLeave:()=>x(!1)})};return e.jsx(e.Fragment,{children:e.jsxs(B,{color:"danger",variant:"outline",onClick:c,className:"me-2",disabled:y,children:[y?e.jsx(E,{size:"sm"}):e.jsx(I,{icon:W})," Delete"]})})},me=({driver:i,loading:V,onDeleteDriver:y,onUpdateDriver:m})=>{const g=$(),p=["manager","admin","super admin","fleet manager"],[N,L]=a.useState(null),[c,I]=a.useState(""),[o,A]=a.useState([]),[x,j]=a.useState(1),[h]=a.useState(10),M=x*h,S=M-h,t=o.slice(S,M),d=Math.ceil(o.length/h);a.useEffect(()=>{(async()=>{if(j(1),c==="")A(i);else{const u=i.filter(D=>D.driverName.toLowerCase().includes(c.toLowerCase())||D.idNum.toString().includes(c)||D.email.toLowerCase().includes(c.toLowerCase())||D.phone.toString().includes(c)||D.address.toLowerCase().includes(c.toLowerCase())||D.licenseNumber.toString().includes(c)||b.find(r=>r.value===D.status).label.toLowerCase().includes(c.toLowerCase()));A(u),u.length===0?L("No results found"):L(null)}})()},[c,i]);const n=s=>{switch(s){case"available":return"green";case"on_duty":return"red";case"off_duty":return"orange";default:return"black"}},b=[{label:"Available",value:"available"},{label:"On Duty",value:"on_duty"},{label:"Off Duty",value:"off_duty"}];return i.length===0?e.jsx(T,{color:"danger",className:"justfy-content-center",children:"No drivers found"}):e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"mt-3",children:e.jsxs(ee,{className:"w-50 mb-3 ",children:[e.jsx(C,{type:"text",placeholder:"Search Drivers...",id:"search",value:c,onChange:s=>I(s.target.value),className:"w-50 me-2 "}),e.jsx(se,{children:e.jsx(F,{icon:X})})]})}),e.jsx(ae,{className:"m-2",children:t.map(s=>e.jsxs(le,{children:[e.jsx(te,{children:e.jsxs("p",{className:"w-100 m-1",children:["Driver Name: ",e.jsxs("strong",{children:[" ",s.driverName," "]}),e.jsx(F,{icon:Z,color:n(s.status),className:"m-2 float-end"}),e.jsxs("small",{className:"m-2 float-end",children:[" ",b.find(u=>u.value===s.status).label]})]})}),e.jsxs(ne,{children:[e.jsxs(w,{children:["ID: ",s.idNum]}),e.jsxs(w,{children:["Email: ",s.email]}),e.jsxs(w,{children:["Phone: ",s.phone]}),e.jsxs(w,{children:["Address: ",s.address]}),e.jsxs(w,{children:["License Number: ",s.licenseNumber]}),e.jsxs(w,{children:["License Restriction: ",s.licenseRestriction||"No restriction"]}),e.jsxs(w,{children:["Vehicle:"," ",s.assignedVehicle?`${s.assignedVehicle.regisNumber} - ${s.assignedVehicle.brand} ${s.assignedVehicle.model}`:"No vehicle assigned"]}),e.jsxs(w,{children:["Status: ",b.find(u=>u.value===s.status).label]}),e.jsxs(k,{className:"d-flex justify-content-end mt-3",children:[V?e.jsx(E,{color:"primary",size:"sm"}):e.jsx(de,{driver:s,onUpdateDriver:m}),p.includes(g)&&e.jsx(ue,{driver:s,onDeleteDriver:y})]})]})]},s._id))}),o.length>0&&e.jsxs(k,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs(k,{children:["Showing ",S+1," to ",Math.min(M,o.length)," of"," ",o.length," entries"]}),e.jsxs(re,{className:"mt-3",children:[e.jsx(R,{disabled:x===1,onClick:()=>j(s=>Math.max(s-1,1)),children:"Previous"}),Array.from({length:d},(s,u)=>u+1).map(s=>e.jsx(R,{active:s===x,onClick:()=>j(s),children:s},s)),e.jsx(R,{disabled:x===d,onClick:()=>j(s=>Math.min(s+1,d)),children:"Next"})]})]}),N&&e.jsx(T,{color:"danger",className:"text-center justify-content-center",children:N})]})},Be=()=>{const i=$(),V=["super admin","admin","manager","fleet manager"],{showError:y}=q(),[m,g]=a.useState([]),[p,N]=a.useState(!1),[L,c]=a.useState(null),[I,o]=a.useState(!1),[A,x]=a.useState(null),j=async()=>{var d,n,b,s;N(!0);try{const u=await _.get("api/v1/driver");u.status===200?(g(u.data.data),N(!1)):(c(u.data.message),y(u.data.message))}catch(u){c(((n=(d=u.response)==null?void 0:d.data)==null?void 0:n.message)||u.message),y(((s=(b=u.response)==null?void 0:b.data)==null?void 0:s.message)||u.message)}finally{N(!1)}};a.useEffect(()=>{j()},[]);const h=d=>{g(n=>[...n,d]),j()},M=d=>{x(d),o(!0)},S=d=>{g(n=>n.filter(b=>b._id!==d))},t=d=>{g(n=>n.map(b=>b._id===d._id?d:b))};return p?e.jsx("div",{className:"text-center  ",children:e.jsx(E,{color:"primary",size:"sm"})}):e.jsx(e.Fragment,{children:i&&V.includes(i)?e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"text-center",children:"Driver Management"}),e.jsx(k,{className:"m-3",children:e.jsx(ce,{onAddDriver:h})}),e.jsxs(oe,{children:[e.jsx(w,{children:"Drivers list"}),e.jsx(ie,{className:"md-3",children:e.jsx(me,{driver:m,loading:p,error:L,onDeleteDriver:M,onUpdateDriver:t})})]}),e.jsxs(z,{visible:I,onClose:()=>o(!1),alignment:"center",children:[e.jsx(O,{closeButton:!0,children:"Confirm Delete"}),e.jsx(H,{children:"Are you sure you want to delete this driver? This action cannot be undone."}),e.jsxs(U,{children:[e.jsx(B,{color:"secondary",onClick:()=>o(!1),children:"Cancel"}),e.jsx(B,{color:"danger",onClick:S,children:"Delete"})]})]})]}):e.jsx(T,{color:"danger",className:"text-center w-100 mx-auto mt-5 justify-content-center",children:"You are not authorized to access this page."})})};export{Be as default};
