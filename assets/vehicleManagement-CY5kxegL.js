import{B as E,r as n,j as e,k as L,A as q,l as U,D as H}from"./index-BsAuDz7v.js";import{F as D,h as Q,i as J,j as K,k as O,l as W}from"./index-DdzPpfT1.js";import{a as k}from"./CButton-1aJwC6WA.js";import{C as Y,a as R,b as _,c as P,d as $}from"./CModalTitle-9RnGyc5_.js";import{a as w,C as z}from"./CForm-DJmgfv4a.js";import{C as p}from"./CFormInput-De0-5chn.js";import{C as I}from"./CFormSelect-C2W4ju5D.js";import{C as B}from"./CContainer-D4HQE-qk.js";import{C as X,a as Z}from"./CInputGroupText-scgwoFmL.js";import{C as ee,a as ae,b as se,c as le}from"./CAccordionHeader-C2ZL91sv.js";import{C as y}from"./DefaultLayout-DeL5tmJy.js";import{C as re}from"./CCard-BQgonU39.js";import{C as te}from"./CCardBody-D4BA6tNM.js";import"./index.esm-CMByg3QK.js";import"./1-DdutqShQ.js";import"./cil-user-Ddrdy7PS.js";const ne=({onAddVehicle:r})=>{const{showSuccess:j,showError:S}=E(),[C,g]=n.useState(!1),[f,u]=n.useState(!1),[T,m]=n.useState(null),[b,l]=n.useState(null),[s,i]=n.useState(!1),v={idNum:Math.floor(Math.random()*1e6).toString(),brand:"",model:"",year:"",regisNumber:"",type:"",capacity:"",fuelType:"",currentMileage:"",status:"available"},[o,a]=n.useState(v),c=x=>{const{id:h,value:d}=x.target;a(N=>({...N,[h]:d}))},t=[{label:"Van",value:"van"},{label:"Pickup Truck",value:"pickup"},{label:"Box Truck",value:"box"},{label:"Straight Truck",value:"straight"},{label:"Semi-Trailer Trucks",value:"semi"},{label:"Refrigerated Trucks",value:"refrigerated"},{label:"Tanker Trucks",value:"tanker"},{label:"Flatbed Trucks",value:"flatbed"}],M=[{label:"Diesel",value:"Diesel"},{label:"Gasoline",value:"Gasoline"}],A=async x=>{x.currentTarget.checkValidity()===!1&&(x.preDefault(),x.stopPropagation()),g(!0),i(!0);try{const d=await q.post("/api/v1/vehicle",o);d.data.success&&(j(d.data.message),r(d.data.data),setTimeout(()=>{a(v),i(!1),g(!1),u(!1)},2e3))}catch(d){m(d.response.data.message),S(d.response.data.message),setTimeout(()=>{m(null)},2e3)}i(!1)},F=new Date().getFullYear(),V=1990;return e.jsx(e.Fragment,{children:s?e.jsx(L,{color:"primary",size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsxs(k,{color:"primary",variant:"outline",onClick:()=>u(!0),children:[e.jsx(D,{icon:Q})," Add Vehicle"]}),e.jsxs(Y,{visible:f,onClose:()=>u(!1),children:[e.jsx(R,{closeButton:!0,children:e.jsx(_,{children:"Add Vehicle"})}),T&&e.jsx(w,{color:"danger",className:"m-3",children:T}),b&&e.jsx(w,{color:"success",className:"m-3",children:b}),e.jsx(P,{children:e.jsxs(z,{noValidate:!0,validated:C,children:[e.jsx(p,{className:"mb-3",floatingLabel:"ID Number",placeholder:"ID Number",type:"text",id:"idNum",label:"ID Number",value:o.idNum,disabled:!0}),e.jsx(p,{className:"mb-3",floatingLabel:"Brand",placeholder:"Brand",type:"text",id:"brand",label:"Brand",autoComplete:"off",required:!0,value:o.brand,onChange:c}),e.jsx(p,{className:"mb-3",floatingLabel:"Model",placeholder:"Model",type:"text",id:"model",label:"Model",autoComplete:"off",required:!0,value:o.model,onChange:c}),e.jsx(p,{type:"number",className:"mb-3",floatingLabel:"Year",placeholder:"Year",id:"year",value:o.year,required:!0,min:V,max:F,onChange:c,onBlur:x=>{const h=parseInt(x.target.value);h>=V&&h<=F&&!isNaN(h)||(alert(`Please enter a year between ${V} and ${F}`),a({...o,year:V}))}}),e.jsx(p,{className:"mb-3",floatingLabel:"Registration Number",placeholder:"Registration Number",type:"text",id:"regisNumber",label:"Registration Number",autoComplete:"off",required:!0,value:o.regisNumber,onChange:c}),e.jsx(I,{className:"mb-3",floatingLabel:"Vehicle Type",placeholder:"Vehicle Type",id:"type",value:o.type,required:!0,onChange:c,options:[{label:"Select Vehicle Type",value:""},...t]}),e.jsx(p,{className:"mb-2",type:"number",floatingLabel:"Capacity",placeholder:"Capacity",id:"capacity",label:"Capacity",autoComplete:"off",required:!0,min:"0",value:o.capacity,onChange:c}),e.jsx(I,{className:"mb-3",floatingLabel:"Fuel Type",placeholder:"Fuel Type",id:"fuelType",value:o.fuelType,required:!0,onChange:c,options:[{label:"Select Fuel Type",value:""},...M]}),e.jsx(p,{className:"mb-3",floatingLabel:"Current Mileage",placeholder:"Current Mileage",type:"number",id:"currentMileage",label:"Current Mileage",autoComplete:"off",required:!0,value:o.currentMileage,min:"0",max:"100000000000",onChange:c})]})}),e.jsxs($,{children:[e.jsx(k,{color:"secondary",variant:"outline",disabled:s,onClick:()=>{u(!1),a(v),g(!1),m(null)},children:s?e.jsx(L,{color:"secondary",size:"sm"}):"Cancel"}),e.jsx(k,{color:"primary",variant:"outline",disabled:s,onClick:A,children:s?e.jsx(L,{color:"primary",size:"sm"}):"Save"})]})]})]})})},ie=({vehicle:r,onDeleteVehicle:j})=>{const{showSuccess:S,showErrors:C}=E(),g=sessionStorage.getItem("accessToken"),u=U.create({baseURL:"http://localhost:5057",withCredentials:!0,headers:{"Content-Type":"application/json",...g&&{Authorization:`Bearer ${g}`}}}),[T,m]=n.useState(!1),[b,l]=n.useState(null),s=async()=>{m(!0);try{const i=await u.delete(`/api/v1/vehicle/${r._id}`);i.data.success&&(S(i.data.message),m(!1),j(r._id),m(!1),l(null))}catch(i){l(i),C(i.response.data.message)}finally{m(!1)}};return b?e.jsxs(w,{color:"danger",className:"text-center mt-5 w-75 mx-auto",children:["Error: ",b.message]}):e.jsx(e.Fragment,{children:e.jsx(k,{color:"danger",variant:"outline",disabled:T,onClick:s,className:"me-2",children:T?e.jsx(L,{size:"sm"}):e.jsx(D,{icon:J})})})},oe=({vehicle:r,onUpdateVehicle:j})=>{const{showSuccess:S,showError:C}=E(),[g,f]=n.useState(!1),[u,T]=n.useState(null),[m,b]=n.useState(null),[l,s]=n.useState(!1),[i,v]=n.useState(!1),o={idNum:r.idNum,brand:r.brand,model:r.model,year:r.year,regisNumber:r.regisNumber,type:r.type,capacity:r.capacity,fuelType:r.fuelType,currentMileage:r.currentMileage},[a,c]=n.useState(o),t=h=>{const{id:d,value:N}=h.target;c(G=>({...G,[d]:N}))},M=[{label:"Van",value:"van"},{label:"Pickup Truck",value:"pickup"},{label:"Box Truck",value:"box"},{label:"Straight Truck",value:"straight"},{label:"Semi-Trailer Trucks",value:"semi"},{label:"Refrigerated Trucks",value:"refrigerated"},{label:"Tanker Trucks",value:"tanker"},{label:"Flatbed Trucks",value:"flatbed"}],A=[{label:"Diesel",value:"Diesel"},{label:"Gasoline",value:"Gasoline"}],F=async h=>{s(!0),h.currentTarget.checkValidity()===!1&&h.stopPropagation(),v(!0);try{const N=await q.put(`/api/v1/vehicle/${r._id}`,a);N.data.success&&(S(N.data.message),j(N.data.data),setTimeout(()=>{s(!1),v(!1),f(!1)},2e3))}catch(N){C(N.response.data.message),b(N.response.data.message),setTimeout(()=>{b(null)},2e3)}finally{s(!1)}},V=new Date().getFullYear(),x=1990;return e.jsxs(e.Fragment,{children:[e.jsx(k,{color:"primary",variant:"outline",disabled:l,onClick:()=>f(!0),className:"me-2",children:l?e.jsx(L,{size:"sm"}):e.jsx(D,{icon:K})}),e.jsxs(Y,{visible:g,onClose:()=>f(!1),children:[e.jsx(R,{closeButton:!0,children:e.jsx(_,{children:"Update Vehicle"})}),m&&e.jsx(w,{color:"danger",className:"m-3",children:m}),u&&e.jsx(w,{color:"success",className:"m-3",children:u}),e.jsx(P,{children:e.jsxs(z,{noValidate:!0,validated:i,children:[e.jsx(p,{className:"mb-3",floatingLabel:"ID Number",placeholder:"ID Number",type:"text",id:"idNum",label:"ID Number",value:a.idNum,disabled:!0}),e.jsx(p,{className:"mb-3",floatingLabel:"Brand",placeholder:"Brand",type:"text",id:"brand",label:"Brand",required:!0,value:a.brand,onChange:t}),e.jsx(p,{className:"mb-3",floatingLabel:"Model",placeholder:"Model",type:"text",id:"model",label:"Model",required:!0,value:a.model,onChange:t}),e.jsx(p,{type:"number",className:"mb-3",floatingLabel:"Year",placeholder:"Year",id:"year",value:a.year,required:!0,min:x,max:V,onChange:t,onBlur:h=>{const d=parseInt(h.target.value);d>=x&&d<=V&&!isNaN(d)||(alert(`Please enter a year between ${x} and ${V}`),c({...a,year:x}))}}),e.jsx(p,{className:"mb-3",floatingLabel:"Registration Number",placeholder:"Registration Number",type:"text",id:"regisNumber",label:"Registration Number",required:!0,value:a.regisNumber,onChange:t}),e.jsx(I,{className:"mb-3",floatingLabel:"Vehicle Type",placeholder:"Vehicle Type",id:"type",value:a.type,required:!0,onChange:t,options:[{label:"Select Vehicle Type",value:""},...M]}),e.jsx(p,{className:"mb-2",type:"number",floatingLabel:"Capacity",placeholder:"Capacity",id:"capacity",label:"Capacity",required:!0,min:"0",value:a.capacity,onChange:t}),e.jsx(I,{className:"mb-3",floatingLabel:"Fuel Type",placeholder:"Fuel Type",id:"fuelType",label:"Fuel Type",value:a.fuelType,required:!0,onChange:t,options:[{label:"Select Fuel Type",value:""},...A]}),e.jsx(p,{className:"mb-3",floatingLabel:"Current Mileage",placeholder:"Current Mileage",type:"number",id:"currentMileage",label:"Current Mileage",required:!0,min:"0",max:"100000000000",value:a.currentMileage,onChange:t})]})}),e.jsxs($,{children:[e.jsx(k,{color:"secondary",variant:"outline",disabled:l,onClick:()=>{f(!1),b(null),c(r),v(!1)},children:l?e.jsx(L,{size:"sm",color:"secondary"}):"Cancel"}),e.jsx(k,{color:"success",variant:"outline",disabled:l,onClick:F,children:l?e.jsx(L,{size:"sm",color:"success"}):"Save Changes"})]})]})]})},ce=({vehicle:r,error:j,loading:S,onDeleteVehicle:C,onUpdateVehicle:g})=>{const[f,u]=n.useState([]),T=H(),m=["manager","admin"],[b,l]=n.useState(null),[s,i]=n.useState("");n.useEffect(()=>{u(r)},[r]),n.useEffect(()=>{(()=>{if(s==="")u(r);else{const c=r.filter(t=>t.idNum.toString().includes(s)||t.brand.toLowerCase().includes(s.toLowerCase())||t.model.toLowerCase().includes(s.toLowerCase())||t.year.toString().includes(s)||t.type.toLowerCase().includes(s.toLowerCase())||t.regisNumber.toLowerCase().includes(s.toLowerCase())||t.capacity.toString().includes(s)||o.find(M=>M.value===t.status).label.toLowerCase().includes(s.toLowerCase()));u(c),c.length===0?l("No vehicles found"):l(null)}})()},[s,r]);const v=a=>{switch(a){case"available":return"green";case"in_use":return"red";case"maintenance":return"orange";case"inspection":return"yellow";default:return"black"}},o=[{value:"available",label:"Available"},{value:"in_use",label:"In Use"},{value:"maintenance",label:"Maintenance"},{value:"inactive",label:"Inactive"},{value:"inspection",label:"Inspection"}];return r.length===0?e.jsx(w,{color:"danger",className:"text-center justify-content-center",children:"No vehicles found"}):e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"mt-3",children:e.jsxs(X,{className:"w-50 mb-3",children:[e.jsx(p,{type:"text",placeholder:"Search vehicles",id:"search",value:s,onChange:a=>i(a.target.value),className:"w-50 me-2 "}),e.jsx(Z,{children:e.jsx(D,{icon:O})})]})}),e.jsx(ee,{className:"m-2",children:f.map((a,c)=>e.jsxs(ae,{children:[e.jsx(se,{children:e.jsxs("p",{className:"w-100 m-1 ",children:["Registration Number:",e.jsx("strong",{className:"ms-2",children:a.regisNumber}),e.jsx(D,{icon:W,color:v(a.status),className:"m-2 float-end"}),e.jsx("small",{className:"m-2 float-end",children:o.find(t=>t.value===a.status).label})]})}),e.jsxs(le,{children:[e.jsxs(y,{children:["ID: ",a.idNum]}),e.jsxs(y,{children:["Brand: ",a.brand]}),e.jsxs(y,{children:["Model: ",a.model]}),e.jsxs(y,{children:["Year: ",a.year]}),e.jsxs(y,{children:["Type: ",a.type]}),e.jsxs(y,{children:["Capacity: ",a.capacity]}),e.jsxs(y,{children:["Status: ",o.find(t=>t.value===a.status).label]}),e.jsxs(y,{children:["Driver:"," ",a.assignedDriver?`${a.assignedDriver.driverName} - ${a.assignedDriver.licenseNumber}`:"Not assigned"]}),e.jsxs(y,{children:["Fuel Type: ",a.fuelType]}),e.jsxs(y,{children:["Current Mileage: ",a.currentMileage]}),e.jsxs(B,{className:"d-flex justify-content-end mt-3",children:[e.jsx(oe,{vehicle:a,onUpdateVehicle:g}),m.includes(T)&&e.jsx(ie,{vehicle:a,onDeleteVehicle:C})]})]})]},a._id||c))}),b&&e.jsx(w,{color:"danger",className:"text-center justify-content-center",children:b})]})},Ve=()=>{const[r,j]=n.useState([]),[S,C]=n.useState(!0),[g,f]=n.useState(null),u=async()=>{C(!0);try{const l=await q.get("/api/v1/vehicle");l.status===200?(j(l.data.data),C(!1)):f(l.data.message)}catch(l){f(l.message)}finally{C(!1)}};n.useEffect(()=>{u()},[]);const T=l=>{j(s=>[...s,l])},m=l=>{j(s=>s.filter(i=>i._id!==l))},b=l=>{j(s=>s.map(i=>i._id===l._id?l:i),u())};return e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"text-center",children:"Vehicle Management"}),e.jsx(B,{className:"m-3",children:e.jsx(ne,{onAddVehicle:T})}),e.jsxs(re,{children:[e.jsx(y,{children:"Vehicle List"}),e.jsx(te,{className:"md-3",children:e.jsx(ce,{vehicle:r,error:g,onDeleteVehicle:m,onUpdateVehicle:b,loading:S})})]})]})};export{Ve as default};
